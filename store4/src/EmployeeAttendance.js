// // // // // // // // // // // // // // // // // // // // import React, { useState } from "react";
// // // // // // // // // // // // // // // // // // // // import styled from "styled-components";

// // // // // // // // // // // // // // // // // // // // // Styled components for the form
// // // // // // // // // // // // // // // // // // // // const FormContainer = styled.div`
// // // // // // // // // // // // // // // // // // // //   max-width: 500px;
// // // // // // // // // // // // // // // // // // // //   margin: 2rem auto;
// // // // // // // // // // // // // // // // // // // //   padding: 2rem;
// // // // // // // // // // // // // // // // // // // //   background: #ffffff;
// // // // // // // // // // // // // // // // // // // //   border-radius: 10px;
// // // // // // // // // // // // // // // // // // // //   box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
// // // // // // // // // // // // // // // // // // // //   animation: fadeIn 0.5s ease-in-out;

// // // // // // // // // // // // // // // // // // // //   @keyframes fadeIn {
// // // // // // // // // // // // // // // // // // // //     from {
// // // // // // // // // // // // // // // // // // // //       opacity: 0;
// // // // // // // // // // // // // // // // // // // //       transform: translateY(-20px);
// // // // // // // // // // // // // // // // // // // //     }
// // // // // // // // // // // // // // // // // // // //     to {
// // // // // // // // // // // // // // // // // // // //       opacity: 1;
// // // // // // // // // // // // // // // // // // // //       transform: translateY(0);
// // // // // // // // // // // // // // // // // // // //     }
// // // // // // // // // // // // // // // // // // // //   }
// // // // // // // // // // // // // // // // // // // // `;

// // // // // // // // // // // // // // // // // // // // const FormTitle = styled.h2`
// // // // // // // // // // // // // // // // // // // //   font-size: 1.8rem;
// // // // // // // // // // // // // // // // // // // //   color: #333;
// // // // // // // // // // // // // // // // // // // //   text-align: center;
// // // // // // // // // // // // // // // // // // // //   margin-bottom: 1.5rem;
// // // // // // // // // // // // // // // // // // // //   font-weight: bold;
// // // // // // // // // // // // // // // // // // // // `;

// // // // // // // // // // // // // // // // // // // // const FormGroup = styled.div`
// // // // // // // // // // // // // // // // // // // //   margin-bottom: 1.5rem;
// // // // // // // // // // // // // // // // // // // // `;

// // // // // // // // // // // // // // // // // // // // const Label = styled.label`
// // // // // // // // // // // // // // // // // // // //   display: block;
// // // // // // // // // // // // // // // // // // // //   font-size: 1rem;
// // // // // // // // // // // // // // // // // // // //   color: #555;
// // // // // // // // // // // // // // // // // // // //   margin-bottom: 0.5rem;
// // // // // // // // // // // // // // // // // // // // `;

// // // // // // // // // // // // // // // // // // // // const Input = styled.input`
// // // // // // // // // // // // // // // // // // // //   width: 100%;
// // // // // // // // // // // // // // // // // // // //   padding: 0.8rem;
// // // // // // // // // // // // // // // // // // // //   font-size: 1rem;
// // // // // // // // // // // // // // // // // // // //   border: 1px solid #ddd;
// // // // // // // // // // // // // // // // // // // //   border-radius: 5px;
// // // // // // // // // // // // // // // // // // // //   outline: none;
// // // // // // // // // // // // // // // // // // // //   transition: border-color 0.3s ease;

// // // // // // // // // // // // // // // // // // // //   &:focus {
// // // // // // // // // // // // // // // // // // // //     border-color: #6a11cb;
// // // // // // // // // // // // // // // // // // // //   }
// // // // // // // // // // // // // // // // // // // // `;

// // // // // // // // // // // // // // // // // // // // const Select = styled.select`
// // // // // // // // // // // // // // // // // // // //   width: 100%;
// // // // // // // // // // // // // // // // // // // //   padding: 0.8rem;
// // // // // // // // // // // // // // // // // // // //   font-size: 1rem;
// // // // // // // // // // // // // // // // // // // //   border: 1px solid #ddd;
// // // // // // // // // // // // // // // // // // // //   border-radius: 5px;
// // // // // // // // // // // // // // // // // // // //   outline: none;
// // // // // // // // // // // // // // // // // // // //   transition: border-color 0.3s ease;

// // // // // // // // // // // // // // // // // // // //   &:focus {
// // // // // // // // // // // // // // // // // // // //     border-color: #6a11cb;
// // // // // // // // // // // // // // // // // // // //   }
// // // // // // // // // // // // // // // // // // // // `;

// // // // // // // // // // // // // // // // // // // // const Button = styled.button`
// // // // // // // // // // // // // // // // // // // //   width: 100%;
// // // // // // // // // // // // // // // // // // // //   padding: 0.8rem;
// // // // // // // // // // // // // // // // // // // //   font-size: 1rem;
// // // // // // // // // // // // // // // // // // // //   color: #fff;
// // // // // // // // // // // // // // // // // // // //   background: linear-gradient(135deg, #6a11cb, #2575fc);
// // // // // // // // // // // // // // // // // // // //   border: none;
// // // // // // // // // // // // // // // // // // // //   border-radius: 5px;
// // // // // // // // // // // // // // // // // // // //   cursor: pointer;
// // // // // // // // // // // // // // // // // // // //   transition: background 0.3s ease;

// // // // // // // // // // // // // // // // // // // //   &:hover {
// // // // // // // // // // // // // // // // // // // //     background: linear-gradient(135deg, #2575fc, #6a11cb);
// // // // // // // // // // // // // // // // // // // //   }

// // // // // // // // // // // // // // // // // // // //   &:disabled {
// // // // // // // // // // // // // // // // // // // //     background: #ccc;
// // // // // // // // // // // // // // // // // // // //     cursor: not-allowed;
// // // // // // // // // // // // // // // // // // // //   }
// // // // // // // // // // // // // // // // // // // // `;

// // // // // // // // // // // // // // // // // // // // const ErrorMessage = styled.p`
// // // // // // // // // // // // // // // // // // // //   color: #ff4d4f;
// // // // // // // // // // // // // // // // // // // //   font-size: 0.9rem;
// // // // // // // // // // // // // // // // // // // //   margin-top: 0.5rem;
// // // // // // // // // // // // // // // // // // // // `;

// // // // // // // // // // // // // // // // // // // // const SuccessMessage = styled.p`
// // // // // // // // // // // // // // // // // // // //   color: #4caf50;
// // // // // // // // // // // // // // // // // // // //   font-size: 1rem;
// // // // // // // // // // // // // // // // // // // //   text-align: center;
// // // // // // // // // // // // // // // // // // // //   margin-top: 1rem;
// // // // // // // // // // // // // // // // // // // // `;

// // // // // // // // // // // // // // // // // // // // const EmployeeAttendanceForm = () => {
// // // // // // // // // // // // // // // // // // // //   const [formData, setFormData] = useState({
// // // // // // // // // // // // // // // // // // // //     employeeId: "",
// // // // // // // // // // // // // // // // // // // //     employeeName: "",
// // // // // // // // // // // // // // // // // // // //     date: "",
// // // // // // // // // // // // // // // // // // // //     status: "",
// // // // // // // // // // // // // // // // // // // //   });

// // // // // // // // // // // // // // // // // // // //   const [errors, setErrors] = useState({});
// // // // // // // // // // // // // // // // // // // //   const [isSubmitted, setIsSubmitted] = useState(false);

// // // // // // // // // // // // // // // // // // // //   const handleChange = (e) => {
// // // // // // // // // // // // // // // // // // // //     const { name, value } = e.target;
// // // // // // // // // // // // // // // // // // // //     setFormData({
// // // // // // // // // // // // // // // // // // // //       ...formData,
// // // // // // // // // // // // // // // // // // // //       [name]: value,
// // // // // // // // // // // // // // // // // // // //     });
// // // // // // // // // // // // // // // // // // // //     // Clear errors when user starts typing
// // // // // // // // // // // // // // // // // // // //     setErrors({
// // // // // // // // // // // // // // // // // // // //       ...errors,
// // // // // // // // // // // // // // // // // // // //       [name]: "",
// // // // // // // // // // // // // // // // // // // //     });
// // // // // // // // // // // // // // // // // // // //   };

// // // // // // // // // // // // // // // // // // // //   const validateForm = () => {
// // // // // // // // // // // // // // // // // // // //     const newErrors = {};

// // // // // // // // // // // // // // // // // // // //     if (!formData.employeeId.trim()) {
// // // // // // // // // // // // // // // // // // // //       newErrors.employeeId = "Employee ID is required.";
// // // // // // // // // // // // // // // // // // // //     }
// // // // // // // // // // // // // // // // // // // //     if (!formData.employeeName.trim()) {
// // // // // // // // // // // // // // // // // // // //       newErrors.employeeName = "Employee Name is required.";
// // // // // // // // // // // // // // // // // // // //     }
// // // // // // // // // // // // // // // // // // // //     if (!formData.date) {
// // // // // // // // // // // // // // // // // // // //       newErrors.date = "Date is required.";
// // // // // // // // // // // // // // // // // // // //     }
// // // // // // // // // // // // // // // // // // // //     if (!formData.status) {
// // // // // // // // // // // // // // // // // // // //       newErrors.status = "Attendance status is required.";
// // // // // // // // // // // // // // // // // // // //     }

// // // // // // // // // // // // // // // // // // // //     setErrors(newErrors);
// // // // // // // // // // // // // // // // // // // //     return Object.keys(newErrors).length === 0;
// // // // // // // // // // // // // // // // // // // //   };

// // // // // // // // // // // // // // // // // // // //   const handleSubmit = (e) => {
// // // // // // // // // // // // // // // // // // // //     e.preventDefault();

// // // // // // // // // // // // // // // // // // // //     if (validateForm()) {
// // // // // // // // // // // // // // // // // // // //       // Simulate form submission (e.g., API call)
// // // // // // // // // // // // // // // // // // // //       console.log("Form Data Submitted:", formData);
// // // // // // // // // // // // // // // // // // // //       setIsSubmitted(true);
// // // // // // // // // // // // // // // // // // // //       setFormData({
// // // // // // // // // // // // // // // // // // // //         employeeId: "",
// // // // // // // // // // // // // // // // // // // //         employeeName: "",
// // // // // // // // // // // // // // // // // // // //         date: "",
// // // // // // // // // // // // // // // // // // // //         status: "",
// // // // // // // // // // // // // // // // // // // //       });
// // // // // // // // // // // // // // // // // // // //       setTimeout(() => setIsSubmitted(false), 3000); // Reset success message after 3 seconds
// // // // // // // // // // // // // // // // // // // //     }
// // // // // // // // // // // // // // // // // // // //   };

// // // // // // // // // // // // // // // // // // // //   return (
// // // // // // // // // // // // // // // // // // // //     <FormContainer>
// // // // // // // // // // // // // // // // // // // //       <FormTitle>Employee Attendance Form</FormTitle>
// // // // // // // // // // // // // // // // // // // //       <form onSubmit={handleSubmit}>
// // // // // // // // // // // // // // // // // // // //         <FormGroup>
// // // // // // // // // // // // // // // // // // // //           <Label>Employee ID</Label>
// // // // // // // // // // // // // // // // // // // //           <Input
// // // // // // // // // // // // // // // // // // // //             type="text"
// // // // // // // // // // // // // // // // // // // //             name="employeeId"
// // // // // // // // // // // // // // // // // // // //             value={formData.employeeId}
// // // // // // // // // // // // // // // // // // // //             onChange={handleChange}
// // // // // // // // // // // // // // // // // // // //             placeholder="Enter Employee ID"
// // // // // // // // // // // // // // // // // // // //           />
// // // // // // // // // // // // // // // // // // // //           {errors.employeeId && <ErrorMessage>{errors.employeeId}</ErrorMessage>}
// // // // // // // // // // // // // // // // // // // //         </FormGroup>

// // // // // // // // // // // // // // // // // // // //         <FormGroup>
// // // // // // // // // // // // // // // // // // // //           <Label>Employee Name</Label>
// // // // // // // // // // // // // // // // // // // //           <Input
// // // // // // // // // // // // // // // // // // // //             type="text"
// // // // // // // // // // // // // // // // // // // //             name="employeeName"
// // // // // // // // // // // // // // // // // // // //             value={formData.employeeName}
// // // // // // // // // // // // // // // // // // // //             onChange={handleChange}
// // // // // // // // // // // // // // // // // // // //             placeholder="Enter Employee Name"
// // // // // // // // // // // // // // // // // // // //           />
// // // // // // // // // // // // // // // // // // // //           {errors.employeeName && <ErrorMessage>{errors.employeeName}</ErrorMessage>}
// // // // // // // // // // // // // // // // // // // //         </FormGroup>

// // // // // // // // // // // // // // // // // // // //         <FormGroup>
// // // // // // // // // // // // // // // // // // // //           <Label>Date</Label>
// // // // // // // // // // // // // // // // // // // //           <Input
// // // // // // // // // // // // // // // // // // // //             type="date"
// // // // // // // // // // // // // // // // // // // //             name="date"
// // // // // // // // // // // // // // // // // // // //             value={formData.date}
// // // // // // // // // // // // // // // // // // // //             onChange={handleChange}
// // // // // // // // // // // // // // // // // // // //           />
// // // // // // // // // // // // // // // // // // // //           {errors.date && <ErrorMessage>{errors.date}</ErrorMessage>}
// // // // // // // // // // // // // // // // // // // //         </FormGroup>

// // // // // // // // // // // // // // // // // // // //         <FormGroup>
// // // // // // // // // // // // // // // // // // // //           <Label>Attendance Status</Label>
// // // // // // // // // // // // // // // // // // // //           <Select
// // // // // // // // // // // // // // // // // // // //             name="status"
// // // // // // // // // // // // // // // // // // // //             value={formData.status}
// // // // // // // // // // // // // // // // // // // //             onChange={handleChange}
// // // // // // // // // // // // // // // // // // // //           >
// // // // // // // // // // // // // // // // // // // //             <option value="">Select Status</option>
// // // // // // // // // // // // // // // // // // // //             <option value="Present">Present</option>
// // // // // // // // // // // // // // // // // // // //             <option value="Absent">Absent</option>
// // // // // // // // // // // // // // // // // // // //             <option value="Late">Late</option>
// // // // // // // // // // // // // // // // // // // //           </Select>
// // // // // // // // // // // // // // // // // // // //           {errors.status && <ErrorMessage>{errors.status}</ErrorMessage>}
// // // // // // // // // // // // // // // // // // // //         </FormGroup>

// // // // // // // // // // // // // // // // // // // //         <Button type="submit" disabled={isSubmitted}>
// // // // // // // // // // // // // // // // // // // //           {isSubmitted ? "Submitting..." : "Submit Attendance"}
// // // // // // // // // // // // // // // // // // // //         </Button>
// // // // // // // // // // // // // // // // // // // //       </form>

// // // // // // // // // // // // // // // // // // // //       {isSubmitted && (
// // // // // // // // // // // // // // // // // // // //         <SuccessMessage>Attendance submitted successfully!</SuccessMessage>
// // // // // // // // // // // // // // // // // // // //       )}
// // // // // // // // // // // // // // // // // // // //     </FormContainer>
// // // // // // // // // // // // // // // // // // // //   );
// // // // // // // // // // // // // // // // // // // // };

// // // // // // // // // // // // // // // // // // // // export default EmployeeAttendanceForm;

// // // // // // // // // // // // // // // // // // // import React, { useState, useEffect, useContext } from "react";
// // // // // // // // // // // // // // // // // // // import axios from "axios";
// // // // // // // // // // // // // // // // // // // import { useStore } from "./StoreContext"; // Adjust the import path as needed
// // // // // // // // // // // // // // // // // // // import styled from "styled-components";

// // // // // // // // // // // // // // // // // // // // Styled components
// // // // // // // // // // // // // // // // // // // const Container = styled.div`
// // // // // // // // // // // // // // // // // // //   padding: 2rem;
// // // // // // // // // // // // // // // // // // //   max-width: 800px;
// // // // // // // // // // // // // // // // // // //   margin: 0 auto;
// // // // // // // // // // // // // // // // // // // `;

// // // // // // // // // // // // // // // // // // // const Title = styled.h2`
// // // // // // // // // // // // // // // // // // //   font-size: 2rem;
// // // // // // // // // // // // // // // // // // //   color: #333;
// // // // // // // // // // // // // // // // // // //   text-align: center;
// // // // // // // // // // // // // // // // // // //   margin-bottom: 1.5rem;
// // // // // // // // // // // // // // // // // // // `;

// // // // // // // // // // // // // // // // // // // const SearchInput = styled.input`
// // // // // // // // // // // // // // // // // // //   width: 100%;
// // // // // // // // // // // // // // // // // // //   padding: 0.8rem;
// // // // // // // // // // // // // // // // // // //   font-size: 1rem;
// // // // // // // // // // // // // // // // // // //   border: 1px solid #ddd;
// // // // // // // // // // // // // // // // // // //   border-radius: 5px;
// // // // // // // // // // // // // // // // // // //   margin-bottom: 1.5rem;
// // // // // // // // // // // // // // // // // // //   outline: none;
// // // // // // // // // // // // // // // // // // //   transition: border-color 0.3s ease;

// // // // // // // // // // // // // // // // // // //   &:focus {
// // // // // // // // // // // // // // // // // // //     border-color: #6a11cb;
// // // // // // // // // // // // // // // // // // //   }
// // // // // // // // // // // // // // // // // // // `;

// // // // // // // // // // // // // // // // // // // const EmployeeList = styled.div`
// // // // // // // // // // // // // // // // // // //   margin-bottom: 2rem;
// // // // // // // // // // // // // // // // // // // `;

// // // // // // // // // // // // // // // // // // // const EmployeeItem = styled.div`
// // // // // // // // // // // // // // // // // // //   display: flex;
// // // // // // // // // // // // // // // // // // //   justify-content: space-between;
// // // // // // // // // // // // // // // // // // //   align-items: center;
// // // // // // // // // // // // // // // // // // //   padding: 1rem;
// // // // // // // // // // // // // // // // // // //   border: 1px solid #ddd;
// // // // // // // // // // // // // // // // // // //   border-radius: 5px;
// // // // // // // // // // // // // // // // // // //   margin-bottom: 1rem;
// // // // // // // // // // // // // // // // // // //   background: #f9f9f9;
// // // // // // // // // // // // // // // // // // //   transition: transform 0.2s ease;

// // // // // // // // // // // // // // // // // // //   &:hover {
// // // // // // // // // // // // // // // // // // //     transform: scale(1.02);
// // // // // // // // // // // // // // // // // // //   }
// // // // // // // // // // // // // // // // // // // `;

// // // // // // // // // // // // // // // // // // // const StatusSelect = styled.select`
// // // // // // // // // // // // // // // // // // //   padding: 0.5rem;
// // // // // // // // // // // // // // // // // // //   font-size: 1rem;
// // // // // // // // // // // // // // // // // // //   border: 1px solid #ddd;
// // // // // // // // // // // // // // // // // // //   border-radius: 5px;
// // // // // // // // // // // // // // // // // // //   outline: none;
// // // // // // // // // // // // // // // // // // //   transition: border-color 0.3s ease;

// // // // // // // // // // // // // // // // // // //   &:focus {
// // // // // // // // // // // // // // // // // // //     border-color: #6a11cb;
// // // // // // // // // // // // // // // // // // //   }
// // // // // // // // // // // // // // // // // // // `;

// // // // // // // // // // // // // // // // // // // const SubmitButton = styled.button`
// // // // // // // // // // // // // // // // // // //   width: 100%;
// // // // // // // // // // // // // // // // // // //   padding: 0.8rem;
// // // // // // // // // // // // // // // // // // //   font-size: 1rem;
// // // // // // // // // // // // // // // // // // //   color: #fff;
// // // // // // // // // // // // // // // // // // //   background: linear-gradient(135deg, #6a11cb, #2575fc);
// // // // // // // // // // // // // // // // // // //   border: none;
// // // // // // // // // // // // // // // // // // //   border-radius: 5px;
// // // // // // // // // // // // // // // // // // //   cursor: pointer;
// // // // // // // // // // // // // // // // // // //   transition: background 0.3s ease;

// // // // // // // // // // // // // // // // // // //   &:hover {
// // // // // // // // // // // // // // // // // // //     background: linear-gradient(135deg, #2575fc, #6a11cb);
// // // // // // // // // // // // // // // // // // //   }
// // // // // // // // // // // // // // // // // // // `;

// // // // // // // // // // // // // // // // // // // const EmployeeAttendanceSystem = () => {
// // // // // // // // // // // // // // // // // // //   const { storeId } = useStore(); // Get storeId from context
// // // // // // // // // // // // // // // // // // //   const [employees, setEmployees] = useState([]); // List of all employees
// // // // // // // // // // // // // // // // // // //   const [filteredEmployees, setFilteredEmployees] = useState([]); // Filtered list for search
// // // // // // // // // // // // // // // // // // //   const [searchQuery, setSearchQuery] = useState(""); // Search query
// // // // // // // // // // // // // // // // // // //   const [attendance, setAttendance] = useState({}); // Attendance status for each employee
// // // // // // // // // // // // // // // // // // //   const [loading, setLoading] = useState(true); // Loading state
// // // // // // // // // // // // // // // // // // //   const [error, setError] = useState(null); // Error state

// // // // // // // // // // // // // // // // // // //   // Fetch employees from the backend
// // // // // // // // // // // // // // // // // // //   useEffect(() => {
// // // // // // // // // // // // // // // // // // //     if (!storeId) {
// // // // // // // // // // // // // // // // // // //       setError("Store ID is missing.");
// // // // // // // // // // // // // // // // // // //       setLoading(false);
// // // // // // // // // // // // // // // // // // //       return;
// // // // // // // // // // // // // // // // // // //     }

// // // // // // // // // // // // // // // // // // //     const fetchEmployees = async () => {
// // // // // // // // // // // // // // // // // // //       try {
// // // // // // // // // // // // // // // // // // //         const response = await axios.get("http://localhost:5004/employees", {
// // // // // // // // // // // // // // // // // // //           headers: { storeId },
// // // // // // // // // // // // // // // // // // //         });
// // // // // // // // // // // // // // // // // // //         setEmployees(response.data);
// // // // // // // // // // // // // // // // // // //         setFilteredEmployees(response.data);
// // // // // // // // // // // // // // // // // // //       } catch (err) {
// // // // // // // // // // // // // // // // // // //         setError("Failed to fetch employees.");
// // // // // // // // // // // // // // // // // // //         console.error(err);
// // // // // // // // // // // // // // // // // // //       } finally {
// // // // // // // // // // // // // // // // // // //         setLoading(false);
// // // // // // // // // // // // // // // // // // //       }
// // // // // // // // // // // // // // // // // // //     };

// // // // // // // // // // // // // // // // // // //     fetchEmployees();
// // // // // // // // // // // // // // // // // // //   }, [storeId]);

// // // // // // // // // // // // // // // // // // //   // Handle search input
// // // // // // // // // // // // // // // // // // //   useEffect(() => {
// // // // // // // // // // // // // // // // // // //     const filtered = employees.filter((employee) =>
// // // // // // // // // // // // // // // // // // //       employee.employeeName.toLowerCase().includes(searchQuery.toLowerCase()) ||
// // // // // // // // // // // // // // // // // // //       employee.employeeId.toLowerCase().includes(searchQuery.toLowerCase())
// // // // // // // // // // // // // // // // // // //     );
// // // // // // // // // // // // // // // // // // //     setFilteredEmployees(filtered);
// // // // // // // // // // // // // // // // // // //   }, [searchQuery, employees]);

// // // // // // // // // // // // // // // // // // //   // Handle attendance status change
// // // // // // // // // // // // // // // // // // //   const handleStatusChange = (employeeId, status) => {
// // // // // // // // // // // // // // // // // // //     setAttendance((prev) => ({
// // // // // // // // // // // // // // // // // // //       ...prev,
// // // // // // // // // // // // // // // // // // //       [employeeId]: status,
// // // // // // // // // // // // // // // // // // //     }));
// // // // // // // // // // // // // // // // // // //   };

// // // // // // // // // // // // // // // // // // //   // Submit attendance
// // // // // // // // // // // // // // // // // // //   const handleSubmit = async () => {
// // // // // // // // // // // // // // // // // // //     if (!storeId) {
// // // // // // // // // // // // // // // // // // //       setError("Store ID is missing.");
// // // // // // // // // // // // // // // // // // //       return;
// // // // // // // // // // // // // // // // // // //     }

// // // // // // // // // // // // // // // // // // //     try {
// // // // // // // // // // // // // // // // // // //       const attendanceRecords = Object.keys(attendance).map((employeeId) => ({
// // // // // // // // // // // // // // // // // // //         employeeId,
// // // // // // // // // // // // // // // // // // //         date: new Date().toISOString().split("T")[0], // Current date
// // // // // // // // // // // // // // // // // // //         status: attendance[employeeId],
// // // // // // // // // // // // // // // // // // //       }));

// // // // // // // // // // // // // // // // // // //       // Send attendance records to the backend
// // // // // // // // // // // // // // // // // // //       await axios.post("http://localhost:5004/attendance", attendanceRecords, {
// // // // // // // // // // // // // // // // // // //         headers: { storeId },
// // // // // // // // // // // // // // // // // // //       });

// // // // // // // // // // // // // // // // // // //       alert("Attendance recorded successfully!");
// // // // // // // // // // // // // // // // // // //       setAttendance({}); // Reset attendance
// // // // // // // // // // // // // // // // // // //     } catch (err) {
// // // // // // // // // // // // // // // // // // //       setError("Failed to record attendance.");
// // // // // // // // // // // // // // // // // // //       console.error(err);
// // // // // // // // // // // // // // // // // // //     }
// // // // // // // // // // // // // // // // // // //   };

// // // // // // // // // // // // // // // // // // //   if (loading) {
// // // // // // // // // // // // // // // // // // //     return <div>Loading...</div>;
// // // // // // // // // // // // // // // // // // //   }

// // // // // // // // // // // // // // // // // // //   if (error) {
// // // // // // // // // // // // // // // // // // //     return <div>{error}</div>;
// // // // // // // // // // // // // // // // // // //   }

// // // // // // // // // // // // // // // // // // //   return (
// // // // // // // // // // // // // // // // // // //     <Container>
// // // // // // // // // // // // // // // // // // //       <Title>Employee Attendance System</Title>
// // // // // // // // // // // // // // // // // // //       <SearchInput
// // // // // // // // // // // // // // // // // // //         type="text"
// // // // // // // // // // // // // // // // // // //         placeholder="Search by Employee Name or ID"
// // // // // // // // // // // // // // // // // // //         value={searchQuery}
// // // // // // // // // // // // // // // // // // //         onChange={(e) => setSearchQuery(e.target.value)}
// // // // // // // // // // // // // // // // // // //       />
// // // // // // // // // // // // // // // // // // //       <EmployeeList>
// // // // // // // // // // // // // // // // // // //         {filteredEmployees.map((employee) => (
// // // // // // // // // // // // // // // // // // //           <EmployeeItem key={employee._id}>
// // // // // // // // // // // // // // // // // // //             <div>
// // // // // // // // // // // // // // // // // // //               <strong>{employee.employeeName}</strong> (ID: {employee.employeeId})
// // // // // // // // // // // // // // // // // // //             </div>
// // // // // // // // // // // // // // // // // // //             <StatusSelect
// // // // // // // // // // // // // // // // // // //               value={attendance[employee.employeeId] || ""}
// // // // // // // // // // // // // // // // // // //               onChange={(e) =>
// // // // // // // // // // // // // // // // // // //                 handleStatusChange(employee.employeeId, e.target.value)
// // // // // // // // // // // // // // // // // // //               }
// // // // // // // // // // // // // // // // // // //             >
// // // // // // // // // // // // // // // // // // //               <option value="">Select Status</option>
// // // // // // // // // // // // // // // // // // //               <option value="Present">Present</option>
// // // // // // // // // // // // // // // // // // //               <option value="Absent">Absent</option>
// // // // // // // // // // // // // // // // // // //               <option value="Late">Late</option>
// // // // // // // // // // // // // // // // // // //             </StatusSelect>
// // // // // // // // // // // // // // // // // // //           </EmployeeItem>
// // // // // // // // // // // // // // // // // // //         ))}
// // // // // // // // // // // // // // // // // // //       </EmployeeList>
// // // // // // // // // // // // // // // // // // //       <SubmitButton onClick={handleSubmit}>Submit Attendance</SubmitButton>
// // // // // // // // // // // // // // // // // // //     </Container>
// // // // // // // // // // // // // // // // // // //   );
// // // // // // // // // // // // // // // // // // // };

// // // // // // // // // // // // // // // // // // // export default EmployeeAttendanceSystem;

// // // // // // // // // // // // // // // // // // import React, { useState, useEffect, useContext } from "react";
// // // // // // // // // // // // // // // // // // import axios from "axios";
// // // // // // // // // // // // // // // // // // import { useStore } from "./StoreContext"; // Adjust the import path as needed
// // // // // // // // // // // // // // // // // // import styled from "styled-components";

// // // // // // // // // // // // // // // // // // // Styled components
// // // // // // // // // // // // // // // // // // const Container = styled.div`
// // // // // // // // // // // // // // // // // //   padding: 2rem;
// // // // // // // // // // // // // // // // // //   max-width: 800px;
// // // // // // // // // // // // // // // // // //   margin: 0 auto;
// // // // // // // // // // // // // // // // // // `;

// // // // // // // // // // // // // // // // // // const Title = styled.h2`
// // // // // // // // // // // // // // // // // //   font-size: 2rem;
// // // // // // // // // // // // // // // // // //   color: #333;
// // // // // // // // // // // // // // // // // //   text-align: center;
// // // // // // // // // // // // // // // // // //   margin-bottom: 1.5rem;
// // // // // // // // // // // // // // // // // // `;

// // // // // // // // // // // // // // // // // // const SearchInput = styled.input`
// // // // // // // // // // // // // // // // // //   width: 100%;
// // // // // // // // // // // // // // // // // //   padding: 0.8rem;
// // // // // // // // // // // // // // // // // //   font-size: 1rem;
// // // // // // // // // // // // // // // // // //   border: 1px solid #ddd;
// // // // // // // // // // // // // // // // // //   border-radius: 5px;
// // // // // // // // // // // // // // // // // //   margin-bottom: 1.5rem;
// // // // // // // // // // // // // // // // // //   outline: none;
// // // // // // // // // // // // // // // // // //   transition: border-color 0.3s ease;

// // // // // // // // // // // // // // // // // //   &:focus {
// // // // // // // // // // // // // // // // // //     border-color: #6a11cb;
// // // // // // // // // // // // // // // // // //   }
// // // // // // // // // // // // // // // // // // `;

// // // // // // // // // // // // // // // // // // const EmployeeList = styled.div`
// // // // // // // // // // // // // // // // // //   margin-bottom: 2rem;
// // // // // // // // // // // // // // // // // // `;

// // // // // // // // // // // // // // // // // // const EmployeeItem = styled.div`
// // // // // // // // // // // // // // // // // //   display: flex;
// // // // // // // // // // // // // // // // // //   justify-content: space-between;
// // // // // // // // // // // // // // // // // //   align-items: center;
// // // // // // // // // // // // // // // // // //   padding: 1rem;
// // // // // // // // // // // // // // // // // //   border: 1px solid #ddd;
// // // // // // // // // // // // // // // // // //   border-radius: 5px;
// // // // // // // // // // // // // // // // // //   margin-bottom: 1rem;
// // // // // // // // // // // // // // // // // //   background: #f9f9f9;
// // // // // // // // // // // // // // // // // //   transition: transform 0.2s ease;

// // // // // // // // // // // // // // // // // //   &:hover {
// // // // // // // // // // // // // // // // // //     transform: scale(1.02);
// // // // // // // // // // // // // // // // // //   }
// // // // // // // // // // // // // // // // // // `;

// // // // // // // // // // // // // // // // // // const StatusSelect = styled.select`
// // // // // // // // // // // // // // // // // //   padding: 0.5rem;
// // // // // // // // // // // // // // // // // //   font-size: 1rem;
// // // // // // // // // // // // // // // // // //   border: 1px solid #ddd;
// // // // // // // // // // // // // // // // // //   border-radius: 5px;
// // // // // // // // // // // // // // // // // //   outline: none;
// // // // // // // // // // // // // // // // // //   transition: border-color 0.3s ease;

// // // // // // // // // // // // // // // // // //   &:focus {
// // // // // // // // // // // // // // // // // //     border-color: #6a11cb;
// // // // // // // // // // // // // // // // // //   }
// // // // // // // // // // // // // // // // // // `;

// // // // // // // // // // // // // // // // // // const SubmitButton = styled.button`
// // // // // // // // // // // // // // // // // //   width: 100%;
// // // // // // // // // // // // // // // // // //   padding: 0.8rem;
// // // // // // // // // // // // // // // // // //   font-size: 1rem;
// // // // // // // // // // // // // // // // // //   color: #fff;
// // // // // // // // // // // // // // // // // //   background: linear-gradient(135deg, #6a11cb, #2575fc);
// // // // // // // // // // // // // // // // // //   border: none;
// // // // // // // // // // // // // // // // // //   border-radius: 5px;
// // // // // // // // // // // // // // // // // //   cursor: pointer;
// // // // // // // // // // // // // // // // // //   transition: background 0.3s ease;

// // // // // // // // // // // // // // // // // //   &:hover {
// // // // // // // // // // // // // // // // // //     background: linear-gradient(135deg, #2575fc, #6a11cb);
// // // // // // // // // // // // // // // // // //   }
// // // // // // // // // // // // // // // // // // `;

// // // // // // // // // // // // // // // // // // const EmployeeAttendanceSystem = () => {
// // // // // // // // // // // // // // // // // //   const { storeId } = useStore(); // Get storeId from context
// // // // // // // // // // // // // // // // // //   const [employees, setEmployees] = useState([]); // List of all employees
// // // // // // // // // // // // // // // // // //   const [filteredEmployees, setFilteredEmployees] = useState([]); // Filtered list for search
// // // // // // // // // // // // // // // // // //   const [searchQuery, setSearchQuery] = useState(""); // Search query
// // // // // // // // // // // // // // // // // //   const [attendance, setAttendance] = useState({}); // Attendance status for each employee
// // // // // // // // // // // // // // // // // //   const [loading, setLoading] = useState(true); // Loading state
// // // // // // // // // // // // // // // // // //   const [error, setError] = useState(null); // Error state

// // // // // // // // // // // // // // // // // //   // Fetch employees from the backend
// // // // // // // // // // // // // // // // // //   useEffect(() => {
// // // // // // // // // // // // // // // // // //     if (!storeId) {
// // // // // // // // // // // // // // // // // //       setError("Store ID is missing.");
// // // // // // // // // // // // // // // // // //       setLoading(false);
// // // // // // // // // // // // // // // // // //       return;
// // // // // // // // // // // // // // // // // //     }

// // // // // // // // // // // // // // // // // //     const fetchEmployees = async () => {
// // // // // // // // // // // // // // // // // //       try {
// // // // // // // // // // // // // // // // // //         const response = await axios.get("http://localhost:5004/employees", {
// // // // // // // // // // // // // // // // // //           headers: { storeId },
// // // // // // // // // // // // // // // // // //         });
// // // // // // // // // // // // // // // // // //         setEmployees(response.data);
// // // // // // // // // // // // // // // // // //         setFilteredEmployees(response.data);
// // // // // // // // // // // // // // // // // //       } catch (err) {
// // // // // // // // // // // // // // // // // //         setError("Failed to fetch employees.");
// // // // // // // // // // // // // // // // // //         console.error(err);
// // // // // // // // // // // // // // // // // //       } finally {
// // // // // // // // // // // // // // // // // //         setLoading(false);
// // // // // // // // // // // // // // // // // //       }
// // // // // // // // // // // // // // // // // //     };

// // // // // // // // // // // // // // // // // //     fetchEmployees();
// // // // // // // // // // // // // // // // // //   }, [storeId]);

// // // // // // // // // // // // // // // // // //   // Handle search input
// // // // // // // // // // // // // // // // // //   useEffect(() => {
// // // // // // // // // // // // // // // // // //     const filtered = employees.filter((employee) => {
// // // // // // // // // // // // // // // // // //       const name = employee.employeeName || ""; // Default to empty string if undefined
// // // // // // // // // // // // // // // // // //       const id = employee.employeeId || ""; // Default to empty string if undefined
// // // // // // // // // // // // // // // // // //       return (
// // // // // // // // // // // // // // // // // //         name.toLowerCase().includes(searchQuery.toLowerCase()) ||
// // // // // // // // // // // // // // // // // //         id.toLowerCase().includes(searchQuery.toLowerCase())
// // // // // // // // // // // // // // // // // //       );
// // // // // // // // // // // // // // // // // //     });
// // // // // // // // // // // // // // // // // //     setFilteredEmployees(filtered);
// // // // // // // // // // // // // // // // // //   }, [searchQuery, employees]);

// // // // // // // // // // // // // // // // // //   // Handle attendance status change
// // // // // // // // // // // // // // // // // //   const handleStatusChange = (employeeId, status) => {
// // // // // // // // // // // // // // // // // //     setAttendance((prev) => ({
// // // // // // // // // // // // // // // // // //       ...prev,
// // // // // // // // // // // // // // // // // //       [employeeId]: status,
// // // // // // // // // // // // // // // // // //     }));
// // // // // // // // // // // // // // // // // //   };

// // // // // // // // // // // // // // // // // //   // Submit attendance
// // // // // // // // // // // // // // // // // // //   const handleSubmit = async () => {
// // // // // // // // // // // // // // // // // // //     if (!storeId) {
// // // // // // // // // // // // // // // // // // //       setError("Store ID is missing.");
// // // // // // // // // // // // // // // // // // //       return;
// // // // // // // // // // // // // // // // // // //     }

// // // // // // // // // // // // // // // // // // //     try {
// // // // // // // // // // // // // // // // // // //       const attendanceRecords = Object.keys(attendance).map((employeeId) => ({
// // // // // // // // // // // // // // // // // // //         employeeId,
// // // // // // // // // // // // // // // // // // //         date: new Date().toISOString().split("T")[0], // Current date
// // // // // // // // // // // // // // // // // // //         status: attendance[employeeId],
// // // // // // // // // // // // // // // // // // //       }));

// // // // // // // // // // // // // // // // // // //       // Send attendance records to the backend
// // // // // // // // // // // // // // // // // // //       await axios.post("http://localhost:5004/attendance", attendanceRecords, {
// // // // // // // // // // // // // // // // // // //         headers: { storeId },
// // // // // // // // // // // // // // // // // // //       });

// // // // // // // // // // // // // // // // // // //       alert("Attendance recorded successfully!");
// // // // // // // // // // // // // // // // // // //       setAttendance({}); // Reset attendance
// // // // // // // // // // // // // // // // // // //     } catch (err) {
// // // // // // // // // // // // // // // // // // //       setError("Failed to record attendance.");
// // // // // // // // // // // // // // // // // // //       console.error(err);
// // // // // // // // // // // // // // // // // // //     }
// // // // // // // // // // // // // // // // // // //   };
// // // // // // // // // // // // // // // // // // const handleSubmit = async () => {
// // // // // // // // // // // // // // // // // //     if (!storeId) {
// // // // // // // // // // // // // // // // // //       setError("Store ID is missing.");
// // // // // // // // // // // // // // // // // //       return;
// // // // // // // // // // // // // // // // // //     }
  
// // // // // // // // // // // // // // // // // //     try {
// // // // // // // // // // // // // // // // // //       // Prepare attendance records with timestamp
// // // // // // // // // // // // // // // // // //       const attendanceRecords = Object.keys(attendance).map((employeeId) => ({
// // // // // // // // // // // // // // // // // //         employeeId,
// // // // // // // // // // // // // // // // // //         status: attendance[employeeId],
// // // // // // // // // // // // // // // // // //         timestamp: new Date().toISOString(), // Current date and time in ISO format
// // // // // // // // // // // // // // // // // //       }));
  
// // // // // // // // // // // // // // // // // //       // Send attendance records to the backend
// // // // // // // // // // // // // // // // // //       const response = await axios.post("http://localhost:5004/attendance", attendanceRecords, {
// // // // // // // // // // // // // // // // // //         headers: { storeId },
// // // // // // // // // // // // // // // // // //       });
  
// // // // // // // // // // // // // // // // // //       alert("Attendance recorded successfully!");
// // // // // // // // // // // // // // // // // //       setAttendance({}); // Reset attendance
// // // // // // // // // // // // // // // // // //     } catch (err) {
// // // // // // // // // // // // // // // // // //       setError("Failed to record attendance.");
// // // // // // // // // // // // // // // // // //       console.error(err);
// // // // // // // // // // // // // // // // // //     }
// // // // // // // // // // // // // // // // // //   };
// // // // // // // // // // // // // // // // // //   if (loading) {
// // // // // // // // // // // // // // // // // //     return <div>Loading...</div>;
// // // // // // // // // // // // // // // // // //   }

// // // // // // // // // // // // // // // // // //   if (error) {
// // // // // // // // // // // // // // // // // //     return <div>{error}</div>;
// // // // // // // // // // // // // // // // // //   }

// // // // // // // // // // // // // // // // // //   return (
// // // // // // // // // // // // // // // // // //     <Container>
// // // // // // // // // // // // // // // // // //       <Title>Employee Attendance System</Title>
// // // // // // // // // // // // // // // // // //       <SearchInput
// // // // // // // // // // // // // // // // // //         type="text"
// // // // // // // // // // // // // // // // // //         placeholder="Search by Employee Name or ID"
// // // // // // // // // // // // // // // // // //         value={searchQuery}
// // // // // // // // // // // // // // // // // //         onChange={(e) => setSearchQuery(e.target.value)}
// // // // // // // // // // // // // // // // // //       />
// // // // // // // // // // // // // // // // // //       <EmployeeList>
// // // // // // // // // // // // // // // // // //         {filteredEmployees.map((employee) => (
// // // // // // // // // // // // // // // // // //           <EmployeeItem key={employee._id}>
// // // // // // // // // // // // // // // // // //             <div>
// // // // // // // // // // // // // // // // // //               <strong>{employee.employeeName}</strong> (ID: {employee.employeeId})
// // // // // // // // // // // // // // // // // //             </div>
// // // // // // // // // // // // // // // // // //             <StatusSelect
// // // // // // // // // // // // // // // // // //               value={attendance[employee.employeeId] || ""}
// // // // // // // // // // // // // // // // // //               onChange={(e) =>
// // // // // // // // // // // // // // // // // //                 handleStatusChange(employee.employeeId, e.target.value)
// // // // // // // // // // // // // // // // // //               }
// // // // // // // // // // // // // // // // // //             >
// // // // // // // // // // // // // // // // // //               <option value="">Select Status</option>
// // // // // // // // // // // // // // // // // //               <option value="Present">Present</option>
// // // // // // // // // // // // // // // // // //               <option value="Absent">Absent</option>
// // // // // // // // // // // // // // // // // //               <option value="Late">Late</option>
// // // // // // // // // // // // // // // // // //             </StatusSelect>
// // // // // // // // // // // // // // // // // //           </EmployeeItem>
// // // // // // // // // // // // // // // // // //         ))}
// // // // // // // // // // // // // // // // // //       </EmployeeList>
// // // // // // // // // // // // // // // // // //       <SubmitButton onClick={handleSubmit}>Submit Attendance</SubmitButton>
// // // // // // // // // // // // // // // // // //     </Container>
// // // // // // // // // // // // // // // // // //   );
// // // // // // // // // // // // // // // // // // };

// // // // // // // // // // // // // // // // // // export default EmployeeAttendanceSystem;

// // // // // // // // // // // // // // // // // import React, { useState, useEffect, useMemo } from 'react';
// // // // // // // // // // // // // // // // // import axios from 'axios';
// // // // // // // // // // // // // // // // // import { 
// // // // // // // // // // // // // // // // //   Briefcase, 
// // // // // // // // // // // // // // // // //   CheckCircle, 
// // // // // // // // // // // // // // // // //   XCircle, 
// // // // // // // // // // // // // // // // //   Clock, 
// // // // // // // // // // // // // // // // //   Search, 
// // // // // // // // // // // // // // // // //   BarChart2, 
// // // // // // // // // // // // // // // // //   Calendar, 
// // // // // // // // // // // // // // // // //   Users 
// // // // // // // // // // // // // // // // // } from 'lucide-react';
// // // // // // // // // // // // // // // // // import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
// // // // // // // // // // // // // // // // // import { Button } from '@/components/ui/button';
// // // // // // // // // // // // // // // // // import { Input } from '@/components/ui/input';
// // // // // // // // // // // // // // // // // import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';
// // // // // // // // // // // // // // // // // import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';
// // // // // // // // // // // // // // // // // import { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog';

// // // // // // // // // // // // // // // // // // Analytics Component
// // // // // // // // // // // // // // // // // const AttendanceAnalytics = ({ attendanceRecords, employees }) => {
// // // // // // // // // // // // // // // // //   const calculateAnalytics = useMemo(() => {
// // // // // // // // // // // // // // // // //     const today = new Date().toISOString().split('T')[0];
    
// // // // // // // // // // // // // // // // //     // Today's attendance
// // // // // // // // // // // // // // // // //     const todayAttendance = attendanceRecords.filter(record => 
// // // // // // // // // // // // // // // // //       record.timestamp.split('T')[0] === today
// // // // // // // // // // // // // // // // //     );

// // // // // // // // // // // // // // // // //     // Overall attendance statistics
// // // // // // // // // // // // // // // // //     const totalEmployees = employees.length;
// // // // // // // // // // // // // // // // //     const presentToday = todayAttendance.filter(record => record.status === 'Present').length;
// // // // // // // // // // // // // // // // //     const absentToday = todayAttendance.filter(record => record.status === 'Absent').length;
// // // // // // // // // // // // // // // // //     const lateToday = todayAttendance.filter(record => record.status === 'Late').length;

// // // // // // // // // // // // // // // // //     // Monthly attendance trends
// // // // // // // // // // // // // // // // //     const attendanceByMonth = {};
// // // // // // // // // // // // // // // // //     attendanceRecords.forEach(record => {
// // // // // // // // // // // // // // // // //       const month = new Date(record.timestamp).toLocaleString('default', { month: 'long' });
// // // // // // // // // // // // // // // // //       if (!attendanceByMonth[month]) {
// // // // // // // // // // // // // // // // //         attendanceByMonth[month] = { 
// // // // // // // // // // // // // // // // //           Present: 0, 
// // // // // // // // // // // // // // // // //           Absent: 0, 
// // // // // // // // // // // // // // // // //           Late: 0 
// // // // // // // // // // // // // // // // //         };
// // // // // // // // // // // // // // // // //       }
// // // // // // // // // // // // // // // // //       attendanceByMonth[month][record.status]++;
// // // // // // // // // // // // // // // // //     });

// // // // // // // // // // // // // // // // //     return {
// // // // // // // // // // // // // // // // //       totalEmployees,
// // // // // // // // // // // // // // // // //       presentToday,
// // // // // // // // // // // // // // // // //       absentToday,
// // // // // // // // // // // // // // // // //       lateToday,
// // // // // // // // // // // // // // // // //       attendanceByMonth
// // // // // // // // // // // // // // // // //     };
// // // // // // // // // // // // // // // // //   }, [attendanceRecords, employees]);

// // // // // // // // // // // // // // // // //   return (
// // // // // // // // // // // // // // // // //     <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
// // // // // // // // // // // // // // // // //       <Card>
// // // // // // // // // // // // // // // // //         <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
// // // // // // // // // // // // // // // // //           <CardTitle className="text-sm font-medium">Total Employees</CardTitle>
// // // // // // // // // // // // // // // // //           <Users className="h-4 w-4 text-muted-foreground" />
// // // // // // // // // // // // // // // // //         </CardHeader>
// // // // // // // // // // // // // // // // //         <CardContent>
// // // // // // // // // // // // // // // // //           <div className="text-2xl font-bold">{calculateAnalytics.totalEmployees}</div>
// // // // // // // // // // // // // // // // //         </CardContent>
// // // // // // // // // // // // // // // // //       </Card>
      
// // // // // // // // // // // // // // // // //       <Card>
// // // // // // // // // // // // // // // // //         <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
// // // // // // // // // // // // // // // // //           <CardTitle className="text-sm font-medium">Present Today</CardTitle>
// // // // // // // // // // // // // // // // //           <CheckCircle className="h-4 w-4 text-green-500" />
// // // // // // // // // // // // // // // // //         </CardHeader>
// // // // // // // // // // // // // // // // //         <CardContent>
// // // // // // // // // // // // // // // // //           <div className="text-2xl font-bold text-green-600">{calculateAnalytics.presentToday}</div>
// // // // // // // // // // // // // // // // //         </CardContent>
// // // // // // // // // // // // // // // // //       </Card>
      
// // // // // // // // // // // // // // // // //       <Card>
// // // // // // // // // // // // // // // // //         <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
// // // // // // // // // // // // // // // // //           <CardTitle className="text-sm font-medium">Absent Today</CardTitle>
// // // // // // // // // // // // // // // // //           <XCircle className="h-4 w-4 text-red-500" />
// // // // // // // // // // // // // // // // //         </CardHeader>
// // // // // // // // // // // // // // // // //         <CardContent>
// // // // // // // // // // // // // // // // //           <div className="text-2xl font-bold text-red-600">{calculateAnalytics.absentToday}</div>
// // // // // // // // // // // // // // // // //         </CardContent>
// // // // // // // // // // // // // // // // //       </Card>
      
// // // // // // // // // // // // // // // // //       <Card>
// // // // // // // // // // // // // // // // //         <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
// // // // // // // // // // // // // // // // //           <CardTitle className="text-sm font-medium">Late Today</CardTitle>
// // // // // // // // // // // // // // // // //           <Clock className="h-4 w-4 text-yellow-500" />
// // // // // // // // // // // // // // // // //         </CardHeader>
// // // // // // // // // // // // // // // // //         <CardContent>
// // // // // // // // // // // // // // // // //           <div className="text-2xl font-bold text-yellow-600">{calculateAnalytics.lateToday}</div>
// // // // // // // // // // // // // // // // //         </CardContent>
// // // // // // // // // // // // // // // // //       </Card>
// // // // // // // // // // // // // // // // //     </div>
// // // // // // // // // // // // // // // // //   );
// // // // // // // // // // // // // // // // // };

// // // // // // // // // // // // // // // // // // Main Attendance Component
// // // // // // // // // // // // // // // // // const EmployeeAttendanceSystem = () => {
// // // // // // // // // // // // // // // // //   const [employees, setEmployees] = useState([]);
// // // // // // // // // // // // // // // // //   const [attendanceRecords, setAttendanceRecords] = useState([]);
// // // // // // // // // // // // // // // // //   const [filteredEmployees, setFilteredEmployees] = useState([]);
// // // // // // // // // // // // // // // // //   const [searchQuery, setSearchQuery] = useState('');
// // // // // // // // // // // // // // // // //   const [attendance, setAttendance] = useState({});
// // // // // // // // // // // // // // // // //   const [loading, setLoading] = useState(true);
// // // // // // // // // // // // // // // // //   const [error, setError] = useState(null);

// // // // // // // // // // // // // // // // //   // Fetch employees and attendance records
// // // // // // // // // // // // // // // // //   useEffect(() => {
// // // // // // // // // // // // // // // // //     const fetchData = async () => {
// // // // // // // // // // // // // // // // //       try {
// // // // // // // // // // // // // // // // //         const [employeesResponse, attendanceResponse] = await Promise.all([
// // // // // // // // // // // // // // // // //           axios.get('http://localhost:5004/employees', { headers: { storeId: 'your_store_id' } }),
// // // // // // // // // // // // // // // // //           axios.get('http://localhost:5004/attendance', { headers: { storeId: 'your_store_id' } })
// // // // // // // // // // // // // // // // //         ]);

// // // // // // // // // // // // // // // // //         setEmployees(employeesResponse.data);
// // // // // // // // // // // // // // // // //         setFilteredEmployees(employeesResponse.data);
// // // // // // // // // // // // // // // // //         setAttendanceRecords(attendanceResponse.data);
// // // // // // // // // // // // // // // // //       } catch (err) {
// // // // // // // // // // // // // // // // //         setError('Failed to fetch data');
// // // // // // // // // // // // // // // // //         console.error(err);
// // // // // // // // // // // // // // // // //       } finally {
// // // // // // // // // // // // // // // // //         setLoading(false);
// // // // // // // // // // // // // // // // //       }
// // // // // // // // // // // // // // // // //     };

// // // // // // // // // // // // // // // // //     fetchData();
// // // // // // // // // // // // // // // // //   }, []);

// // // // // // // // // // // // // // // // //   // Search and filter employees
// // // // // // // // // // // // // // // // //   useEffect(() => {
// // // // // // // // // // // // // // // // //     const filtered = employees.filter(employee => {
// // // // // // // // // // // // // // // // //       const name = employee.employeeName?.toLowerCase() || '';
// // // // // // // // // // // // // // // // //       const id = employee.employeeId?.toLowerCase() || '';
// // // // // // // // // // // // // // // // //       const query = searchQuery.toLowerCase();
// // // // // // // // // // // // // // // // //       return name.includes(query) || id.includes(query);
// // // // // // // // // // // // // // // // //     });
// // // // // // // // // // // // // // // // //     setFilteredEmployees(filtered);
// // // // // // // // // // // // // // // // //   }, [searchQuery, employees]);

// // // // // // // // // // // // // // // // //   // Handle attendance status change
// // // // // // // // // // // // // // // // //   const handleStatusChange = (employeeId, status) => {
// // // // // // // // // // // // // // // // //     setAttendance(prev => ({
// // // // // // // // // // // // // // // // //       ...prev,
// // // // // // // // // // // // // // // // //       [employeeId]: status
// // // // // // // // // // // // // // // // //     }));
// // // // // // // // // // // // // // // // //   };

// // // // // // // // // // // // // // // // //   // Submit attendance
// // // // // // // // // // // // // // // // //   const handleSubmit = async () => {
// // // // // // // // // // // // // // // // //     try {
// // // // // // // // // // // // // // // // //       const attendanceRecords = Object.keys(attendance).map(employeeId => ({
// // // // // // // // // // // // // // // // //         employeeId,
// // // // // // // // // // // // // // // // //         status: attendance[employeeId],
// // // // // // // // // // // // // // // // //         timestamp: new Date().toISOString()
// // // // // // // // // // // // // // // // //       }));

// // // // // // // // // // // // // // // // //       await axios.post('http://localhost:5004/attendance', attendanceRecords, {
// // // // // // // // // // // // // // // // //         headers: { storeId: 'your_store_id' }
// // // // // // // // // // // // // // // // //       });

// // // // // // // // // // // // // // // // //       alert('Attendance recorded successfully!');
// // // // // // // // // // // // // // // // //       setAttendance({});
// // // // // // // // // // // // // // // // //     } catch (err) {
// // // // // // // // // // // // // // // // //       setError('Failed to record attendance');
// // // // // // // // // // // // // // // // //       console.error(err);
// // // // // // // // // // // // // // // // //     }
// // // // // // // // // // // // // // // // //   };

// // // // // // // // // // // // // // // // //   if (loading) return <div>Loading...</div>;
// // // // // // // // // // // // // // // // //   if (error) return <div>{error}</div>;

// // // // // // // // // // // // // // // // //   return (
// // // // // // // // // // // // // // // // //     <div className="container mx-auto p-6">
// // // // // // // // // // // // // // // // //       <h1 className="text-3xl font-bold mb-6 flex items-center">
// // // // // // // // // // // // // // // // //         <Briefcase className="mr-3" /> Employee Attendance System
// // // // // // // // // // // // // // // // //       </h1>

// // // // // // // // // // // // // // // // //       <Tabs defaultValue="attendance">
// // // // // // // // // // // // // // // // //         <TabsList className="mb-6">
// // // // // // // // // // // // // // // // //           <TabsTrigger value="attendance">Take Attendance</TabsTrigger>
// // // // // // // // // // // // // // // // //           <TabsTrigger value="analytics">Analytics</TabsTrigger>
// // // // // // // // // // // // // // // // //           <TabsTrigger value="history">Attendance History</TabsTrigger>
// // // // // // // // // // // // // // // // //         </TabsList>

// // // // // // // // // // // // // // // // //         <TabsContent value="attendance">
// // // // // // // // // // // // // // // // //           <Card>
// // // // // // // // // // // // // // // // //             <CardHeader>
// // // // // // // // // // // // // // // // //               <div className="flex items-center">
// // // // // // // // // // // // // // // // //                 <Search className="mr-2" />
// // // // // // // // // // // // // // // // //                 <Input
// // // // // // // // // // // // // // // // //                   placeholder="Search by Employee Name or ID"
// // // // // // // // // // // // // // // // //                   value={searchQuery}
// // // // // // // // // // // // // // // // //                   onChange={(e) => setSearchQuery(e.target.value)}
// // // // // // // // // // // // // // // // //                   className="w-full"
// // // // // // // // // // // // // // // // //                 />
// // // // // // // // // // // // // // // // //               </div>
// // // // // // // // // // // // // // // // //             </CardHeader>
// // // // // // // // // // // // // // // // //             <CardContent>
// // // // // // // // // // // // // // // // //               <div className="space-y-2">
// // // // // // // // // // // // // // // // //                 {filteredEmployees.map(employee => (
// // // // // // // // // // // // // // // // //                   <div 
// // // // // // // // // // // // // // // // //                     key={employee._id} 
// // // // // // // // // // // // // // // // //                     className="flex justify-between items-center p-3 border rounded-lg hover:bg-gray-50 transition"
// // // // // // // // // // // // // // // // //                   >
// // // // // // // // // // // // // // // // //                     <div>
// // // // // // // // // // // // // // // // //                       <h3 className="font-semibold">{employee.employeeName}</h3>
// // // // // // // // // // // // // // // // //                       <p className="text-sm text-gray-500">ID: {employee.employeeId}</p>
// // // // // // // // // // // // // // // // //                     </div>
// // // // // // // // // // // // // // // // //                     <Select
// // // // // // // // // // // // // // // // //                       onValueChange={(status) => handleStatusChange(employee.employeeId, status)}
// // // // // // // // // // // // // // // // //                       value={attendance[employee.employeeId] || ''}
// // // // // // // // // // // // // // // // //                     >
// // // // // // // // // // // // // // // // //                       <SelectTrigger className="w-[180px]">
// // // // // // // // // // // // // // // // //                         <SelectValue placeholder="Select Status" />
// // // // // // // // // // // // // // // // //                       </SelectTrigger>
// // // // // // // // // // // // // // // // //                       <SelectContent>
// // // // // // // // // // // // // // // // //                         <SelectItem value="Present">Present</SelectItem>
// // // // // // // // // // // // // // // // //                         <SelectItem value="Absent">Absent</SelectItem>
// // // // // // // // // // // // // // // // //                         <SelectItem value="Late">Late</SelectItem>
// // // // // // // // // // // // // // // // //                       </SelectContent>
// // // // // // // // // // // // // // // // //                     </Select>
// // // // // // // // // // // // // // // // //                   </div>
// // // // // // // // // // // // // // // // //                 ))}
// // // // // // // // // // // // // // // // //               </div>
// // // // // // // // // // // // // // // // //             </CardContent>
// // // // // // // // // // // // // // // // //           </Card>

// // // // // // // // // // // // // // // // //           <Button 
// // // // // // // // // // // // // // // // //             onClick={handleSubmit} 
// // // // // // // // // // // // // // // // //             className="w-full mt-4"
// // // // // // // // // // // // // // // // //             disabled={Object.keys(attendance).length === 0}
// // // // // // // // // // // // // // // // //           >
// // // // // // // // // // // // // // // // //             Submit Attendance
// // // // // // // // // // // // // // // // //           </Button>
// // // // // // // // // // // // // // // // //         </TabsContent>

// // // // // // // // // // // // // // // // //         <TabsContent value="analytics">
// // // // // // // // // // // // // // // // //           <AttendanceAnalytics 
// // // // // // // // // // // // // // // // //             attendanceRecords={attendanceRecords} 
// // // // // // // // // // // // // // // // //             employees={employees} 
// // // // // // // // // // // // // // // // //           />
// // // // // // // // // // // // // // // // //         </TabsContent>

// // // // // // // // // // // // // // // // //         <TabsContent value="history">
// // // // // // // // // // // // // // // // //           <Card>
// // // // // // // // // // // // // // // // //             <CardHeader>
// // // // // // // // // // // // // // // // //               <CardTitle>Attendance History</CardTitle>
// // // // // // // // // // // // // // // // //             </CardHeader>
// // // // // // // // // // // // // // // // //             <CardContent>
// // // // // // // // // // // // // // // // //               {/* Implement detailed attendance history view */}
// // // // // // // // // // // // // // // // //               <div>Detailed attendance history coming soon...</div>
// // // // // // // // // // // // // // // // //             </CardContent>
// // // // // // // // // // // // // // // // //           </Card>
// // // // // // // // // // // // // // // // //         </TabsContent>
// // // // // // // // // // // // // // // // //       </Tabs>
// // // // // // // // // // // // // // // // //     </div>
// // // // // // // // // // // // // // // // //   );
// // // // // // // // // // // // // // // // // };

// // // // // // // // // // // // // // // // // export default EmployeeAttendanceSystem;


// // // // // // // // // // // // // // // // import React, { useState, useEffect, useMemo } from 'react';
// // // // // // // // // // // // // // // // import axios from 'axios';

// // // // // // // // // // // // // // // // const EmployeeAttendanceSystem = () => {
// // // // // // // // // // // // // // // //   const [employees, setEmployees] = useState([]);
// // // // // // // // // // // // // // // //   const [attendanceRecords, setAttendanceRecords] = useState([]);
// // // // // // // // // // // // // // // //   const [filteredEmployees, setFilteredEmployees] = useState([]);
// // // // // // // // // // // // // // // //   const [searchQuery, setSearchQuery] = useState('');
// // // // // // // // // // // // // // // //   const [attendance, setAttendance] = useState({});
// // // // // // // // // // // // // // // //   const [activeTab, setActiveTab] = useState('attendance');
// // // // // // // // // // // // // // // //   const [loading, setLoading] = useState(true);
// // // // // // // // // // // // // // // //   const [error, setError] = useState(null);
// // // // // // // // // // // // // // // // const storeid=localStorage.getItem("storeId");
// // // // // // // // // // // // // // // //   // Fetch employees and attendance records
// // // // // // // // // // // // // // // //   useEffect(() => {
// // // // // // // // // // // // // // // //     const fetchData = async () => {
// // // // // // // // // // // // // // // //       try {
// // // // // // // // // // // // // // // //         const [employeesResponse, attendanceResponse] = await Promise.all([
// // // // // // // // // // // // // // // //           axios.get('http://localhost:5004/employees', { headers: { storeId: storeid } }),
// // // // // // // // // // // // // // // //           axios.get('http://localhost:5004/attendance', { headers: { storeId: storeid } })
// // // // // // // // // // // // // // // //         ]);

// // // // // // // // // // // // // // // //         setEmployees(employeesResponse.data);
// // // // // // // // // // // // // // // //         setFilteredEmployees(employeesResponse.data);
// // // // // // // // // // // // // // // //         setAttendanceRecords(attendanceResponse.data);
// // // // // // // // // // // // // // // //       } catch (err) {
// // // // // // // // // // // // // // // //         setError('Failed to fetch data');
// // // // // // // // // // // // // // // //         console.error(err);
// // // // // // // // // // // // // // // //       } finally {
// // // // // // // // // // // // // // // //         setLoading(false);
// // // // // // // // // // // // // // // //       }
// // // // // // // // // // // // // // // //     };

// // // // // // // // // // // // // // // //     fetchData();
// // // // // // // // // // // // // // // //   }, []);

// // // // // // // // // // // // // // // //   // Search and filter employees
// // // // // // // // // // // // // // // //   useEffect(() => {
// // // // // // // // // // // // // // // //     const filtered = employees.filter(employee => {
// // // // // // // // // // // // // // // //       const name = employee.employeeName?.toLowerCase() || '';
// // // // // // // // // // // // // // // //       const id = employee.employeeId?.toLowerCase() || '';
// // // // // // // // // // // // // // // //       const query = searchQuery.toLowerCase();
// // // // // // // // // // // // // // // //       return name.includes(query) || id.includes(query);
// // // // // // // // // // // // // // // //     });
// // // // // // // // // // // // // // // //     setFilteredEmployees(filtered);
// // // // // // // // // // // // // // // //   }, [searchQuery, employees]);

// // // // // // // // // // // // // // // //   // Analytics Calculation
// // // // // // // // // // // // // // // //   const attendanceAnalytics = useMemo(() => {
// // // // // // // // // // // // // // // //     const today = new Date().toISOString().split('T')[0];
    
// // // // // // // // // // // // // // // //     const todayAttendance = attendanceRecords.filter(record => 
// // // // // // // // // // // // // // // //       record.timestamp.split('T')[0] === today
// // // // // // // // // // // // // // // //     );

// // // // // // // // // // // // // // // //     return {
// // // // // // // // // // // // // // // //       totalEmployees: employees.length,
// // // // // // // // // // // // // // // //       presentToday: todayAttendance.filter(r => r.status === 'Present').length,
// // // // // // // // // // // // // // // //       absentToday: todayAttendance.filter(r => r.status === 'Absent').length,
// // // // // // // // // // // // // // // //       lateToday: todayAttendance.filter(r => r.status === 'Late').length
// // // // // // // // // // // // // // // //     };
// // // // // // // // // // // // // // // //   }, [attendanceRecords, employees]);

// // // // // // // // // // // // // // // //   // Handle attendance status change
// // // // // // // // // // // // // // // //   const handleStatusChange = (employeeId, status) => {
// // // // // // // // // // // // // // // //     setAttendance(prev => ({
// // // // // // // // // // // // // // // //       ...prev,
// // // // // // // // // // // // // // // //       [employeeId]: status
// // // // // // // // // // // // // // // //     }));
// // // // // // // // // // // // // // // //   };

// // // // // // // // // // // // // // // //   // Submit attendance
// // // // // // // // // // // // // // // //   const handleSubmit = async () => {
// // // // // // // // // // // // // // // //     try {
// // // // // // // // // // // // // // // //       const records = Object.keys(attendance).map(employeeId => ({
// // // // // // // // // // // // // // // //         employeeId,
// // // // // // // // // // // // // // // //         status: attendance[employeeId],
// // // // // // // // // // // // // // // //         timestamp: new Date().toISOString()
// // // // // // // // // // // // // // // //       }));

// // // // // // // // // // // // // // // //       await axios.post('http://localhost:5004/attendance', records, {
// // // // // // // // // // // // // // // //         headers: { storeId: 'your_store_id' }
// // // // // // // // // // // // // // // //       });

// // // // // // // // // // // // // // // //       alert('Attendance recorded successfully!');
// // // // // // // // // // // // // // // //       setAttendance({});
// // // // // // // // // // // // // // // //     } catch (err) {
// // // // // // // // // // // // // // // //       setError('Failed to record attendance');
// // // // // // // // // // // // // // // //       console.error(err);
// // // // // // // // // // // // // // // //     }
// // // // // // // // // // // // // // // //   };

// // // // // // // // // // // // // // // //   if (loading) return <div className="text-center py-10">Loading...</div>;
// // // // // // // // // // // // // // // //   if (error) return <div className="text-red-500 text-center py-10">{error}</div>;

// // // // // // // // // // // // // // // //   return (
// // // // // // // // // // // // // // // //     <div className="container mx-auto p-6 max-w-4xl">
// // // // // // // // // // // // // // // //       <h1 className="text-3xl font-bold mb-6 text-center">Employee Attendance System</h1>

// // // // // // // // // // // // // // // //       {/* Tabs */}
// // // // // // // // // // // // // // // //       <div className="flex mb-6 border-b">
// // // // // // // // // // // // // // // //         {['attendance', 'analytics', 'history'].map(tab => (
// // // // // // // // // // // // // // // //           <button
// // // // // // // // // // // // // // // //             key={tab}
// // // // // // // // // // // // // // // //             className={`px-4 py-2 font-semibold 
// // // // // // // // // // // // // // // //               ${activeTab === tab 
// // // // // // // // // // // // // // // //                 ? 'border-b-2 border-blue-500 text-blue-600' 
// // // // // // // // // // // // // // // //                 : 'text-gray-600 hover:text-gray-800'
// // // // // // // // // // // // // // // //               }`}
// // // // // // // // // // // // // // // //             onClick={() => setActiveTab(tab)}
// // // // // // // // // // // // // // // //           >
// // // // // // // // // // // // // // // //             {tab.charAt(0).toUpperCase() + tab.slice(1)}
// // // // // // // // // // // // // // // //           </button>
// // // // // // // // // // // // // // // //         ))}
// // // // // // // // // // // // // // // //       </div>

// // // // // // // // // // // // // // // //       {/* Attendance Tab */}
// // // // // // // // // // // // // // // //       {activeTab === 'attendance' && (
// // // // // // // // // // // // // // // //         <div>
// // // // // // // // // // // // // // // //           {/* Search Input */}
// // // // // // // // // // // // // // // //           <input
// // // // // // // // // // // // // // // //             type="text"
// // // // // // // // // // // // // // // //             placeholder="Search by Employee Name or ID"
// // // // // // // // // // // // // // // //             className="w-full px-4 py-2 border rounded-lg mb-4 focus:outline-none focus:ring-2 focus:ring-blue-500"
// // // // // // // // // // // // // // // //             value={searchQuery}
// // // // // // // // // // // // // // // //             onChange={(e) => setSearchQuery(e.target.value)}
// // // // // // // // // // // // // // // //           />

// // // // // // // // // // // // // // // //           {/* Employee List */}
// // // // // // // // // // // // // // // //           <div className="space-y-2">
// // // // // // // // // // // // // // // //             {filteredEmployees.map(employee => (
// // // // // // // // // // // // // // // //               <div 
// // // // // // // // // // // // // // // //                 key={employee._id} 
// // // // // // // // // // // // // // // //                 className="flex justify-between items-center p-3 border rounded-lg hover:bg-gray-50 transition"
// // // // // // // // // // // // // // // //               >
// // // // // // // // // // // // // // // //                 <div>
// // // // // // // // // // // // // // // //                   <h3 className="font-semibold">{employee.employeeName}</h3>
// // // // // // // // // // // // // // // //                   <p className="text-sm text-gray-500">ID: {employee.employeeId}</p>
// // // // // // // // // // // // // // // //                 </div>
// // // // // // // // // // // // // // // //                 <select
// // // // // // // // // // // // // // // //                   className="px-3 py-1 border rounded"
// // // // // // // // // // // // // // // //                   value={attendance[employee.employeeId] || ''}
// // // // // // // // // // // // // // // //                   onChange={(e) => handleStatusChange(employee.employeeId, e.target.value)}
// // // // // // // // // // // // // // // //                 >
// // // // // // // // // // // // // // // //                   <option value="">Select Status</option>
// // // // // // // // // // // // // // // //                   <option value="Present">Present</option>
// // // // // // // // // // // // // // // //                   <option value="Absent">Absent</option>
// // // // // // // // // // // // // // // //                   <option value="Late">Late</option>
// // // // // // // // // // // // // // // //                 </select>
// // // // // // // // // // // // // // // //               </div>
// // // // // // // // // // // // // // // //             ))}
// // // // // // // // // // // // // // // //           </div>

// // // // // // // // // // // // // // // //           {/* Submit Button */}
// // // // // // // // // // // // // // // //           <button 
// // // // // // // // // // // // // // // //             onClick={handleSubmit}
// // // // // // // // // // // // // // // //             disabled={Object.keys(attendance).length === 0}
// // // // // // // // // // // // // // // //             className="w-full mt-4 bg-blue-500 text-white py-2 rounded-lg 
// // // // // // // // // // // // // // // //               hover:bg-blue-600 transition disabled:bg-gray-300 disabled:cursor-not-allowed"
// // // // // // // // // // // // // // // //           >
// // // // // // // // // // // // // // // //             Submit Attendance
// // // // // // // // // // // // // // // //           </button>
// // // // // // // // // // // // // // // //         </div>
// // // // // // // // // // // // // // // //       )}

// // // // // // // // // // // // // // // //       {/* Analytics Tab */}
// // // // // // // // // // // // // // // //       {activeTab === 'analytics' && (
// // // // // // // // // // // // // // // //         <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
// // // // // // // // // // // // // // // //           {[
// // // // // // // // // // // // // // // //             { label: 'Total Employees', value: attendanceAnalytics.totalEmployees, color: 'text-blue-600' },
// // // // // // // // // // // // // // // //             { label: 'Present Today', value: attendanceAnalytics.presentToday, color: 'text-green-600' },
// // // // // // // // // // // // // // // //             { label: 'Absent Today', value: attendanceAnalytics.absentToday, color: 'text-red-600' },
// // // // // // // // // // // // // // // //             { label: 'Late Today', value: attendanceAnalytics.lateToday, color: 'text-yellow-600' }
// // // // // // // // // // // // // // // //           ].map(({ label, value, color }) => (
// // // // // // // // // // // // // // // //             <div key={label} className="bg-white border rounded-lg p-4 text-center shadow-sm">
// // // // // // // // // // // // // // // //               <h3 className="text-sm text-gray-500 mb-2">{label}</h3>
// // // // // // // // // // // // // // // //               <div className={`text-2xl font-bold ${color}`}>{value}</div>
// // // // // // // // // // // // // // // //             </div>
// // // // // // // // // // // // // // // //           ))}
// // // // // // // // // // // // // // // //         </div>
// // // // // // // // // // // // // // // //       )}

// // // // // // // // // // // // // // // //       {/* Attendance History Tab */}
// // // // // // // // // // // // // // // //       {activeTab === 'history' && (
// // // // // // // // // // // // // // // //         <div className="bg-white border rounded-lg p-4">
// // // // // // // // // // // // // // // //           <h2 className="text-xl font-semibold mb-4">Attendance History</h2>
// // // // // // // // // // // // // // // //           <table className="w-full">
// // // // // // // // // // // // // // // //             <thead>
// // // // // // // // // // // // // // // //               <tr className="bg-gray-100">
// // // // // // // // // // // // // // // //                 <th className="p-2 text-left">Employee ID</th>
// // // // // // // // // // // // // // // //                 <th className="p-2 text-left">Status</th>
// // // // // // // // // // // // // // // //                 <th className="p-2 text-left">Date</th>
// // // // // // // // // // // // // // // //               </tr>
// // // // // // // // // // // // // // // //             </thead>
// // // // // // // // // // // // // // // //             <tbody>
// // // // // // // // // // // // // // // //               {attendanceRecords.slice(0, 10).map((record, index) => (
// // // // // // // // // // // // // // // //                 <tr key={index} className="border-b">
// // // // // // // // // // // // // // // //                   <td className="p-2">{record.employeeId}</td>
// // // // // // // // // // // // // // // //                   <td className="p-2">
// // // // // // // // // // // // // // // //                     <span className={`
// // // // // // // // // // // // // // // //                       px-2 py-1 rounded text-xs
// // // // // // // // // // // // // // // //                       ${record.status === 'Present' ? 'bg-green-100 text-green-800' : 
// // // // // // // // // // // // // // // //                         record.status === 'Absent' ? 'bg-red-100 text-red-800' : 
// // // // // // // // // // // // // // // //                         'bg-yellow-100 text-yellow-800'
// // // // // // // // // // // // // // // //                       }
// // // // // // // // // // // // // // // //                     `}>
// // // // // // // // // // // // // // // //                       {record.status}
// // // // // // // // // // // // // // // //                     </span>
// // // // // // // // // // // // // // // //                   </td>
// // // // // // // // // // // // // // // //                   <td className="p-2">{new Date(record.timestamp).toLocaleString()}</td>
// // // // // // // // // // // // // // // //                 </tr>
// // // // // // // // // // // // // // // //               ))}
// // // // // // // // // // // // // // // //             </tbody>
// // // // // // // // // // // // // // // //           </table>
// // // // // // // // // // // // // // // //         </div>
// // // // // // // // // // // // // // // //       )}
// // // // // // // // // // // // // // // //     </div>
// // // // // // // // // // // // // // // //   );
// // // // // // // // // // // // // // // // };

// // // // // // // // // // // // // // // // export default EmployeeAttendanceSystem;

// // // // // // // // // // // // // // // // import React, { useState, useEffect, useMemo } from 'react';
// // // // // // // // // // // // // // // // import axios from 'axios';

// // // // // // // // // // // // // // // // const EmployeeAttendanceSystem = () => {
// // // // // // // // // // // // // // // //   const [employees, setEmployees] = useState([]);
// // // // // // // // // // // // // // // //   const [attendanceRecords, setAttendanceRecords] = useState([]);
// // // // // // // // // // // // // // // //   const [filteredEmployees, setFilteredEmployees] = useState([]);
// // // // // // // // // // // // // // // //   const [searchQuery, setSearchQuery] = useState('');
// // // // // // // // // // // // // // // //   const [attendance, setAttendance] = useState({});
// // // // // // // // // // // // // // // //   const [activeTab, setActiveTab] = useState('attendance');
// // // // // // // // // // // // // // // //   const [loading, setLoading] = useState(true);
// // // // // // // // // // // // // // // //   const [error, setError] = useState(null);

// // // // // // // // // // // // // // // //   const storeId = localStorage.getItem("storeId");

// // // // // // // // // // // // // // // //   useEffect(() => {
// // // // // // // // // // // // // // // //     const fetchData = async () => {
// // // // // // // // // // // // // // // //       try {
// // // // // // // // // // // // // // // //         const [employeesResponse, attendanceResponse] = await Promise.all([
// // // // // // // // // // // // // // // //           axios.get('http://localhost:5004/employees', { headers: { storeId } }),
// // // // // // // // // // // // // // // //           axios.get('http://localhost:5004/attendance', { headers: { storeId } })
// // // // // // // // // // // // // // // //         ]);

// // // // // // // // // // // // // // // //         setEmployees(employeesResponse.data);
// // // // // // // // // // // // // // // //         setFilteredEmployees(employeesResponse.data);
// // // // // // // // // // // // // // // //         setAttendanceRecords(attendanceResponse.data);
// // // // // // // // // // // // // // // //       } catch (err) {
// // // // // // // // // // // // // // // //         setError('Failed to fetch data');
// // // // // // // // // // // // // // // //         console.error(err);
// // // // // // // // // // // // // // // //       } finally {
// // // // // // // // // // // // // // // //         setLoading(false);
// // // // // // // // // // // // // // // //       }
// // // // // // // // // // // // // // // //     };

// // // // // // // // // // // // // // // //     fetchData();
// // // // // // // // // // // // // // // //   }, [storeId]);

// // // // // // // // // // // // // // // //   useEffect(() => {
// // // // // // // // // // // // // // // //     const filtered = employees.filter(employee => {
// // // // // // // // // // // // // // // //       const name = employee.employeeName?.toLowerCase() || '';
// // // // // // // // // // // // // // // //       const id = employee.employeeId?.toLowerCase() || '';
// // // // // // // // // // // // // // // //       const query = searchQuery.toLowerCase();
// // // // // // // // // // // // // // // //       return name.includes(query) || id.includes(query);
// // // // // // // // // // // // // // // //     });
// // // // // // // // // // // // // // // //     setFilteredEmployees(filtered);
// // // // // // // // // // // // // // // //   }, [searchQuery, employees]);
// // // // // // // // // // // // // // // //   useEffect(() => {
// // // // // // // // // // // // // // // //     console.log("Updated Attendance Records:", attendanceRecords);
// // // // // // // // // // // // // // // //   }, [attendanceRecords]);
  
// // // // // // // // // // // // // // // //   // const attendanceAnalytics = useMemo(() => {
// // // // // // // // // // // // // // // //   //   const today = new Date().toISOString().split('T')[0];

// // // // // // // // // // // // // // // //   //   const todayAttendance = attendanceRecords.filter(record => {
// // // // // // // // // // // // // // // //   //     const recordDate = record.timestamp ? new Date(record.timestamp).toISOString().split('T')[0] : null;
// // // // // // // // // // // // // // // //   //     return recordDate === today;
// // // // // // // // // // // // // // // //   //   });

// // // // // // // // // // // // // // // //   //   return {
// // // // // // // // // // // // // // // //   //     totalEmployees: employees.length,
// // // // // // // // // // // // // // // //   //     presentToday: todayAttendance.filter(r => r.status === 'Present').length,
// // // // // // // // // // // // // // // //   //     absentToday: todayAttendance.filter(r => r.status === 'Absent').length,
// // // // // // // // // // // // // // // //   //     lateToday: todayAttendance.filter(r => r.status === 'Late').length
// // // // // // // // // // // // // // // //   //   };
// // // // // // // // // // // // // // // //   // }, [attendanceRecords, employees]);
// // // // // // // // // // // // // // // //   // const attendanceAnalytics = useMemo(() => {
// // // // // // // // // // // // // // // //   //   const today = new Date().toISOString().split('T')[0];
  
// // // // // // // // // // // // // // // //   //   const todayAttendance = attendanceRecords.filter(record => {
// // // // // // // // // // // // // // // //   //     if (!record.timestamp) return false; // Ensure timestamp exists
// // // // // // // // // // // // // // // //   //     const recordDate = new Date(record.timestamp);
      
// // // // // // // // // // // // // // // //   //     if (isNaN(recordDate.getTime())) return false; // Check if it's a valid date
  
// // // // // // // // // // // // // // // //   //     return recordDate.toISOString().split('T')[0] === today;
// // // // // // // // // // // // // // // //   //   });
// // // // // // // // // // // // // // // //   const attendanceAnalytics = useMemo(() => {
// // // // // // // // // // // // // // // //     if (!attendanceRecords || attendanceRecords.length === 0) return {
// // // // // // // // // // // // // // // //       totalEmployees: employees.length,
// // // // // // // // // // // // // // // //       presentToday: 0,
// // // // // // // // // // // // // // // //       absentToday: employees.length, // Default all as absent if no data
// // // // // // // // // // // // // // // //       lateToday: 0
// // // // // // // // // // // // // // // //     };
  
// // // // // // // // // // // // // // // //     const today = new Date().toISOString().split('T')[0];
  
// // // // // // // // // // // // // // // //     const todayAttendance = attendanceRecords.filter(record => {
// // // // // // // // // // // // // // // //       if (!record.timestamp) return false; 
// // // // // // // // // // // // // // // //       const recordDate = new Date(record.timestamp);
// // // // // // // // // // // // // // // //       if (isNaN(recordDate.getTime())) return false; 
// // // // // // // // // // // // // // // //       return recordDate.toISOString().split('T')[0] === today;
// // // // // // // // // // // // // // // //     });
  
// // // // // // // // // // // // // // // //     return {
// // // // // // // // // // // // // // // //       totalEmployees: employees.length,
// // // // // // // // // // // // // // // //       presentToday: todayAttendance.filter(r => r.status === 'Present').length,
// // // // // // // // // // // // // // // //       absentToday: employees.length - todayAttendance.length, // Employees not in records are absent
// // // // // // // // // // // // // // // //       lateToday: todayAttendance.filter(r => r.status === 'Late').length
// // // // // // // // // // // // // // // //     };
// // // // // // // // // // // // // // // //   }, [attendanceRecords, employees]);
  
// // // // // // // // // // // // // // // //     return {
// // // // // // // // // // // // // // // //       totalEmployees: employees.length,
// // // // // // // // // // // // // // // //       presentToday: todayAttendance.filter(r => r.status === 'Present').length,
// // // // // // // // // // // // // // // //       absentToday: todayAttendance.filter(r => r.status === 'Absent').length,
// // // // // // // // // // // // // // // //       lateToday: todayAttendance.filter(r => r.status === 'Late').length
// // // // // // // // // // // // // // // //     };
// // // // // // // // // // // // // // // //   }, [attendanceRecords, employees]);
  
// // // // // // // // // // // // // // // //   const handleStatusChange = (employeeId, status) => {
// // // // // // // // // // // // // // // //     setAttendance(prev => ({
// // // // // // // // // // // // // // // //       ...prev,
// // // // // // // // // // // // // // // //       [employeeId]: status
// // // // // // // // // // // // // // // //     }));
// // // // // // // // // // // // // // // //   };

// // // // // // // // // // // // // // // //   const handleSubmit = async () => {
// // // // // // // // // // // // // // // //     try {
// // // // // // // // // // // // // // // //       const records = Object.keys(attendance).map(employeeId => ({
// // // // // // // // // // // // // // // //         employeeId,
// // // // // // // // // // // // // // // //         status: attendance[employeeId],
// // // // // // // // // // // // // // // //         timestamp: new Date().toISOString()
// // // // // // // // // // // // // // // //       }));

// // // // // // // // // // // // // // // //       await axios.post('http://localhost:5004/attendance', records, { headers: { storeId } });

// // // // // // // // // // // // // // // //       alert('Attendance recorded successfully!');
// // // // // // // // // // // // // // // //       setAttendance({});
// // // // // // // // // // // // // // // //     } catch (err) {
// // // // // // // // // // // // // // // //       setError('Failed to record attendance');
// // // // // // // // // // // // // // // //       console.error(err);
// // // // // // // // // // // // // // // //     }
// // // // // // // // // // // // // // // //   };

// // // // // // // // // // // // // // // //   if (loading) return <div className="text-center py-10">Loading...</div>;
// // // // // // // // // // // // // // // //   if (error) return <div className="text-red-500 text-center py-10">{error}</div>;

// // // // // // // // // // // // // // // //   return (
// // // // // // // // // // // // // // // //     <div className="container mx-auto p-6 max-w-4xl">
// // // // // // // // // // // // // // // //       <h1 className="text-3xl font-bold mb-6 text-center">Employee Attendance System</h1>

// // // // // // // // // // // // // // // //       <div className="flex mb-6 border-b">
// // // // // // // // // // // // // // // //         {['attendance', 'analytics', 'history'].map(tab => (
// // // // // // // // // // // // // // // //           <button
// // // // // // // // // // // // // // // //             key={tab}
// // // // // // // // // // // // // // // //             className={`px-4 py-2 font-semibold ${activeTab === tab ? 'border-b-2 border-blue-500 text-blue-600' : 'text-gray-600 hover:text-gray-800'}`}
// // // // // // // // // // // // // // // //             onClick={() => setActiveTab(tab)}
// // // // // // // // // // // // // // // //           >
// // // // // // // // // // // // // // // //             {tab.charAt(0).toUpperCase() + tab.slice(1)}
// // // // // // // // // // // // // // // //           </button>
// // // // // // // // // // // // // // // //         ))}
// // // // // // // // // // // // // // // //       </div>

// // // // // // // // // // // // // // // //       {activeTab === 'attendance' && (
// // // // // // // // // // // // // // // //         <div>
// // // // // // // // // // // // // // // //           <input
// // // // // // // // // // // // // // // //             type="text"
// // // // // // // // // // // // // // // //             placeholder="Search by Employee Name or ID"
// // // // // // // // // // // // // // // //             className="w-full px-4 py-2 border rounded-lg mb-4"
// // // // // // // // // // // // // // // //             value={searchQuery}
// // // // // // // // // // // // // // // //             onChange={(e) => setSearchQuery(e.target.value)}
// // // // // // // // // // // // // // // //           />
// // // // // // // // // // // // // // // //           <div className="space-y-2">
// // // // // // // // // // // // // // // //             {filteredEmployees.map(employee => (
// // // // // // // // // // // // // // // //               <div key={employee._id} className="flex justify-between p-3 border rounded-lg">
// // // // // // // // // // // // // // // //                 <div>
// // // // // // // // // // // // // // // //                   <h3 className="font-semibold">{employee.employeeName}</h3>
// // // // // // // // // // // // // // // //                   <p className="text-sm text-gray-500">ID: {employee.employeeId}</p>
// // // // // // // // // // // // // // // //                 </div>
// // // // // // // // // // // // // // // //                 <select className="px-3 py-1 border rounded" value={attendance[employee.employeeId] || ''} onChange={(e) => handleStatusChange(employee.employeeId, e.target.value)}>
// // // // // // // // // // // // // // // //                   <option value="">Select Status</option>
// // // // // // // // // // // // // // // //                   <option value="Present">Present</option>
// // // // // // // // // // // // // // // //                   <option value="Absent">Absent</option>
// // // // // // // // // // // // // // // //                   <option value="Late">Late</option>
// // // // // // // // // // // // // // // //                 </select>
// // // // // // // // // // // // // // // //               </div>
// // // // // // // // // // // // // // // //             ))}
// // // // // // // // // // // // // // // //           </div>
// // // // // // // // // // // // // // // //           <button onClick={handleSubmit} disabled={!Object.keys(attendance).length} className="w-full mt-4 bg-blue-500 text-white py-2 rounded-lg hover:bg-blue-600">
// // // // // // // // // // // // // // // //             Submit Attendance
// // // // // // // // // // // // // // // //           </button>
// // // // // // // // // // // // // // // //         </div>
// // // // // // // // // // // // // // // //       )}
// // // // // // // // // // // // // // // // {attendanceRecords.map((record, index) => (
// // // // // // // // // // // // // // // //   <div key={index}>
// // // // // // // // // // // // // // // //     <p>{record.employeeName} - {record.status} ({new Date(record.timestamp).toLocaleString()})</p>
// // // // // // // // // // // // // // // //   </div>
// // // // // // // // // // // // // // // // ))}

// // // // // // // // // // // // // // // //       {activeTab === 'analytics' && (
// // // // // // // // // // // // // // // //         <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
// // // // // // // // // // // // // // // //           {[
// // // // // // // // // // // // // // // //             { label: 'Total Employees', value: attendanceAnalytics.totalEmployees, color: 'text-blue-600' },
// // // // // // // // // // // // // // // //             { label: 'Present Today', value: attendanceAnalytics.presentToday, color: 'text-green-600' },
// // // // // // // // // // // // // // // //             { label: 'Absent Today', value: attendanceAnalytics.absentToday, color: 'text-red-600' },
// // // // // // // // // // // // // // // //             { label: 'Late Today', value: attendanceAnalytics.lateToday, color: 'text-yellow-600' }
// // // // // // // // // // // // // // // //           ].map(({ label, value, color }) => (
// // // // // // // // // // // // // // // //             <div key={label} className="bg-white border rounded-lg p-4 text-center">
// // // // // // // // // // // // // // // //               <h3 className="text-sm text-gray-500">{label}</h3>
// // // // // // // // // // // // // // // //               <div className={`text-2xl font-bold ${color}`}>{value}</div>
// // // // // // // // // // // // // // // //             </div>
// // // // // // // // // // // // // // // //           ))}
// // // // // // // // // // // // // // // //         </div>
// // // // // // // // // // // // // // // //       )}
// // // // // // // // // // // // // // // //     </div>
// // // // // // // // // // // // // // // //   );
// // // // // // // // // // // // // // // // };

// // // // // // // // // // // // // // // // export default EmployeeAttendanceSystem;
// // // // // // // // // // // // // // // import React, { useState, useEffect, useMemo } from 'react';
// // // // // // // // // // // // // // // import axios from 'axios';

// // // // // // // // // // // // // // // const EmployeeAttendanceSystem = () => {
// // // // // // // // // // // // // // //   const [employees, setEmployees] = useState([]);
// // // // // // // // // // // // // // //   const [attendanceRecords, setAttendanceRecords] = useState([]);
// // // // // // // // // // // // // // //   const [filteredEmployees, setFilteredEmployees] = useState([]);
// // // // // // // // // // // // // // //   const [searchQuery, setSearchQuery] = useState('');
// // // // // // // // // // // // // // //   const [attendance, setAttendance] = useState({});
// // // // // // // // // // // // // // //   const [activeTab, setActiveTab] = useState('attendance');
// // // // // // // // // // // // // // //   const [loading, setLoading] = useState(true);
// // // // // // // // // // // // // // //   const [error, setError] = useState(null);

// // // // // // // // // // // // // // //   const storeId = localStorage.getItem("storeId");

// // // // // // // // // // // // // // //   useEffect(() => {
// // // // // // // // // // // // // // //     const fetchData = async () => {
// // // // // // // // // // // // // // //       try {
// // // // // // // // // // // // // // //         const [employeesResponse, attendanceResponse] = await Promise.all([
// // // // // // // // // // // // // // //           axios.get('http://localhost:5004/employees', { headers: { storeId } }),
// // // // // // // // // // // // // // //           axios.get('http://localhost:5004/attendance', { headers: { storeId } })
// // // // // // // // // // // // // // //         ]);

// // // // // // // // // // // // // // //         setEmployees(employeesResponse.data);
// // // // // // // // // // // // // // //         setFilteredEmployees(employeesResponse.data);
// // // // // // // // // // // // // // //         setAttendanceRecords(attendanceResponse.data);
// // // // // // // // // // // // // // //       } catch (err) {
// // // // // // // // // // // // // // //         setError('Failed to fetch data');
// // // // // // // // // // // // // // //         console.error(err);
// // // // // // // // // // // // // // //       } finally {
// // // // // // // // // // // // // // //         setLoading(false);
// // // // // // // // // // // // // // //       }
// // // // // // // // // // // // // // //     };

// // // // // // // // // // // // // // //     fetchData();
// // // // // // // // // // // // // // //   }, [storeId]);

// // // // // // // // // // // // // // //   useEffect(() => {
// // // // // // // // // // // // // // //     const filtered = employees.filter(employee => {
// // // // // // // // // // // // // // //       const name = employee.employeeName?.toLowerCase() || '';
// // // // // // // // // // // // // // //       const id = employee.employeeId?.toLowerCase() || '';
// // // // // // // // // // // // // // //       const query = searchQuery.toLowerCase();
// // // // // // // // // // // // // // //       return name.includes(query) || id.includes(query);
// // // // // // // // // // // // // // //     });
// // // // // // // // // // // // // // //     setFilteredEmployees(filtered);
// // // // // // // // // // // // // // //   }, [searchQuery, employees]);

// // // // // // // // // // // // // // //   useEffect(() => {
// // // // // // // // // // // // // // //     console.log("Updated Attendance Records:", attendanceRecords);
// // // // // // // // // // // // // // //   }, [attendanceRecords]);

// // // // // // // // // // // // // // //   const attendanceAnalytics = useMemo(() => {
// // // // // // // // // // // // // // //     if (!attendanceRecords || attendanceRecords.length === 0) {
// // // // // // // // // // // // // // //       return {
// // // // // // // // // // // // // // //         totalEmployees: employees.length,
// // // // // // // // // // // // // // //         presentToday: 0,
// // // // // // // // // // // // // // //         absentToday: employees.length, // Default all as absent if no data
// // // // // // // // // // // // // // //         lateToday: 0
// // // // // // // // // // // // // // //       };
// // // // // // // // // // // // // // //     }

// // // // // // // // // // // // // // //     const today = new Date().toISOString().split('T')[0];

// // // // // // // // // // // // // // //     const todayAttendance = attendanceRecords.filter(record => {
// // // // // // // // // // // // // // //       if (!record.timestamp) return false;
// // // // // // // // // // // // // // //       const recordDate = new Date(record.timestamp);
// // // // // // // // // // // // // // //       if (isNaN(recordDate.getTime())) return false;
// // // // // // // // // // // // // // //       return recordDate.toISOString().split('T')[0] === today;
// // // // // // // // // // // // // // //     });

// // // // // // // // // // // // // // //     return {
// // // // // // // // // // // // // // //       totalEmployees: employees.length,
// // // // // // // // // // // // // // //       presentToday: todayAttendance.filter(r => r.status === 'Present').length,
// // // // // // // // // // // // // // //       absentToday: employees.length - todayAttendance.length, // Employees not in records are absent
// // // // // // // // // // // // // // //       lateToday: todayAttendance.filter(r => r.status === 'Late').length
// // // // // // // // // // // // // // //     };
// // // // // // // // // // // // // // //   }, [attendanceRecords, employees]);

// // // // // // // // // // // // // // //   const handleStatusChange = (employeeId, status) => {
// // // // // // // // // // // // // // //     setAttendance(prev => ({
// // // // // // // // // // // // // // //       ...prev,
// // // // // // // // // // // // // // //       [employeeId]: status
// // // // // // // // // // // // // // //     }));
// // // // // // // // // // // // // // //   };

// // // // // // // // // // // // // // //   const handleSubmit = async () => {
// // // // // // // // // // // // // // //     try {
// // // // // // // // // // // // // // //       const records = Object.keys(attendance).map(employeeId => ({
// // // // // // // // // // // // // // //         employeeId,
// // // // // // // // // // // // // // //         status: attendance[employeeId],
// // // // // // // // // // // // // // //         timestamp: new Date().toISOString()
// // // // // // // // // // // // // // //       }));

// // // // // // // // // // // // // // //       await axios.post('http://localhost:5004/attendance', records, { headers: { storeId } });

// // // // // // // // // // // // // // //       alert('Attendance recorded successfully!');
// // // // // // // // // // // // // // //       setAttendance({});

// // // // // // // // // // // // // // //       // Refresh attendance records after submitting
// // // // // // // // // // // // // // //       const attendanceResponse = await axios.get('http://localhost:5004/attendance', { headers: { storeId } });
// // // // // // // // // // // // // // //       setAttendanceRecords(attendanceResponse.data);
// // // // // // // // // // // // // // //     } catch (err) {
// // // // // // // // // // // // // // //       setError('Failed to record attendance');
// // // // // // // // // // // // // // //       console.error(err);
// // // // // // // // // // // // // // //     }
// // // // // // // // // // // // // // //   };

// // // // // // // // // // // // // // //   if (loading) return <div className="text-center py-10">Loading...</div>;
// // // // // // // // // // // // // // //   if (error) return <div className="text-red-500 text-center py-10">{error}</div>;

// // // // // // // // // // // // // // //   return (
// // // // // // // // // // // // // // //     <div className="container mx-auto p-6 max-w-4xl">
// // // // // // // // // // // // // // //       <h1 className="text-3xl font-bold mb-6 text-center">Employee Attendance System</h1>

// // // // // // // // // // // // // // //       {/* Tabs Navigation */}
// // // // // // // // // // // // // // //       <div className="flex mb-6 border-b">
// // // // // // // // // // // // // // //         {['attendance', 'analytics', 'history'].map(tab => (
// // // // // // // // // // // // // // //           <button
// // // // // // // // // // // // // // //             key={tab}
// // // // // // // // // // // // // // //             className={`px-4 py-2 font-semibold ${activeTab === tab ? 'border-b-2 border-blue-500 text-blue-600' : 'text-gray-600 hover:text-gray-800'}`}
// // // // // // // // // // // // // // //             onClick={() => setActiveTab(tab)}
// // // // // // // // // // // // // // //           >
// // // // // // // // // // // // // // //             {tab.charAt(0).toUpperCase() + tab.slice(1)}
// // // // // // // // // // // // // // //           </button>
// // // // // // // // // // // // // // //         ))}
// // // // // // // // // // // // // // //       </div>

// // // // // // // // // // // // // // //       {/* Attendance Marking */}
// // // // // // // // // // // // // // //       {activeTab === 'attendance' && (
// // // // // // // // // // // // // // //         <div>
// // // // // // // // // // // // // // //           <input
// // // // // // // // // // // // // // //             type="text"
// // // // // // // // // // // // // // //             placeholder="Search by Employee Name or ID"
// // // // // // // // // // // // // // //             className="w-full px-4 py-2 border rounded-lg mb-4"
// // // // // // // // // // // // // // //             value={searchQuery}
// // // // // // // // // // // // // // //             onChange={(e) => setSearchQuery(e.target.value)}
// // // // // // // // // // // // // // //           />
// // // // // // // // // // // // // // //           <div className="space-y-2">
// // // // // // // // // // // // // // //             {filteredEmployees.map(employee => (
// // // // // // // // // // // // // // //               <div key={employee._id} className="flex justify-between p-3 border rounded-lg">
// // // // // // // // // // // // // // //                 <div>
// // // // // // // // // // // // // // //                   <h3 className="font-semibold">{employee.employeeName}</h3>
// // // // // // // // // // // // // // //                   <p className="text-sm text-gray-500">ID: {employee.employeeId}</p>
// // // // // // // // // // // // // // //                 </div>
// // // // // // // // // // // // // // //                 <select
// // // // // // // // // // // // // // //                   className="px-3 py-1 border rounded"
// // // // // // // // // // // // // // //                   value={attendance[employee.employeeId] || ''}
// // // // // // // // // // // // // // //                   onChange={(e) => handleStatusChange(employee.employeeId, e.target.value)}
// // // // // // // // // // // // // // //                 >
// // // // // // // // // // // // // // //                   <option value="">Select Status</option>
// // // // // // // // // // // // // // //                   <option value="Present">Present</option>
// // // // // // // // // // // // // // //                   <option value="Absent">Absent</option>
// // // // // // // // // // // // // // //                   <option value="Late">Late</option>
// // // // // // // // // // // // // // //                 </select>
// // // // // // // // // // // // // // //               </div>
// // // // // // // // // // // // // // //             ))}
// // // // // // // // // // // // // // //           </div>
// // // // // // // // // // // // // // //           <button
// // // // // // // // // // // // // // //             onClick={handleSubmit}
// // // // // // // // // // // // // // //             disabled={!Object.keys(attendance).length}
// // // // // // // // // // // // // // //             className="w-full mt-4 bg-blue-500 text-white py-2 rounded-lg hover:bg-blue-600"
// // // // // // // // // // // // // // //           >
// // // // // // // // // // // // // // //             Submit Attendance
// // // // // // // // // // // // // // //           </button>
// // // // // // // // // // // // // // //         </div>
// // // // // // // // // // // // // // //       )}

// // // // // // // // // // // // // // //       {/* Attendance Analytics */}
// // // // // // // // // // // // // // //       {activeTab === 'analytics' && (
// // // // // // // // // // // // // // //         <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
// // // // // // // // // // // // // // //           {[
// // // // // // // // // // // // // // //             { label: 'Total Employees', value: attendanceAnalytics.totalEmployees, color: 'text-blue-600' },
// // // // // // // // // // // // // // //             { label: 'Present Today', value: attendanceAnalytics.presentToday, color: 'text-green-600' },
// // // // // // // // // // // // // // //             { label: 'Absent Today', value: attendanceAnalytics.absentToday, color: 'text-red-600' },
// // // // // // // // // // // // // // //             { label: 'Late Today', value: attendanceAnalytics.lateToday, color: 'text-yellow-600' }
// // // // // // // // // // // // // // //           ].map(({ label, value, color }) => (
// // // // // // // // // // // // // // //             <div key={label} className="bg-white border rounded-lg p-4 text-center">
// // // // // // // // // // // // // // //               <h3 className="text-sm text-gray-500">{label}</h3>
// // // // // // // // // // // // // // //               <div className={`text-2xl font-bold ${color}`}>{value}</div>
// // // // // // // // // // // // // // //             </div>
// // // // // // // // // // // // // // //           ))}
// // // // // // // // // // // // // // //         </div>
// // // // // // // // // // // // // // //       )}

// // // // // // // // // // // // // // //       {/* Attendance History */}
// // // // // // // // // // // // // // //       {activeTab === 'history' && (
// // // // // // // // // // // // // // //         <div className="mt-4">
// // // // // // // // // // // // // // //           {attendanceRecords.length > 0 ? (
// // // // // // // // // // // // // // //             attendanceRecords.map((record, index) => (
// // // // // // // // // // // // // // //               <div key={index} className="p-2 border-b">
// // // // // // // // // // // // // // //                 <p>
// // // // // // // // // // // // // // //                   {record.employeeName} - {record.status} ({new Date(record.timestamp).toLocaleString()})
// // // // // // // // // // // // // // //                 </p>
// // // // // // // // // // // // // // //               </div>
// // // // // // // // // // // // // // //             ))
// // // // // // // // // // // // // // //           ) : (
// // // // // // // // // // // // // // //             <p className="text-gray-500">No attendance records found.</p>
// // // // // // // // // // // // // // //           )}
// // // // // // // // // // // // // // //         </div>
// // // // // // // // // // // // // // //       )}
// // // // // // // // // // // // // // //     </div>
// // // // // // // // // // // // // // //   );
// // // // // // // // // // // // // // // };

// // // // // // // // // // // // // // // export default EmployeeAttendanceSystem;
// // // // // // // // // // // // // // import React, { useState, useEffect, useMemo } from 'react';
// // // // // // // // // // // // // // import axios from 'axios';

// // // // // // // // // // // // // // const EmployeeAttendanceSystem = () => {
// // // // // // // // // // // // // //   const [employees, setEmployees] = useState([]);
// // // // // // // // // // // // // //   const [attendanceRecords, setAttendanceRecords] = useState([]);
// // // // // // // // // // // // // //   const [filteredEmployees, setFilteredEmployees] = useState([]);
// // // // // // // // // // // // // //   const [searchQuery, setSearchQuery] = useState('');
// // // // // // // // // // // // // //   const [attendance, setAttendance] = useState({});
// // // // // // // // // // // // // //   const [activeTab, setActiveTab] = useState('attendance');
// // // // // // // // // // // // // //   const [loading, setLoading] = useState(true);
// // // // // // // // // // // // // //   const [error, setError] = useState(null);

// // // // // // // // // // // // // //   const storeId = localStorage.getItem("storeId");

// // // // // // // // // // // // // //   useEffect(() => {
// // // // // // // // // // // // // //     const fetchData = async () => {
// // // // // // // // // // // // // //       try {
// // // // // // // // // // // // // //         const [employeesResponse, attendanceResponse] = await Promise.all([
// // // // // // // // // // // // // //           axios.get('http://localhost:5004/employees', { headers: { storeId } }),
// // // // // // // // // // // // // //           axios.get('http://localhost:5004/attendance', { headers: { storeId } })
// // // // // // // // // // // // // //         ]);

// // // // // // // // // // // // // //         setEmployees(employeesResponse.data);
// // // // // // // // // // // // // //         setFilteredEmployees(employeesResponse.data);
// // // // // // // // // // // // // //         setAttendanceRecords(attendanceResponse.data);
// // // // // // // // // // // // // //       } catch (err) {
// // // // // // // // // // // // // //         setError('Failed to fetch data');
// // // // // // // // // // // // // //         console.error(err);
// // // // // // // // // // // // // //       } finally {
// // // // // // // // // // // // // //         setLoading(false);
// // // // // // // // // // // // // //       }
// // // // // // // // // // // // // //     };

// // // // // // // // // // // // // //     fetchData();
// // // // // // // // // // // // // //   }, [storeId]);

// // // // // // // // // // // // // //   useEffect(() => {
// // // // // // // // // // // // // //     const filtered = employees.filter(employee => {
// // // // // // // // // // // // // //       const name = employee.employeeName?.toLowerCase() || '';
// // // // // // // // // // // // // //       const id = employee.employeeId?.toLowerCase() || '';
// // // // // // // // // // // // // //       const query = searchQuery.toLowerCase();
// // // // // // // // // // // // // //       return name.includes(query) || id.includes(query);
// // // // // // // // // // // // // //     });
// // // // // // // // // // // // // //     setFilteredEmployees(filtered);
// // // // // // // // // // // // // //   }, [searchQuery, employees]);

// // // // // // // // // // // // // //   // Fix: Correctly map employee IDs to records
// // // // // // // // // // // // // //   const attendanceAnalytics = useMemo(() => {
// // // // // // // // // // // // // //     if (!attendanceRecords.length) return {
// // // // // // // // // // // // // //       totalEmployees: employees.length,
// // // // // // // // // // // // // //       presentToday: 0,
// // // // // // // // // // // // // //       absentToday: employees.length, // Default all as absent if no data
// // // // // // // // // // // // // //       lateToday: 0
// // // // // // // // // // // // // //     };

// // // // // // // // // // // // // //     const today = new Date().toISOString().split('T')[0];

// // // // // // // // // // // // // //     const todayAttendance = attendanceRecords.filter(record => {
// // // // // // // // // // // // // //       if (!record.timestamp) return false;
// // // // // // // // // // // // // //       const recordDate = new Date(record.timestamp);
// // // // // // // // // // // // // //       if (isNaN(recordDate.getTime())) return false;
// // // // // // // // // // // // // //       return recordDate.toISOString().split('T')[0] === today;
// // // // // // // // // // // // // //     });

// // // // // // // // // // // // // //     const present = todayAttendance.filter(r => r.status === 'Present').length;
// // // // // // // // // // // // // //     const late = todayAttendance.filter(r => r.status === 'Late').length;

// // // // // // // // // // // // // //     return {
// // // // // // // // // // // // // //       totalEmployees: employees.length,
// // // // // // // // // // // // // //       presentToday: present,
// // // // // // // // // // // // // //       absentToday: employees.length - present - late,
// // // // // // // // // // // // // //       lateToday: late
// // // // // // // // // // // // // //     };
// // // // // // // // // // // // // //   }, [attendanceRecords, employees]);

// // // // // // // // // // // // // //   const handleStatusChange = (employeeId, status) => {
// // // // // // // // // // // // // //     setAttendance(prev => ({
// // // // // // // // // // // // // //       ...prev,
// // // // // // // // // // // // // //       [employeeId]: status
// // // // // // // // // // // // // //     }));
// // // // // // // // // // // // // //   };

// // // // // // // // // // // // // //   const handleSubmit = async () => {
// // // // // // // // // // // // // //     try {
// // // // // // // // // // // // // //       const records = Object.keys(attendance).map(employeeId => ({
// // // // // // // // // // // // // //         employeeId,
// // // // // // // // // // // // // //         status: attendance[employeeId],
// // // // // // // // // // // // // //         timestamp: new Date().toISOString()
// // // // // // // // // // // // // //       }));

// // // // // // // // // // // // // //       await axios.post('http://localhost:5004/attendance', records, { headers: { storeId } });

// // // // // // // // // // // // // //       alert('Attendance recorded successfully!');
// // // // // // // // // // // // // //       setAttendance({});
// // // // // // // // // // // // // //     } catch (err) {
// // // // // // // // // // // // // //       setError('Failed to record attendance');
// // // // // // // // // // // // // //       console.error(err);
// // // // // // // // // // // // // //     }
// // // // // // // // // // // // // //   };

// // // // // // // // // // // // // //   if (loading) return <div className="text-center py-10">Loading...</div>;
// // // // // // // // // // // // // //   if (error) return <div className="text-red-500 text-center py-10">{error}</div>;

// // // // // // // // // // // // // //   return (
// // // // // // // // // // // // // //     <div className="container mx-auto p-6 max-w-4xl">
// // // // // // // // // // // // // //       <h1 className="text-3xl font-bold mb-6 text-center">Employee Attendance System</h1>

// // // // // // // // // // // // // //       <div className="flex mb-6 border-b">
// // // // // // // // // // // // // //         {['attendance', 'analytics', 'history'].map(tab => (
// // // // // // // // // // // // // //           <button
// // // // // // // // // // // // // //             key={tab}
// // // // // // // // // // // // // //             className={`px-4 py-2 font-semibold ${activeTab === tab ? 'border-b-2 border-blue-500 text-blue-600' : 'text-gray-600 hover:text-gray-800'}`}
// // // // // // // // // // // // // //             onClick={() => setActiveTab(tab)}
// // // // // // // // // // // // // //           >
// // // // // // // // // // // // // //             {tab.charAt(0).toUpperCase() + tab.slice(1)}
// // // // // // // // // // // // // //           </button>
// // // // // // // // // // // // // //         ))}
// // // // // // // // // // // // // //       </div>

// // // // // // // // // // // // // //       {activeTab === 'attendance' && (
// // // // // // // // // // // // // //         <div>
// // // // // // // // // // // // // //           <input
// // // // // // // // // // // // // //             type="text"
// // // // // // // // // // // // // //             placeholder="Search by Employee Name or ID"
// // // // // // // // // // // // // //             className="w-full px-4 py-2 border rounded-lg mb-4"
// // // // // // // // // // // // // //             value={searchQuery}
// // // // // // // // // // // // // //             onChange={(e) => setSearchQuery(e.target.value)}
// // // // // // // // // // // // // //           />
// // // // // // // // // // // // // //           <div className="space-y-2">
// // // // // // // // // // // // // //             {filteredEmployees.map(employee => (
// // // // // // // // // // // // // //               <div key={employee._id} className="flex justify-between p-3 border rounded-lg">
// // // // // // // // // // // // // //                 <div>
// // // // // // // // // // // // // //                   <h3 className="font-semibold">{employee.employeeName}</h3>
// // // // // // // // // // // // // //                   <p className="text-sm text-gray-500">ID: {employee.employeeId}</p>
// // // // // // // // // // // // // //                 </div>
// // // // // // // // // // // // // //                 <select className="px-3 py-1 border rounded" value={attendance[employee.employeeId] || ''} onChange={(e) => handleStatusChange(employee.employeeId, e.target.value)}>
// // // // // // // // // // // // // //                   <option value="">Select Status</option>
// // // // // // // // // // // // // //                   <option value="Present">Present</option>
// // // // // // // // // // // // // //                   <option value="Absent">Absent</option>
// // // // // // // // // // // // // //                   <option value="Late">Late</option>
// // // // // // // // // // // // // //                 </select>
// // // // // // // // // // // // // //               </div>
// // // // // // // // // // // // // //             ))}
// // // // // // // // // // // // // //           </div>
// // // // // // // // // // // // // //           <button onClick={handleSubmit} disabled={!Object.keys(attendance).length} className="w-full mt-4 bg-blue-500 text-white py-2 rounded-lg hover:bg-blue-600">
// // // // // // // // // // // // // //             Submit Attendance
// // // // // // // // // // // // // //           </button>
// // // // // // // // // // // // // //         </div>
// // // // // // // // // // // // // //       )}

// // // // // // // // // // // // // //       {activeTab === 'history' && (
// // // // // // // // // // // // // //         <div className="space-y-2">
// // // // // // // // // // // // // //           {attendanceRecords.map((record, index) => {
// // // // // // // // // // // // // //             const formattedDate = record.timestamp ? new Date(record.timestamp).toLocaleString() : "Invalid Date";
// // // // // // // // // // // // // //             return (
// // // // // // // // // // // // // //               <div key={index} className="p-3 border rounded-lg">
// // // // // // // // // // // // // //                 <p>{`Employee ID: ${record.employeeId} - ${record.status} (${formattedDate})`}</p>
// // // // // // // // // // // // // //               </div>
// // // // // // // // // // // // // //             );
// // // // // // // // // // // // // //           })}
// // // // // // // // // // // // // //         </div>
// // // // // // // // // // // // // //       )}

// // // // // // // // // // // // // //       {activeTab === 'analytics' && (
// // // // // // // // // // // // // //         <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
// // // // // // // // // // // // // //           {[
// // // // // // // // // // // // // //             { label: 'Total Employees', value: attendanceAnalytics.totalEmployees, color: 'text-blue-600' },
// // // // // // // // // // // // // //             { label: 'Present Today', value: attendanceAnalytics.presentToday, color: 'text-green-600' },
// // // // // // // // // // // // // //             { label: 'Absent Today', value: attendanceAnalytics.absentToday, color: 'text-red-600' },
// // // // // // // // // // // // // //             { label: 'Late Today', value: attendanceAnalytics.lateToday, color: 'text-yellow-600' }
// // // // // // // // // // // // // //           ].map(({ label, value, color }) => (
// // // // // // // // // // // // // //             <div key={label} className="bg-white border rounded-lg p-4 text-center">
// // // // // // // // // // // // // //               <h3 className="text-sm text-gray-500">{label}</h3>
// // // // // // // // // // // // // //               <div className={`text-2xl font-bold ${color}`}>{value}</div>
// // // // // // // // // // // // // //             </div>
// // // // // // // // // // // // // //           ))}
// // // // // // // // // // // // // //         </div>
// // // // // // // // // // // // // //       )}
// // // // // // // // // // // // // //     </div>
// // // // // // // // // // // // // //   );
// // // // // // // // // // // // // // };

// // // // // // // // // // // // // // export default EmployeeAttendanceSystem;
// // // // // // // // // // // // // import React, { useState, useEffect, useMemo } from 'react';
// // // // // // // // // // // // // import axios from 'axios';

// // // // // // // // // // // // // const EmployeeAttendanceSystem = () => {
// // // // // // // // // // // // //   const [employees, setEmployees] = useState([]);
// // // // // // // // // // // // //   const [attendanceRecords, setAttendanceRecords] = useState([]);
// // // // // // // // // // // // //   const [searchQuery, setSearchQuery] = useState('');
// // // // // // // // // // // // //   const [attendance, setAttendance] = useState({});
// // // // // // // // // // // // //   const [activeTab, setActiveTab] = useState('attendance');
// // // // // // // // // // // // //   const [loading, setLoading] = useState(true);
// // // // // // // // // // // // //   const [error, setError] = useState(null);

// // // // // // // // // // // // //   const storeId = localStorage.getItem("storeId");

// // // // // // // // // // // // //   useEffect(() => {
// // // // // // // // // // // // //     const fetchData = async () => {
// // // // // // // // // // // // //       try {
// // // // // // // // // // // // //         const [employeesResponse, attendanceResponse] = await Promise.all([
// // // // // // // // // // // // //           axios.get('http://localhost:5004/employees', { headers: { storeId } }),
// // // // // // // // // // // // //           axios.get('http://localhost:5004/attendance', { headers: { storeId } })
// // // // // // // // // // // // //         ]);

// // // // // // // // // // // // //         setEmployees(employeesResponse.data);
// // // // // // // // // // // // //         setAttendanceRecords(attendanceResponse.data);
// // // // // // // // // // // // //       } catch (err) {
// // // // // // // // // // // // //         setError('Failed to fetch data');
// // // // // // // // // // // // //         console.error(err);
// // // // // // // // // // // // //       } finally {
// // // // // // // // // // // // //         setLoading(false);
// // // // // // // // // // // // //       }
// // // // // // // // // // // // //     };

// // // // // // // // // // // // //     fetchData();
// // // // // // // // // // // // //   }, [storeId]);

// // // // // // // // // // // // //   useEffect(() => {
// // // // // // // // // // // // //     console.log("Fetched Attendance Records:", attendanceRecords);
// // // // // // // // // // // // //   }, [attendanceRecords]);

// // // // // // // // // // // // //   const attendanceAnalytics = useMemo(() => {
// // // // // // // // // // // // //     if (!attendanceRecords.length) return {
// // // // // // // // // // // // //       totalEmployees: employees.length,
// // // // // // // // // // // // //       presentToday: 0,
// // // // // // // // // // // // //       absentToday: employees.length,
// // // // // // // // // // // // //       lateToday: 0
// // // // // // // // // // // // //     };

// // // // // // // // // // // // //     const today = new Date().toISOString().split('T')[0];

// // // // // // // // // // // // //     // const todayAttendance = attendanceRecords.filter(record => {
// // // // // // // // // // // // //     //   if (!record.timestamp) return false;
// // // // // // // // // // // // //     //   const recordDate = new Date(record.timestamp);
// // // // // // // // // // // // //     //   if (isNaN(recordDate.getTime())) return false;
// // // // // // // // // // // // //     //   return recordDate.toISOString().split('T')[0] === today;
// // // // // // // // // // // // //     // });  


// // // // // // // // // // // // //     const todayAttendance = attendanceRecords.filter(record => {
// // // // // // // // // // // // //       if (!record.timestamp) return false;
// // // // // // // // // // // // //       const recordDate = new Date(record.timestamp);
// // // // // // // // // // // // //       return !isNaN(recordDate.getTime()) && recordDate.toISOString().split('T')[0] === today;
// // // // // // // // // // // // //     });
    

// // // // // // // // // // // // //     const present = todayAttendance.filter(r => r.status === 'Present').length;
// // // // // // // // // // // // //     const late = todayAttendance.filter(r => r.status === 'Late').length;

// // // // // // // // // // // // //     console.log("Today's Attendance Records:", todayAttendance);

// // // // // // // // // // // // //     return {
// // // // // // // // // // // // //       totalEmployees: employees.length,
// // // // // // // // // // // // //       presentToday: present,
// // // // // // // // // // // // //       absentToday: employees.length - present - late,
// // // // // // // // // // // // //       lateToday: late
// // // // // // // // // // // // //     };
// // // // // // // // // // // // //   }, [attendanceRecords, employees]);

// // // // // // // // // // // // //   const handleStatusChange = (employeeId, status) => {
// // // // // // // // // // // // //     setAttendance(prev => ({
// // // // // // // // // // // // //       ...prev,
// // // // // // // // // // // // //       [employeeId]: status
// // // // // // // // // // // // //     }));
// // // // // // // // // // // // //   };

// // // // // // // // // // // // //   const handleSubmit = async () => {
// // // // // // // // // // // // //     try {
// // // // // // // // // // // // //       const records = Object.keys(attendance).map(employeeId => ({
// // // // // // // // // // // // //         employeeId,
// // // // // // // // // // // // //         status: attendance[employeeId],
// // // // // // // // // // // // //         timestamp: new Date().toISOString()
// // // // // // // // // // // // //       }));

// // // // // // // // // // // // //       await axios.post('http://localhost:5004/attendance', records, { headers: { storeId } });

// // // // // // // // // // // // //       alert('Attendance recorded successfully!');
// // // // // // // // // // // // //       setAttendance({});
// // // // // // // // // // // // //     } catch (err) {
// // // // // // // // // // // // //       setError('Failed to record attendance');
// // // // // // // // // // // // //       console.error(err);
// // // // // // // // // // // // //     }
// // // // // // // // // // // // //   };

// // // // // // // // // // // // //   if (loading) return <div className="text-center py-10">Loading...</div>;
// // // // // // // // // // // // //   if (error) return <div className="text-red-500 text-center py-10">{error}</div>;

// // // // // // // // // // // // //   return (
// // // // // // // // // // // // //     <div className="container mx-auto p-6 max-w-4xl">
// // // // // // // // // // // // //       <h1 className="text-3xl font-bold mb-6 text-center">Employee Attendance System</h1>

// // // // // // // // // // // // //       <div className="flex mb-6 border-b">
// // // // // // // // // // // // //         {['attendance', 'analytics', 'history'].map(tab => (
// // // // // // // // // // // // //           <button
// // // // // // // // // // // // //             key={tab}
// // // // // // // // // // // // //             className={`px-4 py-2 font-semibold ${activeTab === tab ? 'border-b-2 border-blue-500 text-blue-600' : 'text-gray-600 hover:text-gray-800'}`}
// // // // // // // // // // // // //             onClick={() => setActiveTab(tab)}
// // // // // // // // // // // // //           >
// // // // // // // // // // // // //             {tab.charAt(0).toUpperCase() + tab.slice(1)}
// // // // // // // // // // // // //           </button>
// // // // // // // // // // // // //         ))}
// // // // // // // // // // // // //       </div>

// // // // // // // // // // // // //       {activeTab === 'attendance' && (
// // // // // // // // // // // // //         <div>
// // // // // // // // // // // // //           <input
// // // // // // // // // // // // //             type="text"
// // // // // // // // // // // // //             placeholder="Search by Employee Name or ID"
// // // // // // // // // // // // //             className="w-full px-4 py-2 border rounded-lg mb-4"
// // // // // // // // // // // // //             value={searchQuery}
// // // // // // // // // // // // //             onChange={(e) => setSearchQuery(e.target.value)}
// // // // // // // // // // // // //           />
// // // // // // // // // // // // //           <div className="space-y-2">
// // // // // // // // // // // // //             {employees.map(employee => (
// // // // // // // // // // // // //               <div key={employee._id} className="flex justify-between p-3 border rounded-lg">
// // // // // // // // // // // // //                 <div>
// // // // // // // // // // // // //                   <h3 className="font-semibold">{employee.employeeName}</h3>
// // // // // // // // // // // // //                   <p className="text-sm text-gray-500">ID: {employee.employeeId}</p>
// // // // // // // // // // // // //                 </div>
// // // // // // // // // // // // //                 <select className="px-3 py-1 border rounded" value={attendance[employee.employeeId] || ''} onChange={(e) => handleStatusChange(employee.employeeId, e.target.value)}>
// // // // // // // // // // // // //                   <option value="">Select Status</option>
// // // // // // // // // // // // //                   <option value="Present">Present</option>
// // // // // // // // // // // // //                   <option value="Absent">Absent</option>
// // // // // // // // // // // // //                   <option value="Late">Late</option>
// // // // // // // // // // // // //                 </select>
// // // // // // // // // // // // //               </div>
// // // // // // // // // // // // //             ))}
// // // // // // // // // // // // //           </div>
// // // // // // // // // // // // //           <button onClick={handleSubmit} disabled={!Object.keys(attendance).length} className="w-full mt-4 bg-blue-500 text-white py-2 rounded-lg hover:bg-blue-600">
// // // // // // // // // // // // //             Submit Attendance
// // // // // // // // // // // // //           </button>
// // // // // // // // // // // // //         </div>
// // // // // // // // // // // // //       )}

// // // // // // // // // // // // //       {activeTab === 'history' && (
// // // // // // // // // // // // //         <div className="space-y-2">
// // // // // // // // // // // // //           {attendanceRecords.length === 0 ? (
// // // // // // // // // // // // //             <p>No attendance records found.</p>
// // // // // // // // // // // // //           ) : (
// // // // // // // // // // // // //             attendanceRecords.map((record, index) => {
// // // // // // // // // // // // //               const formattedDate = record.timestamp ? new Date(record.timestamp).toLocaleString() : "Invalid Date";
// // // // // // // // // // // // //               return (
// // // // // // // // // // // // //                 <div key={index} className="p-3 border rounded-lg">
// // // // // // // // // // // // //                   <p>{`Employee ID: ${record.employeeId} - ${record.status} (${formattedDate})`}</p>
// // // // // // // // // // // // //                 </div>
// // // // // // // // // // // // //               );
// // // // // // // // // // // // //             })
// // // // // // // // // // // // //           )}
// // // // // // // // // // // // //         </div>
// // // // // // // // // // // // //       )}

// // // // // // // // // // // // //       {activeTab === 'analytics' && (
// // // // // // // // // // // // //         <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
// // // // // // // // // // // // //           {[
// // // // // // // // // // // // //             { label: 'Total Employees', value: attendanceAnalytics.totalEmployees, color: 'text-blue-600' },
// // // // // // // // // // // // //             { label: 'Present Today', value: attendanceAnalytics.presentToday, color: 'text-green-600' },
// // // // // // // // // // // // //             { label: 'Absent Today', value: attendanceAnalytics.absentToday, color: 'text-red-600' },
// // // // // // // // // // // // //             { label: 'Late Today', value: attendanceAnalytics.lateToday, color: 'text-yellow-600' }
// // // // // // // // // // // // //           ].map(({ label, value, color }) => (
// // // // // // // // // // // // //             <div key={label} className="bg-white border rounded-lg p-4 text-center">
// // // // // // // // // // // // //               <h3 className="text-sm text-gray-500">{label}</h3>
// // // // // // // // // // // // //               <div className={`text-2xl font-bold ${color}`}>{value}</div>
// // // // // // // // // // // // //             </div>
// // // // // // // // // // // // //           ))}
// // // // // // // // // // // // //         </div>
// // // // // // // // // // // // //       )}
// // // // // // // // // // // // //     </div>
// // // // // // // // // // // // //   );
// // // // // // // // // // // // // };

// // // // // // // // // // // // // export default EmployeeAttendanceSystem;
// // // // // // // // // // // // import React, { useState, useEffect, useMemo } from 'react';
// // // // // // // // // // // // import axios from 'axios';

// // // // // // // // // // // // const EmployeeAttendanceSystem = () => {
// // // // // // // // // // // //   const [employees, setEmployees] = useState([]);
// // // // // // // // // // // //   const [attendanceRecords, setAttendanceRecords] = useState([]);
// // // // // // // // // // // //   const [searchQuery, setSearchQuery] = useState('');
// // // // // // // // // // // //   const [attendance, setAttendance] = useState({});
// // // // // // // // // // // //   const [activeTab, setActiveTab] = useState('attendance');
// // // // // // // // // // // //   const [loading, setLoading] = useState(true);
// // // // // // // // // // // //   const [error, setError] = useState(null);

// // // // // // // // // // // //   const storeId = localStorage.getItem("storeId");

// // // // // // // // // // // //   // useEffect(() => {
// // // // // // // // // // // //   //   const fetchData = async () => {
// // // // // // // // // // // //   //     try {
// // // // // // // // // // // //   //       const [employeesResponse, attendanceResponse] = await Promise.all([
// // // // // // // // // // // //   //         axios.get('http://localhost:5019/employees', { headers: { storeId } }),
// // // // // // // // // // // //   //         axios.get('http://localhost:5019/attendance', { headers: { storeId } })
// // // // // // // // // // // //   //       ]);

// // // // // // // // // // // //   //       setEmployees(employeesResponse.data);
// // // // // // // // // // // //   //       setAttendanceRecords(attendanceResponse.data);
// // // // // // // // // // // //   //     } catch (err) {
// // // // // // // // // // // //   //       setError('Failed to fetch data');
// // // // // // // // // // // //   //       console.error(err);
// // // // // // // // // // // //   //     } finally {
// // // // // // // // // // // //   //       setLoading(false);
// // // // // // // // // // // //   //     }
// // // // // // // // // // // //   //   };

// // // // // // // // // // // //   //   fetchData();
// // // // // // // // // // // //   // }, [storeId]);
// // // // // // // // // // // //   useEffect(() => {
// // // // // // // // // // // //     const fetchData = async () => {
// // // // // // // // // // // //       try {
// // // // // // // // // // // //         const [employeesResponse, attendanceResponse] = await Promise.all([
// // // // // // // // // // // //           axios.get('http://localhost:5019/employees', { headers: { storeId } }),
// // // // // // // // // // // //           axios.get('http://localhost:5019/attendance', { headers: { storeId } })
// // // // // // // // // // // //         ]);
  
// // // // // // // // // // // //         setEmployees(employeesResponse.data);
// // // // // // // // // // // //         setAttendanceRecords(attendanceResponse.data);
// // // // // // // // // // // //         console.log("Fetched Employees:", employeesResponse.data);
// // // // // // // // // // // //         console.log("Fetched Attendance Records:", attendanceResponse.data);
// // // // // // // // // // // //       } catch (err) {
// // // // // // // // // // // //         setError('Failed to fetch data');
// // // // // // // // // // // //         console.error(err);
// // // // // // // // // // // //       } finally {
// // // // // // // // // // // //         setLoading(false);
// // // // // // // // // // // //       }
// // // // // // // // // // // //     };
  
// // // // // // // // // // // //     fetchData();
// // // // // // // // // // // //   }, [storeId]);
// // // // // // // // // // // //   useEffect(() => {
// // // // // // // // // // // //     console.log("Fetched Attendance Records:", attendanceRecords);
// // // // // // // // // // // //   }, [attendanceRecords]);

// // // // // // // // // // // //   // const attendanceAnalytics = useMemo(() => {
// // // // // // // // // // // //   //   if (!attendanceRecords.length) return {
// // // // // // // // // // // //   //     totalEmployees: employees.length,
// // // // // // // // // // // //   //     presentToday: 0,
// // // // // // // // // // // //   //     absentToday: employees.length,
// // // // // // // // // // // //   //     lateToday: 0
// // // // // // // // // // // //   //   };

// // // // // // // // // // // //   //   const today = new Date().toISOString().split('T')[0];

// // // // // // // // // // // //   //   const todayAttendance = attendanceRecords.filter(record => {
// // // // // // // // // // // //   //     if (!record.timestamp) return false;
// // // // // // // // // // // //   //     const recordDate = new Date(record.timestamp);
// // // // // // // // // // // //   //     return !isNaN(recordDate.getTime()) && recordDate.toISOString().split('T')[0] === today;
// // // // // // // // // // // //   //   });

// // // // // // // // // // // //   //   const present = todayAttendance.filter(r => r.status === 'Present').length;
// // // // // // // // // // // //   //   const late = todayAttendance.filter(r => r.status === 'Late').length;

// // // // // // // // // // // //   //   return {
// // // // // // // // // // // //   //     totalEmployees: employees.length,
// // // // // // // // // // // //   //     presentToday: present,
// // // // // // // // // // // //   //     absentToday: employees.length - present - late,
// // // // // // // // // // // //   //     lateToday: late
// // // // // // // // // // // //   //   };
// // // // // // // // // // // //   // }, [attendanceRecords, employees]);
// // // // // // // // // // // //   // const attendanceAnalytics = useMemo(() => {
// // // // // // // // // // // //   //   if (!attendanceRecords.length) return {
// // // // // // // // // // // //   //     totalEmployees: employees.length,
// // // // // // // // // // // //   //     presentToday: 0,
// // // // // // // // // // // //   //     absentToday: employees.length,
// // // // // // // // // // // //   //     lateToday: 0
// // // // // // // // // // // //   //   };
  
// // // // // // // // // // // //   //   const today = new Date().toISOString().split('T')[0];
  
// // // // // // // // // // // //   //   const todayAttendance = attendanceRecords.filter(record => {
// // // // // // // // // // // //   //     if (!record.timestamp) return false;
// // // // // // // // // // // //   //     const recordDate = new Date(record.timestamp);
// // // // // // // // // // // //   //     if (isNaN(recordDate.getTime())) return false;
// // // // // // // // // // // //   //     return recordDate.toISOString().split('T')[0] === today;
// // // // // // // // // // // //   //   });
  
// // // // // // // // // // // //   //   const present = todayAttendance.filter(r => r.status === 'Present').length;
// // // // // // // // // // // //   //   const late = todayAttendance.filter(r => r.status === 'Late').length;
  
// // // // // // // // // // // //   //   return {
// // // // // // // // // // // //   //     totalEmployees: employees.length,
// // // // // // // // // // // //   //     presentToday: present,
// // // // // // // // // // // //   //     absentToday: employees.length - present - late,
// // // // // // // // // // // //   //     lateToday: late
// // // // // // // // // // // //   //   };
// // // // // // // // // // // //   // }, [attendanceRecords, employees]); 
// // // // // // // // // // // //   // const attendanceAnalytics = useMemo(() => {
// // // // // // // // // // // //   //   if (!attendanceRecords.length) return {
// // // // // // // // // // // //   //     totalEmployees: employees.length,
// // // // // // // // // // // //   //     presentToday: 0,
// // // // // // // // // // // //   //     absentToday: employees.length,
// // // // // // // // // // // //   //     lateToday: 0
// // // // // // // // // // // //   //   };
  
// // // // // // // // // // // //   //   const today = new Date().toISOString().split('T')[0];
// // // // // // // // // // // //   //   console.log("Today's Date:", today);
  
// // // // // // // // // // // //   //   const todayAttendance = attendanceRecords.filter(record => {
// // // // // // // // // // // //   //     if (!record.timestamp) return false;
// // // // // // // // // // // //   //     const recordDate = new Date(record.timestamp);
// // // // // // // // // // // //   //     if (isNaN(recordDate.getTime())) {
// // // // // // // // // // // //   //       console.log("Invalid Record Date:", record.timestamp);
// // // // // // // // // // // //   //       return false;
// // // // // // // // // // // //   //     }
// // // // // // // // // // // //   //     const recordDateString = recordDate.toISOString().split('T')[0];
// // // // // // // // // // // //   //     console.log("Record Date:", recordDateString);
// // // // // // // // // // // //   //     return recordDateString === today;
// // // // // // // // // // // //   //   });
  
// // // // // // // // // // // //   //   console.log("Today's Attendance Records:", todayAttendance);
  
// // // // // // // // // // // //   //   const present = todayAttendance.filter(r => r.status === 'Present').length;
// // // // // // // // // // // //   //   const late = todayAttendance.filter(r => r.status === 'Late').length;
  
// // // // // // // // // // // //   //   return {
// // // // // // // // // // // //   //     totalEmployees: employees.length,
// // // // // // // // // // // //   //     presentToday: present,
// // // // // // // // // // // //   //     absentToday: employees.length - present - late,
// // // // // // // // // // // //   //     lateToday: late
// // // // // // // // // // // //   //   };
// // // // // // // // // // // //   // }, [attendanceRecords, employees]);

// // // // // // // // // // // //   // const attendanceAnalytics = useMemo(() => {
// // // // // // // // // // // //   //   if (!attendanceRecords.length) return {
// // // // // // // // // // // //   //     totalEmployees: employees.length,
// // // // // // // // // // // //   //     presentToday: 0,
// // // // // // // // // // // //   //     absentToday: employees.length,
// // // // // // // // // // // //   //     lateToday: 0
// // // // // // // // // // // //   //   };
  
// // // // // // // // // // // //   //   const today = new Date().toISOString().split('T')[0];
// // // // // // // // // // // //   //   console.log("Today's Date:", today);
  
// // // // // // // // // // // //   //   const todayAttendance = attendanceRecords.filter(record => {
// // // // // // // // // // // //   //     if (!record.timestamp) return false;
// // // // // // // // // // // //   //     const recordDate = new Date(record.timestamp);
// // // // // // // // // // // //   //     if (isNaN(recordDate.getTime())) {
// // // // // // // // // // // //   //       console.log("Invalid Record Date:", record.timestamp);
// // // // // // // // // // // //   //       return false;
// // // // // // // // // // // //   //     }
// // // // // // // // // // // //   //     const recordDateString = recordDate.toISOString().split('T')[0];
// // // // // // // // // // // //   //     console.log("Record Date:", recordDateString);
// // // // // // // // // // // //   //     return recordDateString === today;
// // // // // // // // // // // //   //   });
  
// // // // // // // // // // // //   //   console.log("Today's Attendance Records:", todayAttendance);
  
// // // // // // // // // // // //   //   const present = todayAttendance.filter(r => r.status === 'Present').length;
// // // // // // // // // // // //   //   const late = todayAttendance.filter(r => r.status === 'Late').length;
  
// // // // // // // // // // // //   //   return {
// // // // // // // // // // // //   //     totalEmployees: employees.length,
// // // // // // // // // // // //   //     presentToday: present,
// // // // // // // // // // // //   //     absentToday: employees.length - present - late,
// // // // // // // // // // // //   //     lateToday: late
// // // // // // // // // // // //   //   };
// // // // // // // // // // // //   // }, [attendanceRecords, employees]);
// // // // // // // // // // // //   const attendanceAnalytics = useMemo(() => {
// // // // // // // // // // // //     if (!attendanceRecords.length) return {
// // // // // // // // // // // //       totalEmployees: employees.length,
// // // // // // // // // // // //       presentToday: 0,
// // // // // // // // // // // //       absentToday: employees.length,
// // // // // // // // // // // //       lateToday: 0
// // // // // // // // // // // //     };
  
// // // // // // // // // // // //     const today = new Date().toISOString().split('T')[0];
// // // // // // // // // // // //     console.log("Today's Date:", today);
  
// // // // // // // // // // // //     const todayAttendance = attendanceRecords.filter(record => {
// // // // // // // // // // // //       if (!record.timestamp) return false;
// // // // // // // // // // // //       const recordDate = new Date(record.timestamp);
// // // // // // // // // // // //       if (isNaN(recordDate.getTime())) {
// // // // // // // // // // // //         console.log("Invalid Record Date:", record.timestamp);
// // // // // // // // // // // //         return false;
// // // // // // // // // // // //       }
// // // // // // // // // // // //       const recordDateString = recordDate.toISOString().split('T')[0];
// // // // // // // // // // // //       console.log("Record Date:", recordDateString);
// // // // // // // // // // // //       return recordDateString === today;
// // // // // // // // // // // //     });
  
// // // // // // // // // // // //     console.log("Today's Attendance Records:", todayAttendance);
  
// // // // // // // // // // // //     const present = todayAttendance.filter(r => r.status === 'Present').length;
// // // // // // // // // // // //     const late = todayAttendance.filter(r => r.status === 'Late').length;
  
// // // // // // // // // // // //     return {
// // // // // // // // // // // //       totalEmployees: employees.length,
// // // // // // // // // // // //       presentToday: present,
// // // // // // // // // // // //       absentToday: employees.length - present - late,
// // // // // // // // // // // //       lateToday: late
// // // // // // // // // // // //     };
// // // // // // // // // // // //   }, [attendanceRecords, employees]);
// // // // // // // // // // // //   const handleStatusChange = (employeeId, status) => {
// // // // // // // // // // // //     setAttendance(prev => ({
// // // // // // // // // // // //       ...prev,
// // // // // // // // // // // //       [employeeId]: status
// // // // // // // // // // // //     }));
// // // // // // // // // // // //   };

// // // // // // // // // // // //   const handleSubmit = async () => {
// // // // // // // // // // // //     try {
// // // // // // // // // // // //       const records = Object.keys(attendance).map(employeeId => ({
// // // // // // // // // // // //         employeeId,
// // // // // // // // // // // //         status: attendance[employeeId],
// // // // // // // // // // // //         timestamp: new Date().toISOString()
// // // // // // // // // // // //       }));

// // // // // // // // // // // //       await axios.post('http://localhost:5019/attendance', records, { headers: { storeId } });

// // // // // // // // // // // //       alert('Attendance recorded successfully!');
// // // // // // // // // // // //       setAttendance({});
// // // // // // // // // // // //     } catch (err) {
// // // // // // // // // // // //       setError('Failed to record attendance');
// // // // // // // // // // // //       console.error(err);
// // // // // // // // // // // //     }
// // // // // // // // // // // //   };

// // // // // // // // // // // //   if (loading) return <div className="text-center py-10">Loading...</div>;
// // // // // // // // // // // //   if (error) return <div className="text-red-500 text-center py-10">{error}</div>;

// // // // // // // // // // // //   return (
// // // // // // // // // // // //     <div className="container mx-auto p-6 max-w-4xl">
// // // // // // // // // // // //       <h1 className="text-3xl font-bold mb-6 text-center">Employee Attendance System</h1>

// // // // // // // // // // // //       <div className="flex mb-6 border-b">
// // // // // // // // // // // //         {['attendance', 'analytics', 'history'].map(tab => (
// // // // // // // // // // // //           <button
// // // // // // // // // // // //             key={tab}
// // // // // // // // // // // //             className={`px-4 py-2 font-semibold ${activeTab === tab ? 'border-b-2 border-blue-500 text-blue-600' : 'text-gray-600 hover:text-gray-800'}`}
// // // // // // // // // // // //             onClick={() => setActiveTab(tab)}
// // // // // // // // // // // //           >
// // // // // // // // // // // //             {tab.charAt(0).toUpperCase() + tab.slice(1)}
// // // // // // // // // // // //           </button>
// // // // // // // // // // // //         ))}
// // // // // // // // // // // //       </div>

// // // // // // // // // // // //       {activeTab === 'attendance' && (
// // // // // // // // // // // //         <div>
// // // // // // // // // // // //           <input
// // // // // // // // // // // //             type="text"
// // // // // // // // // // // //             placeholder="Search by Employee Name or ID"
// // // // // // // // // // // //             className="w-full px-4 py-2 border rounded-lg mb-4"
// // // // // // // // // // // //             value={searchQuery}
// // // // // // // // // // // //             onChange={(e) => setSearchQuery(e.target.value)}
// // // // // // // // // // // //           />
// // // // // // // // // // // //           <div className="space-y-2">
// // // // // // // // // // // //             {employees.map(employee => (
// // // // // // // // // // // //               <div key={employee._id} className="flex justify-between p-3 border rounded-lg">
// // // // // // // // // // // //                 <div>
// // // // // // // // // // // //                   <h3 className="font-semibold">{employee.employeeName}</h3>
// // // // // // // // // // // //                   <p className="text-sm text-gray-500">ID: {employee.employeeId}</p>
// // // // // // // // // // // //                 </div>
// // // // // // // // // // // //                 <select className="px-3 py-1 border rounded" value={attendance[employee.employeeId] || ''} onChange={(e) => handleStatusChange(employee.employeeId, e.target.value)}>
// // // // // // // // // // // //                   <option value="">Select Status</option>
// // // // // // // // // // // //                   <option value="Present">Present</option>
// // // // // // // // // // // //                   <option value="Absent">Absent</option>
// // // // // // // // // // // //                   <option value="Late">Late</option>
// // // // // // // // // // // //                 </select>
// // // // // // // // // // // //               </div>
// // // // // // // // // // // //             ))}
// // // // // // // // // // // //           </div>
// // // // // // // // // // // //           <button onClick={handleSubmit} disabled={!Object.keys(attendance).length} className="w-full mt-4 bg-blue-500 text-white py-2 rounded-lg hover:bg-blue-600">
// // // // // // // // // // // //             Submit Attendance
// // // // // // // // // // // //           </button>
// // // // // // // // // // // //         </div>
// // // // // // // // // // // //       )}
// // // // // // // // // // // // {/* 
// // // // // // // // // // // //       {activeTab === 'history' && (
// // // // // // // // // // // //         <div className="space-y-2">
// // // // // // // // // // // //           {attendanceRecords.length === 0 ? (
// // // // // // // // // // // //             <p>No attendance records found.</p>
// // // // // // // // // // // //           ) : (
// // // // // // // // // // // //             attendanceRecords.map((record, index) => {
// // // // // // // // // // // //               const formattedDate = record.timestamp ? new Date(record.timestamp).toLocaleString() : "N/A";
// // // // // // // // // // // //               return (
// // // // // // // // // // // //                 <div key={index} className="p-3 border rounded-lg">
// // // // // // // // // // // //                   <p>{`Employee ID: ${record.employeeId} - ${record.status} (${formattedDate})`}</p>
// // // // // // // // // // // //                 </div>
// // // // // // // // // // // //               );
// // // // // // // // // // // //             })
// // // // // // // // // // // //           )}
// // // // // // // // // // // //         </div>
// // // // // // // // // // // //       )} */}

// // // // // // // // // // // // {/* {activeTab === 'history' && (
// // // // // // // // // // // //   <div className="space-y-2">
// // // // // // // // // // // //     {attendanceRecords.length === 0 ? (
// // // // // // // // // // // //       <p>No attendance records found.</p>
// // // // // // // // // // // //     ) : (
// // // // // // // // // // // //       attendanceRecords.map((record, index) => {
// // // // // // // // // // // //         const recordDate = new Date(record.timestamp);
// // // // // // // // // // // //         const formattedDate = isNaN(recordDate.getTime()) ? "Invalid Date" : recordDate.toLocaleString();
// // // // // // // // // // // //         return (
// // // // // // // // // // // //           <div key={index} className="p-3 border rounded-lg">
// // // // // // // // // // // //             <p>{`Employee ID: ${record.employeeId} - ${record.status} (${formattedDate})`}</p>
// // // // // // // // // // // //           </div>
// // // // // // // // // // // //         );
// // // // // // // // // // // //       })
// // // // // // // // // // // //     )}
// // // // // // // // // // // //   </div>
// // // // // // // // // // // // )} */}
// // // // // // // // // // // // {/* {activeTab === 'history' && (
// // // // // // // // // // // //   <div className="space-y-2">
// // // // // // // // // // // //     {attendanceRecords.length === 0 ? (
// // // // // // // // // // // //       <p>No attendance records found.</p>
// // // // // // // // // // // //     ) : (
// // // // // // // // // // // //       attendanceRecords.map((record, index) => {
// // // // // // // // // // // //         const recordDate = new Date(record.timestamp);
// // // // // // // // // // // //         console.log("Raw Timestamp:", record.timestamp);
// // // // // // // // // // // //         console.log("Parsed Date:", recordDate);
// // // // // // // // // // // //         const formattedDate = isNaN(recordDate.getTime()) ? "Invalid Date" : recordDate.toLocaleString();
// // // // // // // // // // // //         return (
// // // // // // // // // // // //           <div key={index} className="p-3 border rounded-lg">
// // // // // // // // // // // //             <p>{`Employee ID: ${record.employeeId} - ${record.status} (${formattedDate})`}</p>
// // // // // // // // // // // //           </div>
// // // // // // // // // // // //         );
// // // // // // // // // // // //       })
// // // // // // // // // // // //     )}
// // // // // // // // // // // //   </div>
// // // // // // // // // // // // )} */}
// // // // // // // // // // // // {/* {activeTab === 'history' && (
// // // // // // // // // // // //   <div className="space-y-2">
// // // // // // // // // // // //     {attendanceRecords.length === 0 ? (
// // // // // // // // // // // //       <p>No attendance records found.</p>
// // // // // // // // // // // //     ) : (
// // // // // // // // // // // //       attendanceRecords.map((record, index) => {
// // // // // // // // // // // //         const recordDate = new Date(record.timestamp);
// // // // // // // // // // // //         const formattedDate = isNaN(recordDate.getTime()) ? "Invalid Date" : recordDate.toLocaleString();
// // // // // // // // // // // //         return (
// // // // // // // // // // // //           <div key={index} className="p-3 border rounded-lg">
// // // // // // // // // // // //             <p>{`Employee ID: ${record.employeeId} - ${record.status} (${formattedDate})`}</p>
// // // // // // // // // // // //           </div>
// // // // // // // // // // // //         );
// // // // // // // // // // // //       })
// // // // // // // // // // // //     )}
// // // // // // // // // // // //   </div>
// // // // // // // // // // // // )} */}
// // // // // // // // // // // // {activeTab === 'history' && (
// // // // // // // // // // // //   <div className="space-y-2">
// // // // // // // // // // // //     {attendanceRecords.length === 0 ? (
// // // // // // // // // // // //       <p>No attendance records found.</p>
// // // // // // // // // // // //     ) : (
// // // // // // // // // // // //       attendanceRecords.map((record, index) => {
// // // // // // // // // // // //         const recordDate = new Date(record.timestamp);
// // // // // // // // // // // //         console.log("Raw Timestamp:", record.timestamp);
// // // // // // // // // // // //         console.log("Parsed Date:", recordDate);
// // // // // // // // // // // //         const formattedDate = isNaN(recordDate.getTime()) ? "Invalid Date" : recordDate.toLocaleString();
// // // // // // // // // // // //         return (
// // // // // // // // // // // //           <div key={index} className="p-3 border rounded-lg">
// // // // // // // // // // // //             <p>{`Employee ID: ${record.employeeId} - ${record.status} (${formattedDate})`}</p>
// // // // // // // // // // // //           </div>
// // // // // // // // // // // //         );
// // // // // // // // // // // //       })
// // // // // // // // // // // //     )}
// // // // // // // // // // // //   </div>
// // // // // // // // // // // // )}

// // // // // // // // // // // //       {/* {activeTab === 'analytics' && (
// // // // // // // // // // // //         <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
// // // // // // // // // // // //           {[
// // // // // // // // // // // //             { label: 'Total Employees', value: attendanceAnalytics.totalEmployees, color: 'text-blue-600' },
// // // // // // // // // // // //             { label: 'Present Today', value: attendanceAnalytics.presentToday, color: 'text-green-600' },
// // // // // // // // // // // //             { label: 'Absent Today', value: attendanceAnalytics.absentToday, color: 'text-red-600' },
// // // // // // // // // // // //             { label: 'Late Today', value: attendanceAnalytics.lateToday, color: 'text-yellow-600' }
// // // // // // // // // // // //           ].map(({ label, value, color }) => (
// // // // // // // // // // // //             <div key={label} className="bg-white border rounded-lg p-4 text-center">
// // // // // // // // // // // //               <h3 className="text-sm text-gray-500">{label}</h3>
// // // // // // // // // // // //               <div className={`text-2xl font-bold ${color}`}>{value}</div>
// // // // // // // // // // // //             </div>
// // // // // // // // // // // //           ))}
// // // // // // // // // // // //         </div>
// // // // // // // // // // // //       )} */}
// // // // // // // // // // // //       {activeTab === 'analytics' && (
// // // // // // // // // // // //   <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
// // // // // // // // // // // //     {[
// // // // // // // // // // // //       { label: 'Total Employees', value: attendanceAnalytics.totalEmployees, color: 'text-blue-600' },
// // // // // // // // // // // //       { label: 'Present Today', value: attendanceAnalytics.presentToday, color: 'text-green-600' },
// // // // // // // // // // // //       { label: 'Absent Today', value: attendanceAnalytics.absentToday, color: 'text-red-600' },
// // // // // // // // // // // //       { label: 'Late Today', value: attendanceAnalytics.lateToday, color: 'text-yellow-600' }
// // // // // // // // // // // //     ].map(({ label, value, color }) => {
// // // // // // // // // // // //       console.log(`${label}: ${value}`);
// // // // // // // // // // // //       return (
// // // // // // // // // // // //         <div key={label} className="bg-white border rounded-lg p-4 text-center">
// // // // // // // // // // // //           <h3 className="text-sm text-gray-500">{label}</h3>
// // // // // // // // // // // //           <div className={`text-2xl font-bold ${color}`}>{value}</div>
// // // // // // // // // // // //         </div>
// // // // // // // // // // // //       );
// // // // // // // // // // // //     })}
// // // // // // // // // // // //   </div>
// // // // // // // // // // // // )}
// // // // // // // // // // // //     </div>
// // // // // // // // // // // //   );
// // // // // // // // // // // // };

// // // // // // // // // // // // export default EmployeeAttendanceSystem;
// // // // // // // // // // // import React, { useState, useEffect, useMemo } from 'react';
// // // // // // // // // // // import axios from 'axios';

// // // // // // // // // // // const EmployeeAttendanceSystem = () => {
// // // // // // // // // // //   const [employees, setEmployees] = useState([]);
// // // // // // // // // // //   const [attendanceRecords, setAttendanceRecords] = useState([]);
// // // // // // // // // // //   const [searchQuery, setSearchQuery] = useState('');
// // // // // // // // // // //   const [attendance, setAttendance] = useState({});
// // // // // // // // // // //   const [activeTab, setActiveTab] = useState('attendance');
// // // // // // // // // // //   const [loading, setLoading] = useState(true);
// // // // // // // // // // //   const [error, setError] = useState(null);

// // // // // // // // // // //   const storeId = localStorage.getItem("storeId");

// // // // // // // // // // //   // Fetch employees and attendance records
// // // // // // // // // // //   useEffect(() => {
// // // // // // // // // // //     const fetchData = async () => {
// // // // // // // // // // //       try {
// // // // // // // // // // //         const [employeesResponse, attendanceResponse] = await Promise.all([
// // // // // // // // // // //           axios.get('http://localhost:5018/employees', { headers: { storeId } }), // Employees backend port
// // // // // // // // // // //           axios.get('http://localhost:5019/attendance', { headers: { storeId } }) // Attendance backend port
// // // // // // // // // // //         ]);

// // // // // // // // // // //         setEmployees(employeesResponse.data);
// // // // // // // // // // //         setAttendanceRecords(attendanceResponse.data);
// // // // // // // // // // //       } catch (err) {
// // // // // // // // // // //         setError('Failed to fetch data. Please try again.');
// // // // // // // // // // //         console.error(err);
// // // // // // // // // // //       } finally {
// // // // // // // // // // //         setLoading(false);
// // // // // // // // // // //       }
// // // // // // // // // // //     };

// // // // // // // // // // //     fetchData();
// // // // // // // // // // //   }, [storeId]);

// // // // // // // // // // //   // Compute attendance analytics for today
// // // // // // // // // // //   const attendanceAnalytics = useMemo(() => {
// // // // // // // // // // //     if (!attendanceRecords.length) return {
// // // // // // // // // // //       totalEmployees: employees.length,
// // // // // // // // // // //       presentToday: 0,
// // // // // // // // // // //       absentToday: employees.length,
// // // // // // // // // // //       lateToday: 0
// // // // // // // // // // //     };

// // // // // // // // // // //     const today = new Date().toISOString().split('T')[0];
// // // // // // // // // // //     const todayAttendance = attendanceRecords.filter(record => {
// // // // // // // // // // //       if (!record.timestamp) return false;
// // // // // // // // // // //       const recordDate = new Date(record.timestamp);
// // // // // // // // // // //       return recordDate.toISOString().split('T')[0] === today;
// // // // // // // // // // //     });

// // // // // // // // // // //     const present = todayAttendance.filter(r => r.status === 'Present').length;
// // // // // // // // // // //     const late = todayAttendance.filter(r => r.status === 'Late').length;

// // // // // // // // // // //     return {
// // // // // // // // // // //       totalEmployees: employees.length,
// // // // // // // // // // //       presentToday: present,
// // // // // // // // // // //       absentToday: employees.length - present - late,
// // // // // // // // // // //       lateToday: late
// // // // // // // // // // //     };
// // // // // // // // // // //   }, [attendanceRecords, employees]);

// // // // // // // // // // //   // Filter employees based on search query
// // // // // // // // // // //   const filteredEmployees = employees.filter(employee =>
// // // // // // // // // // //     employee.employeeName.toLowerCase().includes(searchQuery.toLowerCase()) ||
// // // // // // // // // // //     employee.employeeId.toLowerCase().includes(searchQuery.toLowerCase())
// // // // // // // // // // //   );

// // // // // // // // // // //   // Handle status change for an employee
// // // // // // // // // // //   const handleStatusChange = (employeeId, status) => {
// // // // // // // // // // //     setAttendance(prev => ({
// // // // // // // // // // //       ...prev,
// // // // // // // // // // //       [employeeId]: status
// // // // // // // // // // //     }));
// // // // // // // // // // //   };

// // // // // // // // // // //   // Submit attendance records
// // // // // // // // // // //   const handleSubmit = async () => {
// // // // // // // // // // //     try {
// // // // // // // // // // //       const records = Object.keys(attendance)
// // // // // // // // // // //         .filter(employeeId => attendance[employeeId]) // Only include selected statuses
// // // // // // // // // // //         .map(employeeId => ({
// // // // // // // // // // //           employeeId,
// // // // // // // // // // //           status: attendance[employeeId],
// // // // // // // // // // //           timestamp: new Date().toISOString()
// // // // // // // // // // //         }));

// // // // // // // // // // //       if (!records.length) {
// // // // // // // // // // //         alert('Please select at least one attendance status.');
// // // // // // // // // // //         return;
// // // // // // // // // // //       }

// // // // // // // // // // //       await axios.post('http://localhost:5019/attendance', records, { headers: { storeId } });
// // // // // // // // // // //       setAttendanceRecords(prev => [...prev, ...records]); // Update local state
// // // // // // // // // // //       setAttendance({}); // Reset form
// // // // // // // // // // //       alert('Attendance recorded successfully!');
// // // // // // // // // // //     } catch (err) {
// // // // // // // // // // //       setError('Failed to record attendance. Please try again.');
// // // // // // // // // // //       console.error(err);
// // // // // // // // // // //     }
// // // // // // // // // // //   };

// // // // // // // // // // //   if (loading) return <div className="text-center py-10 text-gray-600">Loading...</div>;
// // // // // // // // // // //   if (error) return <div className="text-red-500 text-center py-10">{error}</div>;

// // // // // // // // // // //   return (
// // // // // // // // // // //     <div className="container mx-auto p-6 max-w-4xl bg-gray-50 rounded-lg shadow-md">
// // // // // // // // // // //       <h1 className="text-3xl font-bold mb-6 text-center text-gray-800">Employee Attendance System</h1>

// // // // // // // // // // //       {/* Tabs */}
// // // // // // // // // // //       <div className="flex mb-6 border-b border-gray-200">
// // // // // // // // // // //         {['attendance', 'analytics', 'history'].map(tab => (
// // // // // // // // // // //           <button
// // // // // // // // // // //             key={tab}
// // // // // // // // // // //             className={`px-4 py-2 font-semibold ${activeTab === tab ? 'border-b-2 border-blue-500 text-blue-600' : 'text-gray-600 hover:text-gray-800'}`}
// // // // // // // // // // //             onClick={() => setActiveTab(tab)}
// // // // // // // // // // //           >
// // // // // // // // // // //             {tab.charAt(0).toUpperCase() + tab.slice(1)}
// // // // // // // // // // //           </button>
// // // // // // // // // // //         ))}
// // // // // // // // // // //       </div>

// // // // // // // // // // //       {/* Attendance Tab */}
// // // // // // // // // // //       {activeTab === 'attendance' && (
// // // // // // // // // // //         <div>
// // // // // // // // // // //           <input
// // // // // // // // // // //             type="text"
// // // // // // // // // // //             placeholder="Search by Employee Name or ID"
// // // // // // // // // // //             className="w-full px-4 py-2 border rounded-lg mb-4 focus:outline-none focus:ring-2 focus:ring-blue-500"
// // // // // // // // // // //             value={searchQuery}
// // // // // // // // // // //             onChange={(e) => setSearchQuery(e.target.value)}
// // // // // // // // // // //           />
// // // // // // // // // // //           <div className="space-y-2 max-h-96 overflow-y-auto">
// // // // // // // // // // //             {filteredEmployees.length === 0 ? (
// // // // // // // // // // //               <p className="text-gray-500 text-center">No employees found.</p>
// // // // // // // // // // //             ) : (
// // // // // // // // // // //               filteredEmployees.map(employee => (
// // // // // // // // // // //                 <div key={employee._id} className="flex justify-between p-3 border rounded-lg bg-white">
// // // // // // // // // // //                   <div>
// // // // // // // // // // //                     <h3 className="font-semibold text-gray-800">{employee.employeeName}</h3>
// // // // // // // // // // //                     <p className="text-sm text-gray-500">ID: {employee.employeeId}</p>
// // // // // // // // // // //                   </div>
// // // // // // // // // // //                   <select
// // // // // // // // // // //                     className="px-3 py-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
// // // // // // // // // // //                     value={attendance[employee.employeeId] || ''}
// // // // // // // // // // //                     onChange={(e) => handleStatusChange(employee.employeeId, e.target.value)}
// // // // // // // // // // //                   >
// // // // // // // // // // //                     <option value="">Select Status</option>
// // // // // // // // // // //                     <option value="Present">Present</option>
// // // // // // // // // // //                     <option value="Absent">Absent</option>
// // // // // // // // // // //                     <option value="Late">Late</option>
// // // // // // // // // // //                   </select>
// // // // // // // // // // //                 </div>
// // // // // // // // // // //               ))
// // // // // // // // // // //             )}
// // // // // // // // // // //           </div>
// // // // // // // // // // //           <button
// // // // // // // // // // //             onClick={handleSubmit}
// // // // // // // // // // //             disabled={!Object.keys(attendance).some(id => attendance[id])}
// // // // // // // // // // //             className={`w-full mt-4 py-2 rounded-lg text-white ${Object.keys(attendance).some(id => attendance[id]) ? 'bg-blue-500 hover:bg-blue-600' : 'bg-gray-400 cursor-not-allowed'}`}
// // // // // // // // // // //           >
// // // // // // // // // // //             Submit Attendance
// // // // // // // // // // //           </button>
// // // // // // // // // // //         </div>
// // // // // // // // // // //       )}

// // // // // // // // // // //       {/* Analytics Tab */}
// // // // // // // // // // //       {activeTab === 'analytics' && (
// // // // // // // // // // //         <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
// // // // // // // // // // //           {[
// // // // // // // // // // //             { label: 'Total Employees', value: attendanceAnalytics.totalEmployees, color: 'text-blue-600' },
// // // // // // // // // // //             { label: 'Present Today', value: attendanceAnalytics.presentToday, color: 'text-green-600' },
// // // // // // // // // // //             { label: 'Absent Today', value: attendanceAnalytics.absentToday, color: 'text-red-600' },
// // // // // // // // // // //             { label: 'Late Today', value: attendanceAnalytics.lateToday, color: 'text-yellow-600' }
// // // // // // // // // // //           ].map(({ label, value, color }) => (
// // // // // // // // // // //             <div key={label} className="bg-white border rounded-lg p-4 text-center shadow-sm">
// // // // // // // // // // //               <h3 className="text-sm text-gray-500">{label}</h3>
// // // // // // // // // // //               <div className={`text-2xl font-bold ${color}`}>{value}</div>
// // // // // // // // // // //             </div>
// // // // // // // // // // //           ))}
// // // // // // // // // // //         </div>
// // // // // // // // // // //       )}

// // // // // // // // // // //       {/* History Tab */}
// // // // // // // // // // //       {activeTab === 'history' && (
// // // // // // // // // // //         <div className="space-y-2 max-h-96 overflow-y-auto">
// // // // // // // // // // //           {attendanceRecords.length === 0 ? (
// // // // // // // // // // //             <p className="text-gray-500 text-center">No attendance records found.</p>
// // // // // // // // // // //           ) : (
// // // // // // // // // // //             attendanceRecords.map((record, index) => {
// // // // // // // // // // //               const recordDate = new Date(record.timestamp);
// // // // // // // // // // //               const formattedDate = isNaN(recordDate.getTime()) ? 'Invalid Date' : recordDate.toLocaleString();
// // // // // // // // // // //               return (
// // // // // // // // // // //                 <div key={index} className="p-3 border rounded-lg bg-white">
// // // // // // // // // // //                   <p className="text-gray-800">{`Employee ID: ${record.employeeId} - ${record.status} (${formattedDate})`}</p>
// // // // // // // // // // //                 </div>
// // // // // // // // // // //               );
// // // // // // // // // // //             })
// // // // // // // // // // //           )}
// // // // // // // // // // //         </div>
// // // // // // // // // // //       )}
// // // // // // // // // // //     </div>
// // // // // // // // // // //   );
// // // // // // // // // // // };

// // // // // // // // // // // export default EmployeeAttendanceSystem;
// // // // // // // // // // import React, { useState, useEffect, useMemo } from 'react';
// // // // // // // // // // import axios from 'axios';

// // // // // // // // // // const EmployeeAttendanceSystem = () => {
// // // // // // // // // //   const [employees, setEmployees] = useState([]);
// // // // // // // // // //   const [attendanceRecords, setAttendanceRecords] = useState([]);
// // // // // // // // // //   const [searchQuery, setSearchQuery] = useState('');
// // // // // // // // // //   const [attendance, setAttendance] = useState({});
// // // // // // // // // //   const [activeTab, setActiveTab] = useState('attendance');
// // // // // // // // // //   const [loading, setLoading] = useState(true);
// // // // // // // // // //   const [error, setError] = useState(null);

// // // // // // // // // //   const storeId = localStorage.getItem("storeId");

// // // // // // // // // //   // Fetch employees and attendance records
// // // // // // // // // //   useEffect(() => {
// // // // // // // // // //     const fetchData = async () => {
// // // // // // // // // //       try {
// // // // // // // // // //         const [employeesResponse, attendanceResponse] = await Promise.all([
// // // // // // // // // //           axios.get('http://localhost:5004/employees', { headers: { storeId } }), // Employees backend port
// // // // // // // // // //           axios.get('http://localhost:5019/attendance', { headers: { storeId } }) // Attendance backend port
// // // // // // // // // //         ]);

// // // // // // // // // //         setEmployees(employeesResponse.data);
// // // // // // // // // //         const records = attendanceResponse.data.map(record => ({
// // // // // // // // // //           ...record,
// // // // // // // // // //           timestamp: record.timestamp || 'Invalid Timestamp' // Fallback for missing timestamps
// // // // // // // // // //         }));
// // // // // // // // // //         setAttendanceRecords(records);
// // // // // // // // // //         console.log("Fetched Attendance Records:", records); // Debug log
// // // // // // // // // //       } catch (err) {
// // // // // // // // // //         setError('Failed to fetch data. Please try again.');
// // // // // // // // // //         console.error(err);
// // // // // // // // // //       } finally {
// // // // // // // // // //         setLoading(false);
// // // // // // // // // //       }
// // // // // // // // // //     };

// // // // // // // // // //     fetchData();
// // // // // // // // // //   }, [storeId]);

// // // // // // // // // //   // Compute attendance analytics for today
// // // // // // // // // //   const attendanceAnalytics = useMemo(() => {
// // // // // // // // // //     if (!attendanceRecords.length) return {
// // // // // // // // // //       totalEmployees: employees.length,
// // // // // // // // // //       presentToday: 0,
// // // // // // // // // //       absentToday: employees.length,
// // // // // // // // // //       lateToday: 0
// // // // // // // // // //     };

// // // // // // // // // //     const today = new Date().toISOString().split('T')[0];
// // // // // // // // // //     console.log("Today's Date:", today);

// // // // // // // // // //     const todayAttendance = attendanceRecords.filter(record => {
// // // // // // // // // //       if (!record.timestamp || typeof record.timestamp !== 'string' || record.timestamp === 'Invalid Timestamp') {
// // // // // // // // // //         console.warn("Skipping record with invalid timestamp:", record);
// // // // // // // // // //         return false;
// // // // // // // // // //       }
// // // // // // // // // //       const recordDate = new Date(record.timestamp);
// // // // // // // // // //       if (isNaN(recordDate.getTime())) {
// // // // // // // // // //         console.warn("Invalid date parsed from timestamp:", record.timestamp, record);
// // // // // // // // // //         return false;
// // // // // // // // // //       }
// // // // // // // // // //       return recordDate.toISOString().split('T')[0] === today;
// // // // // // // // // //     });

// // // // // // // // // //     console.log("Today's Attendance Records:", todayAttendance);

// // // // // // // // // //     const present = todayAttendance.filter(r => r.status === 'Present').length;
// // // // // // // // // //     const late = todayAttendance.filter(r => r.status === 'Late').length;

// // // // // // // // // //     return {
// // // // // // // // // //       totalEmployees: employees.length,
// // // // // // // // // //       presentToday: present,
// // // // // // // // // //       absentToday: employees.length - present - late,
// // // // // // // // // //       lateToday: late
// // // // // // // // // //     };
// // // // // // // // // //   }, [attendanceRecords, employees]);

// // // // // // // // // //   // Filter employees based on search query
// // // // // // // // // //   const filteredEmployees = employees.filter(employee =>
// // // // // // // // // //     employee.employeeName.toLowerCase().includes(searchQuery.toLowerCase()) ||
// // // // // // // // // //     employee.employeeId.toLowerCase().includes(searchQuery.toLowerCase())
// // // // // // // // // //   );

// // // // // // // // // //   // Handle status change for an employee
// // // // // // // // // //   const handleStatusChange = (employeeId, status) => {
// // // // // // // // // //     setAttendance(prev => ({
// // // // // // // // // //       ...prev,
// // // // // // // // // //       [employeeId]: status
// // // // // // // // // //     }));
// // // // // // // // // //   };

// // // // // // // // // //   // Submit attendance records
// // // // // // // // // //   const handleSubmit = async () => {
// // // // // // // // // //     try {
// // // // // // // // // //       const records = Object.keys(attendance)
// // // // // // // // // //         .filter(employeeId => attendance[employeeId])
// // // // // // // // // //         .map(employeeId => ({
// // // // // // // // // //           employeeId,
// // // // // // // // // //           status: attendance[employeeId],
// // // // // // // // // //           timestamp: new Date().toISOString()
// // // // // // // // // //         }));

// // // // // // // // // //       if (!records.length) {
// // // // // // // // // //         alert('Please select at least one attendance status.');
// // // // // // // // // //         return;
// // // // // // // // // //       }

// // // // // // // // // //       const response = await axios.post('http://localhost:5019/attendance', records, { headers: { storeId } });
// // // // // // // // // //       setAttendanceRecords(prev => [...prev, ...records]); // Update local state
// // // // // // // // // //       setAttendance({});
// // // // // // // // // //       alert('Attendance recorded successfully!');
// // // // // // // // // //       console.log("Attendance Submission Response:", response.data);
// // // // // // // // // //     } catch (err) {
// // // // // // // // // //       setError('Failed to record attendance. Please try again.');
// // // // // // // // // //       console.error("Attendance Submission Error:", err);
// // // // // // // // // //     }
// // // // // // // // // //   };

// // // // // // // // // //   if (loading) return <div className="text-center py-10 text-gray-600">Loading...</div>;
// // // // // // // // // //   if (error) return <div className="text-red-500 text-center py-10">{error}</div>;

// // // // // // // // // //   return (
// // // // // // // // // //     <div className="container mx-auto p-6 max-w-4xl bg-gray-50 rounded-lg shadow-md">
// // // // // // // // // //       <h1 className="text-3xl font-bold mb-6 text-center text-gray-800">Employee Attendance System</h1>

// // // // // // // // // //       {/* Tabs */}
// // // // // // // // // //       <div className="flex mb-6 border-b border-gray-200">
// // // // // // // // // //         {['attendance', 'analytics', 'history'].map(tab => (
// // // // // // // // // //           <button
// // // // // // // // // //             key={tab}
// // // // // // // // // //             className={`px-4 py-2 font-semibold ${activeTab === tab ? 'border-b-2 border-blue-500 text-blue-600' : 'text-gray-600 hover:text-gray-800'}`}
// // // // // // // // // //             onClick={() => setActiveTab(tab)}
// // // // // // // // // //           >
// // // // // // // // // //             {tab.charAt(0).toUpperCase() + tab.slice(1)}
// // // // // // // // // //           </button>
// // // // // // // // // //         ))}
// // // // // // // // // //       </div>

// // // // // // // // // //       {/* Attendance Tab */}
// // // // // // // // // //       {activeTab === 'attendance' && (
// // // // // // // // // //         <div>
// // // // // // // // // //           <input
// // // // // // // // // //             type="text"
// // // // // // // // // //             placeholder="Search by Employee Name or ID"
// // // // // // // // // //             className="w-full px-4 py-2 border rounded-lg mb-4 focus:outline-none focus:ring-2 focus:ring-blue-500"
// // // // // // // // // //             value={searchQuery}
// // // // // // // // // //             onChange={(e) => setSearchQuery(e.target.value)}
// // // // // // // // // //           />
// // // // // // // // // //           <div className="space-y-2 max-h-96 overflow-y-auto">
// // // // // // // // // //             {filteredEmployees.length === 0 ? (
// // // // // // // // // //               <p className="text-gray-500 text-center">No employees found.</p>
// // // // // // // // // //             ) : (
// // // // // // // // // //               filteredEmployees.map(employee => (
// // // // // // // // // //                 <div key={employee._id} className="flex justify-between p-3 border rounded-lg bg-white">
// // // // // // // // // //                   <div>
// // // // // // // // // //                     <h3 className="font-semibold text-gray-800">{employee.employeeName}</h3>
// // // // // // // // // //                     <p className="text-sm text-gray-500">ID: {employee.employeeId}</p>
// // // // // // // // // //                   </div>
// // // // // // // // // //                   <select
// // // // // // // // // //                     className="px-3 py-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
// // // // // // // // // //                     value={attendance[employee.employeeId] || ''}
// // // // // // // // // //                     onChange={(e) => handleStatusChange(employee.employeeId, e.target.value)}
// // // // // // // // // //                   >
// // // // // // // // // //                     <option value="">Select Status</option>
// // // // // // // // // //                     <option value="Present">Present</option>
// // // // // // // // // //                     <option value="Absent">Absent</option>
// // // // // // // // // //                     <option value="Late">Late</option>
// // // // // // // // // //                   </select>
// // // // // // // // // //                 </div>
// // // // // // // // // //               ))
// // // // // // // // // //             )}
// // // // // // // // // //           </div>
// // // // // // // // // //           <button
// // // // // // // // // //             onClick={handleSubmit}
// // // // // // // // // //             disabled={!Object.keys(attendance).some(id => attendance[id])}
// // // // // // // // // //             className={`w-full mt-4 py-2 rounded-lg text-white ${Object.keys(attendance).some(id => attendance[id]) ? 'bg-blue-500 hover:bg-blue-600' : 'bg-gray-400 cursor-not-allowed'}`}
// // // // // // // // // //           >
// // // // // // // // // //             Submit Attendance
// // // // // // // // // //           </button>
// // // // // // // // // //         </div>
// // // // // // // // // //       )}

// // // // // // // // // //       {/* Analytics Tab */}
// // // // // // // // // //       {activeTab === 'analytics' && (
// // // // // // // // // //         <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
// // // // // // // // // //           {[
// // // // // // // // // //             { label: 'Total Employees', value: attendanceAnalytics.totalEmployees, color: 'text-blue-600' },
// // // // // // // // // //             { label: 'Present Today', value: attendanceAnalytics.presentToday, color: 'text-green-600' },
// // // // // // // // // //             { label: 'Absent Today', value: attendanceAnalytics.absentToday, color: 'text-red-600' },
// // // // // // // // // //             { label: 'Late Today', value: attendanceAnalytics.lateToday, color: 'text-yellow-600' }
// // // // // // // // // //           ].map(({ label, value, color }) => (
// // // // // // // // // //             <div key={label} className="bg-white border rounded-lg p-4 text-center shadow-sm">
// // // // // // // // // //               <h3 className="text-sm text-gray-500">{label}</h3>
// // // // // // // // // //               <div className={`text-2xl font-bold ${color}`}>{value}</div>
// // // // // // // // // //             </div>
// // // // // // // // // //           ))}
// // // // // // // // // //         </div>
// // // // // // // // // //       )}

// // // // // // // // // //       {/* History Tab */}
// // // // // // // // // //       {activeTab === 'history' && (
// // // // // // // // // //         <div className="space-y-2 max-h-96 overflow-y-auto">
// // // // // // // // // //           {attendanceRecords.length === 0 ? (
// // // // // // // // // //             <p className="text-gray-500 text-center">No attendance records found.</p>
// // // // // // // // // //           ) : (
// // // // // // // // // //             attendanceRecords.map((record, index) => {
// // // // // // // // // //               const recordDate = new Date(record.timestamp);
// // // // // // // // // //               const formattedDate = isNaN(recordDate.getTime()) ? 'Invalid Date' : recordDate.toLocaleString();
// // // // // // // // // //               return (
// // // // // // // // // //                 <div key={index} className="p-3 border rounded-lg bg-white">
// // // // // // // // // //                   <p className="text-gray-800">{`Employee ID: ${record.employeeId} - ${record.status} (${formattedDate})`}</p>
// // // // // // // // // //                 </div>
// // // // // // // // // //               );
// // // // // // // // // //             })
// // // // // // // // // //           )}
// // // // // // // // // //         </div>
// // // // // // // // // //       )}
// // // // // // // // // //     </div>
// // // // // // // // // //   );
// // // // // // // // // // };

// // // // // // // // // // export default EmployeeAttendanceSystem;
// // // // // // // // // import React, { useState, useEffect, useMemo } from 'react';
// // // // // // // // // import axios from 'axios';

// // // // // // // // // const EmployeeAttendanceSystem = () => {
// // // // // // // // //   const [employees, setEmployees] = useState([]);
// // // // // // // // //   const [attendanceRecords, setAttendanceRecords] = useState([]);
// // // // // // // // //   const [searchQuery, setSearchQuery] = useState('');
// // // // // // // // //   const [attendance, setAttendance] = useState({});
// // // // // // // // //   const [activeTab, setActiveTab] = useState('attendance');
// // // // // // // // //   const [loading, setLoading] = useState(true);
// // // // // // // // //   const [error, setError] = useState(null);

// // // // // // // // //   const storeId = localStorage.getItem("storeId");

// // // // // // // // //   // Fetch employees and attendance records
// // // // // // // // //   useEffect(() => {
// // // // // // // // //     const fetchData = async () => {
// // // // // // // // //       try {
// // // // // // // // //         const [employeesResponse, attendanceResponse] = await Promise.all([
// // // // // // // // //           axios.get('http://localhost:5004/employees', { headers: { storeId } }), // Updated port
// // // // // // // // //           axios.get('http://localhost:5019/attendance', { headers: { storeId } })
// // // // // // // // //         ]);

// // // // // // // // //         const validEmployees = employeesResponse.data.filter(employee => 
// // // // // // // // //           employee && 
// // // // // // // // //           typeof employee.employeeName === 'string' && 
// // // // // // // // //           typeof employee.employeeId === 'string'
// // // // // // // // //         );
// // // // // // // // //         setEmployees(validEmployees);
// // // // // // // // //         console.log("Fetched Employees:", validEmployees); // Debug log

// // // // // // // // //         const records = attendanceResponse.data.map(record => ({
// // // // // // // // //           ...record,
// // // // // // // // //           timestamp: record.timestamp || 'Invalid Timestamp'
// // // // // // // // //         }));
// // // // // // // // //         setAttendanceRecords(records);
// // // // // // // // //         console.log("Fetched Attendance Records:", records); // Debug log
// // // // // // // // //       } catch (err) {
// // // // // // // // //         setError('Failed to fetch data. Please try again.');
// // // // // // // // //         console.error("Fetch Error:", err);
// // // // // // // // //       } finally {
// // // // // // // // //         setLoading(false);
// // // // // // // // //       }
// // // // // // // // //     };

// // // // // // // // //     fetchData();
// // // // // // // // //   }, [storeId]);

// // // // // // // // //   // Compute attendance analytics for today
// // // // // // // // //   const attendanceAnalytics = useMemo(() => {
// // // // // // // // //     if (!attendanceRecords.length) return {
// // // // // // // // //       totalEmployees: employees.length,
// // // // // // // // //       presentToday: 0,
// // // // // // // // //       absentToday: employees.length,
// // // // // // // // //       lateToday: 0
// // // // // // // // //     };

// // // // // // // // //     const today = new Date().toISOString().split('T')[0];
// // // // // // // // //     console.log("Today's Date:", today);

// // // // // // // // //     const todayAttendance = attendanceRecords.filter(record => {
// // // // // // // // //       if (!record.timestamp || typeof record.timestamp !== 'string' || record.timestamp === 'Invalid Timestamp') {
// // // // // // // // //         console.warn("Skipping record with invalid timestamp:", record);
// // // // // // // // //         return false;
// // // // // // // // //       }
// // // // // // // // //       const recordDate = new Date(record.timestamp);
// // // // // // // // //       if (isNaN(recordDate.getTime())) {
// // // // // // // // //         console.warn("Invalid date parsed from timestamp:", record.timestamp, record);
// // // // // // // // //         return false;
// // // // // // // // //       }
// // // // // // // // //       return recordDate.toISOString().split('T')[0] === today;
// // // // // // // // //     });

// // // // // // // // //     console.log("Today's Attendance Records:", todayAttendance);

// // // // // // // // //     const present = todayAttendance.filter(r => r.status === 'Present').length;
// // // // // // // // //     const late = todayAttendance.filter(r => r.status === 'Late').length;

// // // // // // // // //     return {
// // // // // // // // //       totalEmployees: employees.length,
// // // // // // // // //       presentToday: present,
// // // // // // // // //       absentToday: employees.length - present - late,
// // // // // // // // //       lateToday: late
// // // // // // // // //     };
// // // // // // // // //   }, [attendanceRecords, employees]);

// // // // // // // // //   // Filter employees based on search query with safeguard
// // // // // // // // //   const filteredEmployees = employees.filter(employee => {
// // // // // // // // //     if (!employee || !employee.employeeName || !employee.employeeId) {
// // // // // // // // //       console.warn("Invalid employee object:", employee);
// // // // // // // // //       return false;
// // // // // // // // //     }
// // // // // // // // //     return (
// // // // // // // // //       employee.employeeName.toLowerCase().includes(searchQuery.toLowerCase()) ||
// // // // // // // // //       employee.employeeId.toLowerCase().includes(searchQuery.toLowerCase())
// // // // // // // // //     );
// // // // // // // // //   });

// // // // // // // // //   // Handle status change for an employee
// // // // // // // // //   const handleStatusChange = (employeeId, status) => {
// // // // // // // // //     setAttendance(prev => ({
// // // // // // // // //       ...prev,
// // // // // // // // //       [employeeId]: status
// // // // // // // // //     }));
// // // // // // // // //   };

// // // // // // // // //   // Submit attendance records
// // // // // // // // //   const handleSubmit = async () => {
// // // // // // // // //     try {
// // // // // // // // //       const records = Object.keys(attendance)
// // // // // // // // //         .filter(employeeId => attendance[employeeId])
// // // // // // // // //         .map(employeeId => ({
// // // // // // // // //           employeeId,
// // // // // // // // //           status: attendance[employeeId],
// // // // // // // // //           timestamp: new Date().toISOString()
// // // // // // // // //         }));

// // // // // // // // //       if (!records.length) {
// // // // // // // // //         alert('Please select at least one attendance status.');
// // // // // // // // //         return;
// // // // // // // // //       }

// // // // // // // // //       const response = await axios.post('http://localhost:5019/attendance', records, { headers: { storeId } });
// // // // // // // // //       setAttendanceRecords(prev => [...prev, ...records]);
// // // // // // // // //       setAttendance({});
// // // // // // // // //       alert('Attendance recorded successfully!');
// // // // // // // // //       console.log("Attendance Submission Response:", response.data);
// // // // // // // // //     } catch (err) {
// // // // // // // // //       setError('Failed to record attendance. Please try again.');
// // // // // // // // //       console.error("Attendance Submission Error:", err);
// // // // // // // // //     }
// // // // // // // // //   };

// // // // // // // // //   if (loading) return <div className="text-center py-10 text-gray-600">Loading...</div>;
// // // // // // // // //   if (error) return <div className="text-red-500 text-center py-10">{error}</div>;

// // // // // // // // //   return (
// // // // // // // // //     <div className="container mx-auto p-6 max-w-4xl bg-gray-50 rounded-lg shadow-md">
// // // // // // // // //       <h1 className="text-3xl font-bold mb-6 text-center text-gray-800">Employee Attendance System</h1>

// // // // // // // // //       {/* Tabs */}
// // // // // // // // //       <div className="flex mb-6 border-b border-gray-200">
// // // // // // // // //         {['attendance', 'analytics', 'history'].map(tab => (
// // // // // // // // //           <button
// // // // // // // // //             key={tab}
// // // // // // // // //             className={`px-4 py-2 font-semibold ${activeTab === tab ? 'border-b-2 border-blue-500 text-blue-600' : 'text-gray-600 hover:text-gray-800'}`}
// // // // // // // // //             onClick={() => setActiveTab(tab)}
// // // // // // // // //           >
// // // // // // // // //             {tab.charAt(0).toUpperCase() + tab.slice(1)}
// // // // // // // // //           </button>
// // // // // // // // //         ))}
// // // // // // // // //       </div>

// // // // // // // // //       {/* Attendance Tab */}
// // // // // // // // //       {activeTab === 'attendance' && (
// // // // // // // // //         <div>
// // // // // // // // //           <input
// // // // // // // // //             type="text"
// // // // // // // // //             placeholder="Search by Employee Name or ID"
// // // // // // // // //             className="w-full px-4 py-2 border rounded-lg mb-4 focus:outline-none focus:ring-2 focus:ring-blue-500"
// // // // // // // // //             value={searchQuery}
// // // // // // // // //             onChange={(e) => setSearchQuery(e.target.value)}
// // // // // // // // //           />
// // // // // // // // //           <div className="space-y-2 max-h-96 overflow-y-auto">
// // // // // // // // //             {filteredEmployees.length === 0 ? (
// // // // // // // // //               <p className="text-gray-500 text-center">No employees found.</p>
// // // // // // // // //             ) : (
// // // // // // // // //               filteredEmployees.map(employee => (
// // // // // // // // //                 <div key={employee._id} className="flex justify-between p-3 border rounded-lg bg-white">
// // // // // // // // //                   <div>
// // // // // // // // //                     <h3 className="font-semibold text-gray-800">{employee.employeeName}</h3>
// // // // // // // // //                     <p className="text-sm text-gray-500">ID: {employee.employeeId}</p>
// // // // // // // // //                   </div>
// // // // // // // // //                   <select
// // // // // // // // //                     className="px-3 py-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
// // // // // // // // //                     value={attendance[employee.employeeId] || ''}
// // // // // // // // //                     onChange={(e) => handleStatusChange(employee.employeeId, e.target.value)}
// // // // // // // // //                   >
// // // // // // // // //                     <option value="">Select Status</option>
// // // // // // // // //                     <option value="Present">Present</option>
// // // // // // // // //                     <option value="Absent">Absent</option>
// // // // // // // // //                     <option value="Late">Late</option>
// // // // // // // // //                   </select>
// // // // // // // // //                 </div>
// // // // // // // // //               ))
// // // // // // // // //             )}
// // // // // // // // //           </div>
// // // // // // // // //           <button
// // // // // // // // //             onClick={handleSubmit}
// // // // // // // // //             disabled={!Object.keys(attendance).some(id => attendance[id])}
// // // // // // // // //             className={`w-full mt-4 py-2 rounded-lg text-white ${Object.keys(attendance).some(id => attendance[id]) ? 'bg-blue-500 hover:bg-blue-600' : 'bg-gray-400 cursor-not-allowed'}`}
// // // // // // // // //           >
// // // // // // // // //             Submit Attendance
// // // // // // // // //           </button>
// // // // // // // // //         </div>
// // // // // // // // //       )}

// // // // // // // // //       {/* Analytics Tab */}
// // // // // // // // //       {activeTab === 'analytics' && (
// // // // // // // // //         <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
// // // // // // // // //           {[
// // // // // // // // //             { label: 'Total Employees', value: attendanceAnalytics.totalEmployees, color: 'text-blue-600' },
// // // // // // // // //             { label: 'Present Today', value: attendanceAnalytics.presentToday, color: 'text-green-600' },
// // // // // // // // //             { label: 'Absent Today', value: attendanceAnalytics.absentToday, color: 'text-red-600' },
// // // // // // // // //             { label: 'Late Today', value: attendanceAnalytics.lateToday, color: 'text-yellow-600' }
// // // // // // // // //           ].map(({ label, value, color }) => (
// // // // // // // // //             <div key={label} className="bg-white border rounded-lg p-4 text-center shadow-sm">
// // // // // // // // //               <h3 className="text-sm text-gray-500">{label}</h3>
// // // // // // // // //               <div className={`text-2xl font-bold ${color}`}>{value}</div>
// // // // // // // // //             </div>
// // // // // // // // //           ))}
// // // // // // // // //         </div>
// // // // // // // // //       )}

// // // // // // // // //       {/* History Tab */}
// // // // // // // // //       {activeTab === 'history' && (
// // // // // // // // //         <div className="space-y-2 max-h-96 overflow-y-auto">
// // // // // // // // //           {attendanceRecords.length === 0 ? (
// // // // // // // // //             <p className="text-gray-500 text-center">No attendance records found.</p>
// // // // // // // // //           ) : (
// // // // // // // // //             attendanceRecords.map((record, index) => {
// // // // // // // // //               const recordDate = new Date(record.timestamp);
// // // // // // // // //               const formattedDate = isNaN(recordDate.getTime()) ? 'Invalid Date' : recordDate.toLocaleString();
// // // // // // // // //               return (
// // // // // // // // //                 <div key={index} className="p-3 border rounded-lg bg-white">
// // // // // // // // //                   <p className="text-gray-800">{`Employee ID: ${record.employeeId} - ${record.status} (${formattedDate})`}</p>
// // // // // // // // //                 </div>
// // // // // // // // //               );
// // // // // // // // //             })
// // // // // // // // //           )}
// // // // // // // // //         </div>
// // // // // // // // //       )}
// // // // // // // // //     </div>
// // // // // // // // //   );
// // // // // // // // // };

// // // // // // // // // export default EmployeeAttendanceSystem;

// // // // // // // // import React, { useState, useEffect, useMemo } from 'react';
// // // // // // // // import axios from 'axios';

// // // // // // // // const EmployeeAttendanceSystem = () => {
// // // // // // // //   const [employees, setEmployees] = useState([]);
// // // // // // // //   const [attendanceRecords, setAttendanceRecords] = useState([]);
// // // // // // // //   const [searchQuery, setSearchQuery] = useState('');
// // // // // // // //   const [attendance, setAttendance] = useState({});
// // // // // // // //   const [activeTab, setActiveTab] = useState('attendance');
// // // // // // // //   const [loading, setLoading] = useState(true);
// // // // // // // //   const [error, setError] = useState(null);
// // // // // // // //   const [attendanceLocked, setAttendanceLocked] = useState(false);
// // // // // // // //   const [showConfirmation, setShowConfirmation] = useState(false);

// // // // // // // //   const storeId = localStorage.getItem("storeId") || "defaultStore";

// // // // // // // //   // Fetch employees and attendance records
// // // // // // // //   useEffect(() => {
// // // // // // // //     const fetchData = async () => {
// // // // // // // //       setLoading(true);
// // // // // // // //       setError(null);
// // // // // // // //       try {
// // // // // // // //         const [employeesResponse, attendanceResponse] = await Promise.all([
// // // // // // // //           axios.get('http://localhost:5004/employees', { headers: { storeId } }),
// // // // // // // //           axios.get('http://localhost:5019/attendance', { headers: { storeId } }) // Corrected URL
// // // // // // // //         ]);

// // // // // // // //         const validEmployees = employeesResponse.data
// // // // // // // //           .filter(employee => employee && typeof employee.name === 'string')
// // // // // // // //           .map(employee => ({
// // // // // // // //             ...employee,
// // // // // // // //             employeeName: employee.name,
// // // // // // // //             employeeId: employee.employeeId || employee._id
// // // // // // // //           }));
// // // // // // // //         setEmployees(validEmployees);
// // // // // // // //         console.log("Fetched Employees:", validEmployees);

// // // // // // // //         const validRecords = attendanceResponse.data.attendance_records.map(record => ({
// // // // // // // //           ...record,
// // // // // // // //           timestamp: record.timestamp || new Date().toISOString()
// // // // // // // //         }));
// // // // // // // //         setAttendanceRecords(validRecords);
// // // // // // // //         setAttendanceLocked(attendanceResponse.data.attendance_locked || false);
// // // // // // // //         console.log("Fetched Attendance Records:", validRecords, "Attendance Locked:", attendanceLocked);
// // // // // // // //       } catch (err) {
// // // // // // // //         const errorMsg = err.response?.data?.error || err.message;
// // // // // // // //         const detailedError = `Failed to fetch data: ${errorMsg}. Status: ${err.response?.status}. URL: ${err.response?.config?.url}`;
// // // // // // // //         setError(detailedError);
// // // // // // // //         console.error("Fetch Error:", err.response?.data || err, "Full Error:", detailedError);
// // // // // // // //       } finally {
// // // // // // // //         setLoading(false);
// // // // // // // //       }
// // // // // // // //     };

// // // // // // // //     fetchData();
// // // // // // // //   }, [storeId]);

// // // // // // // //   // Compute attendance analytics for today
// // // // // // // //   const attendanceAnalytics = useMemo(() => {
// // // // // // // //     if (!attendanceRecords.length) return {
// // // // // // // //       totalEmployees: employees.length,
// // // // // // // //       presentToday: 0,
// // // // // // // //       absentToday: employees.length,
// // // // // // // //       lateToday: 0
// // // // // // // //     };

// // // // // // // //     const today = new Date().toISOString().split('T')[0];
// // // // // // // //     const todayAttendance = attendanceRecords.filter(record => {
// // // // // // // //       if (!record.timestamp || typeof record.timestamp !== 'string') {
// // // // // // // //         console.warn("Skipping record with invalid timestamp:", record);
// // // // // // // //         return false;
// // // // // // // //       }
// // // // // // // //       const recordDate = new Date(record.timestamp);
// // // // // // // //       return !isNaN(recordDate.getTime()) && recordDate.toISOString().split('T')[0] === today;
// // // // // // // //     });

// // // // // // // //     const present = todayAttendance.filter(r => r.status === 'Present').length;
// // // // // // // //     const late = todayAttendance.filter(r => r.status === 'Late').length;

// // // // // // // //     return {
// // // // // // // //       totalEmployees: employees.length,
// // // // // // // //       presentToday: present,
// // // // // // // //       absentToday: employees.length - present - late,
// // // // // // // //       lateToday: late
// // // // // // // //     };
// // // // // // // //   }, [attendanceRecords, employees]);

// // // // // // // //   const filteredEmployees = employees.filter(employee =>
// // // // // // // //     employee && employee.employeeName && employee.employeeId &&
// // // // // // // //     (employee.employeeName.toLowerCase().includes(searchQuery.toLowerCase()) ||
// // // // // // // //      employee.employeeId.toLowerCase().includes(searchQuery.toLowerCase()))
// // // // // // // //   );

// // // // // // // //   const handleStatusChange = (employeeId, status) => {
// // // // // // // //     setAttendance(prev => ({
// // // // // // // //       ...prev,
// // // // // // // //       [employeeId]: status
// // // // // // // //     }));
// // // // // // // //   };

// // // // // // // //   const handleSubmit = async () => {
// // // // // // // //     if (attendanceLocked) {
// // // // // // // //       alert('Attendance is locked for today. Please try again tomorrow.');
// // // // // // // //       return;
// // // // // // // //     }
// // // // // // // //     setShowConfirmation(true);
// // // // // // // //   };

// // // // // // // //   const confirmSubmit = async () => {
// // // // // // // //     setShowConfirmation(false);
// // // // // // // //     try {
// // // // // // // //       const records = Object.keys(attendance)
// // // // // // // //         .filter(employeeId => attendance[employeeId])
// // // // // // // //         .map(employeeId => ({
// // // // // // // //           employeeId,
// // // // // // // //           status: attendance[employeeId],
// // // // // // // //           timestamp: new Date().toISOString()
// // // // // // // //         }));

// // // // // // // //       if (!records.length) {
// // // // // // // //         alert('Please select at least one attendance status.');
// // // // // // // //         return;
// // // // // // // //       }

// // // // // // // //       console.log("Submitting Attendance Records:", records);
// // // // // // // //       const response = await axios.post('http://localhost:5019/attendance', records, {
// // // // // // // //         headers: { storeId, 'Content-Type': 'application/json' }
// // // // // // // //       });

// // // // // // // //       const updatedResponse = await axios.get('http://localhost:5019/attendance', { headers: { storeId } });
// // // // // // // //       const updatedRecords = updatedResponse.data.attendance_records.map(record => ({
// // // // // // // //         ...record,
// // // // // // // //         timestamp: record.timestamp || new Date().toISOString()
// // // // // // // //       }));
// // // // // // // //       setAttendanceRecords(updatedRecords);
// // // // // // // //       setAttendanceLocked(updatedResponse.data.attendance_locked);
// // // // // // // //       setAttendance({});
// // // // // // // //       alert('Attendance recorded successfully!');
// // // // // // // //       console.log("Attendance Submission Response:", response.data);
// // // // // // // //     } catch (err) {
// // // // // // // //       const errorMsg = err.response?.data?.error || err.message;
// // // // // // // //       if (err.response?.status === 409) {
// // // // // // // //         setAttendanceLocked(true);
// // // // // // // //         setError('Attendance already recorded for some employees today.');
// // // // // // // //       } else {
// // // // // // // //         setError(`Failed to record attendance: ${errorMsg}. Check console for details.`);
// // // // // // // //       }
// // // // // // // //       console.error("Attendance Submission Error:", err.response?.data || err);
// // // // // // // //     }
// // // // // // // //   };

// // // // // // // //   if (loading) return <div className="text-center py-10 text-gray-600">Loading...</div>;
// // // // // // // //   if (error) return (
// // // // // // // //     <div className="text-red-500 text-center py-10">
// // // // // // // //       {error}
// // // // // // // //       <button
// // // // // // // //         className="ml-4 px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"
// // // // // // // //         onClick={() => window.location.reload()}
// // // // // // // //       >
// // // // // // // //         Retry
// // // // // // // //       </button>
// // // // // // // //       <button
// // // // // // // //         className="ml-4 px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600"
// // // // // // // //         onClick={async () => {
// // // // // // // //           try {
// // // // // // // //             const health = await axios.get('http://localhost:5019/health');
// // // // // // // //             alert(`Server Health: ${health.data.status}`);
// // // // // // // //           } catch (healthErr) {
// // // // // // // //             alert(`Server Health Check Failed: ${healthErr.message}`);
// // // // // // // //           }
// // // // // // // //         }}
// // // // // // // //       >
// // // // // // // //         Check Server
// // // // // // // //       </button>
// // // // // // // //     </div>
// // // // // // // //   );

// // // // // // // //   return (
// // // // // // // //     <div className="container mx-auto p-6 max-w-4xl bg-gray-50 rounded-lg shadow-md">
// // // // // // // //       <h1 className="text-3xl font-bold mb-6 text-center text-gray-800">Employee Attendance System</h1>

// // // // // // // //       {/* Attendance Status Indicator */}
// // // // // // // //       <div className="mb-6 text-center">
// // // // // // // //         {attendanceLocked ? (
// // // // // // // //           <span className="px-3 py-1 bg-red-100 text-red-800 rounded-full text-sm font-semibold">
// // // // // // // //             Attendance Locked for Today
// // // // // // // //           </span>
// // // // // // // //         ) : (
// // // // // // // //           <span className="px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm font-semibold">
// // // // // // // //             Attendance Available
// // // // // // // //           </span>
// // // // // // // //         )}
// // // // // // // //       </div>

// // // // // // // //       {/* Tabs */}
// // // // // // // //       <div className="flex mb-6 border-b border-gray-200">
// // // // // // // //         {['attendance', 'analytics', 'history'].map(tab => (
// // // // // // // //           <button
// // // // // // // //             key={tab}
// // // // // // // //             className={`px-4 py-2 font-semibold ${activeTab === tab ? 'border-b-2 border-blue-500 text-blue-600' : 'text-gray-600 hover:text-gray-800'}`}
// // // // // // // //             onClick={() => setActiveTab(tab)}
// // // // // // // //           >
// // // // // // // //             {tab.charAt(0).toUpperCase() + tab.slice(1)}
// // // // // // // //           </button>
// // // // // // // //         ))}
// // // // // // // //       </div>

// // // // // // // //       {/* Attendance Tab */}
// // // // // // // //       {activeTab === 'attendance' && (
// // // // // // // //         <div>
// // // // // // // //           <input
// // // // // // // //             type="text"
// // // // // // // //             placeholder="Search by Employee Name or ID"
// // // // // // // //             className="w-full px-4 py-2 border rounded-lg mb-4 focus:outline-none focus:ring-2 focus:ring-blue-500"
// // // // // // // //             value={searchQuery}
// // // // // // // //             onChange={(e) => setSearchQuery(e.target.value)}
// // // // // // // //             disabled={attendanceLocked}
// // // // // // // //           />
// // // // // // // //           <div className="space-y-4 max-h-96 overflow-y-auto">
// // // // // // // //             {filteredEmployees.length === 0 ? (
// // // // // // // //               <p className="text-gray-500 text-center">
// // // // // // // //                 No employees found. Please add employees to record attendance.
// // // // // // // //               </p>
// // // // // // // //             ) : (
// // // // // // // //               filteredEmployees.map(employee => (
// // // // // // // //                 <div key={employee._id} className="flex items-center justify-between p-4 border rounded-lg bg-white shadow-sm">
// // // // // // // //                   <div>
// // // // // // // //                     <h3 className="font-semibold text-gray-800">{employee.employeeName}</h3>
// // // // // // // //                     <p className="text-sm text-gray-500">ID: {employee.employeeId}</p>
// // // // // // // //                   </div>
// // // // // // // //                   <select
// // // // // // // //                     className="px-3 py-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
// // // // // // // //                     value={attendance[employee.employeeId] || ''}
// // // // // // // //                     onChange={(e) => handleStatusChange(employee.employeeId, e.target.value)}
// // // // // // // //                     disabled={attendanceLocked}
// // // // // // // //                   >
// // // // // // // //                     <option value="">Select Status</option>
// // // // // // // //                     <option value="Present">Present</option>
// // // // // // // //                     <option value="Absent">Absent</option>
// // // // // // // //                     <option value="Late">Late</option>
// // // // // // // //                   </select>
// // // // // // // //                 </div>
// // // // // // // //               ))
// // // // // // // //             )}
// // // // // // // //           </div>
// // // // // // // //           <div className="mt-6">
// // // // // // // //             <button
// // // // // // // //               onClick={handleSubmit}
// // // // // // // //               disabled={attendanceLocked || !Object.keys(attendance).some(id => attendance[id])}
// // // // // // // //               className={`w-full py-3 rounded-lg text-white font-semibold transition-colors ${
// // // // // // // //                 attendanceLocked || !Object.keys(attendance).some(id => attendance[id])
// // // // // // // //                   ? 'bg-gray-400 cursor-not-allowed'
// // // // // // // //                   : 'bg-blue-500 hover:bg-blue-600'
// // // // // // // //               }`}
// // // // // // // //             >
// // // // // // // //               Submit Attendance
// // // // // // // //             </button>
// // // // // // // //           </div>

// // // // // // // //           {/* Confirmation Dialog */}
// // // // // // // //           {showConfirmation && (
// // // // // // // //             <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
// // // // // // // //               <div className="bg-white p-6 rounded-lg shadow-lg w-full max-w-md">
// // // // // // // //                 <h2 className="text-xl font-bold mb-4 text-gray-800">Confirm Attendance</h2>
// // // // // // // //                 <p className="mb-4 text-gray-600">
// // // // // // // //                   Are you sure you want to submit attendance for {Object.keys(attendance).length} employees?
// // // // // // // //                 </p>
// // // // // // // //                 <div className="flex justify-end space-x-4">
// // // // // // // //                   <button
// // // // // // // //                     className="px-4 py-2 bg-gray-300 text-gray-800 rounded hover:bg-gray-400"
// // // // // // // //                     onClick={() => setShowConfirmation(false)}
// // // // // // // //                   >
// // // // // // // //                     Cancel
// // // // // // // //                   </button>
// // // // // // // //                   <button
// // // // // // // //                     className="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"
// // // // // // // //                     onClick={confirmSubmit}
// // // // // // // //                   >
// // // // // // // //                     Confirm
// // // // // // // //                   </button>
// // // // // // // //                 </div>
// // // // // // // //               </div>
// // // // // // // //             </div>
// // // // // // // //           )}
// // // // // // // //         </div>
// // // // // // // //       )}

// // // // // // // //       {/* Analytics Tab */}
// // // // // // // //       {activeTab === 'analytics' && (
// // // // // // // //         <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
// // // // // // // //           {[
// // // // // // // //             { label: 'Total Employees', value: attendanceAnalytics.totalEmployees, color: 'text-blue-600' },
// // // // // // // //             { label: 'Present Today', value: attendanceAnalytics.presentToday, color: 'text-green-600' },
// // // // // // // //             { label: 'Absent Today', value: attendanceAnalytics.absentToday, color: 'text-red-600' },
// // // // // // // //             { label: 'Late Today', value: attendanceAnalytics.lateToday, color: 'text-yellow-600' }
// // // // // // // //           ].map(({ label, value, color }) => (
// // // // // // // //             <div key={label} className="bg-white border rounded-lg p-4 text-center shadow-sm">
// // // // // // // //               <h3 className="text-sm text-gray-500">{label}</h3>
// // // // // // // //               <div className={`text-2xl font-bold ${color}`}>{value}</div>
// // // // // // // //             </div>
// // // // // // // //           ))}
// // // // // // // //         </div>
// // // // // // // //       )}

// // // // // // // //       {/* History Tab */}
// // // // // // // //       {activeTab === 'history' && (
// // // // // // // //         <div className="space-y-2 max-h-96 overflow-y-auto">
// // // // // // // //           {attendanceRecords.length === 0 ? (
// // // // // // // //             <p className="text-gray-500 text-center">No attendance records found.</p>
// // // // // // // //           ) : (
// // // // // // // //             attendanceRecords.map((record, index) => {
// // // // // // // //               const recordDate = new Date(record.timestamp);
// // // // // // // //               const formattedDate = isNaN(recordDate.getTime()) ? 'Invalid Date' : recordDate.toLocaleString();
// // // // // // // //               return (
// // // // // // // //                 <div key={index} className="p-3 border rounded-lg bg-white shadow-sm">
// // // // // // // //                   <p className="text-gray-800">{`Employee ID: ${record.employeeId} - ${record.status} (${formattedDate})`}</p>
// // // // // // // //                 </div>
// // // // // // // //               );
// // // // // // // //             })
// // // // // // // //           )}
// // // // // // // //         </div>
// // // // // // // //       )}
// // // // // // // //     </div>
// // // // // // // //   );
// // // // // // // // };

// // // // // // // // export default EmployeeAttendanceSystem;

// // // // // // // import React, { useState, useEffect, useMemo } from 'react';
// // // // // // // import axios from 'axios';

// // // // // // // const EmployeeAttendanceSystem = () => {
// // // // // // //   const [employees, setEmployees] = useState([]);
// // // // // // //   const [attendanceRecords, setAttendanceRecords] = useState([]);
// // // // // // //   const [searchQuery, setSearchQuery] = useState('');
// // // // // // //   const [attendance, setAttendance] = useState({});
// // // // // // //   const [activeTab, setActiveTab] = useState('attendance');
// // // // // // //   const [loading, setLoading] = useState(true);
// // // // // // //   const [error, setError] = useState(null);
// // // // // // //   const [attendanceLocked, setAttendanceLocked] = useState(false);
// // // // // // //   const [showConfirmation, setShowConfirmation] = useState(false);

// // // // // // //   const storeId = localStorage.getItem("storeId") || "defaultStore";

// // // // // // //   // Fetch employees and attendance records
// // // // // // //   useEffect(() => {
// // // // // // //     const fetchData = async () => {
// // // // // // //       setLoading(true);
// // // // // // //       setError(null);
// // // // // // //       try {
// // // // // // //         const [employeesResponse, attendanceResponse] = await Promise.all([
// // // // // // //           axios.get('http://localhost:5004/employees', { headers: { storeId } }),
// // // // // // //           axios.get('http://localhost:5019/attendance', { headers: { storeId } })
// // // // // // //         ]);

// // // // // // //         const validEmployees = employeesResponse.data
// // // // // // //           .filter(employee => employee && typeof employee.name === 'string')
// // // // // // //           .map(employee => ({
// // // // // // //             ...employee,
// // // // // // //             employeeName: employee.name,
// // // // // // //             employeeId: employee.employeeId || employee._id
// // // // // // //           }));
// // // // // // //         setEmployees(validEmployees);
// // // // // // //         console.log("Fetched Employees:", validEmployees);

// // // // // // //         const validRecords = attendanceResponse.data.attendance_records.map(record => ({
// // // // // // //           ...record,
// // // // // // //           timestamp: record.timestamp || new Date().toISOString()
// // // // // // //         }));
// // // // // // //         setAttendanceRecords(validRecords);
// // // // // // //         setAttendanceLocked(attendanceResponse.data.attendance_locked || false);
// // // // // // //         console.log("Fetched Attendance Records:", validRecords, "Attendance Locked:", attendanceLocked);
// // // // // // //       } catch (err) {
// // // // // // //         const errorMsg = err.response?.data?.error || err.message;
// // // // // // //         const errorDetails = err.response?.data?.details || '';
// // // // // // //         const detailedError = `Failed to fetch data: ${errorMsg}. Status: ${err.response?.status || 'N/A'}. URL: ${err.response?.config?.url || err.request?.url || 'N/A'}. Details: ${errorDetails}`;
// // // // // // //         setError(detailedError);
// // // // // // //         console.error("Fetch Error:", err.response?.data || err, "Full Error:", detailedError);
// // // // // // //       } finally {
// // // // // // //         setLoading(false);
// // // // // // //       }
// // // // // // //     };

// // // // // // //     fetchData();
// // // // // // //   }, [storeId]);

// // // // // // //   // Compute attendance analytics for today
// // // // // // //   const attendanceAnalytics = useMemo(() => {
// // // // // // //     if (!attendanceRecords.length) return {
// // // // // // //       totalEmployees: employees.length,
// // // // // // //       presentToday: 0,
// // // // // // //       absentToday: employees.length,
// // // // // // //       lateToday: 0
// // // // // // //     };

// // // // // // //     const today = new Date().toISOString().split('T')[0];
// // // // // // //     const todayAttendance = attendanceRecords.filter(record => {
// // // // // // //       if (!record.timestamp || typeof record.timestamp !== 'string') {
// // // // // // //         console.warn("Skipping record with invalid timestamp:", record);
// // // // // // //         return false;
// // // // // // //       }
// // // // // // //       const recordDate = new Date(record.timestamp);
// // // // // // //       return !isNaN(recordDate.getTime()) && recordDate.toISOString().split('T')[0] === today;
// // // // // // //     });

// // // // // // //     const present = todayAttendance.filter(r => r.status === 'Present').length;
// // // // // // //     const late = todayAttendance.filter(r => r.status === 'Late').length;

// // // // // // //     return {
// // // // // // //       totalEmployees: employees.length,
// // // // // // //       presentToday: present,
// // // // // // //       absentToday: employees.length - present - late,
// // // // // // //       lateToday: late
// // // // // // //     };
// // // // // // //   }, [attendanceRecords, employees]);

// // // // // // //   const filteredEmployees = employees.filter(employee =>
// // // // // // //     employee && employee.employeeName && employee.employeeId &&
// // // // // // //     (employee.employeeName.toLowerCase().includes(searchQuery.toLowerCase()) ||
// // // // // // //      employee.employeeId.toLowerCase().includes(searchQuery.toLowerCase()))
// // // // // // //   );

// // // // // // //   const handleStatusChange = (employeeId, status) => {
// // // // // // //     setAttendance(prev => ({
// // // // // // //       ...prev,
// // // // // // //       [employeeId]: status
// // // // // // //     }));
// // // // // // //   };

// // // // // // //   const handleSubmit = async () => {
// // // // // // //     if (attendanceLocked) {
// // // // // // //       alert('Attendance is locked for today. Please try again tomorrow.');
// // // // // // //       return;
// // // // // // //     }
// // // // // // //     setShowConfirmation(true);
// // // // // // //   };

// // // // // // //   const confirmSubmit = async () => {
// // // // // // //     setShowConfirmation(false);
// // // // // // //     try {
// // // // // // //       const records = Object.keys(attendance)
// // // // // // //         .filter(employeeId => attendance[employeeId])
// // // // // // //         .map(employeeId => ({
// // // // // // //           employeeId,
// // // // // // //           status: attendance[employeeId],
// // // // // // //           timestamp: new Date().toISOString()
// // // // // // //         }));

// // // // // // //       if (!records.length) {
// // // // // // //         alert('Please select at least one attendance status.');
// // // // // // //         return;
// // // // // // //       }

// // // // // // //       console.log("Submitting Attendance Records:", records);
// // // // // // //       const response = await axios.post('http://localhost:5019/attendance', records, {
// // // // // // //         headers: { storeId, 'Content-Type': 'application/json' }
// // // // // // //       });

// // // // // // //       const updatedResponse = await axios.get('http://localhost:5019/attendance', { headers: { storeId } });
// // // // // // //       const updatedRecords = updatedResponse.data.attendance_records.map(record => ({
// // // // // // //         ...record,
// // // // // // //         timestamp: record.timestamp || new Date().toISOString()
// // // // // // //       }));
// // // // // // //       setAttendanceRecords(updatedRecords);
// // // // // // //       setAttendanceLocked(updatedResponse.data.attendance_locked);
// // // // // // //       setAttendance({});
// // // // // // //       alert('Attendance recorded successfully!');
// // // // // // //       console.log("Attendance Submission Response:", response.data);
// // // // // // //     } catch (err) {
// // // // // // //       const errorMsg = err.response?.data?.error || err.message;
// // // // // // //       const errorDetails = err.response?.data?.details || '';
// // // // // // //       if (err.response?.status === 409) {
// // // // // // //         setAttendanceLocked(true);
// // // // // // //         setError('Attendance already recorded for some employees today.');
// // // // // // //       } else {
// // // // // // //         const detailedError = `Failed to record attendance: ${errorMsg}. Details: ${errorDetails}`;
// // // // // // //         setError(detailedError);
// // // // // // //         console.error("Attendance Submission Error:", err.response?.data || err, "Full Error:", detailedError);
// // // // // // //       }
// // // // // // //     }
// // // // // // //   };

// // // // // // //   if (loading) return <div className="text-center py-10 text-gray-600">Loading...</div>;
// // // // // // //   if (error) return (
// // // // // // //     <div className="text-red-500 text-center py-10">
// // // // // // //       {error}
// // // // // // //       <div className="mt-4 space-x-4">
// // // // // // //         <button
// // // // // // //           className="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"
// // // // // // //           onClick={() => window.location.reload()}
// // // // // // //         >
// // // // // // //           Retry
// // // // // // //         </button>
// // // // // // //         <button
// // // // // // //           className="px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600"
// // // // // // //           onClick={async () => {
// // // // // // //             try {
// // // // // // //               const health = await axios.get('http://localhost:5019/health');
// // // // // // //               alert(`Server Health: ${health.data.status}, MongoDB: ${health.data.mongo_status}`);
// // // // // // //             } catch (healthErr) {
// // // // // // //               alert(`Server Health Check Failed: ${healthErr.message}`);
// // // // // // //             }
// // // // // // //           }}
// // // // // // //         >
// // // // // // //           Check Server
// // // // // // //         </button>
// // // // // // //       </div>
// // // // // // //     </div>
// // // // // // //   );

// // // // // // //   return (
// // // // // // //     <div className="container mx-auto p-6 max-w-4xl bg-gray-50 rounded-lg shadow-md">
// // // // // // //       <h1 className="text-3xl font-bold mb-6 text-center text-gray-800">Employee Attendance System</h1>

// // // // // // //       {/* Attendance Status Indicator */}
// // // // // // //       <div className="mb-6 text-center">
// // // // // // //         {attendanceLocked ? (
// // // // // // //           <span className="px-3 py-1 bg-red-100 text-red-800 rounded-full text-sm font-semibold">
// // // // // // //             Attendance Locked for Today
// // // // // // //           </span>
// // // // // // //         ) : (
// // // // // // //           <span className="px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm font-semibold">
// // // // // // //             Attendance Available
// // // // // // //           </span>
// // // // // // //         )}
// // // // // // //       </div>

// // // // // // //       {/* Tabs */}
// // // // // // //       <div className="flex mb-6 border-b border-gray-200">
// // // // // // //         {['attendance', 'analytics', 'history'].map(tab => (
// // // // // // //           <button
// // // // // // //             key={tab}
// // // // // // //             className={`px-4 py-2 font-semibold ${activeTab === tab ? 'border-b-2 border-blue-500 text-blue-600' : 'text-gray-600 hover:text-gray-800'}`}
// // // // // // //             onClick={() => setActiveTab(tab)}
// // // // // // //           >
// // // // // // //             {tab.charAt(0).toUpperCase() + tab.slice(1)}
// // // // // // //           </button>
// // // // // // //         ))}
// // // // // // //       </div>

// // // // // // //       {/* Attendance Tab */}
// // // // // // //       {activeTab === 'attendance' && (
// // // // // // //         <div>
// // // // // // //           <input
// // // // // // //             type="text"
// // // // // // //             placeholder="Search by Employee Name or ID"
// // // // // // //             className="w-full px-4 py-2 border rounded-lg mb-4 focus:outline-none focus:ring-2 focus:ring-blue-500"
// // // // // // //             value={searchQuery}
// // // // // // //             onChange={(e) => setSearchQuery(e.target.value)}
// // // // // // //             disabled={attendanceLocked}
// // // // // // //           />
// // // // // // //           <div className="space-y-4 max-h-96 overflow-y-auto">
// // // // // // //             {filteredEmployees.length === 0 ? (
// // // // // // //               <p className="text-gray-500 text-center">
// // // // // // //                 No employees found. Please add employees to record attendance.
// // // // // // //               </p>
// // // // // // //             ) : (
// // // // // // //               filteredEmployees.map(employee => (
// // // // // // //                 <div key={employee._id} className="flex items-center justify-between p-4 border rounded-lg bg-white shadow-sm">
// // // // // // //                   <div>
// // // // // // //                     <h3 className="font-semibold text-gray-800">{employee.employeeName}</h3>
// // // // // // //                     <p className="text-sm text-gray-500">ID: {employee.employeeId}</p>
// // // // // // //                   </div>
// // // // // // //                   <select
// // // // // // //                     className="px-3 py-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
// // // // // // //                     value={attendance[employee.employeeId] || ''}
// // // // // // //                     onChange={(e) => handleStatusChange(employee.employeeId, e.target.value)}
// // // // // // //                     disabled={attendanceLocked}
// // // // // // //                   >
// // // // // // //                     <option value="">Select Status</option>
// // // // // // //                     <option value="Present">Present</option>
// // // // // // //                     <option value="Absent">Absent</option>
// // // // // // //                     <option value="Late">Late</option>
// // // // // // //                   </select>
// // // // // // //                 </div>
// // // // // // //               ))
// // // // // // //             )}
// // // // // // //           </div>
// // // // // // //           <div className="mt-6">
// // // // // // //             <button
// // // // // // //               onClick={handleSubmit}
// // // // // // //               disabled={attendanceLocked || !Object.keys(attendance).some(id => attendance[id])}
// // // // // // //               className={`w-full py-3 rounded-lg text-white font-semibold transition-colors ${
// // // // // // //                 attendanceLocked || !Object.keys(attendance).some(id => attendance[id])
// // // // // // //                   ? 'bg-gray-400 cursor-not-allowed'
// // // // // // //                   : 'bg-blue-500 hover:bg-blue-600'
// // // // // // //               }`}
// // // // // // //             >
// // // // // // //               Submit Attendance
// // // // // // //             </button>
// // // // // // //           </div>

// // // // // // //           {/* Confirmation Dialog */}
// // // // // // //           {showConfirmation && (
// // // // // // //             <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
// // // // // // //               <div className="bg-white p-6 rounded-lg shadow-lg w-full max-w-md">
// // // // // // //                 <h2 className="text-xl font-bold mb-4 text-gray-800">Confirm Attendance</h2>
// // // // // // //                 <p className="mb-4 text-gray-600">
// // // // // // //                   Are you sure you want to submit attendance for {Object.keys(attendance).length} employees?
// // // // // // //                 </p>
// // // // // // //                 <div className="flex justify-end space-x-4">
// // // // // // //                   <button
// // // // // // //                     className="px-4 py-2 bg-gray-300 text-gray-800 rounded hover:bg-gray-400"
// // // // // // //                     onClick={() => setShowConfirmation(false)}
// // // // // // //                   >
// // // // // // //                     Cancel
// // // // // // //                   </button>
// // // // // // //                   <button
// // // // // // //                     className="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"
// // // // // // //                     onClick={confirmSubmit}
// // // // // // //                   >
// // // // // // //                     Confirm
// // // // // // //                   </button>
// // // // // // //                 </div>
// // // // // // //               </div>
// // // // // // //             </div>
// // // // // // //           )}
// // // // // // //         </div>
// // // // // // //       )}

// // // // // // //       {/* Analytics Tab */}
// // // // // // //       {activeTab === 'analytics' && (
// // // // // // //         <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
// // // // // // //           {[
// // // // // // //             { label: 'Total Employees', value: attendanceAnalytics.totalEmployees, color: 'text-blue-600' },
// // // // // // //             { label: 'Present Today', value: attendanceAnalytics.presentToday, color: 'text-green-600' },
// // // // // // //             { label: 'Absent Today', value: attendanceAnalytics.absentToday, color: 'text-red-600' },
// // // // // // //             { label: 'Late Today', value: attendanceAnalytics.lateToday, color: 'text-yellow-600' }
// // // // // // //           ].map(({ label, value, color }) => (
// // // // // // //             <div key={label} className="bg-white border rounded-lg p-4 text-center shadow-sm">
// // // // // // //               <h3 className="text-sm text-gray-500">{label}</h3>
// // // // // // //               <div className={`text-2xl font-bold ${color}`}>{value}</div>
// // // // // // //             </div>
// // // // // // //           ))}
// // // // // // //         </div>
// // // // // // //       )}

// // // // // // //       {/* History Tab */}
// // // // // // //       {activeTab === 'history' && (
// // // // // // //         <div className="space-y-2 max-h-96 overflow-y-auto">
// // // // // // //           {attendanceRecords.length === 0 ? (
// // // // // // //             <p className="text-gray-500 text-center">No attendance records found.</p>
// // // // // // //           ) : (
// // // // // // //             attendanceRecords.map((record, index) => {
// // // // // // //               const recordDate = new Date(record.timestamp);
// // // // // // //               const formattedDate = isNaN(recordDate.getTime()) ? 'Invalid Date' : recordDate.toLocaleString();
// // // // // // //               return (
// // // // // // //                 <div key={index} className="p-3 border rounded-lg bg-white shadow-sm">
// // // // // // //                   <p className="text-gray-800">{`Employee ID: ${record.employeeId} - ${record.status} (${formattedDate})`}</p>
// // // // // // //                 </div>
// // // // // // //               );
// // // // // // //             })
// // // // // // //           )}
// // // // // // //         </div>
// // // // // // //       )}
// // // // // // //     </div>
// // // // // // //   );
// // // // // // // };

// // // // // // // export default EmployeeAttendanceSystem;
// // // // // // import React, { useState, useEffect, useMemo } from 'react';
// // // // // // import axios from 'axios';

// // // // // // const EmployeeAttendanceSystem = () => {
// // // // // //   const [employees, setEmployees] = useState([]);
// // // // // //   const [attendanceRecords, setAttendanceRecords] = useState([]);
// // // // // //   const [searchQuery, setSearchQuery] = useState('');
// // // // // //   const [attendance, setAttendance] = useState({});
// // // // // //   const [activeTab, setActiveTab] = useState('attendance');
// // // // // //   const [loading, setLoading] = useState(true);
// // // // // //   const [error, setError] = useState(null);

// // // // // //   const storeId = localStorage.getItem("storeId") || "defaultStore"; // Fallback if storeId is null

// // // // // //   // Fetch employees and attendance records
// // // // // //   useEffect(() => {
// // // // // //     const fetchData = async () => {
// // // // // //       setLoading(true);
// // // // // //       setError(null);
// // // // // //       try {
// // // // // //         const [employeesResponse, attendanceResponse] = await Promise.all([
// // // // // //           axios.get('http://localhost:5004/employees', { headers: { storeId } }),
// // // // // //           axios.get('http://localhost:5019/attendance', { headers: { storeId } })
// // // // // //         ]);

// // // // // //         // Map backend employee data to the expected format
// // // // // //         const validEmployees = employeesResponse.data
// // // // // //           .filter(employee => employee && typeof employee.name === 'string')
// // // // // //           .map(employee => ({
// // // // // //             ...employee,
// // // // // //             employeeName: employee.name, // Map 'name' to 'employeeName'
// // // // // //             employeeId: employee.employeeId || employee._id // Use '_id' as 'employeeId' if not provided
// // // // // //           }));
// // // // // //         setEmployees(validEmployees);
// // // // // //         console.log("Fetched Employees:", validEmployees);

// // // // // //         const validRecords = attendanceResponse.data.map(record => ({
// // // // // //           ...record,
// // // // // //           timestamp: record.timestamp || new Date().toISOString() // Fallback for missing timestamps
// // // // // //         }));
// // // // // //         setAttendanceRecords(validRecords);
// // // // // //         console.log("Fetched Attendance Records:", validRecords);
// // // // // //       } catch (err) {
// // // // // //         const errorMsg = err.response?.data?.error || err.message;
// // // // // //         setError(`Failed to fetch data: ${errorMsg}. Check console for details.`);
// // // // // //         console.error("Fetch Error:", err.response?.data || err);
// // // // // //       } finally {
// // // // // //         setLoading(false);
// // // // // //       }
// // // // // //     };

// // // // // //     fetchData();
// // // // // //   }, [storeId]);

// // // // // //   // Compute attendance analytics for today
// // // // // //   const attendanceAnalytics = useMemo(() => {
// // // // // //     if (!attendanceRecords.length) return {
// // // // // //       totalEmployees: employees.length,
// // // // // //       presentToday: 0,
// // // // // //       absentToday: employees.length,
// // // // // //       lateToday: 0
// // // // // //     };

// // // // // //     const today = new Date().toISOString().split('T')[0];
// // // // // //     console.log("Today's Date:", today);

// // // // // //     const todayAttendance = attendanceRecords.filter(record => {
// // // // // //       if (!record.timestamp || typeof record.timestamp !== 'string') {
// // // // // //         console.warn("Skipping record with invalid timestamp:", record);
// // // // // //         return false;
// // // // // //       }
// // // // // //       const recordDate = new Date(record.timestamp);
// // // // // //       if (isNaN(recordDate.getTime())) {
// // // // // //         console.warn("Invalid date parsed from timestamp:", record.timestamp, record);
// // // // // //         return false;
// // // // // //       }
// // // // // //       return recordDate.toISOString().split('T')[0] === today;
// // // // // //     });

// // // // // //     console.log("Today's Attendance Records:", todayAttendance);

// // // // // //     const present = todayAttendance.filter(r => r.status === 'Present').length;
// // // // // //     const late = todayAttendance.filter(r => r.status === 'Late').length;

// // // // // //     return {
// // // // // //       totalEmployees: employees.length,
// // // // // //       presentToday: present,
// // // // // //       absentToday: employees.length - present - late,
// // // // // //       lateToday: late
// // // // // //     };
// // // // // //   }, [attendanceRecords, employees]);

// // // // // //   // Filter employees based on search query
// // // // // //   const filteredEmployees = employees.filter(employee => {
// // // // // //     if (!employee || !employee.employeeName || !employee.employeeId) {
// // // // // //       console.warn("Invalid employee object:", employee);
// // // // // //       return false;
// // // // // //     }
// // // // // //     return (
// // // // // //       employee.employeeName.toLowerCase().includes(searchQuery.toLowerCase()) ||
// // // // // //       employee.employeeId.toLowerCase().includes(searchQuery.toLowerCase())
// // // // // //     );
// // // // // //   });

// // // // // //   // Handle status change for an employee
// // // // // //   const handleStatusChange = (employeeId, status) => {
// // // // // //     setAttendance(prev => ({
// // // // // //       ...prev,
// // // // // //       [employeeId]: status
// // // // // //     }));
// // // // // //   };

// // // // // //   // Submit attendance records
// // // // // //   const handleSubmit = async () => {
// // // // // //     try {
// // // // // //       const records = Object.keys(attendance)
// // // // // //         .filter(employeeId => attendance[employeeId])
// // // // // //         .map(employeeId => ({
// // // // // //           employeeId,
// // // // // //           status: attendance[employeeId],
// // // // // //           timestamp: new Date().toISOString()
// // // // // //         }));

// // // // // //       if (!records.length) {
// // // // // //         alert('Please select at least one attendance status.');
// // // // // //         return;
// // // // // //       }

// // // // // //       console.log("Submitting Attendance Records:", records);
// // // // // //       const response = await axios.post('http://localhost:5019/attendance', records, { 
// // // // // //         headers: { 
// // // // // //           'storeId': storeId,
// // // // // //           'Content-Type': 'application/json'
// // // // // //         }
// // // // // //       });
      
// // // // // //       // Fetch updated records after submission to ensure sync
// // // // // //       const updatedResponse = await axios.get('http://localhost:5019/attendance', { headers: { storeId } });
// // // // // //       const updatedRecords = updatedResponse.data.map(record => ({
// // // // // //         ...record,
// // // // // //         timestamp: record.timestamp || new Date().toISOString()
// // // // // //       }));
// // // // // //       setAttendanceRecords(updatedRecords);
// // // // // //       setAttendance({});
// // // // // //       alert('Attendance recorded successfully!');
// // // // // //       console.log("Attendance Submission Response:", response.data);
// // // // // //       console.log("Updated Attendance Records:", updatedRecords);
// // // // // //     } catch (err) {
// // // // // //       const errorMsg = err.response?.data?.error || err.message;
// // // // // //       setError(`Failed to record attendance: ${errorMsg}. Check console for details.`);
// // // // // //       console.error("Attendance Submission Error:", err.response?.data || err);
// // // // // //     }
// // // // // //   };

// // // // // //   if (loading) return <div className="text-center py-10 text-gray-600">Loading...</div>;
// // // // // //   if (error) return (
// // // // // //     <div className="text-red-500 text-center py-10">
// // // // // //       {error}
// // // // // //       <button 
// // // // // //         className="ml-4 px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"
// // // // // //         onClick={() => window.location.reload()}
// // // // // //       >
// // // // // //         Retry
// // // // // //       </button>
// // // // // //     </div>
// // // // // //   );

// // // // // //   return (
// // // // // //     <div className="container mx-auto p-6 max-w-4xl bg-gray-50 rounded-lg shadow-md">
// // // // // //       <h1 className="text-3xl font-bold mb-6 text-center text-gray-800">Employee Attendance System</h1>

// // // // // //       {/* Tabs */}
// // // // // //       <div className="flex mb-6 border-b border-gray-200">
// // // // // //         {['attendance', 'analytics', 'history'].map(tab => (
// // // // // //           <button
// // // // // //             key={tab}
// // // // // //             className={`px-4 py-2 font-semibold ${activeTab === tab ? 'border-b-2 border-blue-500 text-blue-600' : 'text-gray-600 hover:text-gray-800'}`}
// // // // // //             onClick={() => setActiveTab(tab)}
// // // // // //           >
// // // // // //             {tab.charAt(0).toUpperCase() + tab.slice(1)}
// // // // // //           </button>
// // // // // //         ))}
// // // // // //       </div>

// // // // // //       {/* Attendance Tab */}
// // // // // //       {activeTab === 'attendance' && (
// // // // // //         <div>
// // // // // //           <input
// // // // // //             type="text"
// // // // // //             placeholder="Search by Employee Name or ID"
// // // // // //             className="w-full px-4 py-2 border rounded-lg mb-4 focus:outline-none focus:ring-2 focus:ring-blue-500"
// // // // // //             value={searchQuery}
// // // // // //             onChange={(e) => setSearchQuery(e.target.value)}
// // // // // //           />
// // // // // //           <div className="space-y-2 max-h-96 overflow-y-auto">
// // // // // //             {filteredEmployees.length === 0 ? (
// // // // // //               <p className="text-gray-500 text-center">
// // // // // //                 No employees found. Please add employees to record attendance.
// // // // // //               </p>
// // // // // //             ) : (
// // // // // //               filteredEmployees.map(employee => (
// // // // // //                 <div key={employee._id} className="flex justify-between p-3 border rounded-lg bg-white">
// // // // // //                   <div>
// // // // // //                     <h3 className="font-semibold text-gray-800">{employee.employeeName}</h3>
// // // // // //                     <p className="text-sm text-gray-500">ID: {employee.employeeId}</p>
// // // // // //                   </div>
// // // // // //                   <select
// // // // // //                     className="px-3 py-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
// // // // // //                     value={attendance[employee.employeeId] || ''}
// // // // // //                     onChange={(e) => handleStatusChange(employee.employeeId, e.target.value)}
// // // // // //                   >
// // // // // //                     <option value="">Select Status</option>
// // // // // //                     <option value="Present">Present</option>
// // // // // //                     <option value="Absent">Absent</option>
// // // // // //                     <option value="Late">Late</option>
// // // // // //                   </select>
// // // // // //                 </div>
// // // // // //               ))
// // // // // //             )}
// // // // // //           </div>
// // // // // //           <button
// // // // // //             onClick={handleSubmit}
// // // // // //             disabled={!Object.keys(attendance).some(id => attendance[id])}
// // // // // //             className={`w-full mt-4 py-2 rounded-lg text-white ${Object.keys(attendance).some(id => attendance[id]) ? 'bg-blue-500 hover:bg-blue-600' : 'bg-gray-400 cursor-not-allowed'}`}
// // // // // //           >
// // // // // //             Submit Attendance
// // // // // //           </button>
// // // // // //         </div>
// // // // // //       )}

// // // // // //       {/* Analytics Tab */}
// // // // // //       {activeTab === 'analytics' && (
// // // // // //         <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
// // // // // //           {[
// // // // // //             { label: 'Total Employees', value: attendanceAnalytics.totalEmployees, color: 'text-blue-600' },
// // // // // //             { label: 'Present Today', value: attendanceAnalytics.presentToday, color: 'text-green-600' },
// // // // // //             { label: 'Absent Today', value: attendanceAnalytics.absentToday, color: 'text-red-600' },
// // // // // //             { label: 'Late Today', value: attendanceAnalytics.lateToday, color: 'text-yellow-600' }
// // // // // //           ].map(({ label, value, color }) => (
// // // // // //             <div key={label} className="bg-white border rounded-lg p-4 text-center shadow-sm">
// // // // // //               <h3 className="text-sm text-gray-500">{label}</h3>
// // // // // //               <div className={`text-2xl font-bold ${color}`}>{value}</div>
// // // // // //             </div>
// // // // // //           ))}
// // // // // //         </div>
// // // // // //       )}

// // // // // //       {/* History Tab */}
// // // // // //       {activeTab === 'history' && (
// // // // // //         <div className="space-y-2 max-h-96 overflow-y-auto">
// // // // // //           {attendanceRecords.length === 0 ? (
// // // // // //             <p className="text-gray-500 text-center">No attendance records found.</p>
// // // // // //           ) : (
// // // // // //             attendanceRecords.map((record, index) => {
// // // // // //               const recordDate = new Date(record.timestamp);
// // // // // //               const formattedDate = isNaN(recordDate.getTime()) ? 'Invalid Date' : recordDate.toLocaleString();
// // // // // //               return (
// // // // // //                 <div key={index} className="p-3 border rounded-lg bg-white">
// // // // // //                   <p className="text-gray-800">{`Employee ID: ${record.employeeId} - ${record.status} (${formattedDate})`}</p>
// // // // // //                 </div>
// // // // // //               );
// // // // // //             })
// // // // // //           )}
// // // // // //         </div>
// // // // // //       )}
// // // // // //     </div>
// // // // // //   );
// // // // // // };

// // // // // // export default EmployeeAttendanceSystem;
// // // // // import React, { useState, useEffect, useMemo } from 'react';
// // // // // import axios from 'axios';
// // // // // import io from 'socket.io-client';

// // // // // const socket = io('http://localhost:5019'); // WebSocket connection to attendance backend

// // // // // const EmployeeAttendanceSystem = () => {
// // // // //   const [employees, setEmployees] = useState([]);
// // // // //   const [attendanceRecords, setAttendanceRecords] = useState([]);
// // // // //   const [searchQuery, setSearchQuery] = useState('');
// // // // //   const [attendance, setAttendance] = useState({});
// // // // //   const [activeTab, setActiveTab] = useState('attendance');
// // // // //   const [loading, setLoading] = useState(true);
// // // // //   const [error, setError] = useState(null);
// // // // //   const [page, setPage] = useState(1);
// // // // //   const employeesPerPage = 50; // Pagination limit for scalability

// // // // //   const storeId = localStorage.getItem("storeId") || "defaultStore";

// // // // //   // Fetch employees and attendance records, plus real-time updates
// // // // //   useEffect(() => {
// // // // //     const fetchData = async () => {
// // // // //       setLoading(true);
// // // // //       setError(null);
// // // // //       try {
// // // // //         const [employeesResponse, attendanceResponse] = await Promise.all([
// // // // //           axios.get(`http://localhost:5004/employees?page=${page}&limit=${employeesPerPage}`, { headers: { storeId } }),
// // // // //           axios.get('http://localhost:5019/attendance', { headers: { storeId } })
// // // // //         ]);

// // // // //         const validEmployees = employeesResponse.data.map(employee => ({
// // // // //           ...employee,
// // // // //           employeeName: employee.name,
// // // // //           employeeId: employee.employeeId || employee._id
// // // // //         }));
// // // // //         setEmployees(validEmployees);
// // // // //         setAttendanceRecords(attendanceResponse.data);
// // // // //       } catch (err) {
// // // // //         setError(`Failed to fetch data: ${err.message}`);
// // // // //         console.error("Fetch Error:", err);
// // // // //       } finally {
// // // // //         setLoading(false);
// // // // //       }
// // // // //     };

// // // // //     fetchData();

// // // // //     // Listen for real-time attendance updates
// // // // //     socket.on('attendanceUpdate', (newRecords) => {
// // // // //       setAttendanceRecords(prev => [...prev, ...newRecords]);
// // // // //     });

// // // // //     // Cleanup WebSocket listener
// // // // //     return () => socket.off('attendanceUpdate');
// // // // //   }, [storeId, page]);

// // // // //   // Reset attendance daily at midnight
// // // // //   useEffect(() => {
// // // // //     const resetAttendance = () => {
// // // // //       const now = new Date();
// // // // //       if (now.getHours() === 0 && now.getMinutes() === 0) {
// // // // //         setAttendance({});
// // // // //       }
// // // // //     };
// // // // //     const interval = setInterval(resetAttendance, 60000); // Check every minute
// // // // //     return () => clearInterval(interval);
// // // // //   }, []);

// // // // //   // Compute attendance analytics
// // // // //   const attendanceAnalytics = useMemo(() => {
// // // // //     const today = new Date().toISOString().split('T')[0];
// // // // //     const todayAttendance = attendanceRecords.filter(r => r.timestamp.split('T')[0] === today);

// // // // //     const present = todayAttendance.filter(r => r.status === 'Present').length;
// // // // //     const late = todayAttendance.filter(r => r.status === 'Late').length;

// // // // //     return {
// // // // //       totalEmployees: employees.length,
// // // // //       presentToday: present,
// // // // //       absentToday: employees.length - present - late,
// // // // //       lateToday: late
// // // // //     };
// // // // //   }, [attendanceRecords, employees]);

// // // // //   // Filter employees based on search query
// // // // //   const filteredEmployees = employees.filter(employee =>
// // // // //     employee.employeeName.toLowerCase().includes(searchQuery.toLowerCase()) ||
// // // // //     employee.employeeId.toLowerCase().includes(searchQuery.toLowerCase())
// // // // //   );

// // // // //   // Handle bulk status change
// // // // //   const handleBulkStatusChange = (status) => {
// // // // //     const newAttendance = {};
// // // // //     filteredEmployees.forEach(emp => {
// // // // //       newAttendance[emp.employeeId] = status;
// // // // //     });
// // // // //     setAttendance(newAttendance);
// // // // //   };

// // // // //   // Handle individual status change
// // // // //   const handleStatusChange = (employeeId, status) => {
// // // // //     setAttendance(prev => ({
// // // // //       ...prev,
// // // // //       [employeeId]: status
// // // // //     }));
// // // // //   };

// // // // //   // Submit attendance records
// // // // //   const handleSubmit = async () => {
// // // // //     const records = Object.keys(attendance)
// // // // //       .map(employeeId => ({
// // // // //         employeeId,
// // // // //         status: attendance[employeeId],
// // // // //         timestamp: new Date().toISOString()
// // // // //       }));

// // // // //     if (!records.length) {
// // // // //       alert('Please mark at least one attendance status.');
// // // // //       return;
// // // // //     }

// // // // //     try {
// // // // //       await axios.post('http://localhost:5019/attendance', records, { 
// // // // //         headers: { 
// // // // //           'storeId': storeId,
// // // // //           'Content-Type': 'application/json'
// // // // //         }
// // // // //       });
// // // // //       socket.emit('newAttendance', records); // Notify via WebSocket
// // // // //       setAttendance({}); // Reset after submission
// // // // //       alert('Attendance recorded successfully!');
// // // // //     } catch (err) {
// // // // //       setError(`Failed to record attendance: ${err.message}`);
// // // // //       console.error("Submission Error:", err);
// // // // //     }
// // // // //   };

// // // // //   // Loading and error states
// // // // //   if (loading) return <div className="text-center py-10 text-gray-600">Loading...</div>;
// // // // //   if (error) return (
// // // // //     <div className="text-red-500 text-center py-10">
// // // // //       {error}
// // // // //       <button 
// // // // //         className="ml-4 px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"
// // // // //         onClick={() => window.location.reload()}
// // // // //       >
// // // // //         Retry
// // // // //       </button>
// // // // //     </div>
// // // // //   );

// // // // //   return (
// // // // //     <div className="container mx-auto p-6 max-w-4xl bg-gray-50 rounded-lg shadow-md">
// // // // //       <h1 className="text-3xl font-bold mb-6 text-center text-gray-800">Employee Attendance System</h1>

// // // // //       {/* Tabs */}
// // // // //       <div className="flex mb-6 border-b border-gray-200">
// // // // //         {['attendance', 'analytics', 'history'].map(tab => (
// // // // //           <button
// // // // //             key={tab}
// // // // //             className={`px-4 py-2 font-semibold ${activeTab === tab ? 'border-b-2 border-blue-500 text-blue-600' : 'text-gray-600 hover:text-gray-800'}`}
// // // // //             onClick={() => setActiveTab(tab)}
// // // // //           >
// // // // //             {tab.charAt(0).toUpperCase() + tab.slice(1)}
// // // // //           </button>
// // // // //         ))}
// // // // //       </div>

// // // // //       {/* Attendance Tab */}
// // // // //       {activeTab === 'attendance' && (
// // // // //         <div>
// // // // //           <input
// // // // //             type="text"
// // // // //             placeholder="Search by Employee Name or ID"
// // // // //             className="w-full px-4 py-2 border rounded-lg mb-4 focus:outline-none focus:ring-2 focus:ring-blue-500"
// // // // //             value={searchQuery}
// // // // //             onChange={(e) => setSearchQuery(e.target.value)}
// // // // //           />
// // // // //           <div className="mb-4 flex space-x-2">
// // // // //             <button 
// // // // //               onClick={() => handleBulkStatusChange('Present')} 
// // // // //               className="px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600"
// // // // //             >
// // // // //               Mark All Present
// // // // //             </button>
// // // // //             <button 
// // // // //               onClick={() => handleBulkStatusChange('Absent')} 
// // // // //               className="px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600"
// // // // //             >
// // // // //               Mark All Absent
// // // // //             </button>
// // // // //             <button 
// // // // //               onClick={() => handleBulkStatusChange('Late')} 
// // // // //               className="px-4 py-2 bg-yellow-500 text-white rounded hover:bg-yellow-600"
// // // // //             >
// // // // //               Mark All Late
// // // // //             </button>
// // // // //           </div>
// // // // //           <div className="space-y-2 max-h-96 overflow-y-auto">
// // // // //             {filteredEmployees.length === 0 ? (
// // // // //               <p className="text-gray-500 text-center">No employees found.</p>
// // // // //             ) : (
// // // // //               filteredEmployees.map(employee => (
// // // // //                 <div key={employee._id} className="flex justify-between p-3 border rounded-lg bg-white">
// // // // //                   <div>
// // // // //                     <h3 className="font-semibold text-gray-800">{employee.employeeName}</h3>
// // // // //                     <p className="text-sm text-gray-500">ID: {employee.employeeId}</p>
// // // // //                   </div>
// // // // //                   <select
// // // // //                     className="px-3 py-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
// // // // //                     value={attendance[employee.employeeId] || ''}
// // // // //                     onChange={(e) => handleStatusChange(employee.employeeId, e.target.value)}
// // // // //                   >
// // // // //                     <option value="">Select Status</option>
// // // // //                     <option value="Present">Present</option>
// // // // //                     <option value="Absent">Absent</option>
// // // // //                     <option value="Late">Late</option>
// // // // //                   </select>
// // // // //                 </div>
// // // // //               ))
// // // // //             )}
// // // // //           </div>
// // // // //           <div className="mt-4 flex justify-between">
// // // // //             <button 
// // // // //               onClick={() => setPage(p => Math.max(1, p - 1))} 
// // // // //               className="px-4 py-2 bg-gray-300 rounded hover:bg-gray-400"
// // // // //             >
// // // // //               Previous
// // // // //             </button>
// // // // //             <button
// // // // //               onClick={handleSubmit}
// // // // //               className="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"
// // // // //             >
// // // // //               Submit Attendance
// // // // //             </button>
// // // // //             <button 
// // // // //               onClick={() => setPage(p => p + 1)} 
// // // // //               className="px-4 py-2 bg-gray-300 rounded hover:bg-gray-400"
// // // // //             >
// // // // //               Next
// // // // //             </button>
// // // // //           </div>
// // // // //         </div>
// // // // //       )}

// // // // //       {/* Analytics Tab */}
// // // // //       {activeTab === 'analytics' && (
// // // // //         <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
// // // // //           {[
// // // // //             { label: 'Total Employees', value: attendanceAnalytics.totalEmployees, color: 'text-blue-600' },
// // // // //             { label: 'Present Today', value: attendanceAnalytics.presentToday, color: 'text-green-600' },
// // // // //             { label: 'Absent Today', value: attendanceAnalytics.absentToday, color: 'text-red-600' },
// // // // //             { label: 'Late Today', value: attendanceAnalytics.lateToday, color: 'text-yellow-600' }
// // // // //           ].map(({ label, value, color }) => (
// // // // //             <div key={label} className="bg-white border rounded-lg p-4 text-center shadow-sm">
// // // // //               <h3 className="text-sm text-gray-500">{label}</h3>
// // // // //               <div className={`text-2xl font-bold ${color}`}>{value}</div>
// // // // //             </div>
// // // // //           ))}
// // // // //         </div>
// // // // //       )}

// // // // //       {/* History Tab */}
// // // // //       {activeTab === 'history' && (
// // // // //         <div className="space-y-2 max-h-96 overflow-y-auto">
// // // // //           {attendanceRecords.length === 0 ? (
// // // // //             <p className="text-gray-500 text-center">No attendance records found.</p>
// // // // //           ) : (
// // // // //             attendanceRecords.map((record, index) => (
// // // // //               <div key={index} className="p-3 border rounded-lg bg-white">
// // // // //                 <p className="text-gray-800">{`Employee ID: ${record.employeeId} - ${record.status} (${new Date(record.timestamp).toLocaleString()})`}</p>
// // // // //               </div>
// // // // //             ))
// // // // //           )}
// // // // //         </div>
// // // // //       )}
// // // // //     </div>
// // // // //   );
// // // // // };

// // // // // export default EmployeeAttendanceSystem;
// // // // import React, { useState, useEffect, useMemo } from 'react';
// // // // import axios from 'axios';

// // // // const EmployeeAttendanceSystem = () => {
// // // //   const [employees, setEmployees] = useState([]);
// // // //   const [attendanceRecords, setAttendanceRecords] = useState([]);
// // // //   const [searchQuery, setSearchQuery] = useState('');
// // // //   const [attendance, setAttendance] = useState({});
// // // //   const [activeTab, setActiveTab] = useState('attendance');
// // // //   const [loading, setLoading] = useState(true);
// // // //   const [error, setError] = useState(null);
// // // //   const [currentDate, setCurrentDate] = useState(new Date().toISOString().split('T')[0]);
// // // //   const [selectedDepartment, setSelectedDepartment] = useState('All');
// // // //   const [bulkAction, setBulkAction] = useState('');
// // // //   const [selectedEmployees, setSelectedEmployees] = useState([]);

// // // //   const storeId = localStorage.getItem("storeId") || "defaultStore";

// // // //   // Fetch employees and attendance records
// // // //   useEffect(() => {
// // // //     const fetchData = async () => {
// // // //       setLoading(true);
// // // //       setError(null);
// // // //       try {
// // // //         const [employeesResponse, attendanceResponse] = await Promise.all([
// // // //           axios.get('http://localhost:5004/employees', { headers: { storeId } }),
// // // //           axios.get(`http://localhost:5019/attendance?date=${currentDate}`, { headers: { storeId } })
// // // //         ]);

// // // //         // Map backend employee data to the expected format
// // // //         const validEmployees = employeesResponse.data
// // // //           .filter(employee => employee && typeof employee.name === 'string')
// // // //           .map(employee => ({
// // // //             ...employee,
// // // //             employeeName: employee.name,
// // // //             employeeId: employee.employeeId || employee._id,
// // // //             department: employee.department || 'Unassigned'
// // // //           }));
// // // //         setEmployees(validEmployees);

// // // //         const validRecords = attendanceResponse.data.map(record => ({
// // // //           ...record,
// // // //           timestamp: record.timestamp || new Date().toISOString()
// // // //         }));
// // // //         setAttendanceRecords(validRecords);
        
// // // //         // Pre-fill attendance state with today's records
// // // //         const todayAttendance = {};
// // // //         validRecords.forEach(record => {
// // // //           const recordDate = new Date(record.timestamp).toISOString().split('T')[0];
// // // //           if (recordDate === currentDate) {
// // // //             todayAttendance[record.employeeId] = record.status;
// // // //           }
// // // //         });
// // // //         setAttendance(todayAttendance);
// // // //       } catch (err) {
// // // //         const errorMsg = err.response?.data?.error || err.message;
// // // //         setError(`Failed to fetch data: ${errorMsg}. Check console for details.`);
// // // //         console.error("Fetch Error:", err.response?.data || err);
// // // //       } finally {
// // // //         setLoading(false);
// // // //       }
// // // //     };

// // // //     fetchData();
    
// // // //     // Set up an interval to check for date change
// // // //     const dateCheckInterval = setInterval(() => {
// // // //       const newDate = new Date().toISOString().split('T')[0];
// // // //       if (newDate !== currentDate) {
// // // //         setCurrentDate(newDate);
// // // //         setAttendance({}); // Reset attendance for the new day
// // // //       }
// // // //     }, 60000); // Check every minute
    
// // // //     return () => clearInterval(dateCheckInterval);
// // // //   }, [storeId, currentDate]);

// // // //   // Get unique departments
// // // //   const departments = useMemo(() => {
// // // //     const depts = [...new Set(employees.map(emp => emp.department || 'Unassigned'))];
// // // //     return ['All', ...depts];
// // // //   }, [employees]);

// // // //   // Compute attendance analytics for today
// // // //   const attendanceAnalytics = useMemo(() => {
// // // //     const totalEmployees = employees.length;
    
// // // //     const todayAttendance = attendanceRecords.filter(record => {
// // // //       if (!record.timestamp || typeof record.timestamp !== 'string') return false;
// // // //       const recordDate = new Date(record.timestamp);
// // // //       if (isNaN(recordDate.getTime())) return false;
// // // //       return recordDate.toISOString().split('T')[0] === currentDate;
// // // //     });

// // // //     const present = todayAttendance.filter(r => r.status === 'Present').length;
// // // //     const late = todayAttendance.filter(r => r.status === 'Late').length;
// // // //     const absent = todayAttendance.filter(r => r.status === 'Absent').length;
// // // //     const unmarked = totalEmployees - present - late - absent;

// // // //     return {
// // // //       totalEmployees,
// // // //       presentToday: present,
// // // //       absentToday: absent,
// // // //       lateToday: late,
// // // //       unmarkedToday: unmarked,
// // // //       attendanceRate: totalEmployees > 0 ? Math.round((present + late) / totalEmployees * 100) : 0
// // // //     };
// // // //   }, [attendanceRecords, employees, currentDate]);

// // // //   // Filter employees based on search query and department
// // // //   const filteredEmployees = useMemo(() => {
// // // //     return employees.filter(employee => {
// // // //       if (!employee || !employee.employeeName) return false;
      
// // // //       const matchesSearch = 
// // // //         employee.employeeName.toLowerCase().includes(searchQuery.toLowerCase()) ||
// // // //         (employee.employeeId && employee.employeeId.toLowerCase().includes(searchQuery.toLowerCase()));
      
// // // //       const matchesDepartment = 
// // // //         selectedDepartment === 'All' || 
// // // //         employee.department === selectedDepartment;
        
// // // //       return matchesSearch && matchesDepartment;
// // // //     });
// // // //   }, [employees, searchQuery, selectedDepartment]);

// // // //   // Handle status change for an employee
// // // //   const handleStatusChange = (employeeId, status) => {
// // // //     setAttendance(prev => ({
// // // //       ...prev,
// // // //       [employeeId]: status
// // // //     }));
// // // //   };

// // // //   // Handle bulk action
// // // //   const handleBulkAction = () => {
// // // //     if (!bulkAction) {
// // // //       alert('Please select a status for bulk action');
// // // //       return;
// // // //     }
    
// // // //     const updatedAttendance = { ...attendance };
// // // //     selectedEmployees.forEach(employeeId => {
// // // //       updatedAttendance[employeeId] = bulkAction;
// // // //     });
    
// // // //     setAttendance(updatedAttendance);
// // // //     setSelectedEmployees([]);
// // // //     setBulkAction('');
// // // //   };

// // // //   // Toggle employee selection for bulk action
// // // //   const toggleEmployeeSelection = (employeeId) => {
// // // //     setSelectedEmployees(prev => {
// // // //       if (prev.includes(employeeId)) {
// // // //         return prev.filter(id => id !== employeeId);
// // // //       } else {
// // // //         return [...prev, employeeId];
// // // //       }
// // // //     });
// // // //   };

// // // //   // Select all visible employees
// // // //   const selectAllVisible = () => {
// // // //     setSelectedEmployees(filteredEmployees.map(emp => emp.employeeId));
// // // //   };

// // // //   // Deselect all employees
// // // //   const deselectAll = () => {
// // // //     setSelectedEmployees([]);
// // // //   };

// // // //   // Submit attendance records
// // // //   const handleSubmit = async () => {
// // // //     try {
// // // //       const records = Object.keys(attendance)
// // // //         .filter(employeeId => attendance[employeeId])
// // // //         .map(employeeId => ({
// // // //           employeeId,
// // // //           status: attendance[employeeId],
// // // //           timestamp: new Date().toISOString()
// // // //         }));

// // // //       if (!records.length) {
// // // //         alert('Please select at least one attendance status.');
// // // //         return;
// // // //       }

// // // //       await axios.post('http://localhost:5019/attendance', records, { 
// // // //         headers: { 
// // // //           'storeId': storeId,
// // // //           'Content-Type': 'application/json'
// // // //         }
// // // //       });
      
// // // //       // Fetch updated records after submission
// // // //       const updatedResponse = await axios.get(`http://localhost:5019/attendance?date=${currentDate}`, { 
// // // //         headers: { storeId } 
// // // //       });
      
// // // //       const updatedRecords = updatedResponse.data.map(record => ({
// // // //         ...record,
// // // //         timestamp: record.timestamp || new Date().toISOString()
// // // //       }));
      
// // // //       setAttendanceRecords(updatedRecords);
// // // //       alert('Attendance recorded successfully!');
// // // //     } catch (err) {
// // // //       const errorMsg = err.response?.data?.error || err.message;
// // // //       setError(`Failed to record attendance: ${errorMsg}. Check console for details.`);
// // // //       console.error("Attendance Submission Error:", err.response?.data || err);
// // // //     }
// // // //   };

// // // //   // Get attendance history for a specific date
// // // //   const getAttendanceForDate = async (date) => {
// // // //     try {
// // // //       setLoading(true);
// // // //       const response = await axios.get(`http://localhost:5019/attendance?date=${date}`, { 
// // // //         headers: { storeId } 
// // // //       });
      
// // // //       const records = response.data.map(record => ({
// // // //         ...record,
// // // //         timestamp: record.timestamp || new Date().toISOString()
// // // //       }));
      
// // // //       setAttendanceRecords(records);
// // // //       setLoading(false);
// // // //     } catch (err) {
// // // //       setError(`Failed to fetch attendance for ${date}: ${err.message}`);
// // // //       setLoading(false);
// // // //     }
// // // //   };

// // // //   if (loading) return (
// // // //     <div className="flex justify-center items-center h-64">
// // // //       <div className="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"></div>
// // // //     </div>
// // // //   );
  
// // // //   if (error) return (
// // // //     <div className="text-red-500 text-center py-10">
// // // //       {error}
// // // //       <button 
// // // //         className="ml-4 px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"
// // // //         onClick={() => window.location.reload()}
// // // //       >
// // // //         Retry
// // // //       </button>
// // // //     </div>
// // // //   );

// // // //   return (
// // // //     <div className="container mx-auto p-4 max-w-6xl bg-gray-50 rounded-lg shadow-md">
// // // //       <h1 className="text-3xl font-bold mb-6 text-center text-gray-800">Employee Attendance System</h1>
      
// // // //       {/* Date Display */}
// // // //       <div className="mb-4 text-center">
// // // //         <h2 className="text-xl font-semibold">
// // // //           {new Date(currentDate).toLocaleDateString('en-US', { 
// // // //             weekday: 'long', 
// // // //             year: 'numeric', 
// // // //             month: 'long', 
// // // //             day: 'numeric' 
// // // //           })}
// // // //         </h2>
// // // //       </div>

// // // //       {/* Tabs */}
// // // //       <div className="flex mb-6 border-b border-gray-200">
// // // //         {['attendance', 'analytics', 'history'].map(tab => (
// // // //           <button
// // // //             key={tab}
// // // //             className={`px-4 py-2 font-semibold ${activeTab === tab ? 'border-b-2 border-blue-500 text-blue-600' : 'text-gray-600 hover:text-gray-800'}`}
// // // //             onClick={() => setActiveTab(tab)}
// // // //           >
// // // //             {tab.charAt(0).toUpperCase() + tab.slice(1)}
// // // //           </button>
// // // //         ))}
// // // //       </div>

// // // //       {/* Attendance Tab */}
// // // //       {activeTab === 'attendance' && (
// // // //         <div>
// // // //           {/* Search and Filter Controls */}
// // // //           <div className="flex flex-col md:flex-row gap-4 mb-4">
// // // //             <input
// // // //               type="text"
// // // //               placeholder="Search by Employee Name or ID"
// // // //               className="flex-1 px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
// // // //               value={searchQuery}
// // // //               onChange={(e) => setSearchQuery(e.target.value)}
// // // //             />
            
// // // //             <select
// // // //               className="px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
// // // //               value={selectedDepartment}
// // // //               onChange={(e) => setSelectedDepartment(e.target.value)}
// // // //             >
// // // //               {departments.map(dept => (
// // // //                 <option key={dept} value={dept}>{dept}</option>
// // // //               ))}
// // // //             </select>
// // // //           </div>
          
// // // //           {/* Bulk Actions */}
// // // //           <div className="flex flex-col md:flex-row gap-2 mb-4 items-center p-2 bg-gray-100 rounded-lg">
// // // //             <span className="font-semibold">Bulk Actions:</span>
// // // //             <select
// // // //               className="px-3 py-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
// // // //               value={bulkAction}
// // // //               onChange={(e) => setBulkAction(e.target.value)}
// // // //             >
// // // //               <option value="">Select Status</option>
// // // //               <option value="Present">Present</option>
// // // //               <option value="Absent">Absent</option>
// // // //               <option value="Late">Late</option>
// // // //             </select>
// // // //             <button
// // // //               onClick={handleBulkAction}
// // // //               disabled={!bulkAction || selectedEmployees.length === 0}
// // // //               className={`px-4 py-1 rounded text-white ${bulkAction && selectedEmployees.length > 0 ? 'bg-blue-500 hover:bg-blue-600' : 'bg-gray-400 cursor-not-allowed'}`}
// // // //             >
// // // //               Apply to Selected ({selectedEmployees.length})
// // // //             </button>
// // // //             <button
// // // //               onClick={selectAllVisible}
// // // //               className="px-4 py-1 rounded text-white bg-gray-600 hover:bg-gray-700"
// // // //             >
// // // //               Select All Visible
// // // //             </button>
// // // //             <button
// // // //               onClick={deselectAll}
// // // //               className="px-4 py-1 rounded text-white bg-gray-600 hover:bg-gray-700"
// // // //             >
// // // //               Deselect All
// // // //             </button>
// // // //           </div>
          
// // // //           {/* Employee List */}
// // // //           <div className="space-y-1 max-h-96 overflow-y-auto">
// // // //             {filteredEmployees.length === 0 ? (
// // // //               <p className="text-gray-500 text-center p-4">
// // // //                 No employees found. Please try a different search or filter.
// // // //               </p>
// // // //             ) : (
// // // //               <div className="divide-y divide-gray-200">
// // // //                 {filteredEmployees.map(employee => (
// // // //                   <div 
// // // //                     key={employee._id} 
// // // //                     className={`flex justify-between p-3 ${selectedEmployees.includes(employee.employeeId) ? 'bg-blue-50' : 'bg-white'} hover:bg-gray-50 transition-colors`}
// // // //                   >
// // // //                     <div className="flex items-center">
// // // //                       <input
// // // //                         type="checkbox"
// // // //                         checked={selectedEmployees.includes(employee.employeeId)}
// // // //                         onChange={() => toggleEmployeeSelection(employee.employeeId)}
// // // //                         className="mr-3 h-5 w-5 text-blue-600"
// // // //                       />
// // // //                       <div>
// // // //                         <h3 className="font-semibold text-gray-800">{employee.employeeName}</h3>
// // // //                         <div className="flex gap-2 text-sm text-gray-500">
// // // //                           <span>ID: {employee.employeeId}</span>
// // // //                           {employee.department && (
// // // //                             <span className="px-2 py-0.5 bg-gray-100 rounded-full text-xs">
// // // //                               {employee.department}
// // // //                             </span>
// // // //                           )}
// // // //                         </div>
// // // //                       </div>
// // // //                     </div>
// // // //                     <select
// // // //                       className={`px-3 py-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500 ${
// // // //                         attendance[employee.employeeId] === 'Present' ? 'bg-green-100' : 
// // // //                         attendance[employee.employeeId] === 'Absent' ? 'bg-red-100' : 
// // // //                         attendance[employee.employeeId] === 'Late' ? 'bg-yellow-100' : ''
// // // //                       }`}
// // // //                       value={attendance[employee.employeeId] || ''}
// // // //                       onChange={(e) => handleStatusChange(employee.employeeId, e.target.value)}
// // // //                     >
// // // //                       <option value="">Select Status</option>
// // // //                       <option value="Present">Present</option>
// // // //                       <option value="Absent">Absent</option>
// // // //                       <option value="Late">Late</option>
// // // //                     </select>
// // // //                   </div>
// // // //                 ))
// // // //               }
// // // //               </div>
// // // //             )}
// // // //           </div>

// // // //           {/* Pagination (for hundreds of employees) */}
// // // //           {employees.length > 50 && (
// // // //             <div className="flex justify-center mt-4">
// // // //               {/* Pagination controls would go here */}
// // // //               <p className="text-gray-500">
// // // //                 Showing {filteredEmployees.length} of {employees.length} employees
// // // //               </p>
// // // //             </div>
// // // //           )}
          
// // // //           {/* Submit Button */}
// // // //           <button
// // // //             onClick={handleSubmit}
// // // //             disabled={!Object.keys(attendance).some(id => attendance[id])}
// // // //             className={`w-full mt-4 py-2 rounded-lg text-white ${Object.keys(attendance).some(id => attendance[id]) ? 'bg-blue-500 hover:bg-blue-600' : 'bg-gray-400 cursor-not-allowed'}`}
// // // //           >
// // // //             Submit Attendance
// // // //           </button>
// // // //         </div>
// // // //       )}

// // // //       {/* Analytics Tab */}
// // // //       {activeTab === 'analytics' && (
// // // //         <div>
// // // //           {/* Summary Stats */}
// // // //           <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4 mb-6">
// // // //             <div className="bg-white border rounded-lg p-4 text-center shadow-sm">
// // // //               <h3 className="text-sm text-gray-500">Total Employees</h3>
// // // //               <div className="text-2xl font-bold text-blue-600">{attendanceAnalytics.totalEmployees}</div>
// // // //             </div>
// // // //             <div className="bg-white border rounded-lg p-4 text-center shadow-sm">
// // // //               <h3 className="text-sm text-gray-500">Present Today</h3>
// // // //               <div className="text-2xl font-bold text-green-600">{attendanceAnalytics.presentToday}</div>
// // // //             </div>
// // // //             <div className="bg-white border rounded-lg p-4 text-center shadow-sm">
// // // //               <h3 className="text-sm text-gray-500">Absent Today</h3>
// // // //               <div className="text-2xl font-bold text-red-600">{attendanceAnalytics.absentToday}</div>
// // // //             </div>
// // // //             <div className="bg-white border rounded-lg p-4 text-center shadow-sm">
// // // //               <h3 className="text-sm text-gray-500">Late Today</h3>
// // // //               <div className="text-2xl font-bold text-yellow-600">{attendanceAnalytics.lateToday}</div>
// // // //             </div>
// // // //             <div className="bg-white border rounded-lg p-4 text-center shadow-sm">
// // // //               <h3 className="text-sm text-gray-500">Unmarked</h3>
// // // //               <div className="text-2xl font-bold text-gray-600">{attendanceAnalytics.unmarkedToday}</div>
// // // //             </div>
// // // //             <div className="bg-white border rounded-lg p-4 text-center shadow-sm">
// // // //               <h3 className="text-sm text-gray-500">Attendance Rate</h3>
// // // //               <div className="text-2xl font-bold text-blue-600">{attendanceAnalytics.attendanceRate}%</div>
// // // //             </div>
// // // //           </div>
          
// // // //           {/* Department-wise analytics would go here */}
// // // //           <div className="bg-white border rounded-lg p-4 shadow-sm mb-6">
// // // //             <h3 className="font-semibold mb-2">Department-wise Attendance</h3>
// // // //             <div className="space-y-2">
// // // //               {departments.filter(dept => dept !== 'All').map(dept => {
// // // //                 const deptEmployees = employees.filter(e => e.department === dept);
// // // //                 const deptPresent = attendanceRecords.filter(r => {
// // // //                   const employee = employees.find(e => e.employeeId === r.employeeId);
// // // //                   return employee?.department === dept && 
// // // //                          r.status === 'Present' && 
// // // //                          new Date(r.timestamp).toISOString().split('T')[0] === currentDate;
// // // //                 }).length;
                
// // // //                 const percentage = deptEmployees.length > 0 
// // // //                   ? Math.round((deptPresent / deptEmployees.length) * 100) 
// // // //                   : 0;
                
// // // //                 return (
// // // //                   <div key={dept} className="flex items-center">
// // // //                     <span className="w-1/4">{dept}</span>
// // // //                     <div className="w-2/4 bg-gray-200 rounded-full h-4">
// // // //                       <div 
// // // //                         className="bg-blue-600 h-4 rounded-full" 
// // // //                         style={{ width: `${percentage}%` }}
// // // //                       ></div>
// // // //                     </div>
// // // //                     <span className="ml-2">{percentage}%</span>
// // // //                   </div>
// // // //                 );
// // // //               })}
// // // //             </div>
// // // //           </div>
// // // //         </div>
// // // //       )}

// // // //       {/* History Tab */}
// // // //       {activeTab === 'history' && (
// // // //         <div>
// // // //           {/* Date Selector */}
// // // //           <div className="mb-4">
// // // //             <input
// // // //               type="date"
// // // //               value={currentDate}
// // // //               onChange={(e) => {
// // // //                 setCurrentDate(e.target.value);
// // // //                 getAttendanceForDate(e.target.value);
// // // //               }}
// // // //               className="px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
// // // //             />
// // // //           </div>
          
// // // //           {/* Attendance Records */}
// // // //           <div className="bg-white border rounded-lg shadow-sm overflow-hidden">
// // // //             <table className="min-w-full divide-y divide-gray-200">
// // // //               <thead className="bg-gray-50">
// // // //                 <tr>
// // // //                   <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
// // // //                     Employee
// // // //                   </th>
// // // //                   <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
// // // //                     Status
// // // //                   </th>
// // // //                   <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
// // // //                     Time
// // // //                   </th>
// // // //                 </tr>
// // // //               </thead>
// // // //               <tbody className="bg-white divide-y divide-gray-200">
// // // //                 {attendanceRecords.filter(record => {
// // // //                   if (!record.timestamp || typeof record.timestamp !== 'string') return false;
// // // //                   const recordDate = new Date(record.timestamp);
// // // //                   if (isNaN(recordDate.getTime())) return false;
// // // //                   return recordDate.toISOString().split('T')[0] === currentDate;
// // // //                 }).length === 0 ? (
// // // //                   <tr>
// // // //                     <td colSpan="3" className="px-6 py-4 text-center text-gray-500">
// // // //                       No attendance records found for this date.
// // // //                     </td>
// // // //                   </tr>
// // // //                 ) : (
// // // //                   attendanceRecords
// // // //                     .filter(record => {
// // // //                       if (!record.timestamp || typeof record.timestamp !== 'string') return false;
// // // //                       const recordDate = new Date(record.timestamp);
// // // //                       if (isNaN(recordDate.getTime())) return false;
// // // //                       return recordDate.toISOString().split('T')[0] === currentDate;
// // // //                     })
// // // //                     .map((record, index) => {
// // // //                       const employee = employees.find(e => e.employeeId === record.employeeId);
// // // //                       const recordDate = new Date(record.timestamp);
// // // //                       return (
// // // //                         <tr key={index} className="hover:bg-gray-50">
// // // //                           <td className="px-6 py-4 whitespace-nowrap">
// // // //                             <div className="text-sm font-medium text-gray-900">
// // // //                               {employee?.employeeName || 'Unknown Employee'}
// // // //                             </div>
// // // //                             <div className="text-sm text-gray-500">
// // // //                               {record.employeeId}
// // // //                             </div>
// // // //                           </td>
// // // //                           <td className="px-6 py-4 whitespace-nowrap">
// // // //                             <span className={`px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${
// // // //                               record.status === 'Present' ? 'bg-green-100 text-green-800' : 
// // // //                               record.status === 'Absent' ? 'bg-red-100 text-red-800' : 
// // // //                               'bg-yellow-100 text-yellow-800'
// // // //                             }`}>
// // // //                               {record.status}
// // // //                             </span>
// // // //                           </td>
// // // //                           <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
// // // //                             {!isNaN(recordDate.getTime()) 
// // // //                               ? recordDate.toLocaleTimeString('en-US', { 
// // // //                                   hour: '2-digit', 
// // // //                                   minute: '2-digit'
// // // //                                 }) 
// // // //                               : 'Invalid time'}
// // // //                           </td>
// // // //                         </tr>
// // // //                       );
// // // //                     })
// // // //                 )}
// // // //               </tbody>
// // // //             </table>
// // // //           </div>
// // // //         </div>
// // // //       )}
// // // //     </div>
// // // //   );
// // // // };

// // // // export default EmployeeAttendanceSystem;
// // // import React, { useState, useEffect, useMemo } from 'react';
// // // import axios from 'axios';
// // // import io from 'socket.io-client';

// // // const socket = io('http://localhost:5019');

// // // const EmployeeAttendanceSystem = () => {
// // //   const [employees, setEmployees] = useState([]);
// // //   const [attendanceRecords, setAttendanceRecords] = useState([]);
// // //   const [searchQuery, setSearchQuery] = useState('');
// // //   const [attendance, setAttendance] = useState({});
// // //   const [activeTab, setActiveTab] = useState('attendance');
// // //   const [loading, setLoading] = useState(true);
// // //   const [error, setError] = useState(null);
// // //   const [page, setPage] = useState(1);
// // //   const employeesPerPage = 50;

// // //   const storeId = localStorage.getItem("storeId") || "defaultStore";

// // //   // Fetch data and set up real-time updates
// // //   useEffect(() => {
// // //     const fetchData = async () => {
// // //       setLoading(true);
// // //       setError(null);
// // //       try {
// // //         const [employeesResponse, attendanceResponse] = await Promise.all([
// // //           axios.get(`http://localhost:5004/employees?page=${page}&limit=${employeesPerPage}`, { headers: { storeId } }),
// // //           axios.get('http://localhost:5019/attendance', { headers: { storeId } })
// // //         ]);

// // //         const validEmployees = employeesResponse.data.map(employee => ({
// // //           ...employee,
// // //           employeeName: employee.name,
// // //           employeeId: employee.employeeId || employee._id
// // //         }));
// // //         setEmployees(validEmployees);
// // //         setAttendanceRecords(attendanceResponse.data);
// // //       } catch (err) {
// // //         setError(`Failed to fetch data: ${err.message}`);
// // //         console.error("Fetch Error:", err);
// // //       } finally {
// // //         setLoading(false);
// // //       }
// // //     };

// // //     fetchData();

// // //     socket.on('attendanceUpdate', (newRecords) => {
// // //       setAttendanceRecords(prev => [...prev, ...newRecords]);
// // //     });

// // //     return () => socket.off('attendanceUpdate');
// // //   }, [storeId, page]);

// // //   // Reset attendance state at midnight
// // //   useEffect(() => {
// // //     const resetAttendance = () => {
// // //       const now = new Date();
// // //       if (now.getHours() === 0 && now.getMinutes() === 0) {
// // //         setAttendance({});
// // //       }
// // //     };
// // //     const interval = setInterval(resetAttendance, 60000); // Check every minute
// // //     return () => clearInterval(interval);
// // //   }, []);

// // //   // Attendance analytics
// // //   const attendanceAnalytics = useMemo(() => {
// // //     const today = new Date().toISOString().split('T')[0];
// // //     const todayAttendance = attendanceRecords.filter(r => r.timestamp.split('T')[0] === today);

// // //     const present = todayAttendance.filter(r => r.status === 'Present').length;
// // //     const late = todayAttendance.filter(r => r.status === 'Late').length;

// // //     return {
// // //       totalEmployees: employees.length,
// // //       presentToday: present,
// // //       absentToday: employees.length - present - late,
// // //       lateToday: late
// // //     };
// // //   }, [attendanceRecords, employees]);

// // //   // Filter employees
// // //   const filteredEmployees = employees.filter(employee =>
// // //     employee.employeeName.toLowerCase().includes(searchQuery.toLowerCase()) ||
// // //     employee.employeeId.toLowerCase().includes(searchQuery.toLowerCase())
// // //   );

// // //   // Handle bulk status change
// // //   const handleBulkStatusChange = (status) => {
// // //     const newAttendance = {};
// // //     filteredEmployees.forEach(emp => {
// // //       if (!attendanceRecords.some(r => r.employeeId === emp.employeeId && r.timestamp.split('T')[0] === new Date().toISOString().split('T')[0])) {
// // //         newAttendance[emp.employeeId] = status;
// // //       }
// // //     });
// // //     setAttendance(prev => ({ ...prev, ...newAttendance }));
// // //   };

// // //   // Handle individual status change
// // //   const handleStatusChange = (employeeId, status) => {
// // //     if (!attendanceRecords.some(r => r.employeeId === employeeId && r.timestamp.split('T')[0] === new Date().toISOString().split('T')[0])) {
// // //       setAttendance(prev => ({
// // //         ...prev,
// // //         [employeeId]: status
// // //       }));
// // //     }
// // //   };

// // //   // Submit attendance
// // //   const handleSubmit = async () => {
// // //     const today = new Date().toISOString().split('T')[0];
// // //     const records = Object.keys(attendance)
// // //       .filter(employeeId => !attendanceRecords.some(r => r.employeeId === employeeId && r.timestamp.split('T')[0] === today))
// // //       .map(employeeId => ({
// // //         employeeId,
// // //         status: attendance[employeeId],
// // //         timestamp: new Date().toISOString()
// // //       }));

// // //     if (!records.length) {
// // //       alert('No new attendance to record or all selected employees already have attendance recorded today.');
// // //       return;
// // //     }

// // //     try {
// // //       const response = await axios.post('http://localhost:5019/attendance', records, { 
// // //         headers: { 
// // //           'storeId': storeId,
// // //           'Content-Type': 'application/json'
// // //         }
// // //       });
// // //       socket.emit('newAttendance', records);
// // //       setAttendance({}); // Reset after successful submission
// // //       alert('Attendance recorded successfully!');
// // //       console.log("Attendance Submission Response:", response.data);
// // //     } catch (err) {
// // //       setError(`Failed to record attendance: ${err.response?.data?.error || err.message}`);
// // //       console.error("Submission Error:", err.response?.data || err);
// // //     }
// // //   };

// // //   if (loading) return <div className="text-center py-10 text-gray-600">Loading...</div>;
// // //   if (error) return (
// // //     <div className="text-red-500 text-center py-10">
// // //       {error}
// // //       <button 
// // //         className="ml-4 px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"
// // //         onClick={() => window.location.reload()}
// // //       >
// // //         Retry
// // //       </button>
// // //     </div>
// // //   );

// // //   return (
// // //     <div className="container mx-auto p-6 max-w-4xl bg-gray-50 rounded-lg shadow-md">
// // //       <h1 className="text-3xl font-bold mb-6 text-center text-gray-800">Employee Attendance System</h1>

// // //       <div className="flex mb-6 border-b border-gray-200">
// // //         {['attendance', 'analytics', 'history'].map(tab => (
// // //           <button
// // //             key={tab}
// // //             className={`px-4 py-2 font-semibold ${activeTab === tab ? 'border-b-2 border-blue-500 text-blue-600' : 'text-gray-600 hover:text-gray-800'}`}
// // //             onClick={() => setActiveTab(tab)}
// // //           >
// // //             {tab.charAt(0).toUpperCase() + tab.slice(1)}
// // //           </button>
// // //         ))}
// // //       </div>

// // //       {activeTab === 'attendance' && (
// // //         <div>
// // //           <input
// // //             type="text"
// // //             placeholder="Search by Employee Name or ID"
// // //             className="w-full px-4 py-2 border rounded-lg mb-4 focus:outline-none focus:ring-2 focus:ring-blue-500"
// // //             value={searchQuery}
// // //             onChange={(e) => setSearchQuery(e.target.value)}
// // //           />
// // //           <div className="mb-4 flex space-x-2">
// // //             <button 
// // //               onClick={() => handleBulkStatusChange('Present')} 
// // //               className="px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600"
// // //             >
// // //               Mark All Present
// // //             </button>
// // //             <button 
// // //               onClick={() => handleBulkStatusChange('Absent')} 
// // //               className="px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600"
// // //             >
// // //               Mark All Absent
// // //             </button>
// // //             <button 
// // //               onClick={() => handleBulkStatusChange('Late')} 
// // //               className="px-4 py-2 bg-yellow-500 text-white rounded hover:bg-yellow-600"
// // //             >
// // //               Mark All Late
// // //             </button>
// // //           </div>
// // //           <div className="space-y-2 max-h-96 overflow-y-auto">
// // //             {filteredEmployees.length === 0 ? (
// // //               <p className="text-gray-500 text-center">No employees found.</p>
// // //             ) : (
// // //               filteredEmployees.map(employee => {
// // //                 const todayAttendance = attendanceRecords.find(r => r.employeeId === employee.employeeId && r.timestamp.split('T')[0] === new Date().toISOString().split('T')[0]);
// // //                 return (
// // //                   <div key={employee._id} className="flex justify-between p-3 border rounded-lg bg-white">
// // //                     <div>
// // //                       <h3 className="font-semibold text-gray-800">{employee.employeeName}</h3>
// // //                       <p className="text-sm text-gray-500">ID: {employee.employeeId}</p>
// // //                       {todayAttendance && (
// // //                         <p className="text-sm text-gray-500">Status: {todayAttendance.status}</p>
// // //                       )}
// // //                     </div>
// // //                     <select
// // //                       className="px-3 py-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
// // //                       value={attendance[employee.employeeId] || ''}
// // //                       onChange={(e) => handleStatusChange(employee.employeeId, e.target.value)}
// // //                       disabled={!!todayAttendance} // Disable if already recorded today
// // //                     >
// // //                       <option value="">Select Status</option>
// // //                       <option value="Present">Present</option>
// // //                       <option value="Absent">Absent</option>
// // //                       <option value="Late">Late</option>
// // //                     </select>
// // //                   </div>
// // //                 );
// // //               })
// // //             )}
// // //           </div>
// // //           <div className="mt-4 flex justify-between">
// // //             <button 
// // //               onClick={() => setPage(p => Math.max(1, p - 1))} 
// // //               className="px-4 py-2 bg-gray-300 rounded hover:bg-gray-400"
// // //             >
// // //               Previous
// // //             </button>
// // //             <button
// // //               onClick={handleSubmit}
// // //               className="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"
// // //             >
// // //               Submit Attendance
// // //             </button>
// // //             <button 
// // //               onClick={() => setPage(p => p + 1)} 
// // //               className="px-4 py-2 bg-gray-300 rounded hover:bg-gray-400"
// // //             >
// // //               Next
// // //             </button>
// // //           </div>
// // //         </div>
// // //       )}

// // //       {activeTab === 'analytics' && (
// // //         <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
// // //           {[
// // //             { label: 'Total Employees', value: attendanceAnalytics.totalEmployees, color: 'text-blue-600' },
// // //             { label: 'Present Today', value: attendanceAnalytics.presentToday, color: 'text-green-600' },
// // //             { label: 'Absent Today', value: attendanceAnalytics.absentToday, color: 'text-red-600' },
// // //             { label: 'Late Today', value: attendanceAnalytics.lateToday, color: 'text-yellow-600' }
// // //           ].map(({ label, value, color }) => (
// // //             <div key={label} className="bg-white border rounded-lg p-4 text-center shadow-sm">
// // //               <h3 className="text-sm text-gray-500">{label}</h3>
// // //               <div className={`text-2xl font-bold ${color}`}>{value}</div>
// // //             </div>
// // //           ))}
// // //         </div>
// // //       )}

// // //       {activeTab === 'history' && (
// // //         <div className="space-y-2 max-h-96 overflow-y-auto">
// // //           {attendanceRecords.length === 0 ? (
// // //             <p className="text-gray-500 text-center">No attendance records found.</p>
// // //           ) : (
// // //             attendanceRecords.map((record, index) => (
// // //               <div key={index} className="p-3 border rounded-lg bg-white">
// // //                 <p className="text-gray-800">{`Employee ID: ${record.employeeId} - ${record.status} (${new Date(record.timestamp).toLocaleString()})`}</p>
// // //               </div>
// // //             ))
// // //           )}
// // //         </div>
// // //       )}
// // //     </div>
// // //   );
// // // };

// // // export default EmployeeAttendanceSystem;
// // import React, { useState, useEffect, useMemo } from 'react';
// // import axios from 'axios';
// // import io from 'socket.io-client';

// // const socket = io('http://localhost:5019');

// // const EmployeeAttendanceSystem = () => {
// //   const [employees, setEmployees] = useState([]);
// //   const [attendanceRecords, setAttendanceRecords] = useState([]);
// //   const [searchQuery, setSearchQuery] = useState('');
// //   const [attendance, setAttendance] = useState({});
// //   const [activeTab, setActiveTab] = useState('attendance');
// //   const [loading, setLoading] = useState(true);
// //   const [error, setError] = useState(null);
// //   const [page, setPage] = useState(1);
// //   const employeesPerPage = 50;

// //   const storeId = localStorage.getItem("storeId") || "defaultStore";

// //   useEffect(() => {
// //     const fetchData = async () => {
// //       setLoading(true);
// //       setError(null);
// //       try {
// //         const [employeesResponse, attendanceResponse] = await Promise.all([
// //           axios.get(`http://localhost:5004/employees?page=${page}&limit=${employeesPerPage}`, { headers: { storeId } }),
// //           axios.get('http://localhost:5019/attendance', { headers: { storeId } })
// //         ]);

// //         const validEmployees = employeesResponse.data.map(employee => ({
// //           ...employee,
// //           employeeName: employee.name,
// //           employeeId: employee.employeeId || employee._id
// //         }));
// //         setEmployees(validEmployees);
// //         setAttendanceRecords(attendanceResponse.data);
// //       } catch (err) {
// //         setError(`Failed to fetch data: ${err.message}`);
// //         console.error("Fetch Error:", err);
// //       } finally {
// //         setLoading(false);
// //       }
// //     };

// //     fetchData();

// //     socket.on('attendanceUpdate', (newRecords) => {
// //       setAttendanceRecords(prev => [...prev, ...newRecords]);
// //     });

// //     return () => socket.off('attendanceUpdate');
// //   }, [storeId, page]);

// //   useEffect(() => {
// //     const resetAttendance = () => {
// //       const now = new Date();
// //       if (now.getHours() === 0 && now.getMinutes() === 0) {
// //         setAttendance({});
// //         console.log("Attendance reset at midnight");
// //       }
// //     };
// //     const interval = setInterval(resetAttendance, 60000);
// //     return () => clearInterval(interval);
// //   }, []);

// //   const attendanceAnalytics = useMemo(() => {
// //     const today = new Date().toISOString().split('T')[0];
// //     const todayAttendance = attendanceRecords.filter(r => r.timestamp.split('T')[0] === today);

// //     const present = todayAttendance.filter(r => r.status === 'Present').length;
// //     const late = todayAttendance.filter(r => r.status === 'Late').length;

// //     return {
// //       totalEmployees: employees.length,
// //       presentToday: present,
// //       absentToday: employees.length - present - late,
// //       lateToday: late
// //     };
// //   }, [attendanceRecords, employees]);

// //   const filteredEmployees = employees.filter(employee =>
// //     employee.employeeName.toLowerCase().includes(searchQuery.toLowerCase()) ||
// //     employee.employeeId.toLowerCase().includes(searchQuery.toLowerCase())
// //   );

// //   const handleBulkStatusChange = (status) => {
// //     const newAttendance = { ...attendance };
// //     filteredEmployees.forEach(emp => {
// //       const hasTodayRecord = attendanceRecords.some(r => r.employeeId === emp.employeeId && r.timestamp.split('T')[0] === new Date().toISOString().split('T')[0]);
// //       if (!hasTodayRecord) {
// //         newAttendance[emp.employeeId] = status;
// //       }
// //     });
// //     setAttendance(newAttendance);
// //     console.log("Bulk status updated:", newAttendance);
// //   };

// //   const handleStatusChange = (employeeId, status) => {
// //     const hasTodayRecord = attendanceRecords.some(r => r.employeeId === employeeId && r.timestamp.split('T')[0] === new Date().toISOString().split('T')[0]);
// //     if (!hasTodayRecord) {
// //       setAttendance(prev => {
// //         const updated = { ...prev, [employeeId]: status };
// //         console.log("Status changed for", employeeId, "to", status, "New state:", updated);
// //         return updated;
// //       });
// //     }
// //   };

// //   const handleSubmit = async () => {
// //     const today = new Date().toISOString().split('T')[0];
// //     const records = Object.keys(attendance)
// //       .filter(employeeId => !attendanceRecords.some(r => r.employeeId === employeeId && r.timestamp.split('T')[0] === today))
// //       .map(employeeId => ({
// //         employeeId,
// //         status: attendance[employeeId],
// //         timestamp: new Date().toISOString()
// //       }));

// //     if (!records.length) {
// //       alert('No new attendance to record or all selected employees already have attendance recorded today.');
// //       return;
// //     }

// //     try {
// //       const response = await axios.post('http://localhost:5019/attendance', records, { 
// //         headers: { 
// //           'storeId': storeId,
// //           'Content-Type': 'application/json'
// //         }
// //       });
// //       socket.emit('newAttendance', records);
// //       setAttendance({});
// //       alert('Attendance recorded successfully!');
// //       console.log("Attendance Submission Response:", response.data);
// //     } catch (err) {
// //       const errorMsg = err.response?.data?.error || err.message;
// //       setError(`Failed to record attendance: ${errorMsg}`);
// //       console.error("Submission Error:", err.response?.data || err);
// //     }
// //   };

// //   if (loading) return <div className="text-center py-10 text-gray-600">Loading...</div>;
// //   if (error) return (
// //     <div className="text-red-500 text-center py-10">
// //       {error}
// //       <button 
// //         className="ml-4 px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"
// //         onClick={() => window.location.reload()}
// //       >
// //         Retry
// //       </button>
// //     </div>
// //   );

// //   return (
// //     <div className="container mx-auto p-6 max-w-4xl bg-gray-50 rounded-lg shadow-md">
// //       <h1 className="text-3xl font-bold mb-6 text-center text-gray-800">Employee Attendance System</h1>

// //       <div className="flex mb-6 border-b border-gray-200">
// //         {['attendance', 'analytics', 'history'].map(tab => (
// //           <button
// //             key={tab}
// //             className={`px-4 py-2 font-semibold ${activeTab === tab ? 'border-b-2 border-blue-500 text-blue-600' : 'text-gray-600 hover:text-gray-800'}`}
// //             onClick={() => setActiveTab(tab)}
// //           >
// //             {tab.charAt(0).toUpperCase() + tab.slice(1)}
// //           </button>
// //         ))}
// //       </div>

// //       {activeTab === 'attendance' && (
// //         <div>
// //           <input
// //             type="text"
// //             placeholder="Search by Employee Name or ID"
// //             className="w-full px-4 py-2 border rounded-lg mb-4 focus:outline-none focus:ring-2 focus:ring-blue-500"
// //             value={searchQuery}
// //             onChange={(e) => setSearchQuery(e.target.value)}
// //           />
// //           <div className="mb-4 flex space-x-2">
// //             <button 
// //               onClick={() => handleBulkStatusChange('Present')} 
// //               className="px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600"
// //             >
// //               Mark All Present
// //             </button>
// //             <button 
// //               onClick={() => handleBulkStatusChange('Absent')} 
// //               className="px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600"
// //             >
// //               Mark All Absent
// //             </button>
// //             <button 
// //               onClick={() => handleBulkStatusChange('Late')} 
// //               className="px-4 py-2 bg-yellow-500 text-white rounded hover:bg-yellow-600"
// //             >
// //               Mark All Late
// //             </button>
// //           </div>
// //           <div className="space-y-2 max-h-96 overflow-y-auto">
// //             {filteredEmployees.length === 0 ? (
// //               <p className="text-gray-500 text-center">No employees found.</p>
// //             ) : (
// //               filteredEmployees.map(employee => {
// //                 const todayAttendance = attendanceRecords.find(r => r.employeeId === employee.employeeId && r.timestamp.split('T')[0] === new Date().toISOString().split('T')[0]);
// //                 return (
// //                   <div key={employee._id} className="flex justify-between p-3 border rounded-lg bg-white">
// //                     <div>
// //                       <h3 className="font-semibold text-gray-800">{employee.employeeName}</h3>
// //                       <p className="text-sm text-gray-500">ID: {employee.employeeId}</p>
// //                       {todayAttendance && (
// //                         <p className="text-sm text-gray-500">Status: {todayAttendance.status}</p>
// //                       )}
// //                     </div>
// //                     <select
// //                       className="px-3 py-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
// //                       value={attendance[employee.employeeId] || ''}
// //                       onChange={(e) => handleStatusChange(employee.employeeId, e.target.value)}
// //                       disabled={!!todayAttendance}
// //                     >
// //                       <option value="">Select Status</option>
// //                       <option value="Present">Present</option>
// //                       <option value="Absent">Absent</option>
// //                       <option value="Late">Late</option>
// //                     </select>
// //                   </div>
// //                 );
// //               })
// //             )}
// //           </div>
// //           <div className="mt-4 flex justify-between">
// //             <button 
// //               onClick={() => setPage(p => Math.max(1, p - 1))} 
// //               className="px-4 py-2 bg-gray-300 rounded hover:bg-gray-400"
// //             >
// //               Previous
// //             </button>
// //             <button
// //               onClick={handleSubmit}
// //               className="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"
// //             >
// //               Submit Attendance
// //             </button>
// //             <button 
// //               onClick={() => setPage(p => p + 1)} 
// //               className="px-4 py-2 bg-gray-300 rounded hover:bg-gray-400"
// //             >
// //               Next
// //             </button>
// //           </div>
// //         </div>
// //       )}

// //       {activeTab === 'analytics' && (
// //         <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
// //           {[
// //             { label: 'Total Employees', value: attendanceAnalytics.totalEmployees, color: 'text-blue-600' },
// //             { label: 'Present Today', value: attendanceAnalytics.presentToday, color: 'text-green-600' },
// //             { label: 'Absent Today', value: attendanceAnalytics.absentToday, color: 'text-red-600' },
// //             { label: 'Late Today', value: attendanceAnalytics.lateToday, color: 'text-yellow-600' }
// //           ].map(({ label, value, color }) => (
// //             <div key={label} className="bg-white border rounded-lg p-4 text-center shadow-sm">
// //               <h3 className="text-sm text-gray-500">{label}</h3>
// //               <div className={`text-2xl font-bold ${color}`}>{value}</div>
// //             </div>
// //           ))}
// //         </div>
// //       )}

// //       {activeTab === 'history' && (
// //         <div className="space-y-2 max-h-96 overflow-y-auto">
// //           {attendanceRecords.length === 0 ? (
// //             <p className="text-gray-500 text-center">No attendance records found.</p>
// //           ) : (
// //             attendanceRecords.map((record, index) => (
// //               <div key={index} className="p-3 border rounded-lg bg-white">
// //                 <p className="text-gray-800">{`Employee ID: ${record.employeeId} - ${record.status} (${new Date(record.timestamp).toLocaleString()})`}</p>
// //               </div>
// //             ))
// //           )}
// //         </div>
// //       )}
// //     </div>
// //   );
// // };

// // export default EmployeeAttendanceSystem;
// import React, { useState, useEffect, useMemo } from 'react';
// import axios from 'axios';

// const EmployeeAttendanceSystem = () => {
//   const [employees, setEmployees] = useState([]);
//   const [attendanceRecords, setAttendanceRecords] = useState([]);
//   const [searchQuery, setSearchQuery] = useState('');
//   const [attendance, setAttendance] = useState({});
//   const [activeTab, setActiveTab] = useState('attendance');
//   const [loading, setLoading] = useState(true);
//   const [error, setError] = useState(null);
//   const [currentDate, setCurrentDate] = useState(new Date().toISOString().split('T')[0]);
//   const [selectedDepartment, setSelectedDepartment] = useState('All');
//   const [bulkAction, setBulkAction] = useState('');
//   const [selectedEmployees, setSelectedEmployees] = useState([]);
//   const [pagination, setPagination] = useState({ page: 1, per_page: 50, total_records: 0, total_pages: 1 });

//   const storeId = localStorage.getItem("storeId") || "defaultStore";

//   // Fetch employees and attendance records
//   useEffect(() => {
//     const fetchData = async () => {
//       setLoading(true);
//       setError(null);
//       try {
//         const [employeesResponse, attendanceResponse] = await Promise.all([
//           axios.get('http://localhost:5004/employees', { headers: { storeId } }),
//           axios.get(`http://localhost:5019/attendance?date=${currentDate}`, { headers: { storeId } })
//         ]);

//         // Map backend employee data to the expected format
//         const validEmployees = employeesResponse.data
//           .filter(employee => employee && typeof employee.name === 'string')
//           .map(employee => ({
//             ...employee,
//             employeeName: employee.name,
//             employeeId: employee.employeeId || employee._id,
//             department: employee.department || 'Unassigned'
//           }));
//         setEmployees(validEmployees);

//         const validRecords = attendanceResponse.data.data.map(record => ({
//           ...record,
//           timestamp: record.timestamp || new Date().toISOString()
//         }));
//         setAttendanceRecords(validRecords);
//         setPagination(attendanceResponse.data.pagination);
        
//         // Pre-fill attendance state with today's records
//         const todayAttendance = {};
//         validRecords.forEach(record => {
//           const recordDate = new Date(record.timestamp).toISOString().split('T')[0];
//           if (recordDate === currentDate) {
//             todayAttendance[record.employeeId] = record.status;
//           }
//         });
//         setAttendance(todayAttendance);
//       } catch (err) {
//         const errorMsg = err.response?.data?.error || err.message;
//         setError(`Failed to fetch data: ${errorMsg}. Check console for details.`);
//         console.error("Fetch Error:", err.response?.data || err);
//       } finally {
//         setLoading(false);
//       }
//     };

//     fetchData();
    
//     // Set up an interval to check for date change
//     const dateCheckInterval = setInterval(() => {
//       const newDate = new Date().toISOString().split('T')[0];
//       if (newDate !== currentDate) {
//         setCurrentDate(newDate);
//         setAttendance({}); // Reset attendance for the new day
//       }
//     }, 60000); // Check every minute
    
//     return () => clearInterval(dateCheckInterval);
//   }, [storeId, currentDate]);

//   // Get unique departments
//   const departments = useMemo(() => {
//     const depts = [...new Set(employees.map(emp => emp.department || 'Unassigned'))];
//     return ['All', ...depts];
//   }, [employees]);

//   // Compute attendance analytics for today
//   const attendanceAnalytics = useMemo(() => {
//     const totalEmployees = employees.length;
    
//     const todayAttendance = attendanceRecords.filter(record => {
//       if (!record.timestamp || typeof record.timestamp !== 'string') return false;
//       const recordDate = new Date(record.timestamp);
//       if (isNaN(recordDate.getTime())) return false;
//       return recordDate.toISOString().split('T')[0] === currentDate;
//     });

//     const present = todayAttendance.filter(r => r.status === 'Present').length;
//     const late = todayAttendance.filter(r => r.status === 'Late').length;
//     const absent = todayAttendance.filter(r => r.status === 'Absent').length;
//     const unmarked = totalEmployees - present - late - absent;

//     return {
//       totalEmployees,
//       presentToday: present,
//       absentToday: absent,
//       lateToday: late,
//       unmarkedToday: unmarked,
//       attendanceRate: totalEmployees > 0 ? Math.round((present + late) / totalEmployees * 100) : 0
//     };
//   }, [attendanceRecords, employees, currentDate]);

//   // Filter employees based on search query and department
//   const filteredEmployees = useMemo(() => {
//     return employees.filter(employee => {
//       if (!employee || !employee.employeeName) return false;
      
//       const matchesSearch = 
//         employee.employeeName.toLowerCase().includes(searchQuery.toLowerCase()) ||
//         (employee.employeeId && employee.employeeId.toLowerCase().includes(searchQuery.toLowerCase()));
      
//       const matchesDepartment = 
//         selectedDepartment === 'All' || 
//         employee.department === selectedDepartment;
        
//       return matchesSearch && matchesDepartment;
//     });
//   }, [employees, searchQuery, selectedDepartment]);

//   // Handle status change for an employee
//   const handleStatusChange = (employeeId, status) => {
//     setAttendance(prev => ({
//       ...prev,
//       [employeeId]: status
//     }));
//   };

//   // Handle bulk action
//   const handleBulkAction = () => {
//     if (!bulkAction) {
//       alert('Please select a status for bulk action');
//       return;
//     }
    
//     const updatedAttendance = { ...attendance };
//     selectedEmployees.forEach(employeeId => {
//       updatedAttendance[employeeId] = bulkAction;
//     });
    
//     setAttendance(updatedAttendance);
//     setSelectedEmployees([]);
//     setBulkAction('');
//   };

//   // Toggle employee selection for bulk action
//   const toggleEmployeeSelection = (employeeId) => {
//     setSelectedEmployees(prev => {
//       if (prev.includes(employeeId)) {
//         return prev.filter(id => id !== employeeId);
//       } else {
//         return [...prev, employeeId];
//       }
//     });
//   };

//   // Select all visible employees
//   const selectAllVisible = () => {
//     setSelectedEmployees(filteredEmployees.map(emp => emp.employeeId));
//   };

//   // Deselect all employees
//   const deselectAll = () => {
//     setSelectedEmployees([]);
//   };

//   // Submit attendance records
//   const handleSubmit = async () => {
//     try {
//       const records = Object.keys(attendance)
//         .filter(employeeId => attendance[employeeId])
//         .map(employeeId => ({
//           employeeId,
//           status: attendance[employeeId],
//           timestamp: new Date().toISOString()
//         }));

//       if (!records.length) {
//         alert('Please select at least one attendance status.');
//         return;
//       }

//       await axios.post('http://localhost:5019/attendance', records, { 
//         headers: { 
//           'storeId': storeId,
//           'Content-Type': 'application/json'
//         }
//       });
      
//       // Fetch updated records after submission
//       const updatedResponse = await axios.get(`http://localhost:5019/attendance?date=${currentDate}`, { 
//         headers: { storeId } 
//       });
      
//       const updatedRecords = updatedResponse.data.data.map(record => ({
//         ...record,
//         timestamp: record.timestamp || new Date().toISOString()
//       }));
      
//       setAttendanceRecords(updatedRecords);
//       alert('Attendance recorded successfully!');
//     } catch (err) {
//       const errorMsg = err.response?.data?.error || err.message;
//       setError(`Failed to record attendance: ${errorMsg}. Check console for details.`);
//       console.error("Attendance Submission Error:", err.response?.data || err);
//     }
//   };

//   // Get attendance history for a specific date
//   const getAttendanceForDate = async (date, page = 1, perPage = 50) => {
//     try {
//       setLoading(true);
//       const response = await axios.get(`http://localhost:5019/attendance`, {
//         headers: { storeId },
//         params: { date, page, per_page: perPage }
//       });
      
//       const { data, pagination } = response.data;
//       setAttendanceRecords(data);
//       setPagination(pagination);
//       setLoading(false);
//     } catch (err) {
//       setError(`Failed to fetch attendance for ${date}: ${err.message}`);
//       setLoading(false);
//     }
//   };

//   if (loading) return (
//     <div className="flex justify-center items-center h-64">
//       <div className="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"></div>
//     </div>
//   );
  
//   if (error) return (
//     <div className="text-red-500 text-center py-10">
//       {error}
//       <button 
//         className="ml-4 px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"
//         onClick={() => window.location.reload()}
//       >
//         Retry
//       </button>
//     </div>
//   );

//   return (
//     <div className="container mx-auto p-4 max-w-6xl bg-gray-50 rounded-lg shadow-md">
//       <h1 className="text-3xl font-bold mb-6 text-center text-gray-800">Employee Attendance System</h1>
      
//       {/* Date Display */}
//       <div className="mb-4 text-center">
//         <h2 className="text-xl font-semibold">
//           {new Date(currentDate).toLocaleDateString('en-US', { 
//             weekday: 'long', 
//             year: 'numeric', 
//             month: 'long', 
//             day: 'numeric' 
//           })}
//         </h2>
//       </div>

//       {/* Tabs */}
//       <div className="flex mb-6 border-b border-gray-200">
//         {['attendance', 'analytics', 'history'].map(tab => (
//           <button
//             key={tab}
//             className={`px-4 py-2 font-semibold ${activeTab === tab ? 'border-b-2 border-blue-500 text-blue-600' : 'text-gray-600 hover:text-gray-800'}`}
//             onClick={() => setActiveTab(tab)}
//           >
//             {tab.charAt(0).toUpperCase() + tab.slice(1)}
//           </button>
//         ))}
//       </div>

//       {/* Attendance Tab */}
//       {activeTab === 'attendance' && (
//         <div>
//           {/* Search and Filter Controls */}
//           <div className="flex flex-col md:flex-row gap-4 mb-4">
//             <input
//               type="text"
//               placeholder="Search by Employee Name or ID"
//               className="flex-1 px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
//               value={searchQuery}
//               onChange={(e) => setSearchQuery(e.target.value)}
//             />
            
//             <select
//               className="px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
//               value={selectedDepartment}
//               onChange={(e) => setSelectedDepartment(e.target.value)}
//             >
//               {departments.map(dept => (
//                 <option key={dept} value={dept}>{dept}</option>
//               ))}
//             </select>
//           </div>
          
//           {/* Bulk Actions */}
//           <div className="flex flex-col md:flex-row gap-2 mb-4 items-center p-2 bg-gray-100 rounded-lg">
//             <span className="font-semibold">Bulk Actions:</span>
//             <select
//               className="px-3 py-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
//               value={bulkAction}
//               onChange={(e) => setBulkAction(e.target.value)}
//             >
//               <option value="">Select Status</option>
//               <option value="Present">Present</option>
//               <option value="Absent">Absent</option>
//               <option value="Late">Late</option>
//             </select>
//             <button
//               onClick={handleBulkAction}
//               disabled={!bulkAction || selectedEmployees.length === 0}
//               className={`px-4 py-1 rounded text-white ${bulkAction && selectedEmployees.length > 0 ? 'bg-blue-500 hover:bg-blue-600' : 'bg-gray-400 cursor-not-allowed'}`}
//             >
//               Apply to Selected ({selectedEmployees.length})
//             </button>
//             <button
//               onClick={selectAllVisible}
//               className="px-4 py-1 rounded text-white bg-gray-600 hover:bg-gray-700"
//             >
//               Select All Visible
//             </button>
//             <button
//               onClick={deselectAll}
//               className="px-4 py-1 rounded text-white bg-gray-600 hover:bg-gray-700"
//             >
//               Deselect All
//             </button>
//           </div>
          
//           {/* Employee List */}
//           <div className="space-y-1 max-h-96 overflow-y-auto">
//             {filteredEmployees.length === 0 ? (
//               <p className="text-gray-500 text-center p-4">
//                 No employees found. Please try a different search or filter.
//               </p>
//             ) : (
//               <div className="divide-y divide-gray-200">
//                 {filteredEmployees.map(employee => (
//                   <div 
//                     key={employee._id} 
//                     className={`flex justify-between p-3 ${selectedEmployees.includes(employee.employeeId) ? 'bg-blue-50' : 'bg-white'} hover:bg-gray-50 transition-colors`}
//                   >
//                     <div className="flex items-center">
//                       <input
//                         type="checkbox"
//                         checked={selectedEmployees.includes(employee.employeeId)}
//                         onChange={() => toggleEmployeeSelection(employee.employeeId)}
//                         className="mr-3 h-5 w-5 text-blue-600"
//                       />
//                       <div>
//                         <h3 className="font-semibold text-gray-800">{employee.employeeName}</h3>
//                         <div className="flex gap-2 text-sm text-gray-500">
//                           <span>ID: {employee.employeeId}</span>
//                           {employee.department && (
//                             <span className="px-2 py-0.5 bg-gray-100 rounded-full text-xs">
//                               {employee.department}
//                             </span>
//                           )}
//                         </div>
//                       </div>
//                     </div>
//                     <select
//                       className={`px-3 py-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500 ${
//                         attendance[employee.employeeId] === 'Present' ? 'bg-green-100' : 
//                         attendance[employee.employeeId] === 'Absent' ? 'bg-red-100' : 
//                         attendance[employee.employeeId] === 'Late' ? 'bg-yellow-100' : ''
//                       }`}
//                       value={attendance[employee.employeeId] || ''}
//                       onChange={(e) => handleStatusChange(employee.employeeId, e.target.value)}
//                     >
//                       <option value="">Select Status</option>
//                       <option value="Present">Present</option>
//                       <option value="Absent">Absent</option>
//                       <option value="Late">Late</option>
//                     </select>
//                   </div>
//                 ))
//               }
//               </div>
//             )}
//           </div>

//           {/* Pagination (for hundreds of employees) */}
//           {employees.length > 50 && (
//             <div className="flex justify-center mt-4">
//               {/* Pagination controls would go here */}
//               <p className="text-gray-500">
//                 Showing {filteredEmployees.length} of {employees.length} employees
//               </p>
//             </div>
//           )}
          
//           {/* Submit Button */}
//           <button
//             onClick={handleSubmit}
//             disabled={!Object.keys(attendance).some(id => attendance[id])}
//             className={`w-full mt-4 py-2 rounded-lg text-white ${Object.keys(attendance).some(id => attendance[id]) ? 'bg-blue-500 hover:bg-blue-600' : 'bg-gray-400 cursor-not-allowed'}`}
//           >
//             Submit Attendance
//           </button>
//         </div>
//       )}

//       {/* Analytics Tab */}
//       {activeTab === 'analytics' && (
//         <div>
//           {/* Summary Stats */}
//           <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4 mb-6">
//             <div className="bg-white border rounded-lg p-4 text-center shadow-sm">
//               <h3 className="text-sm text-gray-500">Total Employees</h3>
//               <div className="text-2xl font-bold text-blue-600">{attendanceAnalytics.totalEmployees}</div>
//             </div>
//             <div className="bg-white border rounded-lg p-4 text-center shadow-sm">
//               <h3 className="text-sm text-gray-500">Present Today</h3>
//               <div className="text-2xl font-bold text-green-600">{attendanceAnalytics.presentToday}</div>
//             </div>
//             <div className="bg-white border rounded-lg p-4 text-center shadow-sm">
//               <h3 className="text-sm text-gray-500">Absent Today</h3>
//               <div className="text-2xl font-bold text-red-600">{attendanceAnalytics.absentToday}</div>
//             </div>
//             <div className="bg-white border rounded-lg p-4 text-center shadow-sm">
//               <h3 className="text-sm text-gray-500">Late Today</h3>
//               <div className="text-2xl font-bold text-yellow-600">{attendanceAnalytics.lateToday}</div>
//             </div>
//             <div className="bg-white border rounded-lg p-4 text-center shadow-sm">
//               <h3 className="text-sm text-gray-500">Unmarked</h3>
//               <div className="text-2xl font-bold text-gray-600">{attendanceAnalytics.unmarkedToday}</div>
//             </div>
//             <div className="bg-white border rounded-lg p-4 text-center shadow-sm">
//               <h3 className="text-sm text-gray-500">Attendance Rate</h3>
//               <div className="text-2xl font-bold text-blue-600">{attendanceAnalytics.attendanceRate}%</div>
//             </div>
//           </div>
          
//           {/* Department-wise analytics would go here */}
//           <div className="bg-white border rounded-lg p-4 shadow-sm mb-6">
//             <h3 className="font-semibold mb-2">Department-wise Attendance</h3>
//             <div className="space-y-2">
//               {departments.filter(dept => dept !== 'All').map(dept => {
//                 const deptEmployees = employees.filter(e => e.department === dept);
//                 const deptPresent = attendanceRecords.filter(r => {
//                   const employee = employees.find(e => e.employeeId === r.employeeId);
//                   return employee?.department === dept && 
//                          r.status === 'Present' && 
//                          new Date(r.timestamp).toISOString().split('T')[0] === currentDate;
//                 }).length;
                
//                 const percentage = deptEmployees.length > 0 
//                   ? Math.round((deptPresent / deptEmployees.length) * 100) 
//                   : 0;
                
//                 return (
//                   <div key={dept} className="flex items-center">
//                     <span className="w-1/4">{dept}</span>
//                     <div className="w-2/4 bg-gray-200 rounded-full h-4">
//                       <div 
//                         className="bg-blue-600 h-4 rounded-full" 
//                         style={{ width: `${percentage}%` }}
//                       ></div>
//                     </div>
//                     <span className="ml-2">{percentage}%</span>
//                   </div>
//                 );
//               })}
//             </div>
//           </div>
//         </div>
//       )}

//       {/* History Tab */}
//       {activeTab === 'history' && (
//         <div>
//           {/* Date Selector */}
//           <div className="mb-4">
//             <input
//               type="date"
//               value={currentDate}
//               onChange={(e) => {
//                 setCurrentDate(e.target.value);
//                 getAttendanceForDate(e.target.value);
//               }}
//               className="px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
//             />
//           </div>
          
//           {/* Attendance Records */}
//           <div className="bg-white border rounded-lg shadow-sm overflow-hidden">
//             <table className="min-w-full divide-y divide-gray-200">
//               <thead className="bg-gray-50">
//                 <tr>
//                   <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
//                     Employee
//                   </th>
//                   <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
//                     Status
//                   </th>
//                   <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
//                     Time
//                   </th>
//                 </tr>
//               </thead>
//               <tbody className="bg-white divide-y divide-gray-200">
//                 {attendanceRecords.filter(record => {
//                   if (!record.timestamp || typeof record.timestamp !== 'string') return false;
//                   const recordDate = new Date(record.timestamp);
//                   if (isNaN(recordDate.getTime())) return false;
//                   return recordDate.toISOString().split('T')[0] === currentDate;
//                 }).length === 0 ? (
//                   <tr>
//                     <td colSpan="3" className="px-6 py-4 text-center text-gray-500">
//                       No attendance records found for this date.
//                     </td>
//                   </tr>
//                 ) : (
//                   attendanceRecords
//                     .filter(record => {
//                       if (!record.timestamp || typeof record.timestamp !== 'string') return false;
//                       const recordDate = new Date(record.timestamp);
//                       if (isNaN(recordDate.getTime())) return false;
//                       return recordDate.toISOString().split('T')[0] === currentDate;
//                     })
//                     .map((record, index) => {
//                       const employee = employees.find(e => e.employeeId === record.employeeId);
//                       const recordDate = new Date(record.timestamp);
//                       return (
//                         <tr key={index} className="hover:bg-gray-50">
//                           <td className="px-6 py-4 whitespace-nowrap">
//                             <div className="text-sm font-medium text-gray-900">
//                               {employee?.employeeName || 'Unknown Employee'}
//                             </div>
//                             <div className="text-sm text-gray-500">
//                               {record.employeeId}
//                             </div>
//                           </td>
//                           <td className="px-6 py-4 whitespace-nowrap">
//                             <span className={`px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${
//                               record.status === 'Present' ? 'bg-green-100 text-green-800' : 
//                               record.status === 'Absent' ? 'bg-red-100 text-red-800' : 
//                               'bg-yellow-100 text-yellow-800'
//                             }`}>
//                               {record.status}
//                             </span>
//                           </td>
//                           <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
//                             {!isNaN(recordDate.getTime()) 
//                               ? recordDate.toLocaleTimeString('en-US', { 
//                                   hour: '2-digit', 
//                                   minute: '2-digit'
//                                 }) 
//                               : 'Invalid time'}
//                           </td>
//                         </tr>
//                       );
//                     })
//                 )}
//               </tbody>
//             </table>
//           </div>
//         </div>
//       )}
//     </div>
//   );
// };

// export default EmployeeAttendanceSystem;
import React, { useState, useEffect, useMemo, useCallback } from 'react';
import axios from 'axios';

const EmployeeAttendanceSystem = () => {
  // State management
  const [employees, setEmployees] = useState([]);
  const [attendanceRecords, setAttendanceRecords] = useState([]);
  const [searchQuery, setSearchQuery] = useState('');
  const [attendance, setAttendance] = useState({});
  const [activeTab, setActiveTab] = useState('attendance');
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);
  const [currentDate, setCurrentDate] = useState(new Date().toISOString().split('T')[0]);
  const [selectedDepartment, setSelectedDepartment] = useState('All');
  const [bulkAction, setBulkAction] = useState('');
  const [selectedEmployees, setSelectedEmployees] = useState([]);
  const [pagination, setPagination] = useState({ page: 1, per_page: 50, total_records: 0, total_pages: 1 });
  const [notification, setNotification] = useState({ show: false, message: '', type: '' });
  const [isSaving, setIsSaving] = useState(false);
  const [viewMode, setViewMode] = useState('card'); // 'card' or 'list'
  const [dateRange, setDateRange] = useState({ start: currentDate, end: currentDate });
  const [refreshInterval, setRefreshInterval] = useState(60); // seconds

  const storeId = localStorage.getItem("storeId") || "defaultStore";

  // API endpoints with environment variables for better deployment flexibility
  const API_BASE = process.env.REACT_APP_API_BASE || 'http://localhost';
  const EMPLOYEES_ENDPOINT = `${API_BASE}:5004/employees`;
  const ATTENDANCE_ENDPOINT = `${API_BASE}:5019/attendance`;

  // Show notification function
  const showNotification = useCallback((message, type = 'success') => {
    setNotification({ show: true, message, type });
    setTimeout(() => setNotification({ show: false, message: '', type: '' }), 5000);
  }, []);

  // Fetch employees and attendance records
  const fetchData = useCallback(async () => {
    setLoading(true);
    setError(null);
    try {
      const [employeesResponse, attendanceResponse] = await Promise.all([
        axios.get(EMPLOYEES_ENDPOINT, { 
          headers: { storeId },
          timeout: 10000 // 10 seconds timeout
        }),
        axios.get(ATTENDANCE_ENDPOINT, { 
          headers: { storeId },
          params: { date: currentDate },
          timeout: 10000
        })
      ]);

      // Map backend employee data to the expected format with validation
      const validEmployees = (employeesResponse.data || [])
        .filter(employee => employee && typeof employee.name === 'string')
        .map(employee => ({
          ...employee,
          employeeName: employee.name,
          employeeId: employee.employeeId || employee._id,
          department: employee.department || 'Unassigned',
          position: employee.position || 'Staff',
          avatar: employee.avatar || `https://ui-avatars.com/api/?name=${encodeURIComponent(employee.name)}&background=random`
        }));
      setEmployees(validEmployees);

      const { data, pagination } = attendanceResponse.data;
      const validRecords = (data || []).map(record => ({
        ...record,
        timestamp: record.timestamp || new Date().toISOString()
      }));
      setAttendanceRecords(validRecords);
      setPagination(pagination || { page: 1, per_page: 50, total_records: validRecords.length, total_pages: 1 });
      
      // Pre-fill attendance state with today's records
      const todayAttendance = {};
      validRecords.forEach(record => {
        const recordDate = new Date(record.timestamp).toISOString().split('T')[0];
        if (recordDate === currentDate) {
          todayAttendance[record.employeeId] = record.status;
        }
      });
      setAttendance(todayAttendance);
      
      return true;
    } catch (err) {
      const errorMsg = err.response?.data?.error || err.message;
      setError(`Failed to fetch data: ${errorMsg}. Check console for details.`);
      console.error("Fetch Error:", err.response?.data || err);
      return false;
    } finally {
      setLoading(false);
    }
  }, [EMPLOYEES_ENDPOINT, ATTENDANCE_ENDPOINT, storeId, currentDate]);

  // Initial data load and periodic refresh
  useEffect(() => {
    fetchData();
    
    // Set up an interval to refresh data periodically
    const dataRefreshInterval = setInterval(() => {
      if (refreshInterval > 0) fetchData();
    }, refreshInterval * 1000);
    
    // Set up a separate interval to check for date change
    const dateCheckInterval = setInterval(() => {
      const newDate = new Date().toISOString().split('T')[0];
      if (newDate !== currentDate) {
        setCurrentDate(newDate);
        setDateRange(prev => ({ ...prev, start: newDate, end: newDate }));
        setAttendance({}); // Reset attendance for the new day
        showNotification('Date has changed. Attendance reset for new day.', 'info');
      }
    }, 60000); // Check every minute
    
    return () => {
      clearInterval(dataRefreshInterval);
      clearInterval(dateCheckInterval);
    };
  }, [fetchData, refreshInterval, currentDate, showNotification]);

  // Get unique departments
  const departments = useMemo(() => {
    const depts = [...new Set(employees.map(emp => emp.department || 'Unassigned'))];
    return ['All', ...depts.sort()];
  }, [employees]);

  // Compute attendance analytics
  const attendanceAnalytics = useMemo(() => {
    const totalEmployees = employees.length;
    
    const todayAttendance = attendanceRecords.filter(record => {
      if (!record.timestamp || typeof record.timestamp !== 'string') return false;
      const recordDate = new Date(record.timestamp);
      if (isNaN(recordDate.getTime())) return false;
      return recordDate.toISOString().split('T')[0] === currentDate;
    });

    const present = todayAttendance.filter(r => r.status === 'Present').length;
    const late = todayAttendance.filter(r => r.status === 'Late').length;
    const absent = todayAttendance.filter(r => r.status === 'Absent').length;
    const onLeave = todayAttendance.filter(r => r.status === 'On Leave').length;
    const workFromHome = todayAttendance.filter(r => r.status === 'WFH').length;
    const unmarked = totalEmployees - present - late - absent - onLeave - workFromHome;

    // Department-wise attendance
    const deptStats = {};
    departments.forEach(dept => {
      if (dept === 'All') return;
      
      const deptEmployees = employees.filter(e => e.department === dept);
      const deptPresent = todayAttendance.filter(r => {
        const employee = employees.find(e => e.employeeId === r.employeeId);
        return employee?.department === dept && 
               (r.status === 'Present' || r.status === 'Late' || r.status === 'WFH') && 
               new Date(r.timestamp).toISOString().split('T')[0] === currentDate;
      }).length;
      
      deptStats[dept] = {
        total: deptEmployees.length,
        present: deptPresent,
        percentage: deptEmployees.length > 0 
          ? Math.round((deptPresent / deptEmployees.length) * 100) 
          : 0
      };
    });

    return {
      totalEmployees,
      presentToday: present,
      absentToday: absent,
      lateToday: late,
      onLeaveToday: onLeave,
      workFromHomeToday: workFromHome,
      unmarkedToday: unmarked,
      attendanceRate: totalEmployees > 0 ? Math.round((present + late + workFromHome) / totalEmployees * 100) : 0,
      departmentStats: deptStats,
    };
  }, [attendanceRecords, employees, currentDate, departments]);

  // Filter employees based on search query and department
  const filteredEmployees = useMemo(() => {
    return employees.filter(employee => {
      if (!employee || !employee.employeeName) return false;
      
      const matchesSearch = 
        employee.employeeName.toLowerCase().includes(searchQuery.toLowerCase()) ||
        (employee.employeeId && employee.employeeId.toLowerCase().includes(searchQuery.toLowerCase())) ||
        (employee.position && employee.position.toLowerCase().includes(searchQuery.toLowerCase()));
      
      const matchesDepartment = 
        selectedDepartment === 'All' || 
        employee.department === selectedDepartment;
        
      return matchesSearch && matchesDepartment;
    }).sort((a, b) => a.employeeName.localeCompare(b.employeeName));
  }, [employees, searchQuery, selectedDepartment]);

  // Handle status change for an employee
  const handleStatusChange = (employeeId, status) => {
    setAttendance(prev => ({
      ...prev,
      [employeeId]: status
    }));
  };

  // Handle bulk action
  const handleBulkAction = () => {
    if (!bulkAction) {
      showNotification('Please select a status for bulk action', 'error');
      return;
    }
    
    const updatedAttendance = { ...attendance };
    selectedEmployees.forEach(employeeId => {
      updatedAttendance[employeeId] = bulkAction;
    });
    
    setAttendance(updatedAttendance);
    showNotification(`Applied ${bulkAction} status to ${selectedEmployees.length} employees`, 'success');
    setSelectedEmployees([]);
    setBulkAction('');
  };

  // Toggle employee selection for bulk action
  const toggleEmployeeSelection = (employeeId) => {
    setSelectedEmployees(prev => {
      if (prev.includes(employeeId)) {
        return prev.filter(id => id !== employeeId);
      } else {
        return [...prev, employeeId];
      }
    });
  };

  // Select all visible employees
  const selectAllVisible = () => {
    setSelectedEmployees(filteredEmployees.map(emp => emp.employeeId));
    showNotification(`Selected all ${filteredEmployees.length} visible employees`, 'info');
  };

  // Deselect all employees
  const deselectAll = () => {
    setSelectedEmployees([]);
    showNotification('Cleared all selections', 'info');
  };

  // Submit attendance records
  const handleSubmit = async () => {
    try {
      setIsSaving(true);
      const records = Object.keys(attendance)
        .filter(employeeId => attendance[employeeId])
        .map(employeeId => ({
          employeeId,
          status: attendance[employeeId],
          timestamp: new Date().toISOString(),
          notes: "",
          location: "Office" // Default location
        }));

      if (!records.length) {
        showNotification('Please select at least one attendance status.', 'error');
        setIsSaving(false);
        return;
      }

      await axios.post(ATTENDANCE_ENDPOINT, records, { 
        headers: { 
          'storeId': storeId,
          'Content-Type': 'application/json'
        },
        timeout: 15000 // 15 seconds timeout
      });
      
      // Fetch updated records after submission
      await fetchData();
      showNotification('Attendance recorded successfully!', 'success');
    } catch (err) {
      const errorMsg = err.response?.data?.error || err.message;
      setError(`Failed to record attendance: ${errorMsg}.`);
      showNotification(`Failed to save: ${errorMsg}`, 'error');
      console.error("Attendance Submission Error:", err.response?.data || err);
    } finally {
      setIsSaving(false);
    }
  };

  // Get attendance history for a specific date range
  const getAttendanceHistory = async () => {
    try {
      setLoading(true);
      const response = await axios.get(ATTENDANCE_ENDPOINT, {
        headers: { storeId },
        params: { 
          start_date: dateRange.start,
          end_date: dateRange.end,
          page: pagination.page,
          per_page: pagination.per_page
        }
      });
      
      const { data, pagination: newPagination } = response.data;
      setAttendanceRecords(data || []);
      setPagination(newPagination || pagination);
      setLoading(false);
      showNotification('History data loaded successfully', 'success');
    } catch (err) {
      setError(`Failed to fetch attendance history: ${err.message}`);
      showNotification('Failed to load history data', 'error');
      setLoading(false);
    }
  };

  // Change page in pagination
  const handlePageChange = (newPage) => {
    setPagination(prev => ({ ...prev, page: newPage }));
    if (activeTab === 'history') {
      getAttendanceHistory();
    }
  };

  // Handle date range change
  const handleDateRangeChange = (field, value) => {
    setDateRange(prev => ({ ...prev, [field]: value }));
  };

  // Get status label for UI display
  const getStatusLabel = (status) => {
    switch(status) {
      case 'Present': return (
        <span className="px-2 py-1 bg-green-100 text-green-800 rounded-full text-xs font-medium">
          Present
        </span>
      );
      case 'Absent': return (
        <span className="px-2 py-1 bg-red-100 text-red-800 rounded-full text-xs font-medium">
          Absent
        </span>
      );
      case 'Late': return (
        <span className="px-2 py-1 bg-yellow-100 text-yellow-800 rounded-full text-xs font-medium">
          Late
        </span>
      );
      case 'On Leave': return (
        <span className="px-2 py-1 bg-purple-100 text-purple-800 rounded-full text-xs font-medium">
          On Leave
        </span>
      );
      case 'WFH': return (
        <span className="px-2 py-1 bg-blue-100 text-blue-800 rounded-full text-xs font-medium">
          WFH
        </span>
      );
      default: return (
        <span className="px-2 py-1 bg-gray-100 text-gray-800 rounded-full text-xs font-medium">
          Not Set
        </span>
      );
    }
  };

  // Loading indicator
  if (loading && !attendanceRecords.length) return (
    <div className="flex flex-col justify-center items-center h-64">
      <div className="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-600"></div>
      <p className="text-gray-600 mt-4">Loading attendance data...</p>
    </div>
  );
  
  // Error display
  if (error && !attendanceRecords.length) return (
    <div className="bg-red-50 border-l-4 border-red-500 p-6 rounded-lg shadow-md">
      <div className="flex items-center">
        <div className="flex-shrink-0">
          <svg className="h-6 w-6 text-red-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
          </svg>
        </div>
        <div className="ml-3">
          <h3 className="text-red-800 font-medium">Error</h3>
          <p className="text-red-700 mt-1">{error}</p>
          <button 
            className="mt-3 px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 transition-colors"
            onClick={() => fetchData()}
          >
            Retry
          </button>
        </div>
      </div>
    </div>
  );

  return (
    <div className="min-h-screen bg-gray-100">
      {/* Notification Toast */}
      {notification.show && (
        <div className={`fixed top-4 right-4 z-50 px-6 py-3 rounded-lg shadow-lg ${
          notification.type === 'success' ? 'bg-green-600 text-white' : 
          notification.type === 'error' ? 'bg-red-600 text-white' : 
          'bg-blue-600 text-white'
        } transition-opacity duration-300`}>
          <div className="flex items-center space-x-2">
            {notification.type === 'success' && (
              <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M5 13l4 4L19 7"></path>
              </svg>
            )}
            {notification.type === 'error' && (
              <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 18L18 6M6 6l12 12"></path>
              </svg>
            )}
            {notification.type === 'info' && (
              <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
            )}
            <span>{notification.message}</span>
          </div>
        </div>
      )}

      {/* Header */}
      <header className="bg-white shadow-sm">
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
          <div className="flex justify-between items-center">
            <h1 className="text-2xl font-bold text-gray-900">Employee Attendance System</h1>
            <div className="flex items-center space-x-4">
              <div className="text-sm text-gray-600">
                Auto-refresh: 
                <select 
                  value={refreshInterval}
                  onChange={(e) => setRefreshInterval(parseInt(e.target.value))}
                  className="ml-2 border-gray-300 rounded-md shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50"
                >
                  <option value="30">30s</option>
                  <option value="60">1m</option>
                  <option value="300">5m</option>
                  <option value="600">10m</option>
                  <option value="0">Off</option>
                </select>
              </div>
              <button 
                onClick={() => fetchData()}
                className="p-2 text-gray-600 hover:text-blue-600 transition-colors"
                title="Refresh Data"
              >
                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                </svg>
              </button>
            </div>
          </div>
          
          {/* Date Display */}
          <div className="mt-2 text-gray-600">
            {new Date(currentDate).toLocaleDateString('en-US', { 
              weekday: 'long', 
              year: 'numeric', 
              month: 'long', 
              day: 'numeric' 
            })}
          </div>
        </div>
      </header>

      <main className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
        {/* Tabs */}
        <div className="flex border-b border-gray-200 mb-6">
          {['attendance', 'analytics', 'history'].map(tab => (
            <button
              key={tab}
              className={`px-6 py-3 font-medium text-sm ${
                activeTab === tab 
                  ? 'border-b-2 border-blue-600 text-blue-600' 
                  : 'text-gray-500 hover:text-gray-700 hover:border-gray-300 hover:border-b'
              }`}
              onClick={() => setActiveTab(tab)}
            >
              {tab.charAt(0).toUpperCase() + tab.slice(1)}
            </button>
          ))}
        </div>

        {/* Quick Stats */}
        {(activeTab === 'attendance' || activeTab === 'analytics') && (
          <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4 mb-6">
            <div className="bg-white border rounded-lg p-4 text-center shadow-sm">
              <h3 className="text-sm text-gray-500">Total Employees</h3>
              <div className="text-2xl font-bold text-gray-800">{attendanceAnalytics.totalEmployees}</div>
            </div>
            <div className="bg-white border rounded-lg p-4 text-center shadow-sm">
              <h3 className="text-sm text-gray-500">Present Today</h3>
              <div className="text-2xl font-bold text-green-600">{attendanceAnalytics.presentToday}</div>
            </div>
            <div className="bg-white border rounded-lg p-4 text-center shadow-sm">
              <h3 className="text-sm text-gray-500">Absent Today</h3>
              <div className="text-2xl font-bold text-red-600">{attendanceAnalytics.absentToday}</div>
            </div>
            <div className="bg-white border rounded-lg p-4 text-center shadow-sm">
              <h3 className="text-sm text-gray-500">Late Today</h3>
              <div className="text-2xl font-bold text-yellow-600">{attendanceAnalytics.lateToday}</div>
            </div>
            <div className="bg-white border rounded-lg p-4 text-center shadow-sm">
              <h3 className="text-sm text-gray-500">WFH / On Leave</h3>
              <div className="text-2xl font-bold text-blue-600">
                {attendanceAnalytics.workFromHomeToday + attendanceAnalytics.onLeaveToday}
              </div>
            </div>
            <div className="bg-white border rounded-lg p-4 text-center shadow-sm">
              <h3 className="text-sm text-gray-500">Attendance Rate</h3>
              <div className="text-2xl font-bold text-blue-600">{attendanceAnalytics.attendanceRate}%</div>
            </div>
          </div>
        )}

        {/* Attendance Tab */}
        {activeTab === 'attendance' && (
          <div className="bg-white rounded-lg shadow-sm p-6">
            {/* Search and Filter Controls */}
            <div className="flex flex-col md:flex-row gap-4 mb-6">
              <div className="flex-1 relative">
                <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                  <svg className="h-5 w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                    <path fillRule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clipRule="evenodd" />
                  </svg>
                </div>
                <input
                  type="text"
                  placeholder="Search employees by name, ID, or position"
                  className="pl-10 pr-4 py-2 border border-gray-300 rounded-lg w-full focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                  value={searchQuery}
                  onChange={(e) => setSearchQuery(e.target.value)}
                />
              </div>
              
              <select
                className="px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                value={selectedDepartment}
                onChange={(e) => setSelectedDepartment(e.target.value)}
              >
                {departments.map(dept => (
                  <option key={dept} value={dept}>{dept}</option>
                ))}
              </select>
              
              <div className="flex">
                <button
                  onClick={() => setViewMode('card')}
                  className={`px-3 py-2 rounded-l-lg border ${
                    viewMode === 'card' 
                      ? 'bg-blue-50 text-blue-600 border-blue-500' 
                      : 'bg-white text-gray-500 border-gray-300 hover:bg-gray-50'
                  }`}
                  title="Card View"
                >
                  <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zm10 0a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zm10 0a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"></path>
                  </svg>
                </button>
                <button
                  onClick={() => setViewMode('list')}
                  className={`px-3 py-2 rounded-r-lg border ${
                    viewMode === 'list' 
                      ? 'bg-blue-50 text-blue-600 border-blue-500' 
                      : 'bg-white text-gray-500 border-gray-300 hover:bg-gray-50'
                  }`}
                  title="List View"
                >
                  <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M4 6h16M4 10h16M4 14h16M4 18h16"></path>
                  </svg>
                </button>
              </div>
            </div>
            
            {/* Bulk Actions */}
            <div className="flex flex-wrap gap-4 mb-6 items-center p-4 bg-gray-50 rounded-lg border border-gray-200">
              <span className="font-medium text-gray-700">Bulk Actions:</span>
              <select
                className="px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                value={bulkAction}
                onChange={(e) => setBulkAction(e.target.value)}
              >
                <option value="">Select Status</option>
                <option value="Present">Present</option>
                <option value="Absent">Absent</option>
                <option value="Late">Late</option>
                <option value="On Leave">On Leave</option>
                <option value="WFH">Work From Home</option>
              </select>
              <button
                onClick={handleBulkAction}
                disabled={!bulkAction || selectedEmployees.length === 0}
                className={`px-4 py-2 rounded-md text-white ${
                  bulkAction && selectedEmployees.length > 0 
                    ? 'bg-blue-600 hover:bg-blue-700' 
                    : 'bg-gray-400 cursor-not-allowed'
                } transition-colors`}
              >
                Apply to Selected ({selectedEmployees.length})
              </button>
              <button
                onClick={selectAllVisible}
                className="px-4 py-2 rounded-md text-white bg-gray-600 hover:bg-gray-700 transition-colors"
              >
                Select All
              </button>
              <button
                onClick={deselectAll}
                className="px-4 py-2 rounded-md text-white bg-gray-600 hover:bg-gray-700 transition-colors"
              >
                Deselect All
              </button>
            </div>
            
            {/* Employee List */}
            {viewMode === 'card' ? (
              <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 max-h-[60vh] overflow-y-auto">
                {filteredEmployees.map(employee => (
                  <div 
                    key={employee.employeeId}
                    className={`border rounded-lg p-4 ${
                      selectedEmployees.includes(employee.employeeId) ? 'bg-blue-50 border-blue-200' : 'bg-white'
                    } hover:shadow-md transition-all`}
                  >
                    <div className="flex items-center space-x-4">
                      <input
                        type="checkbox"
                        checked={selectedEmployees.includes(employee.employeeId)}
                        onChange={() => toggleEmployeeSelection(employee.employeeId)}
                        className="h-5 w-5 text-blue-600 rounded border-gray-300 focus:ring-blue-500"
                      />
                      <img 
                        src={employee.avatar} 
                        alt={employee.employeeName} 
                        className="w-12 h-12 rounded-full object-cover"
                      />
                      <div className="flex-1">
                        <h3 className="font-semibold text-gray-900">{employee.employeeName}</h3>
                        <p className="text-sm text-gray-600">ID: {employee.employeeId}</p>
                        <p className="text-sm text-gray-500">{employee.department} • {employee.position}</p>
                      </div>
                    </div>
                    <select
                      className="mt-3 w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                      value={attendance[employee.employeeId] || ''}
                      onChange={(e) => handleStatusChange(employee.employeeId, e.target.value)}
                    >
                      <option value="">Select Status</option>
                      <option value="Present">Present</option>
                      <option value="Absent">Absent</option>
                      <option value="Late">Late</option>
                      <option value="On Leave">On Leave</option>
                      <option value="WFH">Work From Home</option>
                    </select>
                  </div>
                ))}
              </div>
            ) : (
              <div className="overflow-x-auto">
                <table className="min-w-full divide-y divide-gray-200">
                  <thead className="bg-gray-50">
                    <tr>
                      <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                        <input
                          type="checkbox"
                          checked={selectedEmployees.length === filteredEmployees.length && filteredEmployees.length > 0}
                          onChange={(e) => e.target.checked ? selectAllVisible() : deselectAll()}
                          className="h-4 w-4 text-blue-600 rounded border-gray-300 focus:ring-blue-500"
                        />
                      </th>
                      <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Employee</th>
                      <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Department</th>
                      <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                    </tr>
                  </thead>
                  <tbody className="bg-white divide-y divide-gray-200">
                    {filteredEmployees.map(employee => (
                      <tr 
                        key={employee.employeeId}
                        className={`${selectedEmployees.includes(employee.employeeId) ? 'bg-blue-50' : ''} hover:bg-gray-50`}
                      >
                        <td className="px-6 py-4 whitespace-nowrap">
                          <input
                            type="checkbox"
                            checked={selectedEmployees.includes(employee.employeeId)}
                            onChange={() => toggleEmployeeSelection(employee.employeeId)}
                            className="h-4 w-4 text-blue-600 rounded border-gray-300 focus:ring-blue-500"
                          />
                        </td>
                        <td className="px-6 py-4 whitespace-nowrap">
                          <div className="flex items-center">
                            <img 
                              src={employee.avatar} 
                              alt={employee.employeeName} 
                              className="w-10 h-10 rounded-full mr-3"
                            />
                            <div>
                              <div className="text-sm font-medium text-gray-900">{employee.employeeName}</div>
                              <div className="text-sm text-gray-500">{employee.employeeId}</div>
                            </div>
                          </div>
                        </td>
                        <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{employee.department}</td>
                        <td className="px-6 py-4 whitespace-nowrap">
                          <select
                            className="px-3 py-1 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                            value={attendance[employee.employeeId] || ''}
                            onChange={(e) => handleStatusChange(employee.employeeId, e.target.value)}
                          >
                            <option value="">Select Status</option>
                            <option value="Present">Present</option>
                            <option value="Absent">Absent</option>
                            <option value="Late">Late</option>
                            <option value="On Leave">On Leave</option>
                            <option value="WFH">Work From Home</option>
                          </select>
                        </td>
                      </tr>
                    ))}
                  </tbody>
                </table>
              </div>
            )}

            {/* Pagination */}
            {filteredEmployees.length > pagination.per_page && (
              <div className="mt-6 flex justify-between items-center">
                <p className="text-sm text-gray-600">
                  Showing {(pagination.page - 1) * pagination.per_page + 1} to {Math.min(pagination.page * pagination.per_page, filteredEmployees.length)} of {filteredEmployees.length} employees
                </p>
                <div className="flex space-x-2">
                  <button
                    onClick={() => handlePageChange(pagination.page - 1)}
                    disabled={pagination.page === 1}
                    className="px-3 py-1 border border-gray-300 rounded-md text-sm disabled:opacity-50 hover:bg-gray-100"
                  >
                    Previous
                  </button>
                  <button
                    onClick={() => handlePageChange(pagination.page + 1)}
                    disabled={pagination.page >= pagination.total_pages}
                    className="px-3 py-1 border border-gray-300 rounded-md text-sm disabled:opacity-50 hover:bg-gray-100"
                  >
                    Next
                  </button>
                </div>
              </div>
            )}

            {/* Submit Button */}
            <button
              onClick={handleSubmit}
              disabled={isSaving || !Object.keys(attendance).some(id => attendance[id])}
              className={`w-full mt-6 py-3 rounded-lg text-white font-medium ${
                isSaving || !Object.keys(attendance).some(id => attendance[id])
                  ? 'bg-gray-400 cursor-not-allowed'
                  : 'bg-blue-600 hover:bg-blue-700'
              } transition-colors flex items-center justify-center`}
            >
              {isSaving ? (
                <>
                  <svg className="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                    <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                  </svg>
                  Saving...
                </>
              ) : (
                'Submit Attendance'
              )}
            </button>
          </div>
        )}

        {/* Analytics Tab */}
        {activeTab === 'analytics' && (
          <div className="space-y-6">
            {/* Department-wise Attendance */}
            <div className="bg-white rounded-lg shadow-sm p-6">
              <h3 className="text-lg font-semibold mb-4">Department-wise Attendance</h3>
              <div className="space-y-4">
                {departments.filter(dept => dept !== 'All').map(dept => (
                  <div key={dept} className="flex items-center">
                    <span className="w-1/4 text-sm font-medium text-gray-700">{dept}</span>
                    <div className="w-2/4 bg-gray-200 rounded-full h-4">
                      <div 
                        className="bg-blue-600 h-4 rounded-full transition-all duration-300" 
                        style={{ width: `${attendanceAnalytics.departmentStats[dept]?.percentage || 0}%` }}
                      ></div>
                    </div>
                    <span className="ml-3 text-sm text-gray-600">
                      {attendanceAnalytics.departmentStats[dept]?.present || 0}/{attendanceAnalytics.departmentStats[dept]?.total || 0} ({attendanceAnalytics.departmentStats[dept]?.percentage || 0}%)
                    </span>
                  </div>
                ))}
              </div>
            </div>
          </div>
        )}

        {/* History Tab */}
        {activeTab === 'history' && (
          <div className="bg-white rounded-lg shadow-sm p-6">
            {/* Date Range Selector */}
            <div className="flex flex-col md:flex-row gap-4 mb-6">
              <div className="flex-1">
                <label className="block text-sm font-medium text-gray-700 mb-1">Start Date</label>
                <input
                  type="date"
                  value={dateRange.start}
                  onChange={(e) => handleDateRangeChange('start', e.target.value)}
                  className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                />
              </div>
              <div className="flex-1">
                <label className="block text-sm font-medium text-gray-700 mb-1">End Date</label>
                <input
                  type="date"
                  value={dateRange.end}
                  onChange={(e) => handleDateRangeChange('end', e.target.value)}
                  className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                />
              </div>
              <button
                onClick={getAttendanceHistory}
                className="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors self-end"
              >
                Load History
              </button>
            </div>

            {/* Attendance Records */}
            <div className="overflow-x-auto">
              <table className="min-w-full divide-y divide-gray-200">
                <thead className="bg-gray-50">
                  <tr>
                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Employee</th>
                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Time</th>
                  </tr>
                </thead>
                <tbody className="bg-white divide-y divide-gray-200">
                  {attendanceRecords.length === 0 ? (
                    <tr>
                      <td colSpan="4" className="px-6 py-4 text-center text-gray-500">
                        No attendance records found for this date range.
                      </td>
                    </tr>
                  ) : (
                    attendanceRecords.map((record, index) => {
                      const employee = employees.find(e => e.employeeId === record.employeeId);
                      const recordDate = new Date(record.timestamp);
                      return (
                        <tr key={index} className="hover:bg-gray-50">
                          <td className="px-6 py-4 whitespace-nowrap">
                            <div className="text-sm font-medium text-gray-900">
                              {employee?.employeeName || 'Unknown Employee'}
                            </div>
                            <div className="text-sm text-gray-500">{record.employeeId}</div>
                          </td>
                          <td className="px-6 py-4 whitespace-nowrap">{getStatusLabel(record.status)}</td>
                          <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                            {recordDate.toLocaleDateString()}
                          </td>
                          <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                            {recordDate.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' })}
                          </td>
                        </tr>
                      );
                    })
                  )}
                </tbody>
              </table>
            </div>

            {/* Pagination */}
            {pagination.total_pages > 1 && (
              <div className="mt-6 flex justify-between items-center">
                <p className="text-sm text-gray-600">
                  Showing {(pagination.page - 1) * pagination.per_page + 1} to {Math.min(pagination.page * pagination.per_page, pagination.total_records)} of {pagination.total_records} records
                </p>
                <div className="flex space-x-2">
                  <button
                    onClick={() => handlePageChange(pagination.page - 1)}
                    disabled={pagination.page === 1}
                    className="px-3 py-1 border border-gray-300 rounded-md text-sm disabled:opacity-50 hover:bg-gray-100"
                  >
                    Previous
                  </button>
                  <button
                    onClick={() => handlePageChange(pagination.page + 1)}
                    disabled={pagination.page >= pagination.total_pages}
                    className="px-3 py-1 border border-gray-300 rounded-md text-sm disabled:opacity-50 hover:bg-gray-100"
                  >
                    Next
                  </button>
                </div>
              </div>
            )}
          </div>
        )}
      </main>
    </div>
  );
};

export default EmployeeAttendanceSystem;