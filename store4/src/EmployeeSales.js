// // //   // // // // // // // // // // // // // // // // // // // // // // import React, { useContext, useEffect, useState } from "react";
// // //   // // // // // // // // // // // // // // // // // // // // // // import { useStore } from "./StoreContext"; // Import your context

// // //   // // // // // // // // // // // // // // // // // // // // // // const EmployeeSales = () => {
// // //   // // // // // // // // // // // // // // // // // // // // // //   const { storeId } = useStore(); // Get storeId from context
// // //   // // // // // // // // // // // // // // // // // // // // // //   const [salesData, setSalesData] = useState([]);
// // //   // // // // // // // // // // // // // // // // // // // // // //   const [employees, setEmployees] = useState({}); // Map of user_id to employee details
// // //   // // // // // // // // // // // // // // // // // // // // // //   const [loading, setLoading] = useState(true);
// // //   // // // // // // // // // // // // // // // // // // // // // //   const [error, setError] = useState(null);

// // //   // // // // // // // // // // // // // // // // // // // // // //   // Fetch sales data from Flask backend
// // //   // // // // // // // // // // // // // // // // // // // // // //   useEffect(() => {
// // //   // // // // // // // // // // // // // // // // // // // // // //     // const fetchSalesData = async () => {
// // //   // // // // // // // // // // // // // // // // // // // // // //     //   try {
// // //   // // // // // // // // // // // // // // // // // // // // // //     //     const response = await fetch(`http://localhost:5010/api/daily-sales?store_id=${storeId}`); // Use storeId in the query
// // //   // // // // // // // // // // // // // // // // // // // // // //     //     if (!response.ok) {
// // //   // // // // // // // // // // // // // // // // // // // // // //     //       throw new Error("Failed to fetch sales data");
// // //   // // // // // // // // // // // // // // // // // // // // // //     //     }
// // //   // // // // // // // // // // // // // // // // // // // // // //     //     const data = await response.json();
// // //   // // // // // // // // // // // // // // // // // // // // // //     //     setSalesData(data);
// // //   // // // // // // // // // // // // // // // // // // // // // //     //   } catch (err) {
// // //   // // // // // // // // // // // // // // // // // // // // // //     //     setError(err.message);
// // //   // // // // // // // // // // // // // // // // // // // // // //     //   } finally {
// // //   // // // // // // // // // // // // // // // // // // // // // //     //     setLoading(false);
// // //   // // // // // // // // // // // // // // // // // // // // // //     //   }
// // //   // // // // // // // // // // // // // // // // // // // // // //     // };
// // //   // // // // // // // // // // // // // // // // // // // // // //     const fetchSalesData = async () => {
// // //   // // // // // // // // // // // // // // // // // // // // // //         try {
// // //   // // // // // // // // // // // // // // // // // // // // // //           const response = await fetch(`http://localhost:5010/api/daily-sales?storeId=${storeId}&date=2025-03-03`);
// // //   // // // // // // // // // // // // // // // // // // // // // //           if (!response.ok) {
// // //   // // // // // // // // // // // // // // // // // // // // // //             throw new Error("Failed to fetch sales data");
// // //   // // // // // // // // // // // // // // // // // // // // // //           }
// // //   // // // // // // // // // // // // // // // // // // // // // //           const data = await response.json();
// // //   // // // // // // // // // // // // // // // // // // // // // //           setSalesData(data);
// // //   // // // // // // // // // // // // // // // // // // // // // //         } catch (err) {
// // //   // // // // // // // // // // // // // // // // // // // // // //           setError(err.message);
// // //   // // // // // // // // // // // // // // // // // // // // // //         } finally {
// // //   // // // // // // // // // // // // // // // // // // // // // //           setLoading(false);
// // //   // // // // // // // // // // // // // // // // // // // // // //         }
// // //   // // // // // // // // // // // // // // // // // // // // // //       };
        
        

// // //   // // // // // // // // // // // // // // // // // // // // // //     if (storeId) {
// // //   // // // // // // // // // // // // // // // // // // // // // //       fetchSalesData();
// // //   // // // // // // // // // // // // // // // // // // // // // //     }
// // //   // // // // // // // // // // // // // // // // // // // // // //   }, [storeId]);

// // //   // // // // // // // // // // // // // // // // // // // // // //   // Fetch employee details from Flask backend
// // //   // // // // // // // // // // // // // // // // // // // // // //   useEffect(() => {
// // //   // // // // // // // // // // // // // // // // // // // // // //     // const fetchEmployeeDetails = async () => {
// // //   // // // // // // // // // // // // // // // // // // // // // //     //   try {
// // //   // // // // // // // // // // // // // // // // // // // // // //     //     const response = await fetch("http://localhost:5010/api/users"); // Replace with your Flask endpoint for users
// // //   // // // // // // // // // // // // // // // // // // // // // //     //     if (!response.ok) {
// // //   // // // // // // // // // // // // // // // // // // // // // //     //       throw new Error("Failed to fetch employee details");
// // //   // // // // // // // // // // // // // // // // // // // // // //     //     }
// // //   // // // // // // // // // // // // // // // // // // // // // //     //     const data = await response.json();
// // //   // // // // // // // // // // // // // // // // // // // // // //     //     const employeeMap = data.reduce((acc, employee) => {
// // //   // // // // // // // // // // // // // // // // // // // // // //     //       acc[employee.user_id] = employee;
// // //   // // // // // // // // // // // // // // // // // // // // // //     //       return acc;
// // //   // // // // // // // // // // // // // // // // // // // // // //     //     }, {});
// // //   // // // // // // // // // // // // // // // // // // // // // //     //     setEmployees(employeeMap);
// // //   // // // // // // // // // // // // // // // // // // // // // //     //   } catch (err) {
// // //   // // // // // // // // // // // // // // // // // // // // // //     //     setError(err.message);
// // //   // // // // // // // // // // // // // // // // // // // // // //     //   }
// // //   // // // // // // // // // // // // // // // // // // // // // //     // };
// // //   // // // // // // // // // // // // // // // // // // // // // //     const fetchEmployeeDetails = async () => {
// // //   // // // // // // // // // // // // // // // // // // // // // //         try {
// // //   // // // // // // // // // // // // // // // // // // // // // //           const response = await fetch(`http://localhost:5010/api/users?storeId=${storeId}`);
// // //   // // // // // // // // // // // // // // // // // // // // // //           if (!response.ok) {
// // //   // // // // // // // // // // // // // // // // // // // // // //             throw new Error("Failed to fetch employee details");
// // //   // // // // // // // // // // // // // // // // // // // // // //           }
// // //   // // // // // // // // // // // // // // // // // // // // // //           const data = await response.json();
// // //   // // // // // // // // // // // // // // // // // // // // // //           const employeeMap = data.reduce((acc, employee) => {
// // //   // // // // // // // // // // // // // // // // // // // // // //             acc[employee._id] = employee;
// // //   // // // // // // // // // // // // // // // // // // // // // //             return acc;
// // //   // // // // // // // // // // // // // // // // // // // // // //           }, {});
// // //   // // // // // // // // // // // // // // // // // // // // // //           setEmployees(employeeMap);
// // //   // // // // // // // // // // // // // // // // // // // // // //         } catch (err) {
// // //   // // // // // // // // // // // // // // // // // // // // // //           setError(err.message);
// // //   // // // // // // // // // // // // // // // // // // // // // //         }
// // //   // // // // // // // // // // // // // // // // // // // // // //       };

// // //   // // // // // // // // // // // // // // // // // // // // // //     fetchEmployeeDetails();
// // //   // // // // // // // // // // // // // // // // // // // // // //   }, []);

// // //   // // // // // // // // // // // // // // // // // // // // // //   if (loading) {
// // //   // // // // // // // // // // // // // // // // // // // // // //     return <div className="text-center py-4">Loading...</div>;
// // //   // // // // // // // // // // // // // // // // // // // // // //   }

// // //   // // // // // // // // // // // // // // // // // // // // // //   if (error) {
// // //   // // // // // // // // // // // // // // // // // // // // // //     return <div className="text-center py-4 text-red-500">Error: {error}</div>;
// // //   // // // // // // // // // // // // // // // // // // // // // //   }

// // //   // // // // // // // // // // // // // // // // // // // // // //   return (
// // //   // // // // // // // // // // // // // // // // // // // // // //     <div className="p-4">
// // //   // // // // // // // // // // // // // // // // // // // // // //       <h1 className="text-2xl font-bold mb-4">Employee-wise Sales Information</h1>
// // //   // // // // // // // // // // // // // // // // // // // // // //       <div className="overflow-x-auto">
// // //   // // // // // // // // // // // // // // // // // // // // // //         <table className="min-w-full bg-white border border-gray-200">
// // //   // // // // // // // // // // // // // // // // // // // // // //           <thead className="bg-gray-50">
// // //   // // // // // // // // // // // // // // // // // // // // // //             <tr>
// // //   // // // // // // // // // // // // // // // // // // // // // //               <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
// // //   // // // // // // // // // // // // // // // // // // // // // //                 Employee Name
// // //   // // // // // // // // // // // // // // // // // // // // // //               </th>
// // //   // // // // // // // // // // // // // // // // // // // // // //               <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
// // //   // // // // // // // // // // // // // // // // // // // // // //                 Total Sales
// // //   // // // // // // // // // // // // // // // // // // // // // //               </th>
// // //   // // // // // // // // // // // // // // // // // // // // // //               <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
// // //   // // // // // // // // // // // // // // // // // // // // // //                 Number of Transactions
// // //   // // // // // // // // // // // // // // // // // // // // // //               </th>
// // //   // // // // // // // // // // // // // // // // // // // // // //               <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
// // //   // // // // // // // // // // // // // // // // // // // // // //                 Details
// // //   // // // // // // // // // // // // // // // // // // // // // //               </th>
// // //   // // // // // // // // // // // // // // // // // // // // // //             </tr>
// // //   // // // // // // // // // // // // // // // // // // // // // //           </thead>
// // //   // // // // // // // // // // // // // // // // // // // // // //           <tbody className="divide-y divide-gray-200">
// // //   // // // // // // // // // // // // // // // // // // // // // //             {Object.keys(employees).map((userId) => {
// // //   // // // // // // // // // // // // // // // // // // // // // //               const employeeSales = salesData.filter((sale) => sale.user_id === userId);
// // //   // // // // // // // // // // // // // // // // // // // // // //               const totalSales = employeeSales.reduce((sum, sale) => sum + sale.total_amount, 0);
// // //   // // // // // // // // // // // // // // // // // // // // // //               const transactionCount = employeeSales.length;

// // //   // // // // // // // // // // // // // // // // // // // // // //               return (
// // //   // // // // // // // // // // // // // // // // // // // // // //                 <tr key={userId} className="hover:bg-gray-50">
// // //   // // // // // // // // // // // // // // // // // // // // // //                   <td className="px-6 py-4 whitespace-nowrap">
// // //   // // // // // // // // // // // // // // // // // // // // // //                     {employees[userId]?.name || "Unknown Employee"}
// // //   // // // // // // // // // // // // // // // // // // // // // //                   </td>
// // //   // // // // // // // // // // // // // // // // // // // // // //                   <td className="px-6 py-4 whitespace-nowrap">₹{totalSales.toFixed(2)}</td>
// // //   // // // // // // // // // // // // // // // // // // // // // //                   <td className="px-6 py-4 whitespace-nowrap">{transactionCount}</td>
// // //   // // // // // // // // // // // // // // // // // // // // // //                   <td className="px-6 py-4 whitespace-nowrap">
// // //   // // // // // // // // // // // // // // // // // // // // // //                     <button
// // //   // // // // // // // // // // // // // // // // // // // // // //                       className="text-blue-500 hover:text-blue-700"
// // //   // // // // // // // // // // // // // // // // // // // // // //                       onClick={() => {
// // //   // // // // // // // // // // // // // // // // // // // // // //                         // Implement a modal or detailed view for transactions
// // //   // // // // // // // // // // // // // // // // // // // // // //                         console.log("View details for:", employees[userId]?.name);
// // //   // // // // // // // // // // // // // // // // // // // // // //                       }}
// // //   // // // // // // // // // // // // // // // // // // // // // //                     >
// // //   // // // // // // // // // // // // // // // // // // // // // //                       View Details
// // //   // // // // // // // // // // // // // // // // // // // // // //                     </button>
// // //   // // // // // // // // // // // // // // // // // // // // // //                   </td>
// // //   // // // // // // // // // // // // // // // // // // // // // //                 </tr>
// // //   // // // // // // // // // // // // // // // // // // // // // //               );
// // //   // // // // // // // // // // // // // // // // // // // // // //             })}
// // //   // // // // // // // // // // // // // // // // // // // // // //           </tbody>
// // //   // // // // // // // // // // // // // // // // // // // // // //         </table>
// // //   // // // // // // // // // // // // // // // // // // // // // //       </div>
// // //   // // // // // // // // // // // // // // // // // // // // // //     </div>
// // //   // // // // // // // // // // // // // // // // // // // // // //   );
// // //   // // // // // // // // // // // // // // // // // // // // // // };

// // //   // // // // // // // // // // // // // // // // // // // // // // export default EmployeeSales;
// // //   // // // // // // // // // // // // // // // // // // // // // import React, { useContext, useEffect, useState } from "react";
// // //   // // // // // // // // // // // // // // // // // // // // // import { useStore } from "./StoreContext"; // Import your context

// // //   // // // // // // // // // // // // // // // // // // // // // const EmployeeSales = () => {
// // //   // // // // // // // // // // // // // // // // // // // // //   const { storeId } = useStore(); // Get storeId from context
// // //   // // // // // // // // // // // // // // // // // // // // //   const [salesData, setSalesData] = useState([]);
// // //   // // // // // // // // // // // // // // // // // // // // //   const [employees, setEmployees] = useState({}); // Map of user_id to employee details
// // //   // // // // // // // // // // // // // // // // // // // // //   const [loading, setLoading] = useState(true);
// // //   // // // // // // // // // // // // // // // // // // // // //   const [error, setError] = useState(null);

// // //   // // // // // // // // // // // // // // // // // // // // //   // Fetch sales data from Flask backend
// // //   // // // // // // // // // // // // // // // // // // // // //   useEffect(() => {
// // //   // // // // // // // // // // // // // // // // // // // // //     const fetchSalesData = async () => {
// // //   // // // // // // // // // // // // // // // // // // // // //       try {
// // //   // // // // // // // // // // // // // // // // // // // // //         const response = await fetch(`http://localhost:5010/api/daily-sales?storeId=${storeId}`);
// // //   // // // // // // // // // // // // // // // // // // // // //         if (!response.ok) {
// // //   // // // // // // // // // // // // // // // // // // // // //           throw new Error("Failed to fetch sales data");
// // //   // // // // // // // // // // // // // // // // // // // // //         }
// // //   // // // // // // // // // // // // // // // // // // // // //         const data = await response.json();
// // //   // // // // // // // // // // // // // // // // // // // // //         setSalesData(data);
// // //   // // // // // // // // // // // // // // // // // // // // //       } catch (err) {
// // //   // // // // // // // // // // // // // // // // // // // // //         setError(err.message);
// // //   // // // // // // // // // // // // // // // // // // // // //       } finally {
// // //   // // // // // // // // // // // // // // // // // // // // //         setLoading(false);
// // //   // // // // // // // // // // // // // // // // // // // // //       }
// // //   // // // // // // // // // // // // // // // // // // // // //     };

// // //   // // // // // // // // // // // // // // // // // // // // //     if (storeId) {
// // //   // // // // // // // // // // // // // // // // // // // // //       fetchSalesData();
// // //   // // // // // // // // // // // // // // // // // // // // //     }
// // //   // // // // // // // // // // // // // // // // // // // // //   }, [storeId]);

// // //   // // // // // // // // // // // // // // // // // // // // //   // Fetch employee details from Flask backend
// // //   // // // // // // // // // // // // // // // // // // // // //   useEffect(() => {
// // //   // // // // // // // // // // // // // // // // // // // // //     const fetchEmployeeDetails = async () => {
// // //   // // // // // // // // // // // // // // // // // // // // //       try {
// // //   // // // // // // // // // // // // // // // // // // // // //         const response = await fetch(`http://localhost:5010/api/users?storeId=${storeId}`);
// // //   // // // // // // // // // // // // // // // // // // // // //         if (!response.ok) {
// // //   // // // // // // // // // // // // // // // // // // // // //           throw new Error("Failed to fetch employee details");
// // //   // // // // // // // // // // // // // // // // // // // // //         }
// // //   // // // // // // // // // // // // // // // // // // // // //         const data = await response.json();
// // //   // // // // // // // // // // // // // // // // // // // // //         const employeeMap = data.reduce((acc, employee) => {
// // //   // // // // // // // // // // // // // // // // // // // // //           acc[employee.id] = employee; // Use 'id' as the key
// // //   // // // // // // // // // // // // // // // // // // // // //           return acc;
// // //   // // // // // // // // // // // // // // // // // // // // //         }, {});
// // //   // // // // // // // // // // // // // // // // // // // // //         setEmployees(employeeMap);
// // //   // // // // // // // // // // // // // // // // // // // // //       } catch (err) {
// // //   // // // // // // // // // // // // // // // // // // // // //         setError(err.message);
// // //   // // // // // // // // // // // // // // // // // // // // //       }
// // //   // // // // // // // // // // // // // // // // // // // // //     };

// // //   // // // // // // // // // // // // // // // // // // // // //     if (storeId) {
// // //   // // // // // // // // // // // // // // // // // // // // //       fetchEmployeeDetails();
// // //   // // // // // // // // // // // // // // // // // // // // //     }
// // //   // // // // // // // // // // // // // // // // // // // // //   }, [storeId]);

// // //   // // // // // // // // // // // // // // // // // // // // //   if (loading) {
// // //   // // // // // // // // // // // // // // // // // // // // //     return <div className="text-center py-4">Loading...</div>;
// // //   // // // // // // // // // // // // // // // // // // // // //   }

// // //   // // // // // // // // // // // // // // // // // // // // //   if (error) {
// // //   // // // // // // // // // // // // // // // // // // // // //     return <div className="text-center py-4 text-red-500">Error: {error}</div>;
// // //   // // // // // // // // // // // // // // // // // // // // //   }

// // //   // // // // // // // // // // // // // // // // // // // // //   // Group sales data by employee (user_id)
// // //   // // // // // // // // // // // // // // // // // // // // //   const employeeSalesMap = salesData.reduce((acc, sale) => {
// // //   // // // // // // // // // // // // // // // // // // // // //     const userId = sale.user_id;
// // //   // // // // // // // // // // // // // // // // // // // // //     if (!acc[userId]) {
// // //   // // // // // // // // // // // // // // // // // // // // //       acc[userId] = {
// // //   // // // // // // // // // // // // // // // // // // // // //         totalSales: 0,
// // //   // // // // // // // // // // // // // // // // // // // // //         transactions: [],
// // //   // // // // // // // // // // // // // // // // // // // // //       };
// // //   // // // // // // // // // // // // // // // // // // // // //     }
// // //   // // // // // // // // // // // // // // // // // // // // //     acc[userId].totalSales += sale.total_amount;
// // //   // // // // // // // // // // // // // // // // // // // // //     acc[userId].transactions.push(sale);
// // //   // // // // // // // // // // // // // // // // // // // // //     return acc;
// // //   // // // // // // // // // // // // // // // // // // // // //   }, {});

// // //   // // // // // // // // // // // // // // // // // // // // //   return (
// // //   // // // // // // // // // // // // // // // // // // // // //     <div className="p-4">
// // //   // // // // // // // // // // // // // // // // // // // // //       <h1 className="text-2xl font-bold mb-4">Employee-wise Sales Information</h1>
// // //   // // // // // // // // // // // // // // // // // // // // //       <div className="overflow-x-auto">
// // //   // // // // // // // // // // // // // // // // // // // // //         <table className="min-w-full bg-white border border-gray-200">
// // //   // // // // // // // // // // // // // // // // // // // // //           <thead className="bg-gray-50">
// // //   // // // // // // // // // // // // // // // // // // // // //             <tr>
// // //   // // // // // // // // // // // // // // // // // // // // //               <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
// // //   // // // // // // // // // // // // // // // // // // // // //                 Employee Name
// // //   // // // // // // // // // // // // // // // // // // // // //               </th>
// // //   // // // // // // // // // // // // // // // // // // // // //               <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
// // //   // // // // // // // // // // // // // // // // // // // // //                 Total Sales
// // //   // // // // // // // // // // // // // // // // // // // // //               </th>
// // //   // // // // // // // // // // // // // // // // // // // // //               <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
// // //   // // // // // // // // // // // // // // // // // // // // //                 Number of Transactions
// // //   // // // // // // // // // // // // // // // // // // // // //               </th>
// // //   // // // // // // // // // // // // // // // // // // // // //               <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
// // //   // // // // // // // // // // // // // // // // // // // // //                 Details
// // //   // // // // // // // // // // // // // // // // // // // // //               </th>
// // //   // // // // // // // // // // // // // // // // // // // // //             </tr>
// // //   // // // // // // // // // // // // // // // // // // // // //           </thead>
// // //   // // // // // // // // // // // // // // // // // // // // //           <tbody className="divide-y divide-gray-200">
// // //   // // // // // // // // // // // // // // // // // // // // //             {Object.keys(employeeSalesMap).map((userId) => {
// // //   // // // // // // // // // // // // // // // // // // // // //               const employee = employees[userId];
// // //   // // // // // // // // // // // // // // // // // // // // //               const salesInfo = employeeSalesMap[userId];
// // //   // // // // // // // // // // // // // // // // // // // // //               const totalSales = salesInfo.totalSales;
// // //   // // // // // // // // // // // // // // // // // // // // //               const transactionCount = salesInfo.transactions.length;

// // //   // // // // // // // // // // // // // // // // // // // // //               return (
// // //   // // // // // // // // // // // // // // // // // // // // //                 <tr key={userId} className="hover:bg-gray-50">
// // //   // // // // // // // // // // // // // // // // // // // // //                   <td className="px-6 py-4 whitespace-nowrap">
// // //   // // // // // // // // // // // // // // // // // // // // //                     {employee ? `${employee.firstName} ${employee.lastName}` : "Unknown Employee"}
// // //   // // // // // // // // // // // // // // // // // // // // //                   </td>
// // //   // // // // // // // // // // // // // // // // // // // // //                   <td className="px-6 py-4 whitespace-nowrap">₹{totalSales.toFixed(2)}</td>
// // //   // // // // // // // // // // // // // // // // // // // // //                   <td className="px-6 py-4 whitespace-nowrap">{transactionCount}</td>
// // //   // // // // // // // // // // // // // // // // // // // // //                   <td className="px-6 py-4 whitespace-nowrap">
// // //   // // // // // // // // // // // // // // // // // // // // //                     <button
// // //   // // // // // // // // // // // // // // // // // // // // //                       className="text-blue-500 hover:text-blue-700"
// // //   // // // // // // // // // // // // // // // // // // // // //                       onClick={() => {
// // //   // // // // // // // // // // // // // // // // // // // // //                         // Implement a modal or detailed view for transactions
// // //   // // // // // // // // // // // // // // // // // // // // //                         console.log("View details for:", employee ? `${employee.firstName} ${employee.lastName}` : "Unknown Employee");
// // //   // // // // // // // // // // // // // // // // // // // // //                       }}
// // //   // // // // // // // // // // // // // // // // // // // // //                     >
// // //   // // // // // // // // // // // // // // // // // // // // //                       View Details
// // //   // // // // // // // // // // // // // // // // // // // // //                     </button>
// // //   // // // // // // // // // // // // // // // // // // // // //                   </td>
// // //   // // // // // // // // // // // // // // // // // // // // //                 </tr>
// // //   // // // // // // // // // // // // // // // // // // // // //               );
// // //   // // // // // // // // // // // // // // // // // // // // //             })}
// // //   // // // // // // // // // // // // // // // // // // // // //           </tbody>
// // //   // // // // // // // // // // // // // // // // // // // // //         </table>
// // //   // // // // // // // // // // // // // // // // // // // // //       </div>
// // //   // // // // // // // // // // // // // // // // // // // // //     </div>
// // //   // // // // // // // // // // // // // // // // // // // // //   );
// // //   // // // // // // // // // // // // // // // // // // // // // };

// // //   // // // // // // // // // // // // // // // // // // // // // export default EmployeeSales;

// // //   // // // // // // // // // // // // // // // // // // // // import React, { useEffect, useState } from "react";

// // //   // // // // // // // // // // // // // // // // // // // // const EmployeeSales = ({ storeId }) => {
// // //   // // // // // // // // // // // // // // // // // // // //     const [salesData, setSalesData] = useState([]);
// // //   // // // // // // // // // // // // // // // // // // // //     const [employees, setEmployees] = useState({});
// // //   // // // // // // // // // // // // // // // // // // // //     const [loading, setLoading] = useState(true);
// // //   // // // // // // // // // // // // // // // // // // // //     const [error, setError] = useState(null);
// // //   // // // // // // // // // // // // // // // // // // // //     const [selectedDate, setSelectedDate] = useState("");

// // //   // // // // // // // // // // // // // // // // // // // //     useEffect(() => {
// // //   // // // // // // // // // // // // // // // // // // // //         fetchEmployees();
// // //   // // // // // // // // // // // // // // // // // // // //     }, []);

// // //   // // // // // // // // // // // // // // // // // // // //     useEffect(() => {
// // //   // // // // // // // // // // // // // // // // // // // //         if (storeId) {
// // //   // // // // // // // // // // // // // // // // // // // //             fetchSalesData();
// // //   // // // // // // // // // // // // // // // // // // // //         }
// // //   // // // // // // // // // // // // // // // // // // // //     }, [storeId, selectedDate]);

// // //   // // // // // // // // // // // // // // // // // // // //     const fetchEmployees = async () => {
// // //   // // // // // // // // // // // // // // // // // // // //         try {
// // //   // // // // // // // // // // // // // // // // // // // //             const response = await fetch("http://localhost:5010/api/employees");
// // //   // // // // // // // // // // // // // // // // // // // //             if (!response.ok) throw new Error("Failed to fetch employees");
// // //   // // // // // // // // // // // // // // // // // // // //             const data = await response.json();
              
// // //   // // // // // // // // // // // // // // // // // // // //             // Convert employee list into an object for quick lookups
// // //   // // // // // // // // // // // // // // // // // // // //             const employeeMap = data.reduce((acc, employee) => {
// // //   // // // // // // // // // // // // // // // // // // // //                 acc[employee._id] = employee; // Ensure MongoDB _id is used
// // //   // // // // // // // // // // // // // // // // // // // //                 return acc;
// // //   // // // // // // // // // // // // // // // // // // // //             }, {});
              
// // //   // // // // // // // // // // // // // // // // // // // //             setEmployees(employeeMap);
// // //   // // // // // // // // // // // // // // // // // // // //         } catch (err) {
// // //   // // // // // // // // // // // // // // // // // // // //             console.error("Employee fetch error:", err);
// // //   // // // // // // // // // // // // // // // // // // // //             setError("Error fetching employee data");
// // //   // // // // // // // // // // // // // // // // // // // //         }
// // //   // // // // // // // // // // // // // // // // // // // //     };

// // //   // // // // // // // // // // // // // // // // // // // //     const fetchSalesData = async () => {
// // //   // // // // // // // // // // // // // // // // // // // //         setLoading(true);
// // //   // // // // // // // // // // // // // // // // // // // //         setError(null);
// // //   // // // // // // // // // // // // // // // // // // // //         try {
// // //   // // // // // // // // // // // // // // // // // // // //             const url = selectedDate
// // //   // // // // // // // // // // // // // // // // // // // //                 ? `http://localhost:5010/api/daily-sales?storeId=${storeId}&date=${selectedDate}`
// // //   // // // // // // // // // // // // // // // // // // // //                 : `http://localhost:5010/api/daily-sales?storeId=${storeId}`;
              
// // //   // // // // // // // // // // // // // // // // // // // //             const response = await fetch(url, {
// // //   // // // // // // // // // // // // // // // // // // // //                 headers: { "storeId": storeId },
// // //   // // // // // // // // // // // // // // // // // // // //             });
// // //   // // // // // // // // // // // // // // // // // // // //             if (!response.ok) throw new Error("Failed to fetch sales data");
              
// // //   // // // // // // // // // // // // // // // // // // // //             const data = await response.json();
// // //   // // // // // // // // // // // // // // // // // // // //             setSalesData(data);
// // //   // // // // // // // // // // // // // // // // // // // //         } catch (err) {
// // //   // // // // // // // // // // // // // // // // // // // //             console.error("Sales fetch error:", err);
// // //   // // // // // // // // // // // // // // // // // // // //             setError("Error fetching sales data");
// // //   // // // // // // // // // // // // // // // // // // // //         } finally {
// // //   // // // // // // // // // // // // // // // // // // // //             setLoading(false);
// // //   // // // // // // // // // // // // // // // // // // // //         }
// // //   // // // // // // // // // // // // // // // // // // // //     };

// // //   // // // // // // // // // // // // // // // // // // // //     return (
// // //   // // // // // // // // // // // // // // // // // // // //         <div>
// // //   // // // // // // // // // // // // // // // // // // // //             <h2>Employee Sales</h2>
// // //   // // // // // // // // // // // // // // // // // // // //             <label>Select Date: </label>
// // //   // // // // // // // // // // // // // // // // // // // //             <input
// // //   // // // // // // // // // // // // // // // // // // // //                 type="date"
// // //   // // // // // // // // // // // // // // // // // // // //                 value={selectedDate}
// // //   // // // // // // // // // // // // // // // // // // // //                 onChange={(e) => setSelectedDate(e.target.value)}
// // //   // // // // // // // // // // // // // // // // // // // //             />
              
// // //   // // // // // // // // // // // // // // // // // // // //             {loading && <p>Loading sales data...</p>}
// // //   // // // // // // // // // // // // // // // // // // // //             {error && <p style={{ color: "red" }}>{error}</p>}
              
// // //   // // // // // // // // // // // // // // // // // // // //             {!loading && !error && (
// // //   // // // // // // // // // // // // // // // // // // // //                 <table border="1">
// // //   // // // // // // // // // // // // // // // // // // // //                     <thead>
// // //   // // // // // // // // // // // // // // // // // // // //                         <tr>
// // //   // // // // // // // // // // // // // // // // // // // //                             <th>Employee</th>
// // //   // // // // // // // // // // // // // // // // // // // //                             <th>Total Sales</th>
// // //   // // // // // // // // // // // // // // // // // // // //                         </tr>
// // //   // // // // // // // // // // // // // // // // // // // //                     </thead>
// // //   // // // // // // // // // // // // // // // // // // // //                     <tbody>
// // //   // // // // // // // // // // // // // // // // // // // //                         {salesData.map((sale) => {
// // //   // // // // // // // // // // // // // // // // // // // //                             const employee = employees[sale.user_id] || { name: "Unknown" };
// // //   // // // // // // // // // // // // // // // // // // // //                             return (
// // //   // // // // // // // // // // // // // // // // // // // //                                 <tr key={sale.user_id}>
// // //   // // // // // // // // // // // // // // // // // // // //                                     <td>{employee.name}</td>
// // //   // // // // // // // // // // // // // // // // // // // //                                     <td>${sale.total_sales.toFixed(2)}</td>
// // //   // // // // // // // // // // // // // // // // // // // //                                 </tr>
// // //   // // // // // // // // // // // // // // // // // // // //                             );
// // //   // // // // // // // // // // // // // // // // // // // //                         })}
// // //   // // // // // // // // // // // // // // // // // // // //                     </tbody>
// // //   // // // // // // // // // // // // // // // // // // // //                 </table>
// // //   // // // // // // // // // // // // // // // // // // // //             )}
// // //   // // // // // // // // // // // // // // // // // // // //         </div>
// // //   // // // // // // // // // // // // // // // // // // // //     );
// // //   // // // // // // // // // // // // // // // // // // // // };

// // //   // // // // // // // // // // // // // // // // // // // // export default EmployeeSales;
// // //   // // // // // // // // // // // // // // // // // // // import React, { useState, useEffect } from "react";
// // //   // // // // // // // // // // // // // // // // // // // import { Card, CardContent } from "@/components/ui/card";
// // //   // // // // // // // // // // // // // // // // // // // import { Table, TableHeader, TableRow, TableHead, TableBody, TableCell } from "@/components/ui/table";
// // //   // // // // // // // // // // // // // // // // // // // import { fetchEmployeeSales } from "@/api/sales"; // Assume this API fetches employee-wise sales data

// // //   // // // // // // // // // // // // // // // // // // // const EmployeeSales = () => {
// // //   // // // // // // // // // // // // // // // // // // //   const [employeeSales, setEmployeeSales] = useState([]);
// // //   // // // // // // // // // // // // // // // // // // //   const [loading, setLoading] = useState(true);

// // //   // // // // // // // // // // // // // // // // // // //   useEffect(() => {
// // //   // // // // // // // // // // // // // // // // // // //     fetchEmployeeSales()
// // //   // // // // // // // // // // // // // // // // // // //       .then((data) => {
// // //   // // // // // // // // // // // // // // // // // // //         setEmployeeSales(data);
// // //   // // // // // // // // // // // // // // // // // // //         setLoading(false);
// // //   // // // // // // // // // // // // // // // // // // //       })
// // //   // // // // // // // // // // // // // // // // // // //       .catch((error) => {
// // //   // // // // // // // // // // // // // // // // // // //         console.error("Error fetching employee sales:", error);
// // //   // // // // // // // // // // // // // // // // // // //         setLoading(false);
// // //   // // // // // // // // // // // // // // // // // // //       });
// // //   // // // // // // // // // // // // // // // // // // //   }, []);

// // //   // // // // // // // // // // // // // // // // // // //   if (loading) {
// // //   // // // // // // // // // // // // // // // // // // //     return <div>Loading employee sales data...</div>;
// // //   // // // // // // // // // // // // // // // // // // //   }

// // //   // // // // // // // // // // // // // // // // // // //   return (
// // //   // // // // // // // // // // // // // // // // // // //     <Card className="shadow-lg p-4 rounded-2xl">
// // //   // // // // // // // // // // // // // // // // // // //       <CardContent>
// // //   // // // // // // // // // // // // // // // // // // //         <h2 className="text-xl font-semibold mb-4">Employee Sales Report</h2>
// // //   // // // // // // // // // // // // // // // // // // //         <Table>
// // //   // // // // // // // // // // // // // // // // // // //           <TableHeader>
// // //   // // // // // // // // // // // // // // // // // // //             <TableRow>
// // //   // // // // // // // // // // // // // // // // // // //               <TableHead>Employee Name</TableHead>
// // //   // // // // // // // // // // // // // // // // // // //               <TableHead>Total Sales</TableHead>
// // //   // // // // // // // // // // // // // // // // // // //               <TableHead>Transactions</TableHead>
// // //   // // // // // // // // // // // // // // // // // // //             </TableRow>
// // //   // // // // // // // // // // // // // // // // // // //           </TableHeader>
// // //   // // // // // // // // // // // // // // // // // // //           <TableBody>
// // //   // // // // // // // // // // // // // // // // // // //             {employeeSales.map((employee) => (
// // //   // // // // // // // // // // // // // // // // // // //               <TableRow key={employee.id}>
// // //   // // // // // // // // // // // // // // // // // // //                 <TableCell>{employee.name}</TableCell>
// // //   // // // // // // // // // // // // // // // // // // //                 <TableCell>${employee.totalSales.toFixed(2)}</TableCell>
// // //   // // // // // // // // // // // // // // // // // // //                 <TableCell>{employee.transactions}</TableCell>
// // //   // // // // // // // // // // // // // // // // // // //               </TableRow>
// // //   // // // // // // // // // // // // // // // // // // //             ))}
// // //   // // // // // // // // // // // // // // // // // // //           </TableBody>
// // //   // // // // // // // // // // // // // // // // // // //         </Table>
// // //   // // // // // // // // // // // // // // // // // // //       </CardContent>
// // //   // // // // // // // // // // // // // // // // // // //     </Card>
// // //   // // // // // // // // // // // // // // // // // // //   );
// // //   // // // // // // // // // // // // // // // // // // // };

// // //   // // // // // // // // // // // // // // // // // // // export default EmployeeSales;
// // //   // // // // // // // // // // // // // // // // // // import React, { useEffect, useState } from 'react';
// // //   // // // // // // // // // // // // // // // // // // import { Card, CardContent } from './components/ui/Card';
// // //   // // // // // // // // // // // // // // // // // // import { Table, TableHead, TableRow, TableHeaderCell, TableBody, TableCell } from './components/ui/Table';
// // //   // // // // // // // // // // // // // // // // // // import { fetchEmployeeSales } from './api/sales';

// // //   // // // // // // // // // // // // // // // // // // const EmployeeSales = () => {
// // //   // // // // // // // // // // // // // // // // // //     const [salesData, setSalesData] = useState([]);
// // //   // // // // // // // // // // // // // // // // // //     const [loading, setLoading] = useState(true);
// // //   // // // // // // // // // // // // // // // // // //     const [error, setError] = useState(null);

// // //   // // // // // // // // // // // // // // // // // //     useEffect(() => {
// // //   // // // // // // // // // // // // // // // // // //         const getSalesData = async () => {
// // //   // // // // // // // // // // // // // // // // // //             try {
// // //   // // // // // // // // // // // // // // // // // //                 const data = await fetchEmployeeSales();
// // //   // // // // // // // // // // // // // // // // // //                 setSalesData(data);
// // //   // // // // // // // // // // // // // // // // // //             } catch (err) {
// // //   // // // // // // // // // // // // // // // // // //                 setError('Failed to fetch employee sales data.');
// // //   // // // // // // // // // // // // // // // // // //             } finally {
// // //   // // // // // // // // // // // // // // // // // //                 setLoading(false);
// // //   // // // // // // // // // // // // // // // // // //             }
// // //   // // // // // // // // // // // // // // // // // //         };

// // //   // // // // // // // // // // // // // // // // // //         getSalesData();
// // //   // // // // // // // // // // // // // // // // // //     }, []);

// // //   // // // // // // // // // // // // // // // // // //     if (loading) return <p>Loading...</p>;
// // //   // // // // // // // // // // // // // // // // // //     if (error) return <p>{error}</p>;

// // //   // // // // // // // // // // // // // // // // // //     return (
// // //   // // // // // // // // // // // // // // // // // //         <Card>
// // //   // // // // // // // // // // // // // // // // // //             <CardContent>
// // //   // // // // // // // // // // // // // // // // // //                 <h2 className="text-xl font-bold mb-4">Employee Sales</h2>
// // //   // // // // // // // // // // // // // // // // // //                 <Table>
// // //   // // // // // // // // // // // // // // // // // //                     <TableHead>
// // //   // // // // // // // // // // // // // // // // // //                         <TableRow>
// // //   // // // // // // // // // // // // // // // // // //                             <TableHeaderCell>Employee</TableHeaderCell>
// // //   // // // // // // // // // // // // // // // // // //                             <TableHeaderCell>Total Sales</TableHeaderCell>
// // //   // // // // // // // // // // // // // // // // // //                             <TableHeaderCell>Transactions</TableHeaderCell>
// // //   // // // // // // // // // // // // // // // // // //                         </TableRow>
// // //   // // // // // // // // // // // // // // // // // //                     </TableHead>
// // //   // // // // // // // // // // // // // // // // // //                     <TableBody>
// // //   // // // // // // // // // // // // // // // // // //                         {salesData.map((employee) => (
// // //   // // // // // // // // // // // // // // // // // //                             <TableRow key={employee.id}>
// // //   // // // // // // // // // // // // // // // // // //                                 <TableCell>{employee.name}</TableCell>
// // //   // // // // // // // // // // // // // // // // // //                                 <TableCell>${employee.totalSales.toFixed(2)}</TableCell>
// // //   // // // // // // // // // // // // // // // // // //                                 <TableCell>{employee.transactions}</TableCell>
// // //   // // // // // // // // // // // // // // // // // //                             </TableRow>
// // //   // // // // // // // // // // // // // // // // // //                         ))}
// // //   // // // // // // // // // // // // // // // // // //                     </TableBody>
// // //   // // // // // // // // // // // // // // // // // //                 </Table>
// // //   // // // // // // // // // // // // // // // // // //             </CardContent>
// // //   // // // // // // // // // // // // // // // // // //         </Card>
// // //   // // // // // // // // // // // // // // // // // //     );
// // //   // // // // // // // // // // // // // // // // // // };

// // //   // // // // // // // // // // // // // // // // // // export default EmployeeSales;

// // //   // // // // // // // // // // // // // // // // // import React, { useEffect, useState } from "react";
// // //   // // // // // // // // // // // // // // // // // import axios from "axios";
// // //   // // // // // // // // // // // // // // // // // import Card from "./components/ui/Card";
// // //   // // // // // // // // // // // // // // // // // import Table from "./components/ui/Table";

// // //   // // // // // // // // // // // // // // // // // const EmployeeSales = () => {
// // //   // // // // // // // // // // // // // // // // //   const [salesData, setSalesData] = useState([]);
// // //   // // // // // // // // // // // // // // // // //   const [loading, setLoading] = useState(true);
// // //   // // // // // // // // // // // // // // // // //   const [error, setError] = useState(null);

// // //   // // // // // // // // // // // // // // // // //   useEffect(() => {
// // //   // // // // // // // // // // // // // // // // //     fetchSalesData();
// // //   // // // // // // // // // // // // // // // // //   }, []);

// // //   // // // // // // // // // // // // // // // // //   const fetchSalesData = async () => {
// // //   // // // // // // // // // // // // // // // // //     try {
// // //   // // // // // // // // // // // // // // // // //       const response = await axios.get("/api/sales"); // Adjust API endpoint if necessary
// // //   // // // // // // // // // // // // // // // // //       const groupedSales = groupSalesByEmployee(response.data);
// // //   // // // // // // // // // // // // // // // // //       setSalesData(groupedSales);
// // //   // // // // // // // // // // // // // // // // //     } catch (err) {
// // //   // // // // // // // // // // // // // // // // //       setError("Failed to fetch sales data");
// // //   // // // // // // // // // // // // // // // // //     } finally {
// // //   // // // // // // // // // // // // // // // // //       setLoading(false);
// // //   // // // // // // // // // // // // // // // // //     }
// // //   // // // // // // // // // // // // // // // // //   };

// // //   // // // // // // // // // // // // // // // // //   const groupSalesByEmployee = (sales) => {
// // //   // // // // // // // // // // // // // // // // //     const salesByEmployee = {};
// // //   // // // // // // // // // // // // // // // // //     sales.forEach((sale) => {
// // //   // // // // // // // // // // // // // // // // //       const { userId, userName, totalAmount } = sale;
// // //   // // // // // // // // // // // // // // // // //       if (!salesByEmployee[userId]) {
// // //   // // // // // // // // // // // // // // // // //         salesByEmployee[userId] = {
// // //   // // // // // // // // // // // // // // // // //           userName,
// // //   // // // // // // // // // // // // // // // // //           totalSales: 0,
// // //   // // // // // // // // // // // // // // // // //         };
// // //   // // // // // // // // // // // // // // // // //       }
// // //   // // // // // // // // // // // // // // // // //       salesByEmployee[userId].totalSales += totalAmount;
// // //   // // // // // // // // // // // // // // // // //     });
// // //   // // // // // // // // // // // // // // // // //     return Object.values(salesByEmployee);
// // //   // // // // // // // // // // // // // // // // //   };

// // //   // // // // // // // // // // // // // // // // //   if (loading) return <p>Loading...</p>;
// // //   // // // // // // // // // // // // // // // // //   if (error) return <p>{error}</p>;

// // //   // // // // // // // // // // // // // // // // //   return (
// // //   // // // // // // // // // // // // // // // // //     <Card>
// // //   // // // // // // // // // // // // // // // // //       <h2>Employee Wise Sales</h2>
// // //   // // // // // // // // // // // // // // // // //       <Table>
// // //   // // // // // // // // // // // // // // // // //         <thead>
// // //   // // // // // // // // // // // // // // // // //           <tr>
// // //   // // // // // // // // // // // // // // // // //             <th>Employee</th>
// // //   // // // // // // // // // // // // // // // // //             <th>Total Sales</th>
// // //   // // // // // // // // // // // // // // // // //           </tr>
// // //   // // // // // // // // // // // // // // // // //         </thead>
// // //   // // // // // // // // // // // // // // // // //         <tbody>
// // //   // // // // // // // // // // // // // // // // //           {salesData.map((employee) => (
// // //   // // // // // // // // // // // // // // // // //             <tr key={employee.userName}>
// // //   // // // // // // // // // // // // // // // // //               <td>{employee.userName}</td>
// // //   // // // // // // // // // // // // // // // // //               <td>${employee.totalSales.toFixed(2)}</td>
// // //   // // // // // // // // // // // // // // // // //             </tr>
// // //   // // // // // // // // // // // // // // // // //           ))}
// // //   // // // // // // // // // // // // // // // // //         </tbody>
// // //   // // // // // // // // // // // // // // // // //       </Table>
// // //   // // // // // // // // // // // // // // // // //     </Card>
// // //   // // // // // // // // // // // // // // // // //   );
// // //   // // // // // // // // // // // // // // // // // };

// // //   // // // // // // // // // // // // // // // // // export default EmployeeSales;
// // //   // // // // // // // // // // // // // // // // import React, { useEffect, useState } from "react";
// // //   // // // // // // // // // // // // // // // // import axios from "axios";

// // //   // // // // // // // // // // // // // // // // const EmployeeSales = () => {
// // //   // // // // // // // // // // // // // // // //   const [salesData, setSalesData] = useState([]);
// // //   // // // // // // // // // // // // // // // //   const [loading, setLoading] = useState(true);
// // //   // // // // // // // // // // // // // // // //   const [error, setError] = useState(null);

// // //   // // // // // // // // // // // // // // // //   useEffect(() => {
// // //   // // // // // // // // // // // // // // // //     const fetchSalesData = async () => {
// // //   // // // // // // // // // // // // // // // //       try {
// // //   // // // // // // // // // // // // // // // //         const response = await axios.get("/api/sales"); // Adjust endpoint if needed
// // //   // // // // // // // // // // // // // // // //         setSalesData(response.data);
// // //   // // // // // // // // // // // // // // // //       } catch (error) {
// // //   // // // // // // // // // // // // // // // //         setError("Failed to fetch sales data");
// // //   // // // // // // // // // // // // // // // //       } finally {
// // //   // // // // // // // // // // // // // // // //         setLoading(false);
// // //   // // // // // // // // // // // // // // // //       }
// // //   // // // // // // // // // // // // // // // //     };

// // //   // // // // // // // // // // // // // // // //     fetchSalesData();
// // //   // // // // // // // // // // // // // // // //   }, []);

// // //   // // // // // // // // // // // // // // // //   const calculateEmployeeSales = () => {
// // //   // // // // // // // // // // // // // // // //     const employeeSales = {};
// // //   // // // // // // // // // // // // // // // //     salesData.forEach((sale) => {
// // //   // // // // // // // // // // // // // // // //       const { userId, userName, amount } = sale;
// // //   // // // // // // // // // // // // // // // //       if (!employeeSales[userId]) {
// // //   // // // // // // // // // // // // // // // //         employeeSales[userId] = { userName, totalSales: 0 };
// // //   // // // // // // // // // // // // // // // //       }
// // //   // // // // // // // // // // // // // // // //       employeeSales[userId].totalSales += amount;
// // //   // // // // // // // // // // // // // // // //     });
// // //   // // // // // // // // // // // // // // // //     return Object.values(employeeSales);
// // //   // // // // // // // // // // // // // // // //   };

// // //   // // // // // // // // // // // // // // // //   if (loading) return <p>Loading...</p>;
// // //   // // // // // // // // // // // // // // // //   if (error) return <p>{error}</p>;

// // //   // // // // // // // // // // // // // // // //   return (
// // //   // // // // // // // // // // // // // // // //     <div style={{ padding: "20px" }}>
// // //   // // // // // // // // // // // // // // // //       <h2>Employee Sales Report</h2>
// // //   // // // // // // // // // // // // // // // //       <table border="1" cellPadding="10" cellSpacing="0" style={{ width: "100%", textAlign: "left" }}>
// // //   // // // // // // // // // // // // // // // //         <thead>
// // //   // // // // // // // // // // // // // // // //           <tr>
// // //   // // // // // // // // // // // // // // // //             <th>Employee Name</th>
// // //   // // // // // // // // // // // // // // // //             <th>Total Sales</th>
// // //   // // // // // // // // // // // // // // // //           </tr>
// // //   // // // // // // // // // // // // // // // //         </thead>
// // //   // // // // // // // // // // // // // // // //         <tbody>
// // //   // // // // // // // // // // // // // // // //           {calculateEmployeeSales().map((employee) => (
// // //   // // // // // // // // // // // // // // // //             <tr key={employee.userName}>
// // //   // // // // // // // // // // // // // // // //               <td>{employee.userName}</td>
// // //   // // // // // // // // // // // // // // // //               <td>{employee.totalSales.toFixed(2)}</td>
// // //   // // // // // // // // // // // // // // // //             </tr>
// // //   // // // // // // // // // // // // // // // //           ))}
// // //   // // // // // // // // // // // // // // // //         </tbody>
// // //   // // // // // // // // // // // // // // // //       </table>
// // //   // // // // // // // // // // // // // // // //     </div>
// // //   // // // // // // // // // // // // // // // //   );
// // //   // // // // // // // // // // // // // // // // };

// // //   // // // // // // // // // // // // // // // // export default EmployeeSales;

// // //   // // // // // // // // // // // // // // // import React, { useState, useEffect } from "react";
// // //   // // // // // // // // // // // // // // // import axios from "axios";

// // //   // // // // // // // // // // // // // // // const EmployeeSales = () => {
// // //   // // // // // // // // // // // // // // //     const [employees, setEmployees] = useState([]);
// // //   // // // // // // // // // // // // // // //     const [selectedEmployee, setSelectedEmployee] = useState("");
// // //   // // // // // // // // // // // // // // //     const [salesData, setSalesData] = useState([]);

// // //   // // // // // // // // // // // // // // //     useEffect(() => {
// // //   // // // // // // // // // // // // // // //         axios.get("http://localhost:5017/api/employees")
// // //   // // // // // // // // // // // // // // //             .then(response => setEmployees(response.data))
// // //   // // // // // // // // // // // // // // //             .catch(error => console.error("Error fetching employees:", error));
// // //   // // // // // // // // // // // // // // //     }, []);

// // //   // // // // // // // // // // // // // // //     const fetchSales = () => {
// // //   // // // // // // // // // // // // // // //         if (!selectedEmployee) return;

// // //   // // // // // // // // // // // // // // //         axios.get(`http://localhost:5017/api/employeesales?userId=${selectedEmployee}`)
// // //   // // // // // // // // // // // // // // //             .then(response => setSalesData(response.data))
// // //   // // // // // // // // // // // // // // //             .catch(error => console.error("Error fetching sales data:", error));
// // //   // // // // // // // // // // // // // // //     };

// // //   // // // // // // // // // // // // // // //     return (
// // //   // // // // // // // // // // // // // // //         <div>
// // //   // // // // // // // // // // // // // // //             <h2>Employee Sales</h2>
// // //   // // // // // // // // // // // // // // //             <label>Select Employee:</label>
// // //   // // // // // // // // // // // // // // //             <select value={selectedEmployee} onChange={(e) => setSelectedEmployee(e.target.value)}>
// // //   // // // // // // // // // // // // // // //                 <option value="">Select</option>
// // //   // // // // // // // // // // // // // // //                 {employees.map(emp => (
// // //   // // // // // // // // // // // // // // //                     <option key={emp.id} value={emp.id}>
// // //   // // // // // // // // // // // // // // //                         {emp.firstName} {emp.lastName}
// // //   // // // // // // // // // // // // // // //                     </option>
// // //   // // // // // // // // // // // // // // //                 ))}
// // //   // // // // // // // // // // // // // // //             </select>
// // //   // // // // // // // // // // // // // // //             <button onClick={fetchSales}>Get Sales</button>

// // //   // // // // // // // // // // // // // // //             {salesData.length > 0 ? (
// // //   // // // // // // // // // // // // // // //                 <table border="1">
// // //   // // // // // // // // // // // // // // //                     <thead>
// // //   // // // // // // // // // // // // // // //                         <tr>
// // //   // // // // // // // // // // // // // // //                             <th>Date</th>
// // //   // // // // // // // // // // // // // // //                             <th>Product</th>
// // //   // // // // // // // // // // // // // // //                             <th>Quantity</th>
// // //   // // // // // // // // // // // // // // //                             <th>Total Price</th>
// // //   // // // // // // // // // // // // // // //                         </tr>
// // //   // // // // // // // // // // // // // // //                     </thead>
// // //   // // // // // // // // // // // // // // //                     <tbody>
// // //   // // // // // // // // // // // // // // //                         {salesData.map((sale, index) => (
// // //   // // // // // // // // // // // // // // //                             <tr key={index}>
// // //   // // // // // // // // // // // // // // //                                 <td>{sale.date}</td>
// // //   // // // // // // // // // // // // // // //                                 <td>{sale.products.map(p => p.name).join(", ")}</td>
// // //   // // // // // // // // // // // // // // //                                 <td>{sale.products.map(p => p.quantity).join(", ")}</td>
// // //   // // // // // // // // // // // // // // //                                 <td>{sale.total_amount}</td>
// // //   // // // // // // // // // // // // // // //                             </tr>
// // //   // // // // // // // // // // // // // // //                         ))}
// // //   // // // // // // // // // // // // // // //                     </tbody>
// // //   // // // // // // // // // // // // // // //                 </table>
// // //   // // // // // // // // // // // // // // //             ) : (
// // //   // // // // // // // // // // // // // // //                 <p>No sales data found.</p>
// // //   // // // // // // // // // // // // // // //             )}
// // //   // // // // // // // // // // // // // // //         </div>
// // //   // // // // // // // // // // // // // // //     );
// // //   // // // // // // // // // // // // // // // };

// // //   // // // // // // // // // // // // // // // export default EmployeeSales;
// // //   // // // // // // // // // // // // // // import React, { useState, useEffect } from "react";

// // //   // // // // // // // // // // // // // // const EmployeeSales = () => {
// // //   // // // // // // // // // // // // // //   const [employees, setEmployees] = useState([]);
// // //   // // // // // // // // // // // // // //   const [selectedEmployee, setSelectedEmployee] = useState("");
// // //   // // // // // // // // // // // // // //   const [sales, setSales] = useState([]);

// // //   // // // // // // // // // // // // // //   useEffect(() => {
// // //   // // // // // // // // // // // // // //     fetch("http://localhost:5000/api/employees")
// // //   // // // // // // // // // // // // // //       .then((res) => res.json())
// // //   // // // // // // // // // // // // // //       .then((data) => setEmployees(data))
// // //   // // // // // // // // // // // // // //       .catch((err) => console.error("Error fetching employees:", err));
// // //   // // // // // // // // // // // // // //   }, []);

// // //   // // // // // // // // // // // // // //   const fetchSales = () => {
// // //   // // // // // // // // // // // // // //     if (!selectedEmployee) return;

// // //   // // // // // // // // // // // // // //     fetch(`http://localhost:5000/api/employeesales?userId=${selectedEmployee}`)
// // //   // // // // // // // // // // // // // //       .then((res) => res.json())
// // //   // // // // // // // // // // // // // //       .then((data) => {
// // //   // // // // // // // // // // // // // //         if (data.message) {
// // //   // // // // // // // // // // // // // //           setSales([]);
// // //   // // // // // // // // // // // // // //         } else {
// // //   // // // // // // // // // // // // // //           setSales(data);
// // //   // // // // // // // // // // // // // //         }
// // //   // // // // // // // // // // // // // //       })
// // //   // // // // // // // // // // // // // //       .catch((err) => console.error("Error fetching sales:", err));
// // //   // // // // // // // // // // // // // //   };

// // //   // // // // // // // // // // // // // //   return (
// // //   // // // // // // // // // // // // // //     <div>
// // //   // // // // // // // // // // // // // //       <h2>Employee Sales</h2>
// // //   // // // // // // // // // // // // // //       <label>Select Employee:</label>
// // //   // // // // // // // // // // // // // //       <select onChange={(e) => setSelectedEmployee(e.target.value)}>
// // //   // // // // // // // // // // // // // //         <option value="">Select</option>
// // //   // // // // // // // // // // // // // //         {employees.map((emp) => (
// // //   // // // // // // // // // // // // // //           <option key={emp.id} value={emp.id}>
// // //   // // // // // // // // // // // // // //             {emp.firstName} {emp.lastName}
// // //   // // // // // // // // // // // // // //           </option>
// // //   // // // // // // // // // // // // // //         ))}
// // //   // // // // // // // // // // // // // //       </select>
// // //   // // // // // // // // // // // // // //       <button onClick={fetchSales}>Get Sales</button>

// // //   // // // // // // // // // // // // // //       {sales.length === 0 ? (
// // //   // // // // // // // // // // // // // //         <p>No sales data found.</p>
// // //   // // // // // // // // // // // // // //       ) : (
// // //   // // // // // // // // // // // // // //         <table>
// // //   // // // // // // // // // // // // // //           <thead>
// // //   // // // // // // // // // // // // // //             <tr>
// // //   // // // // // // // // // // // // // //               <th>Date</th>
// // //   // // // // // // // // // // // // // //               <th>Customer Name</th>
// // //   // // // // // // // // // // // // // //               <th>Products</th>
// // //   // // // // // // // // // // // // // //               <th>Total Amount</th>
// // //   // // // // // // // // // // // // // //             </tr>
// // //   // // // // // // // // // // // // // //           </thead>
// // //   // // // // // // // // // // // // // //           <tbody>
// // //   // // // // // // // // // // // // // //             {sales.map((sale, index) => (
// // //   // // // // // // // // // // // // // //               <tr key={index}>
// // //   // // // // // // // // // // // // // //                 <td>{sale.date}</td>
// // //   // // // // // // // // // // // // // //                 <td>{sale.customer_name}</td>
// // //   // // // // // // // // // // // // // //                 <td>
// // //   // // // // // // // // // // // // // //                   {sale.products.map((p, i) => (
// // //   // // // // // // // // // // // // // //                     <div key={i}>
// // //   // // // // // // // // // // // // // //                       {p.name} - {p.quantity} x ₹{p.unit_price} = ₹{p.total_price}
// // //   // // // // // // // // // // // // // //                     </div>
// // //   // // // // // // // // // // // // // //                   ))}
// // //   // // // // // // // // // // // // // //                 </td>
// // //   // // // // // // // // // // // // // //                 <td>₹{sale.total_amount}</td>
// // //   // // // // // // // // // // // // // //               </tr>
// // //   // // // // // // // // // // // // // //             ))}
// // //   // // // // // // // // // // // // // //           </tbody>
// // //   // // // // // // // // // // // // // //         </table>
// // //   // // // // // // // // // // // // // //       )}
// // //   // // // // // // // // // // // // // //     </div>
// // //   // // // // // // // // // // // // // //   );
// // //   // // // // // // // // // // // // // // };

// // //   // // // // // // // // // // // // // // export default EmployeeSales;
// // //   // // // // // // // // // // // // // import React, { useState, useEffect } from "react";

// // //   // // // // // // // // // // // // // const EmployeeSales = () => {
// // //   // // // // // // // // // // // // //   const [employees, setEmployees] = useState([]); // Ensure default is an array
// // //   // // // // // // // // // // // // //   const [selectedEmployee, setSelectedEmployee] = useState("");
// // //   // // // // // // // // // // // // //   const [sales, setSales] = useState([]);
// // //   // // // // // // // // // // // // //   const [loading, setLoading] = useState(false);
// // //   // // // // // // // // // // // // //   const [error, setError] = useState(null);

// // //   // // // // // // // // // // // // //   useEffect(() => {
// // //   // // // // // // // // // // // // //     fetch("http://localhost:5000/api/employees")
// // //   // // // // // // // // // // // // //       .then((res) => res.json())
// // //   // // // // // // // // // // // // //       .then((data) => {
// // //   // // // // // // // // // // // // //         if (Array.isArray(data)) {
// // //   // // // // // // // // // // // // //           setEmployees(data);
// // //   // // // // // // // // // // // // //         } else {
// // //   // // // // // // // // // // // // //           console.error("Unexpected response format:", data);
// // //   // // // // // // // // // // // // //           setEmployees([]); // Set an empty array if response is incorrect
// // //   // // // // // // // // // // // // //         }
// // //   // // // // // // // // // // // // //       })
// // //   // // // // // // // // // // // // //       .catch((err) => {
// // //   // // // // // // // // // // // // //         console.error("Error fetching employees:", err);
// // //   // // // // // // // // // // // // //         setEmployees([]); // Handle error case
// // //   // // // // // // // // // // // // //       });
// // //   // // // // // // // // // // // // //   }, []);

// // //   // // // // // // // // // // // // //   const fetchSales = () => {
// // //   // // // // // // // // // // // // //     if (!selectedEmployee) return;

// // //   // // // // // // // // // // // // //     setLoading(true);
// // //   // // // // // // // // // // // // //     fetch(`http://localhost:5000/api/employeesales?userId=${selectedEmployee}`)
// // //   // // // // // // // // // // // // //       .then((res) => res.json())
// // //   // // // // // // // // // // // // //       .then((data) => {
// // //   // // // // // // // // // // // // //         if (Array.isArray(data)) {
// // //   // // // // // // // // // // // // //           setSales(data);
// // //   // // // // // // // // // // // // //         } else {
// // //   // // // // // // // // // // // // //           setSales([]); // Handle cases where no sales are found
// // //   // // // // // // // // // // // // //         }
// // //   // // // // // // // // // // // // //         setLoading(false);
// // //   // // // // // // // // // // // // //       })
// // //   // // // // // // // // // // // // //       .catch((err) => {
// // //   // // // // // // // // // // // // //         console.error("Error fetching sales:", err);
// // //   // // // // // // // // // // // // //         setError("Failed to fetch sales data.");
// // //   // // // // // // // // // // // // //         setLoading(false);
// // //   // // // // // // // // // // // // //       });
// // //   // // // // // // // // // // // // //   };

// // //   // // // // // // // // // // // // //   return (
// // //   // // // // // // // // // // // // //     <div>
// // //   // // // // // // // // // // // // //       <h2>Employee Sales</h2>
// // //   // // // // // // // // // // // // //       <label>Select Employee:</label>
// // //   // // // // // // // // // // // // //       <select onChange={(e) => setSelectedEmployee(e.target.value)}>
// // //   // // // // // // // // // // // // //         <option value="">Select</option>
// // //   // // // // // // // // // // // // //         {employees.length > 0 ? (
// // //   // // // // // // // // // // // // //           employees.map((emp) => (
// // //   // // // // // // // // // // // // //             <option key={emp.id} value={emp.id}>
// // //   // // // // // // // // // // // // //               {emp.firstName} {emp.lastName}
// // //   // // // // // // // // // // // // //             </option>
// // //   // // // // // // // // // // // // //           ))
// // //   // // // // // // // // // // // // //         ) : (
// // //   // // // // // // // // // // // // //           <option disabled>Loading employees...</option>
// // //   // // // // // // // // // // // // //         )}
// // //   // // // // // // // // // // // // //       </select>
// // //   // // // // // // // // // // // // //       <button onClick={fetchSales} disabled={!selectedEmployee}>
// // //   // // // // // // // // // // // // //         Get Sales
// // //   // // // // // // // // // // // // //       </button>

// // //   // // // // // // // // // // // // //       {loading ? <p>Loading sales data...</p> : null}
// // //   // // // // // // // // // // // // //       {error ? <p style={{ color: "red" }}>{error}</p> : null}

// // //   // // // // // // // // // // // // //       {sales.length === 0 ? (
// // //   // // // // // // // // // // // // //         <p>No sales data found.</p>
// // //   // // // // // // // // // // // // //       ) : (
// // //   // // // // // // // // // // // // //         <table>
// // //   // // // // // // // // // // // // //           <thead>
// // //   // // // // // // // // // // // // //             <tr>
// // //   // // // // // // // // // // // // //               <th>Date</th>
// // //   // // // // // // // // // // // // //               <th>Customer Name</th>
// // //   // // // // // // // // // // // // //               <th>Products</th>
// // //   // // // // // // // // // // // // //               <th>Total Amount</th>
// // //   // // // // // // // // // // // // //             </tr>
// // //   // // // // // // // // // // // // //           </thead>
// // //   // // // // // // // // // // // // //           <tbody>
// // //   // // // // // // // // // // // // //             {sales.map((sale, index) => (
// // //   // // // // // // // // // // // // //               <tr key={index}>
// // //   // // // // // // // // // // // // //                 <td>{sale.date}</td>
// // //   // // // // // // // // // // // // //                 <td>{sale.customer_name || "N/A"}</td>
// // //   // // // // // // // // // // // // //                 <td>
// // //   // // // // // // // // // // // // //                   {sale.products.map((p, i) => (
// // //   // // // // // // // // // // // // //                     <div key={i}>
// // //   // // // // // // // // // // // // //                       {p.name} - {p.quantity} x ₹{p.unit_price} = ₹{p.total_price}
// // //   // // // // // // // // // // // // //                     </div>
// // //   // // // // // // // // // // // // //                   ))}
// // //   // // // // // // // // // // // // //                 </td>
// // //   // // // // // // // // // // // // //                 <td>₹{sale.total_amount}</td>
// // //   // // // // // // // // // // // // //               </tr>
// // //   // // // // // // // // // // // // //             ))}
// // //   // // // // // // // // // // // // //           </tbody>
// // //   // // // // // // // // // // // // //         </table>
// // //   // // // // // // // // // // // // //       )}
// // //   // // // // // // // // // // // // //     </div>
// // //   // // // // // // // // // // // // //   );
// // //   // // // // // // // // // // // // // };

// // //   // // // // // // // // // // // // // export default EmployeeSales;
// // //   // // // // // // // // // // // // import React, { useState, useEffect, useContext } from "react";
// // //   // // // // // // // // // // // // import { useStore } from "./StoreContext"; // Adjust the import path as needed
// // //   // // // // // // // // // // // // import axios from "axios";

// // //   // // // // // // // // // // // // const UserSales = () => {
// // //   // // // // // // // // // // // //   const { storeId, userId } = useStore();
// // //   // // // // // // // // // // // //   const [allSales, setAllSales] = useState([]); // Store all sales data
// // //   // // // // // // // // // // // //   const [userSales, setUserSales] = useState([]); // Store filtered sales for the user
// // //   // // // // // // // // // // // //   const [loading, setLoading] = useState(true);
// // //   // // // // // // // // // // // //   const [error, setError] = useState(null);

// // //   // // // // // // // // // // // //   useEffect(() => {
// // //   // // // // // // // // // // // //     if (!storeId) {
// // //   // // // // // // // // // // // //       setError("Store ID is missing.");
// // //   // // // // // // // // // // // //       setLoading(false);
// // //   // // // // // // // // // // // //       return;
// // //   // // // // // // // // // // // //     }

// // //   // // // // // // // // // // // //     // const fetchAllSales = async () => {
// // //   // // // // // // // // // // // //     //   try {
// // //   // // // // // // // // // // // //     //     const response = await axios.get(`/api/daily-sales`, {
// // //   // // // // // // // // // // // //     //       params: {
// // //   // // // // // // // // // // // //     //         storeId: storeId, // Fetch all sales for the store
// // //   // // // // // // // // // // // //     //       },
// // //   // // // // // // // // // // // //     //     });

// // //   // // // // // // // // // // // //     //     if (response.data && response.data.length > 0) {
// // //   // // // // // // // // // // // //     //       setAllSales(response.data); // Store all sales data
// // //   // // // // // // // // // // // //     //     } else {
// // //   // // // // // // // // // // // //     //       setError("No sales data found for this store.");
// // //   // // // // // // // // // // // //     //     }
// // //   // // // // // // // // // // // //     //   } catch (err) {
// // //   // // // // // // // // // // // //     //     setError("Failed to fetch sales data.");
// // //   // // // // // // // // // // // //     //     console.error(err);
// // //   // // // // // // // // // // // //     //   } finally {
// // //   // // // // // // // // // // // //     //     setLoading(false);
// // //   // // // // // // // // // // // //     //   }
// // //   // // // // // // // // // // // //     // };
// // //   // // // // // // // // // // // //     const fetchAllSales = async () => {
// // //   // // // // // // // // // // // //         try {
// // //   // // // // // // // // // // // //           const response = await axios.get(`http://localhost:5010/api/daily-sales`, {
// // //   // // // // // // // // // // // //             params: {
// // //   // // // // // // // // // // // //               storeId: storeId, // Fetch all sales for the store
// // //   // // // // // // // // // // // //             },
// // //   // // // // // // // // // // // //           });
        
// // //   // // // // // // // // // // // //           if (response.data && response.data.length > 0) {
// // //   // // // // // // // // // // // //             setAllSales(response.data); // Store all sales data
// // //   // // // // // // // // // // // //           } else {
// // //   // // // // // // // // // // // //             setError("No sales data found for this store.");
// // //   // // // // // // // // // // // //           }
// // //   // // // // // // // // // // // //         } catch (err) {
// // //   // // // // // // // // // // // //           setError("Failed to fetch sales data.");
// // //   // // // // // // // // // // // //           console.error(err);
// // //   // // // // // // // // // // // //         } finally {
// // //   // // // // // // // // // // // //           setLoading(false);
// // //   // // // // // // // // // // // //         }
// // //   // // // // // // // // // // // //       };

// // //   // // // // // // // // // // // //     fetchAllSales();
// // //   // // // // // // // // // // // //   }, [storeId]);

// // //   // // // // // // // // // // // //   // Filter sales data by userId whenever allSales or userId changes
// // //   // // // // // // // // // // // //   useEffect(() => {
// // //   // // // // // // // // // // // //     if (userId && allSales.length > 0) {
// // //   // // // // // // // // // // // //       const filteredSales = allSales.filter((sale) => sale.user_id === userId); // Assuming each sale has a `user_id` field
// // //   // // // // // // // // // // // //       setUserSales(filteredSales);
// // //   // // // // // // // // // // // //     }
// // //   // // // // // // // // // // // //   }, [userId, allSales]);

// // //   // // // // // // // // // // // //   if (loading) {
// // //   // // // // // // // // // // // //     return <div>Loading...</div>;
// // //   // // // // // // // // // // // //   }

// // //   // // // // // // // // // // // //   if (error) {
// // //   // // // // // // // // // // // //     return <div>{error}</div>;
// // //   // // // // // // // // // // // //   }

// // //   // // // // // // // // // // // //   return (
// // //   // // // // // // // // // // // //     <div>
// // //   // // // // // // // // // // // //       <h2>User Sales</h2>
// // //   // // // // // // // // // // // //       {userSales.length > 0 ? (
// // //   // // // // // // // // // // // //         <table>
// // //   // // // // // // // // // // // //           <thead>
// // //   // // // // // // // // // // // //             <tr>
// // //   // // // // // // // // // // // //               <th>Sale ID</th>
// // //   // // // // // // // // // // // //               <th>Total Amount</th>
// // //   // // // // // // // // // // // //               <th>Date</th>
// // //   // // // // // // // // // // // //               <th>Products</th>
// // //   // // // // // // // // // // // //             </tr>
// // //   // // // // // // // // // // // //           </thead>
// // //   // // // // // // // // // // // //           <tbody>
// // //   // // // // // // // // // // // //             {userSales.map((sale) => (
// // //   // // // // // // // // // // // //               <tr key={sale._id}>
// // //   // // // // // // // // // // // //                 <td>{sale._id}</td>
// // //   // // // // // // // // // // // //                 <td>{sale.total_amount}</td>
// // //   // // // // // // // // // // // //                 <td>{sale.date}</td>
// // //   // // // // // // // // // // // //                 <td>
// // //   // // // // // // // // // // // //                   <ul>
// // //   // // // // // // // // // // // //                     {sale.products.map((product, index) => (
// // //   // // // // // // // // // // // //                       <li key={index}>
// // //   // // // // // // // // // // // //                         {product.name} - {product.quantity} x {product.price}
// // //   // // // // // // // // // // // //                       </li>
// // //   // // // // // // // // // // // //                     ))}
// // //   // // // // // // // // // // // //                   </ul>
// // //   // // // // // // // // // // // //                 </td>
// // //   // // // // // // // // // // // //               </tr>
// // //   // // // // // // // // // // // //             ))}
// // //   // // // // // // // // // // // //           </tbody>
// // //   // // // // // // // // // // // //         </table>
// // //   // // // // // // // // // // // //       ) : (
// // //   // // // // // // // // // // // //         <p>No sales data available for this user.</p>
// // //   // // // // // // // // // // // //       )}
// // //   // // // // // // // // // // // //     </div>
// // //   // // // // // // // // // // // //   );
// // //   // // // // // // // // // // // // };

// // //   // // // // // // // // // // // // export default UserSales;
// // //   // // // // // // // // // // // import React, { useState, useEffect, useContext } from "react";
// // //   // // // // // // // // // // // import { useStore } from "./StoreContext"; // Adjust the import path as needed
// // //   // // // // // // // // // // // import axios from "axios";

// // //   // // // // // // // // // // // const UserSales = () => {
// // //   // // // // // // // // // // //   const { storeId, userId } = useStore();
// // //   // // // // // // // // // // //   const [allSales, setAllSales] = useState([]); // Store all sales data
// // //   // // // // // // // // // // //   const [userSales, setUserSales] = useState([]); // Store filtered sales for the user
// // //   // // // // // // // // // // //   const [loading, setLoading] = useState(true);
// // //   // // // // // // // // // // //   const [error, setError] = useState(null);

// // //   // // // // // // // // // // //   useEffect(() => {
// // //   // // // // // // // // // // //     if (!storeId) {
// // //   // // // // // // // // // // //       setError("Store ID is missing.");
// // //   // // // // // // // // // // //       setLoading(false);
// // //   // // // // // // // // // // //       return;
// // //   // // // // // // // // // // //     }

// // //   // // // // // // // // // // //     const fetchAllSales = async () => {
// // //   // // // // // // // // // // //       try {
// // //   // // // // // // // // // // //         const response = await axios.get(`http://localhost:5010/api/daily-sales`, {
// // //   // // // // // // // // // // //           params: {
// // //   // // // // // // // // // // //             storeId: storeId, // Fetch all sales for the store
// // //   // // // // // // // // // // //           },
// // //   // // // // // // // // // // //         });

// // //   // // // // // // // // // // //         if (response.data && response.data.length > 0) {
// // //   // // // // // // // // // // //           setAllSales(response.data); // Store all sales data
// // //   // // // // // // // // // // //         } else {
// // //   // // // // // // // // // // //           setError("No sales data found for this store.");
// // //   // // // // // // // // // // //         }
// // //   // // // // // // // // // // //       } catch (err) {
// // //   // // // // // // // // // // //         setError("Failed to fetch sales data.");
// // //   // // // // // // // // // // //         console.error(err);
// // //   // // // // // // // // // // //       } finally {
// // //   // // // // // // // // // // //         setLoading(false);
// // //   // // // // // // // // // // //       }
// // //   // // // // // // // // // // //     };

// // //   // // // // // // // // // // //     fetchAllSales();
// // //   // // // // // // // // // // //   }, [storeId]);

// // //   // // // // // // // // // // //   // Filter sales data by userId whenever allSales or userId changes
// // //   // // // // // // // // // // //   useEffect(() => {
// // //   // // // // // // // // // // //     if (userId && allSales.length > 0) {
// // //   // // // // // // // // // // //       const filteredSales = allSales.filter((sale) => sale.user_id === userId); // Assuming each sale has a `user_id` field
// // //   // // // // // // // // // // //       setUserSales(filteredSales);
// // //   // // // // // // // // // // //     }
// // //   // // // // // // // // // // //   }, [userId, allSales]);

// // //   // // // // // // // // // // //   if (loading) {
// // //   // // // // // // // // // // //     return <div>Loading...</div>;
// // //   // // // // // // // // // // //   }

// // //   // // // // // // // // // // //   if (error) {
// // //   // // // // // // // // // // //     return <div>{error}</div>;
// // //   // // // // // // // // // // //   }

// // //   // // // // // // // // // // //   return (
// // //   // // // // // // // // // // //     <div>
// // //   // // // // // // // // // // //       <h2>User Sales</h2>
// // //   // // // // // // // // // // //       {userSales.length > 0 ? (
// // //   // // // // // // // // // // //         <table>
// // //   // // // // // // // // // // //           <thead>
// // //   // // // // // // // // // // //             <tr>
// // //   // // // // // // // // // // //               <th>Sale ID</th>
// // //   // // // // // // // // // // //               <th>Total Amount</th>
// // //   // // // // // // // // // // //               <th>Date</th>
// // //   // // // // // // // // // // //               <th>Products</th>
// // //   // // // // // // // // // // //               <th>User ID</th> {/* Add a column for User ID */}
// // //   // // // // // // // // // // //             </tr>
// // //   // // // // // // // // // // //           </thead>
// // //   // // // // // // // // // // //           <tbody>
// // //   // // // // // // // // // // //             {userSales.map((sale) => (
// // //   // // // // // // // // // // //               <tr key={sale._id}>
// // //   // // // // // // // // // // //                 <td>{sale._id}</td>
// // //   // // // // // // // // // // //                 <td>{sale.total_amount}</td>
// // //   // // // // // // // // // // //                 <td>{sale.date}</td>
// // //   // // // // // // // // // // //                 <td>
// // //   // // // // // // // // // // //                   <ul>
// // //   // // // // // // // // // // //                     {sale.products.map((product, index) => (
// // //   // // // // // // // // // // //                       <li key={index}>
// // //   // // // // // // // // // // //                         {product.name} - {product.quantity} x {product.price}
// // //   // // // // // // // // // // //                       </li>
// // //   // // // // // // // // // // //                     ))}
// // //   // // // // // // // // // // //                   </ul>
// // //   // // // // // // // // // // //                 </td>
// // //   // // // // // // // // // // //                 <td>
// // //   // // // // // // // // // // //                   {/* Highlight the user_id if it matches the current userId */}
// // //   // // // // // // // // // // //                   <span
// // //   // // // // // // // // // // //                     style={{
// // //   // // // // // // // // // // //                       fontWeight: sale.user_id === userId ? "bold" : "normal",
// // //   // // // // // // // // // // //                       backgroundColor: sale.user_id === userId ? "yellow" : "transparent",
// // //   // // // // // // // // // // //                       padding: "2px 5px",
// // //   // // // // // // // // // // //                       borderRadius: "3px",
// // //   // // // // // // // // // // //                     }}
// // //   // // // // // // // // // // //                   >
// // //   // // // // // // // // // // //                     {sale.user_id}
// // //   // // // // // // // // // // //                   </span>
// // //   // // // // // // // // // // //                 </td>
// // //   // // // // // // // // // // //               </tr>
// // //   // // // // // // // // // // //             ))}
// // //   // // // // // // // // // // //           </tbody>
// // //   // // // // // // // // // // //         </table>
// // //   // // // // // // // // // // //       ) : (
// // //   // // // // // // // // // // //         <p>No sales data available for this user.</p>
// // //   // // // // // // // // // // //       )}
// // //   // // // // // // // // // // //     </div>
// // //   // // // // // // // // // // //   );
// // //   // // // // // // // // // // // };

// // //   // // // // // // // // // // // export default UserSales;

// // //   // // // // // // // // // // import React, { useState, useEffect, useContext } from "react";
// // //   // // // // // // // // // // import { useStore } from "./StoreContext"; // Adjust the import path as needed
// // //   // // // // // // // // // // import axios from "axios";

// // //   // // // // // // // // // // const UserSales = () => {
// // //   // // // // // // // // // //   const { storeId } = useStore();
// // //   // // // // // // // // // //   const [allSales, setAllSales] = useState([]); // Store all sales data
// // //   // // // // // // // // // //   const [users, setUsers] = useState([]); // Store all users data
// // //   // // // // // // // // // //   const [loading, setLoading] = useState(true);
// // //   // // // // // // // // // //   const [error, setError] = useState(null);

// // //   // // // // // // // // // //   useEffect(() => {
// // //   // // // // // // // // // //     if (!storeId) {
// // //   // // // // // // // // // //       setError("Store ID is missing.");
// // //   // // // // // // // // // //       setLoading(false);
// // //   // // // // // // // // // //       return;
// // //   // // // // // // // // // //     }

// // //   // // // // // // // // // //     const fetchData = async () => {
// // //   // // // // // // // // // //       try {
// // //   // // // // // // // // // //         // Fetch all sales data
// // //   // // // // // // // // // //         const salesResponse = await axios.get(`http://localhost:5010/api/daily-sales`, {
// // //   // // // // // // // // // //           params: {
// // //   // // // // // // // // // //             storeId: storeId, // Fetch all sales for the store
// // //   // // // // // // // // // //           },
// // //   // // // // // // // // // //         });

// // //   // // // // // // // // // //         // Fetch all users data
// // //   // // // // // // // // // //         const usersResponse = await axios.get(`http://localhost:5010/api/users`, {
// // //   // // // // // // // // // //           params: {
// // //   // // // // // // // // // //             storeId: storeId, // Fetch all users for the store
// // //   // // // // // // // // // //           },
// // //   // // // // // // // // // //         });

// // //   // // // // // // // // // //         if (salesResponse.data && usersResponse.data) {
// // //   // // // // // // // // // //           setAllSales(salesResponse.data); // Store all sales data
// // //   // // // // // // // // // //           setUsers(usersResponse.data); // Store all users data
// // //   // // // // // // // // // //         } else {
// // //   // // // // // // // // // //           setError("No data found for this store.");
// // //   // // // // // // // // // //         }
// // //   // // // // // // // // // //       } catch (err) {
// // //   // // // // // // // // // //         setError("Failed to fetch data.");
// // //   // // // // // // // // // //         console.error(err);
// // //   // // // // // // // // // //       } finally {
// // //   // // // // // // // // // //         setLoading(false);
// // //   // // // // // // // // // //       }
// // //   // // // // // // // // // //     };

// // //   // // // // // // // // // //     fetchData();
// // //   // // // // // // // // // //   }, [storeId]);

// // //   // // // // // // // // // //   // Function to get user details by user_id
// // //   // // // // // // // // // //   const getUserDetails = (userId) => {
// // //   // // // // // // // // // //     const user = users.find((user) => user._id === userId);
// // //   // // // // // // // // // //     return user ? user.name : "Unknown User"; // Return the user's name or a fallback
// // //   // // // // // // // // // //   };

// // //   // // // // // // // // // //   if (loading) {
// // //   // // // // // // // // // //     return <div>Loading...</div>;
// // //   // // // // // // // // // //   }

// // //   // // // // // // // // // //   if (error) {
// // //   // // // // // // // // // //     return <div>{error}</div>;
// // //   // // // // // // // // // //   }

// // //   // // // // // // // // // //   return (
// // //   // // // // // // // // // //     <div>
// // //   // // // // // // // // // //       <h2>User Sales</h2>
// // //   // // // // // // // // // //       {allSales.length > 0 ? (
// // //   // // // // // // // // // //         <table>
// // //   // // // // // // // // // //           <thead>
// // //   // // // // // // // // // //             <tr>
// // //   // // // // // // // // // //               <th>Sale ID</th>
// // //   // // // // // // // // // //               <th>Total Amount</th>
// // //   // // // // // // // // // //               <th>Date</th>
// // //   // // // // // // // // // //               <th>Products</th>
// // //   // // // // // // // // // //               <th>User</th> {/* Column for the user who made the sale */}
// // //   // // // // // // // // // //             </tr>
// // //   // // // // // // // // // //           </thead>
// // //   // // // // // // // // // //           <tbody>
// // //   // // // // // // // // // //             {allSales.map((sale) => (
// // //   // // // // // // // // // //               <tr key={sale._id}>
// // //   // // // // // // // // // //                 <td>{sale._id}</td>
// // //   // // // // // // // // // //                 <td>{sale.total_amount}</td>
// // //   // // // // // // // // // //                 <td>{sale.date}</td>
// // //   // // // // // // // // // //                 <td>
// // //   // // // // // // // // // //                   <ul>
// // //   // // // // // // // // // //                     {sale.products.map((product, index) => (
// // //   // // // // // // // // // //                       <li key={index}>
// // //   // // // // // // // // // //                         {product.name} - {product.quantity} x {product.price}
// // //   // // // // // // // // // //                       </li>
// // //   // // // // // // // // // //                     ))}
// // //   // // // // // // // // // //                   </ul>
// // //   // // // // // // // // // //                 </td>
// // //   // // // // // // // // // //                 <td>
// // //   // // // // // // // // // //                   {/* Display the user's name or ID */}
// // //   // // // // // // // // // //                   <span
// // //   // // // // // // // // // //                     style={{
// // //   // // // // // // // // // //                       fontWeight: "bold",
// // //   // // // // // // // // // //                       color: "blue",
// // //   // // // // // // // // // //                     }}
// // //   // // // // // // // // // //                   >
// // //   // // // // // // // // // //                     {getUserDetails(sale.user_id)} (ID: {sale.user_id})
// // //   // // // // // // // // // //                   </span>
// // //   // // // // // // // // // //                 </td>
// // //   // // // // // // // // // //               </tr>
// // //   // // // // // // // // // //             ))}
// // //   // // // // // // // // // //           </tbody>
// // //   // // // // // // // // // //         </table>
// // //   // // // // // // // // // //       ) : (
// // //   // // // // // // // // // //         <p>No sales data available.</p>
// // //   // // // // // // // // // //       )}
// // //   // // // // // // // // // //     </div>
// // //   // // // // // // // // // //   );
// // //   // // // // // // // // // // };

// // //   // // // // // // // // // // export default UserSales;

// // //   // // // // // // // // // // import React, { useState, useEffect, useContext } from "react";
// // //   // // // // // // // // // // import { useStore } from "./StoreContext"; // Adjust the import path as needed
// // //   // // // // // // // // // // import axios from "axios";

// // //   // // // // // // // // // // const UserSales = () => {
// // //   // // // // // // // // // //   const { storeId } = useStore();
// // //   // // // // // // // // // //   const [allSales, setAllSales] = useState([]); // Store all sales data
// // //   // // // // // // // // // //   const [users, setUsers] = useState([]); // Store all users data
// // //   // // // // // // // // // //   const [loading, setLoading] = useState(true);
// // //   // // // // // // // // // //   const [error, setError] = useState(null);

// // //   // // // // // // // // // //   useEffect(() => {
// // //   // // // // // // // // // //     if (!storeId) {
// // //   // // // // // // // // // //       setError("Store ID is missing.");
// // //   // // // // // // // // // //       setLoading(false);
// // //   // // // // // // // // // //       return;
// // //   // // // // // // // // // //     }

// // //   // // // // // // // // // //     const fetchData = async () => {
// // //   // // // // // // // // // //       try {
// // //   // // // // // // // // // //         // Fetch all sales data
// // //   // // // // // // // // // //         const salesResponse = await axios.get(`http://localhost:5010/api/daily-sales`, {
// // //   // // // // // // // // // //           params: {
// // //   // // // // // // // // // //             storeId: storeId, // Fetch all sales for the store
// // //   // // // // // // // // // //           },
// // //   // // // // // // // // // //         });

// // //   // // // // // // // // // //         // Fetch all users data
// // //   // // // // // // // // // //         const usersResponse = await axios.get(`http://localhost:5010/api/users`, {
// // //   // // // // // // // // // //           params: {
// // //   // // // // // // // // // //             storeId: storeId, // Fetch all users for the store
// // //   // // // // // // // // // //           },
// // //   // // // // // // // // // //         });

// // //   // // // // // // // // // //         if (salesResponse.data && usersResponse.data) {
// // //   // // // // // // // // // //           setAllSales(salesResponse.data); // Store all sales data
// // //   // // // // // // // // // //           setUsers(usersResponse.data); // Store all users data
// // //   // // // // // // // // // //         } else {
// // //   // // // // // // // // // //           setError("No data found for this store.");
// // //   // // // // // // // // // //         }
// // //   // // // // // // // // // //       } catch (err) {
// // //   // // // // // // // // // //         setError("Failed to fetch data.");
// // //   // // // // // // // // // //         console.error(err);
// // //   // // // // // // // // // //       } finally {
// // //   // // // // // // // // // //         setLoading(false);
// // //   // // // // // // // // // //       }
// // //   // // // // // // // // // //     };

// // //   // // // // // // // // // //     fetchData();
// // //   // // // // // // // // // //   }, [storeId]);

// // //   // // // // // // // // // //   // Function to get user details by user_id
// // //   // // // // // // // // // // //   const getUserDetails = (userId) => {
// // //   // // // // // // // // // // //     const user = users.find((user) => user._id === userId);
// // //   // // // // // // // // // // //     return user; // Return the entire user object
// // //   // // // // // // // // // // //   };
// // //   // // // // // // // // // // // Function to get user details by user_id
// // //   // // // // // // // // // // const getUserDetails = (userId) => {
// // //   // // // // // // // // // //     const user = users.find((user) => user._id === userId);
// // //   // // // // // // // // // //     return user; // Return the entire user object
// // //   // // // // // // // // // //   };

// // //   // // // // // // // // // //   if (loading) {
// // //   // // // // // // // // // //     return <div>Loading...</div>;
// // //   // // // // // // // // // //   }

// // //   // // // // // // // // // //   if (error) {
// // //   // // // // // // // // // //     return <div>{error}</div>;
// // //   // // // // // // // // // //   }

// // //   // // // // // // // // // //   return (
// // //   // // // // // // // // // //     <div>
// // //   // // // // // // // // // //       <h2>User Sales</h2>
// // //   // // // // // // // // // //       {allSales.length > 0 ? (
// // //   // // // // // // // // // //         <table>
// // //   // // // // // // // // // //           <thead>
// // //   // // // // // // // // // //             <tr>
// // //   // // // // // // // // // //               <th>Sale ID</th>
// // //   // // // // // // // // // //               <th>Total Amount</th>
// // //   // // // // // // // // // //               <th>Date</th>
// // //   // // // // // // // // // //               <th>Products</th>
// // //   // // // // // // // // // //               <th>User Name</th>
// // //   // // // // // // // // // //               <th>User Role</th>
// // //   // // // // // // // // // //               <th>User Email</th>
// // //   // // // // // // // // // //             </tr>
// // //   // // // // // // // // // //           </thead>
// // //   // // // // // // // // // //           <tbody>
// // //   // // // // // // // // // //             {allSales.map((sale) => {
// // //   // // // // // // // // // //               const user = getUserDetails(sale.user_id); // Get user details for this sale
// // //   // // // // // // // // // //               return (
// // //   // // // // // // // // // //                 <tr key={sale._id}>
// // //   // // // // // // // // // //                   <td>{sale._id}</td>
// // //   // // // // // // // // // //                   <td>{sale.total_amount}</td>
// // //   // // // // // // // // // //                   <td>{sale.date}</td>
// // //   // // // // // // // // // //                   <td>
// // //   // // // // // // // // // //                     <ul>
// // //   // // // // // // // // // //                       {sale.products.map((product, index) => (
// // //   // // // // // // // // // //                         <li key={index}>
// // //   // // // // // // // // // //                           {product.name} - {product.quantity} x {product.price}
// // //   // // // // // // // // // //                         </li>
// // //   // // // // // // // // // //                       ))}
// // //   // // // // // // // // // //                     </ul>
// // //   // // // // // // // // // //                   </td>
// // //   // // // // // // // // // //                   <td>
// // //   // // // // // // // // // //                     {/* Display user's name */}
// // //   // // // // // // // // // //                     <span style={{ fontWeight: "bold", color: "blue" }}>
// // //   // // // // // // // // // //                       {user ? `${user.firstName} ${user.lastName}` : "Unknown User"}
// // //   // // // // // // // // // //                     </span>
// // //   // // // // // // // // // //                   </td>
// // //   // // // // // // // // // //                   <td>
// // //   // // // // // // // // // //                     {/* Display user's role */}
// // //   // // // // // // // // // //                     <span style={{ color: "green" }}>
// // //   // // // // // // // // // //                       {user ? user.role : "N/A"}
// // //   // // // // // // // // // //                     </span>
// // //   // // // // // // // // // //                   </td>
// // //   // // // // // // // // // //                   <td>
// // //   // // // // // // // // // //                     {/* Display user's email */}
// // //   // // // // // // // // // //                     <span style={{ color: "purple" }}>
// // //   // // // // // // // // // //                       {user ? user.email : "N/A"}
// // //   // // // // // // // // // //                     </span>
// // //   // // // // // // // // // //                   </td>
// // //   // // // // // // // // // //                 </tr>
// // //   // // // // // // // // // //               );
// // //   // // // // // // // // // //             })}
// // //   // // // // // // // // // //           </tbody>
// // //   // // // // // // // // // //         </table>
// // //   // // // // // // // // // //       ) : (
// // //   // // // // // // // // // //         <p>No sales data available.</p>
// // //   // // // // // // // // // //       )}
// // //   // // // // // // // // // //     </div>
// // //   // // // // // // // // // //   );
// // //   // // // // // // // // // // };

// // //   // // // // // // // // // // export default UserSales;\\
// // //   // // // // // // // // // import React, { useState, useEffect, useContext } from "react";
// // //   // // // // // // // // // import { useStore } from "./StoreContext"; // Adjust the import path as needed
// // //   // // // // // // // // // import axios from "axios";

// // //   // // // // // // // // // const UserSales = () => {
// // //   // // // // // // // // //   const { storeId } = useStore();
// // //   // // // // // // // // //   const [allSales, setAllSales] = useState([]); // Store all sales data
// // //   // // // // // // // // //   const [users, setUsers] = useState([]); // Store all users data
// // //   // // // // // // // // //   const [loading, setLoading] = useState(true);
// // //   // // // // // // // // //   const [error, setError] = useState(null);

// // //   // // // // // // // // //   useEffect(() => {
// // //   // // // // // // // // //     if (!storeId) {
// // //   // // // // // // // // //       setError("Store ID is missing.");
// // //   // // // // // // // // //       setLoading(false);
// // //   // // // // // // // // //       return;
// // //   // // // // // // // // //     }

// // //   // // // // // // // // //     const fetchData = async () => {
// // //   // // // // // // // // //       try {
// // //   // // // // // // // // //         // Fetch all sales data
// // //   // // // // // // // // //         const salesResponse = await axios.get(`http://localhost:5010/api/daily-sales`, {
// // //   // // // // // // // // //           params: {
// // //   // // // // // // // // //             storeId: storeId, // Fetch all sales for the store
// // //   // // // // // // // // //           },
// // //   // // // // // // // // //         });

// // //   // // // // // // // // //         // Fetch all users data
// // //   // // // // // // // // //         const usersResponse = await axios.get(`http://localhost:5010/api/users`, {
// // //   // // // // // // // // //           params: {
// // //   // // // // // // // // //             storeId: storeId, // Fetch all users for the store
// // //   // // // // // // // // //           },
// // //   // // // // // // // // //         });

// // //   // // // // // // // // //         if (salesResponse.data && usersResponse.data) {
// // //   // // // // // // // // //           setAllSales(salesResponse.data); // Store all sales data
// // //   // // // // // // // // //           setUsers(usersResponse.data); // Store all users data
// // //   // // // // // // // // //         } else {
// // //   // // // // // // // // //           setError("No data found for this store.");
// // //   // // // // // // // // //         }
// // //   // // // // // // // // //       } catch (err) {
// // //   // // // // // // // // //         setError("Failed to fetch data.");
// // //   // // // // // // // // //         console.error(err);
// // //   // // // // // // // // //       } finally {
// // //   // // // // // // // // //         setLoading(false);
// // //   // // // // // // // // //       }
// // //   // // // // // // // // //     };

// // //   // // // // // // // // //     fetchData();
// // //   // // // // // // // // //   }, [storeId]);

// // //   // // // // // // // // //   // Function to get user details by user_id
// // //   // // // // // // // // //   const getUserDetails = (userId) => {
// // //   // // // // // // // // //     const user = users.find((user) => user._id === userId);
// // //   // // // // // // // // //     return user; // Return the entire user object
// // //   // // // // // // // // //   };

// // //   // // // // // // // // //   // Log data for debugging
// // //   // // // // // // // // //   useEffect(() => {
// // //   // // // // // // // // //     if (allSales.length > 0 && users.length > 0) {
// // //   // // // // // // // // //       console.log("All Sales:", allSales);
// // //   // // // // // // // // //       console.log("All Users:", users);

// // //   // // // // // // // // //       allSales.forEach((sale) => {
// // //   // // // // // // // // //         const user = getUserDetails(sale.user_id);
// // //   // // // // // // // // //         console.log(`Sale ID: ${sale._id}, User ID: ${sale.user_id}, User Details:`, user);
// // //   // // // // // // // // //       });
// // //   // // // // // // // // //     }
// // //   // // // // // // // // //   }, [allSales, users]);

// // //   // // // // // // // // //   if (loading) {
// // //   // // // // // // // // //     return <div>Loading...</div>;
// // //   // // // // // // // // //   }

// // //   // // // // // // // // //   if (error) {
// // //   // // // // // // // // //     return <div>{error}</div>;
// // //   // // // // // // // // //   }

// // //   // // // // // // // // //   return (
// // //   // // // // // // // // //     <div>
// // //   // // // // // // // // //       <h2>User Sales</h2>
// // //   // // // // // // // // //       {allSales.length > 0 ? (
// // //   // // // // // // // // //         <table>
// // //   // // // // // // // // //           <thead>
// // //   // // // // // // // // //             <tr>
// // //   // // // // // // // // //               <th>Sale ID</th>
// // //   // // // // // // // // //               <th>Total Amount</th>
// // //   // // // // // // // // //               <th>Date</th>
// // //   // // // // // // // // //               <th>Products</th>
// // //   // // // // // // // // //               <th>User Name</th>
// // //   // // // // // // // // //               <th>User Role</th>
// // //   // // // // // // // // //               <th>User Email</th>
// // //   // // // // // // // // //             </tr>
// // //   // // // // // // // // //           </thead>
// // //   // // // // // // // // //           <tbody>
// // //   // // // // // // // // //             {allSales.map((sale) => {
// // //   // // // // // // // // //               const user = getUserDetails(sale.user_id); // Get user details for this sale
// // //   // // // // // // // // //               return (
// // //   // // // // // // // // //                 <tr key={sale._id}>
// // //   // // // // // // // // //                   <td>{sale._id}</td>
// // //   // // // // // // // // //                   <td>{sale.total_amount}</td>
// // //   // // // // // // // // //                   <td>{sale.date}</td>
// // //   // // // // // // // // //                   <td>
// // //   // // // // // // // // //                     <ul>
// // //   // // // // // // // // //                       {sale.products.map((product, index) => (
// // //   // // // // // // // // //                         <li key={index}>
// // //   // // // // // // // // //                           {product.name} - {product.quantity} x {product.price}
// // //   // // // // // // // // //                         </li>
// // //   // // // // // // // // //                       ))}
// // //   // // // // // // // // //                     </ul>
// // //   // // // // // // // // //                   </td>
// // //   // // // // // // // // //                   <td>
// // //   // // // // // // // // //                     {/* Display user's name */}
// // //   // // // // // // // // //                     <span style={{ fontWeight: "bold", color: "blue" }}>
// // //   // // // // // // // // //                       {user ? `${user.firstName} ${user.lastName}` : "Unknown User"}
// // //   // // // // // // // // //                     </span>
// // //   // // // // // // // // //                   </td>
// // //   // // // // // // // // //                   <td>
// // //   // // // // // // // // //                     {/* Display user's role */}
// // //   // // // // // // // // //                     <span style={{ color: "green" }}>
// // //   // // // // // // // // //                       {user ? user.role : "N/A"}
// // //   // // // // // // // // //                     </span>
// // //   // // // // // // // // //                   </td>
// // //   // // // // // // // // //                   <td>
// // //   // // // // // // // // //                     {/* Display user's email */}
// // //   // // // // // // // // //                     <span style={{ color: "purple" }}>
// // //   // // // // // // // // //                       {user ? user.email : "N/A"}
// // //   // // // // // // // // //                     </span>
// // //   // // // // // // // // //                   </td>
// // //   // // // // // // // // //                 </tr>
// // //   // // // // // // // // //               );
// // //   // // // // // // // // //             })}
// // //   // // // // // // // // //           </tbody>
// // //   // // // // // // // // //         </table>
// // //   // // // // // // // // //       ) : (
// // //   // // // // // // // // //         <p>No sales data available.</p>
// // //   // // // // // // // // //       )}
// // //   // // // // // // // // //     </div>
// // //   // // // // // // // // //   );
// // //   // // // // // // // // // };

// // //   // // // // // // // // // export default UserSales;

// // //   // // // // // // // // import React, { useState, useEffect, useContext } from "react";
// // //   // // // // // // // // import { useStore } from "./StoreContext"; // Adjust the import path as needed
// // //   // // // // // // // // import axios from "axios";

// // //   // // // // // // // // const UserSales = () => {
// // //   // // // // // // // //   const { storeId } = useStore();
// // //   // // // // // // // //   const [allSales, setAllSales] = useState([]); // Store all sales data
// // //   // // // // // // // //   const [users, setUsers] = useState([]); // Store all users data
// // //   // // // // // // // //   const [loading, setLoading] = useState(true);
// // //   // // // // // // // //   const [error, setError] = useState(null);

// // //   // // // // // // // //   useEffect(() => {
// // //   // // // // // // // //     if (!storeId) {
// // //   // // // // // // // //       setError("Store ID is missing.");
// // //   // // // // // // // //       setLoading(false);
// // //   // // // // // // // //       return;
// // //   // // // // // // // //     }

// // //   // // // // // // // //     const fetchData = async () => {
// // //   // // // // // // // //       try {
// // //   // // // // // // // //         // Fetch all sales data
// // //   // // // // // // // //         const salesResponse = await axios.get(`http://localhost:5010/api/daily-sales`, {
// // //   // // // // // // // //           params: {
// // //   // // // // // // // //             storeId: storeId, // Fetch all sales for the store
// // //   // // // // // // // //           },
// // //   // // // // // // // //         });

// // //   // // // // // // // //         // Fetch all users data
// // //   // // // // // // // //         const usersResponse = await axios.get(`http://localhost:5010/api/users`, {
// // //   // // // // // // // //           params: {
// // //   // // // // // // // //             storeId: storeId, // Fetch all users for the store
// // //   // // // // // // // //           },
// // //   // // // // // // // //         });

// // //   // // // // // // // //         if (salesResponse.data && usersResponse.data) {
// // //   // // // // // // // //           setAllSales(salesResponse.data); // Store all sales data
// // //   // // // // // // // //           setUsers(usersResponse.data); // Store all users data
// // //   // // // // // // // //         } else {
// // //   // // // // // // // //           setError("No data found for this store.");
// // //   // // // // // // // //         }
// // //   // // // // // // // //       } catch (err) {
// // //   // // // // // // // //         setError("Failed to fetch data.");
// // //   // // // // // // // //         console.error(err);
// // //   // // // // // // // //       } finally {
// // //   // // // // // // // //         setLoading(false);
// // //   // // // // // // // //       }
// // //   // // // // // // // //     };

// // //   // // // // // // // //     fetchData();
// // //   // // // // // // // //   }, [storeId]);

// // //   // // // // // // // //   // Function to get user details by user_id
// // //   // // // // // // // //   const getUserDetails = (userId) => {
// // //   // // // // // // // //     const user = users.find((user) => user.id === userId); // Match user_id with id field
// // //   // // // // // // // //     return user; // Return the entire user object
// // //   // // // // // // // //   };

// // //   // // // // // // // //   // Log data for debugging
// // //   // // // // // // // //   useEffect(() => {
// // //   // // // // // // // //     if (allSales.length > 0 && users.length > 0) {
// // //   // // // // // // // //       console.log("All Sales:", allSales);
// // //   // // // // // // // //       console.log("All Users:", users);

// // //   // // // // // // // //       allSales.forEach((sale) => {
// // //   // // // // // // // //         const user = getUserDetails(sale.user_id);
// // //   // // // // // // // //         console.log(`Sale ID: ${sale._id}, User ID: ${sale.user_id}, User Details:`, user);
// // //   // // // // // // // //       });
// // //   // // // // // // // //     }
// // //   // // // // // // // //   }, [allSales, users]);

// // //   // // // // // // // //   if (loading) {
// // //   // // // // // // // //     return <div>Loading...</div>;
// // //   // // // // // // // //   }

// // //   // // // // // // // //   if (error) {
// // //   // // // // // // // //     return <div>{error}</div>;
// // //   // // // // // // // //   }

// // //   // // // // // // // //   return (
// // //   // // // // // // // //     <div>
// // //   // // // // // // // //       <h2>User Sales</h2>
// // //   // // // // // // // //       {allSales.length > 0 ? (
// // //   // // // // // // // //         <table>
// // //   // // // // // // // //           <thead>
// // //   // // // // // // // //             <tr>
// // //   // // // // // // // //               <th>Sale ID</th>
// // //   // // // // // // // //               <th>Total Amount</th>
// // //   // // // // // // // //               <th>Date</th>
// // //   // // // // // // // //               <th>Products</th>
// // //   // // // // // // // //               <th>User Name</th>
// // //   // // // // // // // //               <th>User Role</th>
// // //   // // // // // // // //               <th>User Email</th>
// // //   // // // // // // // //             </tr>
// // //   // // // // // // // //           </thead>
// // //   // // // // // // // //           <tbody>
// // //   // // // // // // // //             {allSales.map((sale) => {
// // //   // // // // // // // //               const user = getUserDetails(sale.user_id); // Get user details for this sale
// // //   // // // // // // // //               return (
// // //   // // // // // // // //                 <tr key={sale._id}>
// // //   // // // // // // // //                   <td>{sale._id}</td>
// // //   // // // // // // // //                   <td>{sale.total_amount}</td>
// // //   // // // // // // // //                   <td>{sale.date}</td>
// // //   // // // // // // // //                   <td>
// // //   // // // // // // // //                     <ul>
// // //   // // // // // // // //                       {sale.products.map((product, index) => (
// // //   // // // // // // // //                         <li key={index}>
// // //   // // // // // // // //                           {product.name} - {product.quantity} x {product.unit_price}
// // //   // // // // // // // //                         </li>
// // //   // // // // // // // //                       ))}
// // //   // // // // // // // //                     </ul>
// // //   // // // // // // // //                   </td>
// // //   // // // // // // // //                   <td>
// // //   // // // // // // // //                     {/* Display user's name */}
// // //   // // // // // // // //                     <span style={{ fontWeight: "bold", color: "blue" }}>
// // //   // // // // // // // //                       {user ? `${user.firstName} ${user.lastName}` : "Unknown User"}
// // //   // // // // // // // //                     </span>
// // //   // // // // // // // //                   </td>
// // //   // // // // // // // //                   <td>
// // //   // // // // // // // //                     {/* Display user's role */}
// // //   // // // // // // // //                     <span style={{ color: "green" }}>
// // //   // // // // // // // //                       {user ? user.role : "N/A"}
// // //   // // // // // // // //                     </span>
// // //   // // // // // // // //                   </td>
// // //   // // // // // // // //                   <td>
// // //   // // // // // // // //                     {/* Display user's email */}
// // //   // // // // // // // //                     <span style={{ color: "purple" }}>
// // //   // // // // // // // //                       {user ? user.email : "N/A"}
// // //   // // // // // // // //                     </span>
// // //   // // // // // // // //                   </td>
// // //   // // // // // // // //                 </tr>
// // //   // // // // // // // //               );
// // //   // // // // // // // //             })}
// // //   // // // // // // // //           </tbody>
// // //   // // // // // // // //         </table>
// // //   // // // // // // // //       ) : (
// // //   // // // // // // // //         <p>No sales data available.</p>
// // //   // // // // // // // //       )}
// // //   // // // // // // // //     </div>
// // //   // // // // // // // //   );
// // //   // // // // // // // // };

// // //   // // // // // // // // export default UserSales;


// // //   // // // // // // import React, { useState, useEffect, useContext } from "react";
// // //   // // // // // // import { useStore } from "./StoreContext"; // Adjust the import path as needed
// // //   // // // // // // import axios from "axios";

// // //   // // // // // // const UserSales = () => {
// // //   // // // // // //   const { storeId } = useStore();
// // //   // // // // // //   const [allSales, setAllSales] = useState([]); // Store all sales data
// // //   // // // // // //   const [users, setUsers] = useState([]); // Store all users data
// // //   // // // // // //   const [loading, setLoading] = useState(true);
// // //   // // // // // //   const [error, setError] = useState(null);

// // //   // // // // // //   useEffect(() => {
// // //   // // // // // //     if (!storeId) {
// // //   // // // // // //       setError("Store ID is missing.");
// // //   // // // // // //       setLoading(false);
// // //   // // // // // //       return;
// // //   // // // // // //     }

// // //   // // // // // //     const fetchData = async () => {
// // //   // // // // // //       try {
// // //   // // // // // //         // Fetch all sales data
// // //   // // // // // //         const salesResponse = await axios.get(`http://localhost:5010/api/daily-sales`, {
// // //   // // // // // //           params: {
// // //   // // // // // //             storeId: storeId, // Fetch all sales for the store
// // //   // // // // // //           },
// // //   // // // // // //         });

// // //   // // // // // //         // Fetch all users data
// // //   // // // // // //         const usersResponse = await axios.get(`http://localhost:5010/api/users`, {
// // //   // // // // // //           params: {
// // //   // // // // // //             storeId: storeId, // Fetch all users for the store
// // //   // // // // // //           },
// // //   // // // // // //         });

// // //   // // // // // //         if (salesResponse.data && usersResponse.data) {
// // //   // // // // // //           setAllSales(salesResponse.data); // Store all sales data
// // //   // // // // // //           setUsers(usersResponse.data); // Store all users data
// // //   // // // // // //         } else {
// // //   // // // // // //           setError("No data found for this store.");
// // //   // // // // // //         }
// // //   // // // // // //       } catch (err) {
// // //   // // // // // //         setError("Failed to fetch data.");
// // //   // // // // // //         console.error(err);
// // //   // // // // // //       } finally {
// // //   // // // // // //         setLoading(false);
// // //   // // // // // //       }
// // //   // // // // // //     };

// // //   // // // // // //     fetchData();
// // //   // // // // // //   }, [storeId]);

// // //   // // // // // //   // Function to get user details by user_id
// // //   // // // // // //   const getUserDetails = (userId) => {
// // //   // // // // // //     const user = users.find((user) => user.id === userId); // Match user_id with id field
// // //   // // // // // //     return user; // Return the entire user object
// // //   // // // // // //   };

// // //   // // // // // //   // Log data for debugging
// // //   // // // // // //   useEffect(() => {
// // //   // // // // // //     if (allSales.length > 0 && users.length > 0) {
// // //   // // // // // //       console.log("All Sales:", allSales);
// // //   // // // // // //       console.log("All Users:", users);

// // //   // // // // // //       allSales.forEach((sale) => {
// // //   // // // // // //         const user = getUserDetails(sale.user_id);
// // //   // // // // // //         console.log(`Sale ID: ${sale._id}, User ID: ${sale.user_id}, User Details:`, user);
// // //   // // // // // //       });
// // //   // // // // // //     }
// // //   // // // // // //   }, [allSales, users]);

// // //   // // // // // //   if (loading) {
// // //   // // // // // //     return <div>Loading...</div>;
// // //   // // // // // //   }

// // //   // // // // // //   if (error) {
// // //   // // // // // //     return <div>{error}</div>;
// // //   // // // // // //   }

// // //   // // // // // //   return (
// // //   // // // // // //     <div>
// // //   // // // // // //       <h2>User Sales</h2>
// // //   // // // // // //       {allSales.length > 0 ? (
// // //   // // // // // //         <table>
// // //   // // // // // //           <thead>
// // //   // // // // // //             <tr>
// // //   // // // // // //               <th>Sale ID</th>
// // //   // // // // // //               <th>Total Amount</th>
// // //   // // // // // //               <th>Date</th>
// // //   // // // // // //               <th>Products</th>
// // //   // // // // // //               <th>User ID</th> {/* Display User ID instead of User Name */}
// // //   // // // // // //               <th>User Role</th>
// // //   // // // // // //               <th>User Email</th>
// // //   // // // // // //             </tr>
// // //   // // // // // //           </thead>
// // //   // // // // // //           <tbody>
// // //   // // // // // //             {allSales.map((sale) => {
// // //   // // // // // //               const user = getUserDetails(sale.user_id); // Get user details for this sale
// // //   // // // // // //               return (
// // //   // // // // // //                 <tr key={sale._id}>
// // //   // // // // // //                   <td>{sale._id}</td>
// // //   // // // // // //                   <td>{sale.total_amount}</td>
// // //   // // // // // //                   <td>{sale.date}</td>
// // //   // // // // // //                   <td>
// // //   // // // // // //                     <ul>
// // //   // // // // // //                       {sale.products.map((product, index) => (
// // //   // // // // // //                         <li key={index}>
// // //   // // // // // //                           {product.name} - {product.quantity} x {product.unit_price}
// // //   // // // // // //                         </li>
// // //   // // // // // //                       ))}
// // //   // // // // // //                     </ul>
// // //   // // // // // //                   </td>
// // //   // // // // // //                   <td>
// // //   // // // // // //                     {/* Display user ID */}
// // //   // // // // // //                     <span style={{ fontWeight: "bold", color: "blue" }}>
// // //   // // // // // //                       {sale.user_id} {/* Directly display the user_id from the sale */}
// // //   // // // // // //                     </span>
// // //   // // // // // //                   </td>
// // //   // // // // // //                   <td>
// // //   // // // // // //                     {/* Display user's role */}
// // //   // // // // // //                     <span style={{ color: "green" }}>
// // //   // // // // // //                       {user ? user.role : "N/A"}
// // //   // // // // // //                     </span>
// // //   // // // // // //                   </td>
// // //   // // // // // //                   <td>
// // //   // // // // // //                     {/* Display user's email */}
// // //   // // // // // //                     <span style={{ color: "purple" }}>
// // //   // // // // // //                       {user ? user.email : "N/A"}
// // //   // // // // // //                     </span>
// // //   // // // // // //                   </td>
// // //   // // // // // //                 </tr>
// // //   // // // // // //               );
// // //   // // // // // //             })}
// // //   // // // // // //           </tbody>
// // //   // // // // // //         </table>
// // //   // // // // // //       ) : (
// // //   // // // // // //         <p>No sales data available.</p>
// // //   // // // // // //       )}
// // //   // // // // // //     </div>
// // //   // // // // // //   );
// // //   // // // // // // };

// // //   // // // // // // export default UserSales;

// // //   // // // // // // // import React, { useState, useEffect } from "react";
// // //   // // // // // // // import { useStore } from "./StoreContext";
// // //   // // // // // // // import axios from "axios";
// // //   // // // // // // // import { Motion, spring } from "react-motion";
// // //   // // // // // // // import { format } from "date-fns";
// // //   // // // // // // // import {
// // //   // // // // // // //   Table,
// // //   // // // // // // //   TableBody,
// // //   // // // // // // //   TableCell,
// // //   // // // // // // //   TableHead,
// // //   // // // // // // //   TableHeader,
// // //   // // // // // // //   TableRow,
// // //   // // // // // // // } from "@/components/ui/table";
// // //   // // // // // // // import {
// // //   // // // // // // //   Card,
// // //   // // // // // // //   CardContent,
// // //   // // // // // // //   CardDescription,
// // //   // // // // // // //   CardHeader,
// // //   // // // // // // //   CardTitle,
// // //   // // // // // // // } from "@/components/ui/card";
// // //   // // // // // // // import {
// // //   // // // // // // //   Select,
// // //   // // // // // // //   SelectContent,
// // //   // // // // // // //   SelectItem,
// // //   // // // // // // //   SelectTrigger,
// // //   // // // // // // //   SelectValue,
// // //   // // // // // // // } from "@/components/ui/select";
// // //   // // // // // // // import { Badge } from "@/components/ui/badge";
// // //   // // // // // // // import { Skeleton } from "@/components/ui/skeleton";
// // //   // // // // // // // import { Tabs, TabsContent, TabsList, TabsTrigger } from "@/components/ui/tabs";
// // //   // // // // // // // import { PieChart, Pie, Cell, ResponsiveContainer, Tooltip, Legend, BarChart, Bar, XAxis, YAxis, CartesianGrid } from "recharts";
// // //   // // // // // // // import { Users, ShoppingCart, DollarSign, TrendingUp, ChevronDown, ChevronUp } from "lucide-react";

// // //   // // // // // // // const COLORS = ["#0088FE", "#00C49F", "#FFBB28", "#FF8042", "#8884d8"];

// // //   // // // // // // // const UserSales = () => {
// // //   // // // // // // //   const { storeId } = useStore();
// // //   // // // // // // //   const [allSales, setAllSales] = useState([]);
// // //   // // // // // // //   const [users, setUsers] = useState([]);
// // //   // // // // // // //   const [loading, setLoading] = useState(true);
// // //   // // // // // // //   const [error, setError] = useState(null);
// // //   // // // // // // //   const [filter, setFilter] = useState("all");
// // //   // // // // // // //   const [expandedSale, setExpandedSale] = useState(null);
// // //   // // // // // // //   const [sortConfig, setSortConfig] = useState({ key: "date", direction: "desc" });
// // //   // // // // // // //   const [activeTab, setActiveTab] = useState("table");
// // //   // // // // // // //   const [searchQuery, setSearchQuery] = useState("");

// // //   // // // // // // //   useEffect(() => {
// // //   // // // // // // //     if (!storeId) {
// // //   // // // // // // //       setError("Store ID is missing.");
// // //   // // // // // // //       setLoading(false);
// // //   // // // // // // //       return;
// // //   // // // // // // //     }

// // //   // // // // // // //     const fetchData = async () => {
// // //   // // // // // // //       try {
// // //   // // // // // // //         setLoading(true);
          
// // //   // // // // // // //         // Simulate loading delay for animation
// // //   // // // // // // //         await new Promise(resolve => setTimeout(resolve, 800));
          
// // //   // // // // // // //         // Fetch all sales data
// // //   // // // // // // //         const salesResponse = await axios.get(`http://localhost:5010/api/daily-sales`, {
// // //   // // // // // // //           params: { storeId },
// // //   // // // // // // //         });

// // //   // // // // // // //         // Fetch all users data
// // //   // // // // // // //         const usersResponse = await axios.get(`http://localhost:5010/api/users`, {
// // //   // // // // // // //           params: { storeId },
// // //   // // // // // // //         });

// // //   // // // // // // //         if (salesResponse.data && usersResponse.data) {
// // //   // // // // // // //           // Assuming date is stored as string, convert to Date objects for sorting
// // //   // // // // // // //           const formattedSales = salesResponse.data.map(sale => ({
// // //   // // // // // // //             ...sale,
// // //   // // // // // // //             dateObj: new Date(sale.date)
// // //   // // // // // // //           }));
            
// // //   // // // // // // //           setAllSales(formattedSales);
// // //   // // // // // // //           setUsers(usersResponse.data);
// // //   // // // // // // //         } else {
// // //   // // // // // // //           setError("No data found for this store.");
// // //   // // // // // // //         }
// // //   // // // // // // //       } catch (err) {
// // //   // // // // // // //         setError("Failed to fetch data. Please try again later.");
// // //   // // // // // // //         console.error(err);
// // //   // // // // // // //       } finally {
// // //   // // // // // // //         setLoading(false);
// // //   // // // // // // //       }
// // //   // // // // // // //     };

// // //   // // // // // // //     fetchData();
// // //   // // // // // // //   }, [storeId]);

// // //   // // // // // // //   // Function to get user details by user_id
// // //   // // // // // // //   const getUserDetails = (userId) => {
// // //   // // // // // // //     return users.find((user) => user.id === userId);
// // //   // // // // // // //   };

// // //   // // // // // // //   // Sort function
// // //   // // // // // // //   const sortedSales = React.useMemo(() => {
// // //   // // // // // // //     const sortableSales = [...allSales];
      
// // //   // // // // // // //     if (sortConfig.key) {
// // //   // // // // // // //       sortableSales.sort((a, b) => {
// // //   // // // // // // //         if (sortConfig.key === 'date') {
// // //   // // // // // // //           // Sort by date
// // //   // // // // // // //           const aValue = a.dateObj || new Date(a.date);
// // //   // // // // // // //           const bValue = b.dateObj || new Date(b.date);
            
// // //   // // // // // // //           if (sortConfig.direction === 'asc') {
// // //   // // // // // // //             return aValue - bValue;
// // //   // // // // // // //           } else {
// // //   // // // // // // //             return bValue - aValue;
// // //   // // // // // // //           }
// // //   // // // // // // //         } else if (sortConfig.key === 'total_amount') {
// // //   // // // // // // //           // Sort by total amount
// // //   // // // // // // //           return sortConfig.direction === 'asc' 
// // //   // // // // // // //             ? a.total_amount - b.total_amount
// // //   // // // // // // //             : b.total_amount - a.total_amount;
// // //   // // // // // // //         } else {
// // //   // // // // // // //           // Default string comparison for other fields
// // //   // // // // // // //           const aValue = a[sortConfig.key] || '';
// // //   // // // // // // //           const bValue = b[sortConfig.key] || '';
            
// // //   // // // // // // //           if (sortConfig.direction === 'asc') {
// // //   // // // // // // //             return aValue.localeCompare(bValue);
// // //   // // // // // // //           } else {
// // //   // // // // // // //             return bValue.localeCompare(aValue);
// // //   // // // // // // //           }
// // //   // // // // // // //         }
// // //   // // // // // // //       });
// // //   // // // // // // //     }
      
// // //   // // // // // // //     // Filter sales
// // //   // // // // // // //     if (filter !== "all") {
// // //   // // // // // // //       return sortableSales.filter(sale => {
// // //   // // // // // // //         const user = getUserDetails(sale.user_id);
// // //   // // // // // // //         return user && user.role === filter;
// // //   // // // // // // //       });
// // //   // // // // // // //     }
      
// // //   // // // // // // //     // Apply search
// // //   // // // // // // //     if (searchQuery) {
// // //   // // // // // // //       return sortableSales.filter(sale => {
// // //   // // // // // // //         const user = getUserDetails(sale.user_id);
// // //   // // // // // // //         const searchLower = searchQuery.toLowerCase();
          
// // //   // // // // // // //         // Search in sale ID
// // //   // // // // // // //         if (sale._id.toLowerCase().includes(searchLower)) return true;
          
// // //   // // // // // // //         // Search in user details
// // //   // // // // // // //         if (user && (
// // //   // // // // // // //           user.email.toLowerCase().includes(searchLower) ||
// // //   // // // // // // //           user.role.toLowerCase().includes(searchLower)
// // //   // // // // // // //         )) return true;
          
// // //   // // // // // // //         // Search in products
// // //   // // // // // // //         if (sale.products.some(product => 
// // //   // // // // // // //           product.name.toLowerCase().includes(searchLower)
// // //   // // // // // // //         )) return true;
          
// // //   // // // // // // //         return false;
// // //   // // // // // // //       });
// // //   // // // // // // //     }
      
// // //   // // // // // // //     return sortableSales;
// // //   // // // // // // //   }, [allSales, sortConfig, filter, searchQuery, users]);

// // //   // // // // // // //   // Request sort
// // //   // // // // // // //   const requestSort = (key) => {
// // //   // // // // // // //     let direction = 'asc';
// // //   // // // // // // //     if (sortConfig.key === key && sortConfig.direction === 'asc') {
// // //   // // // // // // //       direction = 'desc';
// // //   // // // // // // //     }
// // //   // // // // // // //     setSortConfig({ key, direction });
// // //   // // // // // // //   };

// // //   // // // // // // //   // Get sort indicator
// // //   // // // // // // //   const getSortIndicator = (key) => {
// // //   // // // // // // //     if (sortConfig.key !== key) return null;
// // //   // // // // // // //     return sortConfig.direction === 'asc' ? <ChevronUp className="inline h-4 w-4" /> : <ChevronDown className="inline h-4 w-4" />;
// // //   // // // // // // //   };

// // //   // // // // // // //   // Toggle expanded row
// // //   // // // // // // //   const toggleExpandedSale = (saleId) => {
// // //   // // // // // // //     setExpandedSale(expandedSale === saleId ? null : saleId);
// // //   // // // // // // //   };

// // //   // // // // // // //   // Analytics data preparation
// // //   // // // // // // //   const prepareSalesByRole = () => {
// // //   // // // // // // //     const roleData = {};
      
// // //   // // // // // // //     allSales.forEach(sale => {
// // //   // // // // // // //       const user = getUserDetails(sale.user_id);
// // //   // // // // // // //       if (user) {
// // //   // // // // // // //         const role = user.role;
// // //   // // // // // // //         if (!roleData[role]) {
// // //   // // // // // // //           roleData[role] = {
// // //   // // // // // // //             count: 0,
// // //   // // // // // // //             total: 0
// // //   // // // // // // //           };
// // //   // // // // // // //         }
// // //   // // // // // // //         roleData[role].count++;
// // //   // // // // // // //         roleData[role].total += parseFloat(sale.total_amount);
// // //   // // // // // // //       }
// // //   // // // // // // //     });
      
// // //   // // // // // // //     return Object.keys(roleData).map(role => ({
// // //   // // // // // // //       name: role,
// // //   // // // // // // //       count: roleData[role].count,
// // //   // // // // // // //       total: roleData[role].total.toFixed(2)
// // //   // // // // // // //     }));
// // //   // // // // // // //   };
    
// // //   // // // // // // //   const prepareSalesByDate = () => {
// // //   // // // // // // //     const dateMap = {};
      
// // //   // // // // // // //     allSales.forEach(sale => {
// // //   // // // // // // //       // Format the date to group by day
// // //   // // // // // // //       const dateKey = sale.date.substring(0, 10);
        
// // //   // // // // // // //       if (!dateMap[dateKey]) {
// // //   // // // // // // //         dateMap[dateKey] = {
// // //   // // // // // // //           date: dateKey,
// // //   // // // // // // //           total: 0,
// // //   // // // // // // //           count: 0
// // //   // // // // // // //         };
// // //   // // // // // // //       }
        
// // //   // // // // // // //       dateMap[dateKey].total += parseFloat(sale.total_amount);
// // //   // // // // // // //       dateMap[dateKey].count++;
// // //   // // // // // // //     });
      
// // //   // // // // // // //     return Object.values(dateMap)
// // //   // // // // // // //       .sort((a, b) => new Date(a.date) - new Date(b.date))
// // //   // // // // // // //       .slice(-7); // Last 7 days
// // //   // // // // // // //   };

// // //   // // // // // // //   const salesByRole = prepareSalesByRole();
// // //   // // // // // // //   const salesByDate = prepareSalesByDate();
    
// // //   // // // // // // //   // Calculate total sales and average
// // //   // // // // // // //   const totalSalesAmount = allSales.reduce((sum, sale) => sum + parseFloat(sale.total_amount), 0);
// // //   // // // // // // //   const averageSale = allSales.length > 0 ? totalSalesAmount / allSales.length : 0;

// // //   // // // // // // //   if (error) {
// // //   // // // // // // //     return (
// // //   // // // // // // //       <Card className="w-full shadow-md">
// // //   // // // // // // //         <CardContent className="pt-6">
// // //   // // // // // // //           <div className="flex items-center justify-center h-40 bg-red-50 rounded-md">
// // //   // // // // // // //             <div className="text-center">
// // //   // // // // // // //               <h3 className="text-xl font-semibold text-red-600 mb-2">Error</h3>
// // //   // // // // // // //               <p className="text-gray-600">{error}</p>
// // //   // // // // // // //             </div>
// // //   // // // // // // //           </div>
// // //   // // // // // // //         </CardContent>
// // //   // // // // // // //       </Card>
// // //   // // // // // // //     );
// // //   // // // // // // //   }

// // //   // // // // // // //   return (
// // //   // // // // // // //     <Card className="w-full shadow-lg animate-fadeIn">
// // //   // // // // // // //       <CardHeader className="bg-gradient-to-r from-indigo-50 to-blue-50">
// // //   // // // // // // //         <div className="flex justify-between items-center">
// // //   // // // // // // //           <div>
// // //   // // // // // // //             <CardTitle className="text-2xl font-bold text-gray-800">
// // //   // // // // // // //               <ShoppingCart className="inline mr-2 h-6 w-6 text-blue-600" />
// // //   // // // // // // //               Sales Dashboard
// // //   // // // // // // //             </CardTitle>
// // //   // // // // // // //             <CardDescription className="text-gray-600">
// // //   // // // // // // //               Comprehensive overview of all sales transactions
// // //   // // // // // // //             </CardDescription>
// // //   // // // // // // //           </div>
// // //   // // // // // // //           <div className="space-x-2">
// // //   // // // // // // //             <Select value={filter} onValueChange={setFilter}>
// // //   // // // // // // //               <SelectTrigger className="w-[180px] border-blue-200 focus:ring-blue-500">
// // //   // // // // // // //                 <SelectValue placeholder="Filter by role" />
// // //   // // // // // // //               </SelectTrigger>
// // //   // // // // // // //               <SelectContent>
// // //   // // // // // // //                 <SelectItem value="all">All Roles</SelectItem>
// // //   // // // // // // //                 {Array.from(new Set(users.map(user => user.role))).map(role => (
// // //   // // // // // // //                   <SelectItem key={role} value={role}>{role}</SelectItem>
// // //   // // // // // // //                 ))}
// // //   // // // // // // //               </SelectContent>
// // //   // // // // // // //             </Select>
// // //   // // // // // // //           </div>
// // //   // // // // // // //         </div>
// // //   // // // // // // //       </CardHeader>

// // //   // // // // // // //       <div className="p-4 grid grid-cols-1 md:grid-cols-3 gap-4">
// // //   // // // // // // //         <Card className="bg-blue-50 shadow-md hover:shadow-lg transition-shadow duration-300">
// // //   // // // // // // //           <CardContent className="p-6">
// // //   // // // // // // //             <div className="flex items-center space-x-4">
// // //   // // // // // // //               <div className="bg-blue-500 p-3 rounded-full">
// // //   // // // // // // //                 <ShoppingCart className="h-6 w-6 text-white" />
// // //   // // // // // // //               </div>
// // //   // // // // // // //               <div>
// // //   // // // // // // //                 <p className="text-sm font-medium text-gray-500">Total Sales</p>
// // //   // // // // // // //                 <h3 className="text-2xl font-bold text-gray-800">{sortedSales.length}</h3>
// // //   // // // // // // //               </div>
// // //   // // // // // // //             </div>
// // //   // // // // // // //           </CardContent>
// // //   // // // // // // //         </Card>
          
// // //   // // // // // // //         <Card className="bg-green-50 shadow-md hover:shadow-lg transition-shadow duration-300">
// // //   // // // // // // //           <CardContent className="p-6">
// // //   // // // // // // //             <div className="flex items-center space-x-4">
// // //   // // // // // // //               <div className="bg-green-500 p-3 rounded-full">
// // //   // // // // // // //                 <DollarSign className="h-6 w-6 text-white" />
// // //   // // // // // // //               </div>
// // //   // // // // // // //               <div>
// // //   // // // // // // //                 <p className="text-sm font-medium text-gray-500">Total Revenue</p>
// // //   // // // // // // //                 <h3 className="text-2xl font-bold text-gray-800">${totalSalesAmount.toFixed(2)}</h3>
// // //   // // // // // // //               </div>
// // //   // // // // // // //             </div>
// // //   // // // // // // //           </CardContent>
// // //   // // // // // // //         </Card>
          
// // //   // // // // // // //         <Card className="bg-purple-50 shadow-md hover:shadow-lg transition-shadow duration-300">
// // //   // // // // // // //           <CardContent className="p-6">
// // //   // // // // // // //             <div className="flex items-center space-x-4">
// // //   // // // // // // //               <div className="bg-purple-500 p-3 rounded-full">
// // //   // // // // // // //                 <TrendingUp className="h-6 w-6 text-white" />
// // //   // // // // // // //               </div>
// // //   // // // // // // //               <div>
// // //   // // // // // // //                 <p className="text-sm font-medium text-gray-500">Average Sale</p>
// // //   // // // // // // //                 <h3 className="text-2xl font-bold text-gray-800">${averageSale.toFixed(2)}</h3>
// // //   // // // // // // //               </div>
// // //   // // // // // // //             </div>
// // //   // // // // // // //           </CardContent>
// // //   // // // // // // //         </Card>
// // //   // // // // // // //       </div>

// // //   // // // // // // //       <CardContent>
// // //   // // // // // // //         <div className="mb-4">
// // //   // // // // // // //           <div className="relative">
// // //   // // // // // // //             <input
// // //   // // // // // // //               type="text"
// // //   // // // // // // //               placeholder="Search by ID, email, product..."
// // //   // // // // // // //               className="w-full p-2 pl-10 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all"
// // //   // // // // // // //               value={searchQuery}
// // //   // // // // // // //               onChange={(e) => setSearchQuery(e.target.value)}
// // //   // // // // // // //             />
// // //   // // // // // // //             <div className="absolute left-3 top-2.5 text-gray-400">
// // //   // // // // // // //               <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
// // //   // // // // // // //                 <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
// // //   // // // // // // //               </svg>
// // //   // // // // // // //             </div>
// // //   // // // // // // //           </div>
// // //   // // // // // // //         </div>
          
// // //   // // // // // // //         <Tabs defaultValue="table" value={activeTab} onValueChange={setActiveTab} className="w-full">
// // //   // // // // // // //           <TabsList className="mb-4 bg-gray-100 p-1 rounded-md">
// // //   // // // // // // //             <TabsTrigger value="table" className="data-[state=active]:bg-white data-[state=active]:text-blue-600">
// // //   // // // // // // //               <ShoppingCart className="h-4 w-4 mr-2" />
// // //   // // // // // // //               Sales Table
// // //   // // // // // // //             </TabsTrigger>
// // //   // // // // // // //             <TabsTrigger value="analytics" className="data-[state=active]:bg-white data-[state=active]:text-blue-600">
// // //   // // // // // // //               <TrendingUp className="h-4 w-4 mr-2" />
// // //   // // // // // // //               Analytics
// // //   // // // // // // //             </TabsTrigger>
// // //   // // // // // // //           </TabsList>
            
// // //   // // // // // // //           <TabsContent value="table" className="space-y-4">
// // //   // // // // // // //             {loading ? (
// // //   // // // // // // //               <div className="space-y-3">
// // //   // // // // // // //                 {[1, 2, 3, 4].map((i) => (
// // //   // // // // // // //                   <div key={i} className="flex space-x-4">
// // //   // // // // // // //                     <Skeleton className="h-12 w-full rounded-md" />
// // //   // // // // // // //                   </div>
// // //   // // // // // // //                 ))}
// // //   // // // // // // //               </div>
// // //   // // // // // // //             ) : (
// // //   // // // // // // //               <div className="overflow-x-auto rounded-lg border border-gray-200">
// // //   // // // // // // //                 <Table className="w-full">
// // //   // // // // // // //                   <TableHeader className="bg-gray-50">
// // //   // // // // // // //                     <TableRow>
// // //   // // // // // // //                       <TableHead className="w-[80px]"></TableHead>
// // //   // // // // // // //                       <TableHead 
// // //   // // // // // // //                         className="cursor-pointer hover:bg-gray-100 transition-colors"
// // //   // // // // // // //                         onClick={() => requestSort("_id")}
// // //   // // // // // // //                       >
// // //   // // // // // // //                         Sale ID {getSortIndicator("_id")}
// // //   // // // // // // //                       </TableHead>
// // //   // // // // // // //                       <TableHead 
// // //   // // // // // // //                         className="cursor-pointer hover:bg-gray-100 transition-colors"
// // //   // // // // // // //                         onClick={() => requestSort("total_amount")}
// // //   // // // // // // //                       >
// // //   // // // // // // //                         Amount {getSortIndicator("total_amount")}
// // //   // // // // // // //                       </TableHead>
// // //   // // // // // // //                       <TableHead 
// // //   // // // // // // //                         className="cursor-pointer hover:bg-gray-100 transition-colors"
// // //   // // // // // // //                         onClick={() => requestSort("date")}
// // //   // // // // // // //                       >
// // //   // // // // // // //                         Date {getSortIndicator("date")}
// // //   // // // // // // //                       </TableHead>
// // //   // // // // // // //                       <TableHead>User</TableHead>
// // //   // // // // // // //                       <TableHead>Role</TableHead>
// // //   // // // // // // //                       <TableHead>Products</TableHead>
// // //   // // // // // // //                     </TableRow>
// // //   // // // // // // //                   </TableHeader>
// // //   // // // // // // //                   <TableBody>
// // //   // // // // // // //                     {sortedSales.map((sale) => {
// // //   // // // // // // //                       const user = getUserDetails(sale.user_id);
// // //   // // // // // // //                       const isExpanded = expandedSale === sale._id;
                        
// // //   // // // // // // //                       return (
// // //   // // // // // // //                         <React.Fragment key={sale._id}>
// // //   // // // // // // //                           <TableRow 
// // //   // // // // // // //                             className={`hover:bg-blue-50 transition-colors ${isExpanded ? "bg-blue-50" : ""}`}
// // //   // // // // // // //                             onClick={() => toggleExpandedSale(sale._id)}
// // //   // // // // // // //                           >
// // //   // // // // // // //                             <TableCell>
// // //   // // // // // // //                               <button 
// // //   // // // // // // //                                 className="p-1 rounded-full bg-gray-100 hover:bg-gray-200 transition-colors"
// // //   // // // // // // //                                 aria-label={isExpanded ? "Collapse details" : "Expand details"}
// // //   // // // // // // //                               >
// // //   // // // // // // //                                 {isExpanded ? 
// // //   // // // // // // //                                   <ChevronUp className="h-4 w-4 text-gray-600" /> : 
// // //   // // // // // // //                                   <ChevronDown className="h-4 w-4 text-gray-600" />
// // //   // // // // // // //                                 }
// // //   // // // // // // //                               </button>
// // //   // // // // // // //                             </TableCell>
// // //   // // // // // // //                             <TableCell className="font-medium">
// // //   // // // // // // //                               {sale._id.substring(0, 8)}...
// // //   // // // // // // //                             </TableCell>
// // //   // // // // // // //                             <TableCell className="font-semibold">
// // //   // // // // // // //                               <span className="text-green-600">${parseFloat(sale.total_amount).toFixed(2)}</span>
// // //   // // // // // // //                             </TableCell>
// // //   // // // // // // //                             <TableCell>
// // //   // // // // // // //                               {sale.date ? format(new Date(sale.date), 'MMM dd, yyyy') : 'N/A'}
// // //   // // // // // // //                             </TableCell>
// // //   // // // // // // //                             <TableCell>
// // //   // // // // // // //                               <div className="flex items-center space-x-2">
// // //   // // // // // // //                                 <div className="bg-blue-100 p-1 rounded-full">
// // //   // // // // // // //                                   <Users className="h-4 w-4 text-blue-600" />
// // //   // // // // // // //                                 </div>
// // //   // // // // // // //                                 <span className="text-sm">{user ? user.email : 'N/A'}</span>
// // //   // // // // // // //                               </div>
// // //   // // // // // // //                             </TableCell>
// // //   // // // // // // //                             <TableCell>
// // //   // // // // // // //                               {user?.role && (
// // //   // // // // // // //                                 <Badge variant="outline" className={
// // //   // // // // // // //                                   user.role === "admin" ? "bg-red-100 text-red-800 border-red-200" :
// // //   // // // // // // //                                   user.role === "manager" ? "bg-blue-100 text-blue-800 border-blue-200" :
// // //   // // // // // // //                                   "bg-green-100 text-green-800 border-green-200"
// // //   // // // // // // //                                 }>
// // //   // // // // // // //                                   {user.role}
// // //   // // // // // // //                                 </Badge>
// // //   // // // // // // //                               )}
// // //   // // // // // // //                             </TableCell>
// // //   // // // // // // //                             <TableCell>
// // //   // // // // // // //                               <Badge variant="outline" className="bg-gray-100">
// // //   // // // // // // //                                 {sale.products.length} items
// // //   // // // // // // //                               </Badge>
// // //   // // // // // // //                             </TableCell>
// // //   // // // // // // //                           </TableRow>
                            
// // //   // // // // // // //                           {isExpanded && (
// // //   // // // // // // //                             <Motion defaultStyle={{ opacity: 0, height: 0 }} style={{ opacity: spring(1), height: spring(200) }}>
// // //   // // // // // // //                               {(style) => (
// // //   // // // // // // //                                 <TableRow style={{ opacity: style.opacity }}>
// // //   // // // // // // //                                   <TableCell colSpan={7} className="bg-blue-50 p-0">
// // //   // // // // // // //                                     <div style={{ height: style.height }} className="overflow-hidden">
// // //   // // // // // // //                                       <div className="p-4">
// // //   // // // // // // //                                         <h4 className="font-semibold mb-2">Products</h4>
// // //   // // // // // // //                                         <div className="grid grid-cols-1 md:grid-cols-2 gap-2">
// // //   // // // // // // //                                           {sale.products.map((product, index) => (
// // //   // // // // // // //                                             <div key={index} className="bg-white p-2 rounded border border-gray-200 flex justify-between">
// // //   // // // // // // //                                               <span>{product.name}</span>
// // //   // // // // // // //                                               <span className="text-gray-600">
// // //   // // // // // // //                                                 {product.quantity} x ${product.unit_price}
// // //   // // // // // // //                                               </span>
// // //   // // // // // // //                                             </div>
// // //   // // // // // // //                                           ))}
// // //   // // // // // // //                                         </div>
// // //   // // // // // // //                                         {user && (
// // //   // // // // // // //                                           <div className="mt-4">
// // //   // // // // // // //                                             <h4 className="font-semibold mb-2">User Details</h4>
// // //   // // // // // // //                                             <div className="bg-white p-3 rounded border border-gray-200">
// // //   // // // // // // //                                               <div className="grid grid-cols-2 gap-2">
// // //   // // // // // // //                                                 <div>
// // //   // // // // // // //                                                   <p className="text-sm text-gray-500">User ID</p>
// // //   // // // // // // //                                                   <p className="font-medium">{sale.user_id}</p>
// // //   // // // // // // //                                                 </div>
// // //   // // // // // // //                                                 <div>
// // //   // // // // // // //                                                   <p className="text-sm text-gray-500">Email</p>
// // //   // // // // // // //                                                   <p className="font-medium">{user.email}</p>
// // //   // // // // // // //                                                 </div>
// // //   // // // // // // //                                                 <div>
// // //   // // // // // // //                                                   <p className="text-sm text-gray-500">Role</p>
// // //   // // // // // // //                                                   <p className="font-medium">{user.role}</p>
// // //   // // // // // // //                                                 </div>
// // //   // // // // // // //                                               </div>
// // //   // // // // // // //                                             </div>
// // //   // // // // // // //                                           </div>
// // //   // // // // // // //                                         )}
// // //   // // // // // // //                                       </div>
// // //   // // // // // // //                                     </div>
// // //   // // // // // // //                                   </TableCell>
// // //   // // // // // // //                                 </TableRow>
// // //   // // // // // // //                               )}
// // //   // // // // // // //                             </Motion>
// // //   // // // // // // //                           )}
// // //   // // // // // // //                         </React.Fragment>
// // //   // // // // // // //                       );
// // //   // // // // // // //                     })}
                      
// // //   // // // // // // //                     {sortedSales.length === 0 && (
// // //   // // // // // // //                       <TableRow>
// // //   // // // // // // //                         <TableCell colSpan={7} className="h-24 text-center">
// // //   // // // // // // //                           <div className="flex flex-col items-center justify-center">
// // //   // // // // // // //                             <ShoppingCart className="h-8 w-8 text-gray-400 mb-2" />
// // //   // // // // // // //                             <p className="text-gray-500">No sales found</p>
// // //   // // // // // // //                             {searchQuery && (
// // //   // // // // // // //                               <button 
// // //   // // // // // // //                                 className="mt-2 text-blue-500 hover:text-blue-700"
// // //   // // // // // // //                                 onClick={() => setSearchQuery("")}
// // //   // // // // // // //                               >
// // //   // // // // // // //                                 Clear search
// // //   // // // // // // //                               </button>
// // //   // // // // // // //                             )}
// // //   // // // // // // //                           </div>
// // //   // // // // // // //                         </TableCell>
// // //   // // // // // // //                       </TableRow>
// // //   // // // // // // //                     )}
// // //   // // // // // // //                   </TableBody>
// // //   // // // // // // //                 </Table>
// // //   // // // // // // //               </div>
// // //   // // // // // // //             )}
// // //   // // // // // // //           </TabsContent>
            
// // //   // // // // // // //           <TabsContent value="analytics" className="space-y-6">
// // //   // // // // // // //             <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
// // //   // // // // // // //               <Card>
// // //   // // // // // // //                 <CardHeader>
// // //   // // // // // // //                   <CardTitle className="text-lg">Sales by Role</CardTitle>
// // //   // // // // // // //                 </CardHeader>
// // //   // // // // // // //                 <CardContent className="h-[300px]">
// // //   // // // // // // //                   <ResponsiveContainer width="100%" height="100%">
// // //   // // // // // // //                     <PieChart>
// // //   // // // // // // //                       <Pie
// // //   // // // // // // //                         data={salesByRole}
// // //   // // // // // // //                         cx="50%"
// // //   // // // // // // //                         cy="50%"
// // //   // // // // // // //                         labelLine={false}
// // //   // // // // // // //                         outerRadius={80}
// // //   // // // // // // //                         fill="#8884d8"
// // //   // // // // // // //                         dataKey="count"
// // //   // // // // // // //                         label={({ name, percent }) => `${name} ${(percent * 100).toFixed(0)}%`}
// // //   // // // // // // //                       >
// // //   // // // // // // //                         {salesByRole.map((entry, index) => (
// // //   // // // // // // //                           <Cell key={`cell-${index}`} fill={COLORS[index % COLORS.length]} />
// // //   // // // // // // //                         ))}
// // //   // // // // // // //                       </Pie>
// // //   // // // // // // //                       <Tooltip formatter={(value) => [`${value} sales`, 'Count']} />
// // //   // // // // // // //                       <Legend />
// // //   // // // // // // //                     </PieChart>
// // //   // // // // // // //                   </ResponsiveContainer>
// // //   // // // // // // //                 </CardContent>
// // //   // // // // // // //               </Card>
                
// // //   // // // // // // //               <Card>
// // //   // // // // // // //                 <CardHeader>
// // //   // // // // // // //                   <CardTitle className="text-lg">Revenue by Date (Last 7 Days)</CardTitle>
// // //   // // // // // // //                 </CardHeader>
// // //   // // // // // // //                 <CardContent className="h-[300px]">
// // //   // // // // // // //                   <ResponsiveContainer width="100%" height="100%">
// // //   // // // // // // //                     <BarChart data={salesByDate}>
// // //   // // // // // // //                       <CartesianGrid strokeDasharray="3 3" />
// // //   // // // // // // //                       <XAxis dataKey="date" />
// // //   // // // // // // //                       <YAxis />
// // //   // // // // // // //                       <Tooltip formatter={(value) => [`$${value}`, 'Revenue']} />
// // //   // // // // // // //                       <Bar dataKey="total" fill="#8884d8" name="Total Revenue" />
// // //   // // // // // // //                     </BarChart>
// // //   // // // // // // //                   </ResponsiveContainer>
// // //   // // // // // // //                 </CardContent>
// // //   // // // // // // //               </Card>
// // //   // // // // // // //             </div>
              
// // //   // // // // // // //             <Card>
// // //   // // // // // // //               <CardHeader>
// // //   // // // // // // //                 <CardTitle className="text-lg">Sales Distribution by Role</CardTitle>
// // //   // // // // // // //               </CardHeader>
// // //   // // // // // // //               <CardContent>
// // //   // // // // // // //                 <div className="overflow-x-auto">
// // //   // // // // // // //                   <Table>
// // //   // // // // // // //                     <TableHeader>
// // //   // // // // // // //                       <TableRow>
// // //   // // // // // // //                         <TableHead>Role</TableHead>
// // //   // // // // // // //                         <TableHead>Total Sales</TableHead>
// // //   // // // // // // //                         <TableHead>Revenue</TableHead>
// // //   // // // // // // //                         <TableHead>Average per Sale</TableHead>
// // //   // // // // // // //                       </TableRow>
// // //   // // // // // // //                     </TableHeader>
// // //   // // // // // // //                     <TableBody>
// // //   // // // // // // //                       {salesByRole.map((role) => (
// // //   // // // // // // //                         <TableRow key={role.name}>
// // //   // // // // // // //                           <TableCell className="font-medium">
// // //   // // // // // // //                             <Badge variant="outline" className={
// // //   // // // // // // //                               role.name === "admin" ? "bg-red-100 text-red-800 border-red-200" :
// // //   // // // // // // //                               role.name === "manager" ? "bg-blue-100 text-blue-800 border-blue-200" :
// // //   // // // // // // //                               "bg-green-100 text-green-800 border-green-200"
// // //   // // // // // // //                             }>
// // //   // // // // // // //                               {role.name}
// // //   // // // // // // //                             </Badge>
// // //   // // // // // // //                           </TableCell>
// // //   // // // // // // //                           <TableCell>{role.count}</TableCell>
// // //   // // // // // // //                           <TableCell>${parseFloat(role.total).toFixed(2)}</TableCell>
// // //   // // // // // // //                           <TableCell>
// // //   // // // // // // //                             ${(role.total / role.count).toFixed(2)}
// // //   // // // // // // //                           </TableCell>
// // //   // // // // // // //                         </TableRow>
// // //   // // // // // // //                       ))}
// // //   // // // // // // //                     </TableBody>
// // //   // // // // // // //                   </Table>
// // //   // // // // // // //                 </div>
// // //   // // // // // // //               </CardContent>
// // //   // // // // // // //             </Card>
// // //   // // // // // // //           </TabsContent>
// // //   // // // // // // //         </Tabs>
// // //   // // // // // // //       </CardContent>
// // //   // // // // // // //     </Card>
// // //   // // // // // // //   );
// // //   // // // // // // // };

// // //   // // // // // // // export default UserSales;

// // //   // // // // // // import React, { useState, useEffect } from "react";
// // //   // // // // // // import { useStore } from "./StoreContext"; // Adjust the import path as needed
// // //   // // // // // // import axios from "axios";
// // //   // // // // // // import styled, { keyframes } from "styled-components";

// // //   // // // // // // // Keyframes for animations
// // //   // // // // // // const fadeIn = keyframes`
// // //   // // // // // //   from {
// // //   // // // // // //     opacity: 0;
// // //   // // // // // //     transform: translateY(-20px);
// // //   // // // // // //   }
// // //   // // // // // //   to {
// // //   // // // // // //     opacity: 1;
// // //   // // // // // //     transform: translateY(0);
// // //   // // // // // //   }
// // //   // // // // // // `;

// // //   // // // // // // const pulse = keyframes`
// // //   // // // // // //   0% {
// // //   // // // // // //     transform: scale(1);
// // //   // // // // // //   }
// // //   // // // // // //   50% {
// // //   // // // // // //     transform: scale(1.05);
// // //   // // // // // //   }
// // //   // // // // // //   100% {
// // //   // // // // // //     transform: scale(1);
// // //   // // // // // //   }
// // //   // // // // // // `;

// // //   // // // // // // // Styled components
// // //   // // // // // // const Container = styled.div`
// // //   // // // // // //   padding: 2rem;
// // //   // // // // // //   background: linear-gradient(135deg, #f5f7fa, #c3cfe2);
// // //   // // // // // //   min-height: 100vh;
// // //   // // // // // //   animation: ${fadeIn} 0.5s ease-in-out;
// // //   // // // // // // `;

// // //   // // // // // // const Title = styled.h2`
// // //   // // // // // //   font-size: 2.5rem;
// // //   // // // // // //   color: #333;
// // //   // // // // // //   text-align: center;
// // //   // // // // // //   margin-bottom: 2rem;
// // //   // // // // // //   font-weight: bold;
// // //   // // // // // //   text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
// // //   // // // // // // `;

// // //   // // // // // // const Table = styled.table`
// // //   // // // // // //   width: 100%;
// // //   // // // // // //   border-collapse: collapse;
// // //   // // // // // //   background: white;
// // //   // // // // // //   box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
// // //   // // // // // //   border-radius: 10px;
// // //   // // // // // //   overflow: hidden;
// // //   // // // // // //   animation: ${fadeIn} 0.7s ease-in-out;
// // //   // // // // // // `;

// // //   // // // // // // const TableHeader = styled.thead`
// // //   // // // // // //   background: linear-gradient(135deg, #6a11cb, #2575fc);
// // //   // // // // // //   color: white;
// // //   // // // // // // `;

// // //   // // // // // // const TableRow = styled.tr`
// // //   // // // // // //   &:nth-child(even) {
// // //   // // // // // //     background: #f9f9f9;
// // //   // // // // // //   }
// // //   // // // // // //   &:hover {
// // //   // // // // // //     background: #f1f1f1;
// // //   // // // // // //     transform: scale(1.02);
// // //   // // // // // //     transition: transform 0.2s ease-in-out;
// // //   // // // // // //   }
// // //   // // // // // // `;

// // //   // // // // // // const TableCell = styled.td`
// // //   // // // // // //   padding: 1rem;
// // //   // // // // // //   text-align: center;
// // //   // // // // // //   border-bottom: 1px solid #ddd;
// // //   // // // // // // `;

// // //   // // // // // // const ProductList = styled.ul`
// // //   // // // // // //   list-style: none;
// // //   // // // // // //   padding: 0;
// // //   // // // // // //   margin: 0;
// // //   // // // // // // `;

// // //   // // // // // // const ProductItem = styled.li`
// // //   // // // // // //   padding: 0.5rem;
// // //   // // // // // //   border-bottom: 1px solid #eee;
// // //   // // // // // //   &:last-child {
// // //   // // // // // //     border-bottom: none;
// // //   // // // // // //   }
// // //   // // // // // // `;

// // //   // // // // // // const Loading = styled.div`
// // //   // // // // // //   text-align: center;
// // //   // // // // // //   font-size: 1.5rem;
// // //   // // // // // //   color: #333;
// // //   // // // // // //   animation: ${pulse} 1.5s infinite;
// // //   // // // // // // `;

// // //   // // // // // // const Error = styled.div`
// // //   // // // // // //   text-align: center;
// // //   // // // // // //   font-size: 1.5rem;
// // //   // // // // // //   color: #ff4d4f;
// // //   // // // // // //   padding: 2rem;
// // //   // // // // // //   background: #fff2f0;
// // //   // // // // // //   border-radius: 10px;
// // //   // // // // // //   box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
// // //   // // // // // // `;

// // //   // // // // // // const UserSales = () => {
// // //   // // // // // //   const { storeId } = useStore();
// // //   // // // // // //   const [allSales, setAllSales] = useState([]);
// // //   // // // // // //   const [users, setUsers] = useState([]);
// // //   // // // // // //   const [loading, setLoading] = useState(true);
// // //   // // // // // //   const [error, setError] = useState(null);

// // //   // // // // // //   useEffect(() => {
// // //   // // // // // //     if (!storeId) {
// // //   // // // // // //       setError("Store ID is missing.");
// // //   // // // // // //       setLoading(false);
// // //   // // // // // //       return;
// // //   // // // // // //     }

// // //   // // // // // //     const fetchData = async () => {
// // //   // // // // // //       try {
// // //   // // // // // //         const salesResponse = await axios.get(`http://localhost:5010/api/daily-sales`, {
// // //   // // // // // //           params: { storeId },
// // //   // // // // // //         });

// // //   // // // // // //         const usersResponse = await axios.get(`http://localhost:5010/api/users`, {
// // //   // // // // // //           params: { storeId },
// // //   // // // // // //         });

// // //   // // // // // //         if (salesResponse.data && usersResponse.data) {
// // //   // // // // // //           setAllSales(salesResponse.data);
// // //   // // // // // //           setUsers(usersResponse.data);
// // //   // // // // // //         } else {
// // //   // // // // // //           setError("No data found for this store.");
// // //   // // // // // //         }
// // //   // // // // // //       } catch (err) {
// // //   // // // // // //         setError("Failed to fetch data.");
// // //   // // // // // //         console.error(err);
// // //   // // // // // //       } finally {
// // //   // // // // // //         setLoading(false);
// // //   // // // // // //       }
// // //   // // // // // //     };

// // //   // // // // // //     fetchData();
// // //   // // // // // //   }, [storeId]);

// // //   // // // // // //   const getUserDetails = (userId) => {
// // //   // // // // // //     return users.find((user) => user.id === userId);
// // //   // // // // // //   };

// // //   // // // // // //   if (loading) {
// // //   // // // // // //     return <Loading>Loading...</Loading>;
// // //   // // // // // //   }

// // //   // // // // // //   if (error) {
// // //   // // // // // //     return <Error>{error}</Error>;
// // //   // // // // // //   }

// // //   // // // // // //   return (
// // //   // // // // // //     <Container>
// // //   // // // // // //       <Title>User Sales</Title>
// // //   // // // // // //       {allSales.length > 0 ? (
// // //   // // // // // //         <Table>
// // //   // // // // // //           <TableHeader>
// // //   // // // // // //             <tr>
// // //   // // // // // //               <th>Sale ID</th>
// // //   // // // // // //               <th>Total Amount</th>
// // //   // // // // // //               <th>Date</th>
// // //   // // // // // //               <th>Products</th>
// // //   // // // // // //               <th>User ID</th>
// // //   // // // // // //               <th>User Role</th>
// // //   // // // // // //               <th>User Email</th>
// // //   // // // // // //             </tr>
// // //   // // // // // //           </TableHeader>
// // //   // // // // // //           <tbody>
// // //   // // // // // //             {allSales.map((sale) => {
// // //   // // // // // //               const user = getUserDetails(sale.user_id);
// // //   // // // // // //               return (
// // //   // // // // // //                 <TableRow key={sale._id}>
// // //   // // // // // //                   <TableCell>{sale._id}</TableCell>
// // //   // // // // // //                   <TableCell>${sale.total_amount.toFixed(2)}</TableCell>
// // //   // // // // // //                   <TableCell>{new Date(sale.date).toLocaleDateString()}</TableCell>
// // //   // // // // // //                   <TableCell>
// // //   // // // // // //                     <ProductList>
// // //   // // // // // //                       {sale.products.map((product, index) => (
// // //   // // // // // //                         <ProductItem key={index}>
// // //   // // // // // //                           {product.name} - {product.quantity} x ${product.unit_price.toFixed(2)}
// // //   // // // // // //                         </ProductItem>
// // //   // // // // // //                       ))}
// // //   // // // // // //                     </ProductList>
// // //   // // // // // //                   </TableCell>
// // //   // // // // // //                   <TableCell>
// // //   // // // // // //                     <span style={{ fontWeight: "bold", color: "#6a11cb" }}>{sale.user_id}</span>
// // //   // // // // // //                   </TableCell>
// // //   // // // // // //                   <TableCell>
// // //   // // // // // //                     <span style={{ color: "#2575fc" }}>{user ? user.role : "N/A"}</span>
// // //   // // // // // //                   </TableCell>
// // //   // // // // // //                   <TableCell>
// // //   // // // // // //                     <span style={{ color: "#4caf50" }}>{user ? user.email : "N/A"}</span>
// // //   // // // // // //                   </TableCell>
// // //   // // // // // //                 </TableRow>
// // //   // // // // // //               );
// // //   // // // // // //             })}
// // //   // // // // // //           </tbody>
// // //   // // // // // //         </Table>
// // //   // // // // // //       ) : (
// // //   // // // // // //         <Error>No sales data available.</Error>
// // //   // // // // // //       )}
// // //   // // // // // //     </Container>
// // //   // // // // // //   );
// // //   // // // // // // };

// // //   // // // // // // export default UserSales;


// // //   // // // // // import React, { useState, useEffect } from "react";
// // //   // // // // // import { useStore } from "./StoreContext"; // Adjust the import path as needed
// // //   // // // // // import axios from "axios";
// // //   // // // // // import styled, { keyframes, css } from "styled-components";
// // //   // // // // // import { 
// // //   // // // // //   Users, 
// // //   // // // // //   ShoppingCart, 
// // //   // // // // //   Calendar, 
// // //   // // // // //   DollarSign, 
// // //   // // // // //   BarChart2, 
// // //   // // // // //   Filter 
// // //   // // // // // } from 'lucide-react';

// // //   // // // // // // Advanced Animations
// // //   // // // // // const fadeIn = keyframes`
// // //   // // // // //   from {
// // //   // // // // //     opacity: 0;
// // //   // // // // //     transform: translateY(20px);
// // //   // // // // //   }
// // //   // // // // //   to {
// // //   // // // // //     opacity: 1;
// // //   // // // // //     transform: translateY(0);
// // //   // // // // //   }
// // //   // // // // // `;

// // //   // // // // // const slideIn = keyframes`
// // //   // // // // //   from {
// // //   // // // // //     opacity: 0;
// // //   // // // // //     transform: translateX(-50px);
// // //   // // // // //   }
// // //   // // // // //   to {
// // //   // // // // //     opacity: 1;
// // //   // // // // //     transform: translateX(0);
// // //   // // // // //   }
// // //   // // // // // `;

// // //   // // // // // const pulse = keyframes`
// // //   // // // // //   0% { transform: scale(1); }
// // //   // // // // //   50% { transform: scale(1.03); }
// // //   // // // // //   100% { transform: scale(1); }
// // //   // // // // // `;

// // //   // // // // // // Sophisticated Color Palette
// // //   // // // // // const colors = {
// // //   // // // // //   primary: '#3b82f6',
// // //   // // // // //   secondary: '#10b981',
// // //   // // // // //   background: '#f3f4f6',
// // //   // // // // //   text: '#1f2937',
// // //   // // // // //   accent: '#6366f1',
// // //   // // // // // };

// // //   // // // // // // Styled Components with Advanced Styling
// // //   // // // // // const Container = styled.div`
// // //   // // // // //   max-width: 1400px;
// // //   // // // // //   margin: 0 auto;
// // //   // // // // //   padding: 2rem;
// // //   // // // // //   background: linear-gradient(135deg, ${colors.background}, #e5e7eb);
// // //   // // // // //   min-height: 100vh;
// // //   // // // // //   font-family: 'Inter', sans-serif;
// // //   // // // // // `;

// // //   // // // // // const Header = styled.div`
// // //   // // // // //   display: flex;
// // //   // // // // //   justify-content: space-between;
// // //   // // // // //   align-items: center;
// // //   // // // // //   margin-bottom: 2rem;
// // //   // // // // //   animation: ${fadeIn} 0.6s ease-out;
// // //   // // // // // `;

// // //   // // // // // const Title = styled.h2`
// // //   // // // // //   font-size: 2.5rem;
// // //   // // // // //   color: ${colors.text};
// // //   // // // // //   display: flex;
// // //   // // // // //   align-items: center;
// // //   // // // // //   gap: 1rem;
// // //   // // // // //   font-weight: 800;
// // //   // // // // //   background: linear-gradient(to right, ${colors.primary}, ${colors.accent});
// // //   // // // // //   -webkit-background-clip: text;
// // //   // // // // //   -webkit-text-fill-color: transparent;
// // //   // // // // // `;

// // //   // // // // // const FiltersContainer = styled.div`
// // //   // // // // //   display: flex;
// // //   // // // // //   gap: 1rem;
// // //   // // // // //   animation: ${slideIn} 0.7s ease-out;
// // //   // // // // // `;

// // //   // // // // // const FilterButton = styled.button`
// // //   // // // // //   display: flex;
// // //   // // // // //   align-items: center;
// // //   // // // // //   gap: 0.5rem;
// // //   // // // // //   padding: 0.5rem 1rem;
// // //   // // // // //   background: white;
// // //   // // // // //   border: 1px solid ${colors.primary}20;
// // //   // // // // //   border-radius: 8px;
// // //   // // // // //   color: ${colors.primary};
// // //   // // // // //   transition: all 0.3s ease;
// // //   // // // // //   box-shadow: 0 4px 6px rgba(0,0,0,0.1);

// // //   // // // // //   &:hover {
// // //   // // // // //     transform: translateY(-3px);
// // //   // // // // //     box-shadow: 0 6px 8px rgba(0,0,0,0.15);
// // //   // // // // //     background: ${colors.primary}10;
// // //   // // // // //   }
// // //   // // // // // `;

// // //   // // // // // const Table = styled.table`
// // //   // // // // //   width: 100%;
// // //   // // // // //   border-collapse: separate;
// // //   // // // // //   border-spacing: 0 0.5rem;
// // //   // // // // //   background: white;
// // //   // // // // //   box-shadow: 0 10px 25px rgba(0,0,0,0.1);
// // //   // // // // //   border-radius: 12px;
// // //   // // // // //   overflow: hidden;
// // //   // // // // //   animation: ${fadeIn} 0.8s ease-out;
// // //   // // // // // `;

// // //   // // // // // const TableHeader = styled.thead`
// // //   // // // // //   background: linear-gradient(135deg, ${colors.primary}, ${colors.accent});
// // //   // // // // //   color: white;
// // //   // // // // // `;

// // //   // // // // // const TableHeaderRow = styled.tr`
// // //   // // // // //   transition: all 0.3s ease;
// // //   // // // // // `;

// // //   // // // // // const TableHeaderCell = styled.th`
// // //   // // // // //   padding: 1.2rem;
// // //   // // // // //   text-align: left;
// // //   // // // // //   font-weight: 600;
// // //   // // // // //   text-transform: uppercase;
// // //   // // // // //   letter-spacing: 0.05em;
// // //   // // // // //   display: flex;
// // //   // // // // //   align-items: center;
// // //   // // // // //   gap: 0.5rem;
// // //   // // // // // `;

// // //   // // // // // const TableRow = styled.tr`
// // //   // // // // //   transition: all 0.3s ease;
// // //   // // // // //   cursor: pointer;

// // //   // // // // //   &:hover {
// // //   // // // // //     background-color: ${colors.background};
// // //   // // // // //     transform: scale(1.01);
// // //   // // // // //     box-shadow: 0 5px 15px rgba(0,0,0,0.1);
// // //   // // // // //   }
// // //   // // // // // `;

// // //   // // // // // const TableCell = styled.td`
// // //   // // // // //   padding: 1.2rem;
// // //   // // // // //   border-bottom: 1px solid #eee;
// // //   // // // // //   font-size: 0.9rem;
// // //   // // // // //   color: ${colors.text};
// // //   // // // // // `;

// // //   // // // // // const ProductList = styled.div`
// // //   // // // // //   display: flex;
// // //   // // // // //   flex-direction: column;
// // //   // // // // //   gap: 0.5rem;
// // //   // // // // // `;

// // //   // // // // // const ProductItem = styled.div`
// // //   // // // // //   display: flex;
// // //   // // // // //   justify-content: space-between;
// // //   // // // // //   padding: 0.5rem;
// // //   // // // // //   background: #f9fafb;
// // //   // // // // //   border-radius: 6px;
// // //   // // // // // `;

// // //   // // // // // const LoadingOverlay = styled.div`
// // //   // // // // //   position: fixed;
// // //   // // // // //   top: 0;
// // //   // // // // //   left: 0;
// // //   // // // // //   width: 100%;
// // //   // // // // //   height: 100%;
// // //   // // // // //   background: rgba(255,255,255,0.8);
// // //   // // // // //   display: flex;
// // //   // // // // //   justify-content: center;
// // //   // // // // //   align-items: center;
// // //   // // // // //   z-index: 1000;
// // //   // // // // // `;

// // //   // // // // // const LoadingSpinner = styled.div`
// // //   // // // // //   width: 50px;
// // //   // // // // //   height: 50px;
// // //   // // // // //   border: 4px solid ${colors.primary};
// // //   // // // // //   border-top: 4px solid ${colors.secondary};
// // //   // // // // //   border-radius: 50%;
// // //   // // // // //   animation: ${pulse} 1s infinite linear;
// // //   // // // // // `;

// // //   // // // // // const UserSales = () => {
// // //   // // // // //   const { storeId } = useStore();
// // //   // // // // //   const [allSales, setAllSales] = useState([]);
// // //   // // // // //   const [users, setUsers] = useState([]);
// // //   // // // // //   const [loading, setLoading] = useState(true);
// // //   // // // // //   const [error, setError] = useState(null);
// // //   // // // // //   const [filters, setFilters] = useState({
// // //   // // // // //     dateRange: null,
// // //   // // // // //     minAmount: null,
// // //   // // // // //     userRole: null
// // //   // // // // //   });

// // //   // // // // //   useEffect(() => {
// // //   // // // // //     if (!storeId) {
// // //   // // // // //       setError("Store ID is missing.");
// // //   // // // // //       setLoading(false);
// // //   // // // // //       return;
// // //   // // // // //     }

// // //   // // // // //     const fetchData = async () => {
// // //   // // // // //       try {
// // //   // // // // //         const salesResponse = await axios.get(`http://localhost:5010/api/daily-sales`, {
// // //   // // // // //           params: { storeId, ...filters },
// // //   // // // // //         });

// // //   // // // // //         const usersResponse = await axios.get(`http://localhost:5010/api/users`, {
// // //   // // // // //           params: { storeId },
// // //   // // // // //         });

// // //   // // // // //         if (salesResponse.data && usersResponse.data) {
// // //   // // // // //           setAllSales(salesResponse.data);
// // //   // // // // //           setUsers(usersResponse.data);
// // //   // // // // //         } else {
// // //   // // // // //           setError("No data found for this store.");
// // //   // // // // //         }
// // //   // // // // //       } catch (err) {
// // //   // // // // //         setError("Failed to fetch data.");
// // //   // // // // //         console.error(err);
// // //   // // // // //       } finally {
// // //   // // // // //         setLoading(false);
// // //   // // // // //       }
// // //   // // // // //     };

// // //   // // // // //     fetchData();
// // //   // // // // //   }, [storeId, filters]);

// // //   // // // // //   const getUserDetails = (userId) => {
// // //   // // // // //     return users.find((user) => user.id === userId);
// // //   // // // // //   };

// // //   // // // // //   if (loading) {
// // //   // // // // //     return (
// // //   // // // // //       <LoadingOverlay>
// // //   // // // // //         <LoadingSpinner />
// // //   // // // // //       </LoadingOverlay>
// // //   // // // // //     );
// // //   // // // // //   }

// // //   // // // // //   if (error) {
// // //   // // // // //     return (
// // //   // // // // //       <Container>
// // //   // // // // //         <Title>
// // //   // // // // //           <BarChart2 size={36} /> Error
// // //   // // // // //         </Title>
// // //   // // // // //         <div style={{ 
// // //   // // // // //           background: '#fff0f0', 
// // //   // // // // //           padding: '2rem', 
// // //   // // // // //           borderRadius: '12px', 
// // //   // // // // //           color: '#ff4d4f' 
// // //   // // // // //         }}>
// // //   // // // // //           {error}
// // //   // // // // //         </div>
// // //   // // // // //       </Container>
// // //   // // // // //     );
// // //   // // // // //   }

// // //   // // // // //   return (
// // //   // // // // //     <Container>
// // //   // // // // //       <Header>
// // //   // // // // //         <Title>
// // //   // // // // //           <Users size={36} /> User Sales
// // //   // // // // //         </Title>
// // //   // // // // //         <FiltersContainer>
// // //   // // // // //           <FilterButton onClick={() => setFilters({ ...filters, dateRange: 'last7Days' })}>
// // //   // // // // //             <Calendar size={16} /> Last 7 Days
// // //   // // // // //           </FilterButton>
// // //   // // // // //           <FilterButton onClick={() => setFilters({ ...filters, minAmount: 100 })}>
// // //   // // // // //             <DollarSign size={16} /> High Value Sales
// // //   // // // // //           </FilterButton>
// // //   // // // // //           <FilterButton onClick={() => setFilters({ ...filters, userRole: 'admin' })}>
// // //   // // // // //             <Filter size={16} /> Admin Sales
// // //   // // // // //           </FilterButton>
// // //   // // // // //         </FiltersContainer>
// // //   // // // // //       </Header>
        
// // //   // // // // //       {allSales.length > 0 ? (
// // //   // // // // //         <Table>
// // //   // // // // //           <TableHeader>
// // //   // // // // //             <TableHeaderRow>
// // //   // // // // //               <TableHeaderCell><ShoppingCart size={16} /> Sale ID</TableHeaderCell>
// // //   // // // // //               <TableHeaderCell><DollarSign size={16} /> Total Amount</TableHeaderCell>
// // //   // // // // //               <TableHeaderCell><Calendar size={16} /> Date</TableHeaderCell>
// // //   // // // // //               <TableHeaderCell>Products</TableHeaderCell>
// // //   // // // // //               <TableHeaderCell><Users size={16} /> User Details</TableHeaderCell>
// // //   // // // // //             </TableHeaderRow>
// // //   // // // // //           </TableHeader>
// // //   // // // // //           <tbody>
// // //   // // // // //             {allSales.map((sale) => {
// // //   // // // // //               const user = getUserDetails(sale.user_id);
// // //   // // // // //               return (
// // //   // // // // //                 <TableRow key={sale._id}>
// // //   // // // // //                   <TableCell>{sale._id}</TableCell>
// // //   // // // // //                   <TableCell style={{ fontWeight: 'bold', color: colors.secondary }}>
// // //   // // // // //                     ${sale.total_amount.toFixed(2)}
// // //   // // // // //                   </TableCell>
// // //   // // // // //                   <TableCell>{new Date(sale.date).toLocaleDateString()}</TableCell>
// // //   // // // // //                   <TableCell>
// // //   // // // // //                     <ProductList>
// // //   // // // // //                       {sale.products.map((product, index) => (
// // //   // // // // //                         <ProductItem key={index}>
// // //   // // // // //                           <span>{product.name}</span>
// // //   // // // // //                           <span>{product.quantity} x ${product.unit_price.toFixed(2)}</span>
// // //   // // // // //                         </ProductItem>
// // //   // // // // //                       ))}
// // //   // // // // //                     </ProductList>
// // //   // // // // //                   </TableCell>
// // //   // // // // //                   <TableCell>
// // //   // // // // //                     <div style={{ display: 'flex', flexDirection: 'column', gap: '0.5rem' }}>
// // //   // // // // //                       <span style={{ fontWeight: 'bold', color: colors.primary }}>
// // //   // // // // //                         {sale.user_id}
// // //   // // // // //                       </span>
// // //   // // // // //                       <span style={{ color: colors.accent }}>
// // //   // // // // //                         {user ? user.role : "N/A"}
// // //   // // // // //                       </span>
// // //   // // // // //                       <span style={{ color: colors.secondary, fontSize: '0.8rem' }}>
// // //   // // // // //                         {user ? user.email : "N/A"}
// // //   // // // // //                       </span>
// // //   // // // // //                     </div>
// // //   // // // // //                   </TableCell>
// // //   // // // // //                 </TableRow>
// // //   // // // // //               );
// // //   // // // // //             })}
// // //   // // // // //           </tbody>
// // //   // // // // //         </Table>
// // //   // // // // //       ) : (
// // //   // // // // //         <div style={{ 
// // //   // // // // //           textAlign: 'center', 
// // //   // // // // //           padding: '2rem', 
// // //   // // // // //           background: 'white', 
// // //   // // // // //           borderRadius: '12px',
// // //   // // // // //           boxShadow: '0 10px 25px rgba(0,0,0,0.1)'
// // //   // // // // //         }}>
// // //   // // // // //           No sales data available.
// // //   // // // // //         </div>
// // //   // // // // //       )}
// // //   // // // // //     </Container>
// // //   // // // // //   );
// // //   // // // // // };

// // //   // // // // // export default UserSales;


// // //   // // // // import React, { useState, useEffect, useMemo } from "react";
// // //   // // // // import { useStore } from "./StoreContext";
// // //   // // // // import axios from "axios";
// // //   // // // // import styled, { keyframes, ThemeProvider, createGlobalStyle } from "styled-components";
// // //   // // // // import { 
// // //   // // // //   Users, 
// // //   // // // //   ShoppingCart, 
// // //   // // // //   Calendar, 
// // //   // // // //   DollarSign, 
// // //   // // // //   Filter, 
// // //   // // // //   BarChart2, 
// // //   // // // //   TrendingUp, 
// // //   // // // //   Download, 
// // //   // // // //   RefreshCw,
// // //   // // // //   Search
// // //   // // // // } from 'lucide-react';
// // //   // // // // import * as XLSX from 'xlsx';

// // //   // // // // // Global Style
// // //   // // // // const GlobalStyle = createGlobalStyle`
// // //   // // // //   @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap');
    
// // //   // // // //   body {
// // //   // // // //     margin: 0;
// // //   // // // //     font-family: 'Inter', sans-serif;
// // //   // // // //     background-color: #f4f6f9;
// // //   // // // //     line-height: 1.6;
// // //   // // // //   }
// // //   // // // // `;

// // //   // // // // // Advanced Theme
// // //   // // // // const theme = {
// // //   // // // //   colors: {
// // //   // // // //     primary: '#3b82f6',
// // //   // // // //     secondary: '#10b981',
// // //   // // // //     background: '#f3f4f6',
// // //   // // // //     text: {
// // //   // // // //       dark: '#1f2937',
// // //   // // // //       light: '#6b7280'
// // //   // // // //     },
// // //   // // // //     accent: {
// // //   // // // //       blue: '#6366f1',
// // //   // // // //       green: '#22c55e',
// // //   // // // //       red: '#ef4444'
// // //   // // // //     }
// // //   // // // //   },
// // //   // // // //   typography: {
// // //   // // // //     fontFamily: "'Inter', sans-serif",
// // //   // // // //     fontSize: {
// // //   // // // //       small: '0.8rem',
// // //   // // // //       medium: '1rem',
// // //   // // // //       large: '1.2rem'
// // //   // // // //     }
// // //   // // // //   }
// // //   // // // // };

// // //   // // // // // Advanced Animations
// // //   // // // // const animations = {
// // //   // // // //   fadeIn: keyframes`
// // //   // // // //     from { opacity: 0; transform: translateY(20px); }
// // //   // // // //     to { opacity: 1; transform: translateY(0); }
// // //   // // // //   `,
// // //   // // // //   slideIn: keyframes`
// // //   // // // //     from { opacity: 0; transform: translateX(-50px); }
// // //   // // // //     to { opacity: 1; transform: translateX(0); }
// // //   // // // //   `,
// // //   // // // //   pulse: keyframes`
// // //   // // // //     0% { transform: scale(1); }
// // //   // // // //     50% { transform: scale(1.03); }
// // //   // // // //     100% { transform: scale(1); }
// // //   // // // //   `
// // //   // // // // };

// // //   // // // // // Styled Components
// // //   // // // // const Container = styled.div`
// // //   // // // //   max-width: 1600px;
// // //   // // // //   margin: 0 auto;
// // //   // // // //   padding: 2rem;
// // //   // // // //   background: linear-gradient(135deg, ${p => p.theme.colors.background}, #e5e7eb);
// // //   // // // //   min-height: 100vh;
// // //   // // // // `;

// // //   // // // // const DashboardHeader = styled.div`
// // //   // // // //   display: flex;
// // //   // // // //   justify-content: space-between;
// // //   // // // //   align-items: center;
// // //   // // // //   margin-bottom: 2rem;
// // //   // // // //   animation: ${animations.fadeIn} 0.6s ease-out;
// // //   // // // // `;

// // //   // // // // const Title = styled.h2`
// // //   // // // //   display: flex;
// // //   // // // //   align-items: center;
// // //   // // // //   gap: 1rem;
// // //   // // // //   font-size: 2.5rem;
// // //   // // // //   font-weight: 800;
// // //   // // // //   background: linear-gradient(to right, ${p => p.theme.colors.primary}, ${p => p.theme.colors.accent.blue});
// // //   // // // //   -webkit-background-clip: text;
// // //   // // // //   -webkit-text-fill-color: transparent;
// // //   // // // // `;

// // //   // // // // const ControlPanel = styled.div`
// // //   // // // //   display: flex;
// // //   // // // //   gap: 1rem;
// // //   // // // //   align-items: center;
// // //   // // // // `;

// // //   // // // // const SearchInput = styled.div`
// // //   // // // //   display: flex;
// // //   // // // //   align-items: center;
// // //   // // // //   background: white;
// // //   // // // //   border: 1px solid ${p => p.theme.colors.primary}20;
// // //   // // // //   border-radius: 8px;
// // //   // // // //   padding: 0.5rem 1rem;
// // //   // // // //   box-shadow: 0 4px 6px rgba(0,0,0,0.1);

// // //   // // // //   input {
// // //   // // // //     border: none;
// // //   // // // //     outline: none;
// // //   // // // //     flex-grow: 1;
// // //   // // // //     margin-left: 0.5rem;
// // //   // // // //   }
// // //   // // // // `;

// // //   // // // // const AdvancedTable = styled.table`
// // //   // // // //   width: 100%;
// // //   // // // //   border-collapse: separate;
// // //   // // // //   border-spacing: 0 0.5rem;
// // //   // // // //   background: white;
// // //   // // // //   box-shadow: 0 15px 30px rgba(0,0,0,0.12);
// // //   // // // //   border-radius: 12px;
// // //   // // // //   overflow: hidden;
// // //   // // // // `;

// // //   // // // // const TableHeader = styled.thead`
// // //   // // // //   background: linear-gradient(135deg, ${p => p.theme.colors.primary}, ${p => p.theme.colors.accent.blue});
// // //   // // // //   color: white;
// // //   // // // // `;

// // //   // // // // const TableHeaderCell = styled.th`
// // //   // // // //   padding: 1.2rem;
// // //   // // // //   text-align: left;
// // //   // // // //   font-weight: 600;
// // //   // // // //   text-transform: uppercase;
// // //   // // // //   letter-spacing: 0.05em;
// // //   // // // //   font-size: 0.8rem;
    
// // //   // // // //   &:hover {
// // //   // // // //     background: rgba(255,255,255,0.1);
// // //   // // // //   }
// // //   // // // // `;

// // //   // // // // const TableRow = styled.tr`
// // //   // // // //   transition: all 0.3s ease;
// // //   // // // //   cursor: pointer;

// // //   // // // //   &:hover {
// // //   // // // //     background-color: ${p => p.theme.colors.background};
// // //   // // // //     transform: scale(1.01);
// // //   // // // //     box-shadow: 0 5px 15px rgba(0,0,0,0.1);
// // //   // // // //   }
// // //   // // // // `;

// // //   // // // // const TableCell = styled.td`
// // //   // // // //   padding: 1.2rem;
// // //   // // // //   border-bottom: 1px solid #eee;
// // //   // // // //   font-size: 0.9rem;
// // //   // // // //   color: ${p => p.theme.colors.text.dark};
// // //   // // // // `;

// // //   // // // // const UserSales = () => {
// // //   // // // //   const { storeId } = useStore();
// // //   // // // //   const [sales, setSales] = useState([]);
// // //   // // // //   const [users, setUsers] = useState([]);
// // //   // // // //   const [loading, setLoading] = useState(true);
// // //   // // // //   const [searchTerm, setSearchTerm] = useState('');
// // //   // // // //   const [filters, setFilters] = useState({
// // //   // // // //     dateRange: null,
// // //   // // // //     minAmount: null,
// // //   // // // //     userRole: null
// // //   // // // //   });

// // //   // // // //   // Fetch data
// // //   // // // //   useEffect(() => {
// // //   // // // //     const fetchData = async () => {
// // //   // // // //       try {
// // //   // // // //         const [salesResponse, usersResponse] = await Promise.all([
// // //   // // // //           axios.get(`http://localhost:5010/api/daily-sales`, { params: { storeId, ...filters } }),
// // //   // // // //           axios.get(`http://localhost:5010/api/users`, { params: { storeId } })
// // //   // // // //         ]);

// // //   // // // //         setSales(salesResponse.data);
// // //   // // // //         setUsers(usersResponse.data);
// // //   // // // //       } catch (error) {
// // //   // // // //         console.error("Data fetching error:", error);
// // //   // // // //       } finally {
// // //   // // // //         setLoading(false);
// // //   // // // //       }
// // //   // // // //     };

// // //   // // // //     fetchData();
// // //   // // // //   }, [storeId, filters]);

// // //   // // // //   // Filtered and searched sales
// // //   // // // //   const processedSales = useMemo(() => {
// // //   // // // //     return sales.filter(sale => 
// // //   // // // //       sale._id.toLowerCase().includes(searchTerm.toLowerCase()) ||
// // //   // // // //       sale.total_amount.toString().includes(searchTerm) ||
// // //   // // // //       users.find(user => user.id === sale.user_id)?.email.toLowerCase().includes(searchTerm.toLowerCase())
// // //   // // // //     );
// // //   // // // //   }, [sales, searchTerm, users]);

// // //   // // // //   // Export to Excel
// // //   // // // //   const exportToExcel = () => {
// // //   // // // //     const worksheet = XLSX.utils.json_to_sheet(processedSales);
// // //   // // // //     const workbook = XLSX.utils.book_new();
// // //   // // // //     XLSX.utils.book_append_sheet(workbook, worksheet, "Sales");
// // //   // // // //     XLSX.writeFile(workbook, "sales_report.xlsx");
// // //   // // // //   };

// // //   // // // //   // Render table rows
// // //   // // // //   const renderTableRows = () => {
// // //   // // // //     return processedSales.map(sale => {
// // //   // // // //       const user = users.find(u => u.id === sale.user_id);
// // //   // // // //       return (
// // //   // // // //         <TableRow key={sale._id}>
// // //   // // // //           <TableCell>{sale._id}</TableCell>
// // //   // // // //           <TableCell>${sale.total_amount.toFixed(2)}</TableCell>
// // //   // // // //           <TableCell>{new Date(sale.date).toLocaleDateString()}</TableCell>
// // //   // // // //           <TableCell>
// // //   // // // //             {sale.products.map(p => `${p.name} (${p.quantity})`).join(', ')}
// // //   // // // //           </TableCell>
// // //   // // // //           <TableCell>
// // //   // // // //             {user ? user.email : "Unknown User"}
// // //   // // // //             <div style={{ color: theme.colors.text.light, fontSize: '0.7rem' }}>
// // //   // // // //               {user?.role || "No Role"}
// // //   // // // //             </div>
// // //   // // // //           </TableCell>
// // //   // // // //         </TableRow>
// // //   // // // //       );
// // //   // // // //     });
// // //   // // // //   };

// // //   // // // //   return (
// // //   // // // //     <ThemeProvider theme={theme}>
// // //   // // // //       <>
// // //   // // // //         <GlobalStyle />
// // //   // // // //         <Container>
// // //   // // // //           <DashboardHeader>
// // //   // // // //             <Title>
// // //   // // // //               <BarChart2 size={36} /> Sales Dashboard
// // //   // // // //             </Title>
// // //   // // // //             <ControlPanel>
// // //   // // // //               <SearchInput>
// // //   // // // //                 <Search size={16} color={theme.colors.primary} />
// // //   // // // //                 <input 
// // //   // // // //                   type="text" 
// // //   // // // //                   placeholder="Search sales..." 
// // //   // // // //                   value={searchTerm}
// // //   // // // //                   onChange={(e) => setSearchTerm(e.target.value)}
// // //   // // // //                 />
// // //   // // // //               </SearchInput>
// // //   // // // //               <button onClick={exportToExcel} style={{ 
// // //   // // // //                 display: 'flex', 
// // //   // // // //                 alignItems: 'center', 
// // //   // // // //                 gap: '0.5rem',
// // //   // // // //                 padding: '0.5rem 1rem',
// // //   // // // //                 background: theme.colors.secondary,
// // //   // // // //                 color: 'white',
// // //   // // // //                 border: 'none',
// // //   // // // //                 borderRadius: '8px'
// // //   // // // //               }}>
// // //   // // // //                 <Download size={16} /> Export
// // //   // // // //               </button>
// // //   // // // //             </ControlPanel>
// // //   // // // //           </DashboardHeader>

// // //   // // // //           <AdvancedTable>
// // //   // // // //             <TableHeader>
// // //   // // // //               <tr>
// // //   // // // //                 <TableHeaderCell>Sale ID</TableHeaderCell>
// // //   // // // //                 <TableHeaderCell>Total Amount</TableHeaderCell>
// // //   // // // //                 <TableHeaderCell>Date</TableHeaderCell>
// // //   // // // //                 <TableHeaderCell>Products</TableHeaderCell>
// // //   // // // //                 <TableHeaderCell>User Details</TableHeaderCell>
// // //   // // // //               </tr>
// // //   // // // //             </TableHeader>
// // //   // // // //             <tbody>
// // //   // // // //               {renderTableRows()}
// // //   // // // //             </tbody>
// // //   // // // //           </AdvancedTable>
// // //   // // // //         </Container>
// // //   // // // //       </>
// // //   // // // //     </ThemeProvider>
// // //   // // // //   );
// // //   // // // // };

// // //   // // // // export default UserSales;



// // //   // // // import React, { useState, useEffect, useMemo } from "react";
// // //   // // // import { useStore } from "./StoreContext";
// // //   // // // import axios from "axios";
// // //   // // // import styled, { keyframes, ThemeProvider, createGlobalStyle } from "styled-components";
// // //   // // // import { 
// // //   // // //   Users, 
// // //   // // //   ShoppingCart, 
// // //   // // //   Calendar, 
// // //   // // //   DollarSign, 
// // //   // // //   Filter, 
// // //   // // //   BarChart2, 
// // //   // // //   TrendingUp, 
// // //   // // //   Download, 
// // //   // // //   RefreshCw,
// // //   // // //   Search,
// // //   // // //   Clock
// // //   // // // } from 'lucide-react';
// // //   // // // import * as XLSX from 'xlsx';

// // //   // // // const GlobalStyle = createGlobalStyle`
// // //   // // //   @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap');
    
// // //   // // //   body {
// // //   // // //     margin: 0;
// // //   // // //     font-family: 'Inter', sans-serif;
// // //   // // //     background-color: #f4f6f9;
// // //   // // //     line-height: 1.6;
// // //   // // //   }
// // //   // // // `;

// // //   // // // // Advanced Theme
// // //   // // // const theme = {
// // //   // // //   colors: {
// // //   // // //     primary: '#3b82f6',
// // //   // // //     secondary: '#10b981',
// // //   // // //     background: '#f3f4f6',
// // //   // // //     text: {
// // //   // // //       dark: '#1f2937',
// // //   // // //       light: '#6b7280'
// // //   // // //     },
// // //   // // //     accent: {
// // //   // // //       blue: '#6366f1',
// // //   // // //       green: '#22c55e',
// // //   // // //       red: '#ef4444'
// // //   // // //     }
// // //   // // //   },
// // //   // // //   typography: {
// // //   // // //     fontFamily: "'Inter', sans-serif",
// // //   // // //     fontSize: {
// // //   // // //       small: '0.8rem',
// // //   // // //       medium: '1rem',
// // //   // // //       large: '1.2rem'
// // //   // // //     }
// // //   // // //   }
// // //   // // // };

// // //   // // // // Advanced Animations
// // //   // // // const animations = {
// // //   // // //   fadeIn: keyframes`
// // //   // // //     from { opacity: 0; transform: translateY(20px); }
// // //   // // //     to { opacity: 1; transform: translateY(0); }
// // //   // // //   `,
// // //   // // //   slideIn: keyframes`
// // //   // // //     from { opacity: 0; transform: translateX(-50px); }
// // //   // // //     to { opacity: 1; transform: translateX(0); }
// // //   // // //   `,
// // //   // // //   pulse: keyframes`
// // //   // // //     0% { transform: scale(1); }
// // //   // // //     50% { transform: scale(1.03); }
// // //   // // //     100% { transform: scale(1); }
// // //   // // //   `
// // //   // // // };

// // //   // // // // Styled Components
// // //   // // // const Container = styled.div`
// // //   // // //   max-width: 1600px;
// // //   // // //   margin: 0 auto;
// // //   // // //   padding: 2rem;
// // //   // // //   background: linear-gradient(135deg, ${p => p.theme.colors.background}, #e5e7eb);
// // //   // // //   min-height: 100vh;
// // //   // // // `;

// // //   // // // const DashboardHeader = styled.div`
// // //   // // //   display: flex;
// // //   // // //   justify-content: space-between;
// // //   // // //   align-items: center;
// // //   // // //   margin-bottom: 2rem;
// // //   // // //   animation: ${animations.fadeIn} 0.6s ease-out;
// // //   // // // `;

// // //   // // // const Title = styled.h2`
// // //   // // //   display: flex;
// // //   // // //   align-items: center;
// // //   // // //   gap: 1rem;
// // //   // // //   font-size: 2.5rem;
// // //   // // //   font-weight: 800;
// // //   // // //   background: linear-gradient(to right, ${p => p.theme.colors.primary}, ${p => p.theme.colors.accent.blue});
// // //   // // //   -webkit-background-clip: text;
// // //   // // //   -webkit-text-fill-color: transparent;
// // //   // // // `;

// // //   // // // const ControlPanel = styled.div`
// // //   // // //   display: flex;
// // //   // // //   gap: 1rem;
// // //   // // //   align-items: center;
// // //   // // // `;

// // //   // // // const SearchInput = styled.div`
// // //   // // //   display: flex;
// // //   // // //   align-items: center;
// // //   // // //   background: white;
// // //   // // //   border: 1px solid ${p => p.theme.colors.primary}20;
// // //   // // //   border-radius: 8px;
// // //   // // //   padding: 0.5rem 1rem;
// // //   // // //   box-shadow: 0 4px 6px rgba(0,0,0,0.1);

// // //   // // //   input {
// // //   // // //     border: none;
// // //   // // //     outline: none;
// // //   // // //     flex-grow: 1;
// // //   // // //     margin-left: 0.5rem;
// // //   // // //   }
// // //   // // // `;

// // //   // // // const AdvancedTable = styled.table`
// // //   // // //   width: 100%;
// // //   // // //   border-collapse: separate;
// // //   // // //   border-spacing: 0 0.5rem;
// // //   // // //   background: white;
// // //   // // //   box-shadow: 0 15px 30px rgba(0,0,0,0.12);
// // //   // // //   border-radius: 12px;
// // //   // // //   overflow: hidden;
// // //   // // // `;

// // //   // // // const TableHeader = styled.thead`
// // //   // // //   background: linear-gradient(135deg, ${p => p.theme.colors.primary}, ${p => p.theme.colors.accent.blue});
// // //   // // //   color: white;
// // //   // // // `;

// // //   // // // const TableHeaderCell = styled.th`
// // //   // // //   padding: 1.2rem;
// // //   // // //   text-align: left;
// // //   // // //   font-weight: 600;
// // //   // // //   text-transform: uppercase;
// // //   // // //   letter-spacing: 0.05em;
// // //   // // //   font-size: 0.8rem;
    
// // //   // // //   &:hover {
// // //   // // //     background: rgba(255,255,255,0.1);
// // //   // // //   }
// // //   // // // `;

// // //   // // // const TableRow = styled.tr`
// // //   // // //   transition: all 0.3s ease;
// // //   // // //   cursor: pointer;

// // //   // // //   &:hover {
// // //   // // //     background-color: ${p => p.theme.colors.background};
// // //   // // //     transform: scale(1.01);
// // //   // // //     box-shadow: 0 5px 15px rgba(0,0,0,0.1);
// // //   // // //   }
// // //   // // // `;

// // //   // // // const TableCell = styled.td`
// // //   // // //   padding: 1.2rem;
// // //   // // //   border-bottom: 1px solid #eee;
// // //   // // //   font-size: 0.9rem;
// // //   // // //   color: ${p => p.theme.colors.text.dark};
// // //   // // // `;

// // //   // // // const UserSales = () => {
// // //   // // //   const { storeId } = useStore();
// // //   // // //   const [sales, setSales] = useState([]);
// // //   // // //   const [users, setUsers] = useState([]);
// // //   // // //   const [loading, setLoading] = useState(true);
// // //   // // //   const [searchTerm, setSearchTerm] = useState('');
// // //   // // //   const [filters, setFilters] = useState({
// // //   // // //     dateRange: null,
// // //   // // //     minAmount: null,
// // //   // // //     userRole: null
// // //   // // //   });

// // //   // // //   // Fetch data
// // //   // // //   useEffect(() => {
// // //   // // //     const fetchData = async () => {
// // //   // // //       try {
// // //   // // //         const [salesResponse, usersResponse] = await Promise.all([
// // //   // // //           axios.get(`http://localhost:5010/api/daily-sales`, { params: { storeId, ...filters } }),
// // //   // // //           axios.get(`http://localhost:5010/api/users`, { params: { storeId } })
// // //   // // //         ]);

// // //   // // //         setSales(salesResponse.data);
// // //   // // //         setUsers(usersResponse.data);
// // //   // // //       } catch (error) {
// // //   // // //         console.error("Data fetching error:", error);
// // //   // // //       } finally {
// // //   // // //         setLoading(false);
// // //   // // //       }
// // //   // // //     };

// // //   // // //     fetchData();
// // //   // // //   }, [storeId, filters]);

// // //   // // //   // Filtered and searched sales
// // //   // // //   const processedSales = useMemo(() => {
// // //   // // //     return sales.filter(sale => 
// // //   // // //       sale._id.toLowerCase().includes(searchTerm.toLowerCase()) ||
// // //   // // //       sale.total_amount.toString().includes(searchTerm) ||
// // //   // // //       users.find(user => user.id === sale.user_id)?.email.toLowerCase().includes(searchTerm.toLowerCase())
// // //   // // //     );
// // //   // // //   }, [sales, searchTerm, users]);

// // //   // // //   // Export to Excel
// // //   // // //   const exportToExcel = () => {
// // //   // // //     const worksheet = XLSX.utils.json_to_sheet(processedSales);
// // //   // // //     const workbook = XLSX.utils.book_new();
// // //   // // //     XLSX.utils.book_append_sheet(workbook, worksheet, "Sales");
// // //   // // //     XLSX.writeFile(workbook, "sales_report.xlsx");
// // //   // // //   };

// // //   // // //   // Render table rows
// // //   // // //   const renderTableRows = () => {
// // //   // // //     return processedSales.map(sale => {
// // //   // // //       const user = users.find(u => u.id === sale.user_id);
// // //   // // //       const saleDate = new Date(sale.date);
        
// // //   // // //       return (
// // //   // // //         <TableRow key={sale._id}>
// // //   // // //           <TableCell>{sale._id}</TableCell>
// // //   // // //           <TableCell>${sale.total_amount.toFixed(2)}</TableCell>
// // //   // // //           <TableCell>
// // //   // // //             {saleDate.toLocaleDateString()}
// // //   // // //             <div style={{ 
// // //   // // //               color: theme.colors.text.light, 
// // //   // // //               fontSize: '0.7rem', 
// // //   // // //               display: 'flex', 
// // //   // // //               alignItems: 'center',
// // //   // // //               gap: '0.3rem'
// // //   // // //             }}>
// // //   // // //               <Clock size={12} /> {saleDate.toLocaleTimeString()}
// // //   // // //             </div>
// // //   // // //           </TableCell>
// // //   // // //           <TableCell>
// // //   // // //             {sale.products.map(p => `${p.name} (${p.quantity})`).join(', ')}
// // //   // // //           </TableCell>
// // //   // // //           <TableCell>
// // //   // // //             {user ? user.email : "Unknown User"}
// // //   // // //             <div style={{ color: theme.colors.text.light, fontSize: '0.7rem' }}>
// // //   // // //               {user?.role || "No Role"}
// // //   // // //             </div>
// // //   // // //           </TableCell>
// // //   // // //         </TableRow>
// // //   // // //       );
// // //   // // //     });
// // //   // // //   };

// // //   // // //   return (
// // //   // // //     <ThemeProvider theme={theme}>
// // //   // // //       <>
// // //   // // //         <GlobalStyle />
// // //   // // //         <Container>
// // //   // // //           <DashboardHeader>
// // //   // // //             <Title>
// // //   // // //               <BarChart2 size={36} /> Sales Dashboard
// // //   // // //             </Title>
// // //   // // //             <ControlPanel>
// // //   // // //               <SearchInput>
// // //   // // //                 <Search size={16} color={theme.colors.primary} />
// // //   // // //                 <input 
// // //   // // //                   type="text" 
// // //   // // //                   placeholder="Search sales..." 
// // //   // // //                   value={searchTerm}
// // //   // // //                   onChange={(e) => setSearchTerm(e.target.value)}
// // //   // // //                 />
// // //   // // //               </SearchInput>
// // //   // // //               <button onClick={exportToExcel} style={{ 
// // //   // // //                 display: 'flex', 
// // //   // // //                 alignItems: 'center', 
// // //   // // //                 gap: '0.5rem',
// // //   // // //                 padding: '0.5rem 1rem',
// // //   // // //                 background: theme.colors.secondary,
// // //   // // //                 color: 'white',
// // //   // // //                 border: 'none',
// // //   // // //                 borderRadius: '8px'
// // //   // // //               }}>
// // //   // // //                 <Download size={16} /> Export
// // //   // // //               </button>
// // //   // // //             </ControlPanel>
// // //   // // //           </DashboardHeader>

// // //   // // //           <AdvancedTable>
// // //   // // //             <TableHeader>
// // //   // // //               <tr>
// // //   // // //                 <TableHeaderCell>Sale ID</TableHeaderCell>
// // //   // // //                 <TableHeaderCell>Total Amount</TableHeaderCell>
// // //   // // //                 <TableHeaderCell>Date & Time</TableHeaderCell>
// // //   // // //                 <TableHeaderCell>Products</TableHeaderCell>
// // //   // // //                 <TableHeaderCell>User Details</TableHeaderCell>
// // //   // // //               </tr>
// // //   // // //             </TableHeader>
// // //   // // //             <tbody>
// // //   // // //               {renderTableRows()}
// // //   // // //             </tbody>
// // //   // // //           </AdvancedTable>
// // //   // // //         </Container>
// // //   // // //       </>
// // //   // // //     </ThemeProvider>
// // //   // // //   );
// // //   // // // };

// // //   // // // export default UserSales;


// // //   // // import React, { useState, useEffect, useMemo } from "react";
// // //   // // import { useStore } from "./StoreContext";
// // //   // // import axios from "axios";
// // //   // // import styled, { keyframes, ThemeProvider, createGlobalStyle } from "styled-components";
// // //   // // import { 
// // //   // //   Users, 
// // //   // //   ShoppingCart, 
// // //   // //   Calendar, 
// // //   // //   DollarSign, 
// // //   // //   Filter, 
// // //   // //   BarChart2, 
// // //   // //   TrendingUp, 
// // //   // //   Download, 
// // //   // //   RefreshCw,
// // //   // //   Search,
// // //   // //   Clock,
// // //   // //   UserCheck,
// // //   // //   Package,
// // //   // //   Layers,
// // //   // //   TrendingDown,
// // //   // //   X
// // //   // // } from 'lucide-react';
// // //   // // import * as XLSX from 'xlsx';

// // //   // // // Global Style
// // //   // // const GlobalStyle = createGlobalStyle`
// // //   // //   @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap');
    
// // //   // //   body {
// // //   // //     margin: 0;
// // //   // //     font-family: 'Inter', sans-serif;
// // //   // //     background: linear-gradient(135deg, #f4f6f9, #e9ecef);
// // //   // //     line-height: 1.6;
// // //   // //     color: #333;
// // //   // //   }

// // //   // //   ::-webkit-scrollbar {
// // //   // //     width: 8px;
// // //   // //   }

// // //   // //   ::-webkit-scrollbar-track {
// // //   // //     background: #f1f1f1;
// // //   // //   }

// // //   // //   ::-webkit-scrollbar-thumb {
// // //   // //     background: #888;
// // //   // //     border-radius: 4px;
// // //   // //   }

// // //   // //   ::-webkit-scrollbar-thumb:hover {
// // //   // //     background: #555;
// // //   // //   }
// // //   // // `;

// // //   // // // Theme Configuration
// // //   // // const theme = {
// // //   // //   colors: {
// // //   // //     primary: '#3b82f6',
// // //   // //     secondary: '#10b981',
// // //   // //     background: '#f3f4f6',
// // //   // //     text: {
// // //   // //       dark: '#1f2937',
// // //   // //       light: '#6b7280'
// // //   // //     },
// // //   // //     accent: {
// // //   // //       blue: '#6366f1',
// // //   // //       green: '#22c55e',
// // //   // //       red: '#ef4444',
// // //   // //       orange: '#f97316'
// // //   // //     }
// // //   // //   },
// // //   // //   typography: {
// // //   // //     fontFamily: "'Inter', sans-serif",
// // //   // //     fontSize: {
// // //   // //       small: '0.8rem',
// // //   // //       medium: '1rem',
// // //   // //       large: '1.2rem'
// // //   // //     }
// // //   // //   }
// // //   // // };

// // //   // // // Custom Modal Component
// // //   // // const Modal = ({ isOpen, onClose, children, title }) => {
// // //   // //   if (!isOpen) return null;

// // //   // //   return (
// // //   // //     <ModalOverlay>
// // //   // //       <ModalContent>
// // //   // //         <ModalHeader>
// // //   // //           <h2>{title}</h2>
// // //   // //           <CloseButton onClick={onClose}>
// // //   // //             <X size={24} />
// // //   // //           </CloseButton>
// // //   // //         </ModalHeader>
// // //   // //         {children}
// // //   // //       </ModalContent>
// // //   // //     </ModalOverlay>
// // //   // //   );
// // //   // // };

// // //   // // // Styled components for Modal
// // //   // // const ModalOverlay = styled.div`
// // //   // //   position: fixed;
// // //   // //   top: 0;
// // //   // //   left: 0;
// // //   // //   right: 0;
// // //   // //   bottom: 0;
// // //   // //   background: rgba(0, 0, 0, 0.5);
// // //   // //   display: flex;
// // //   // //   justify-content: center;
// // //   // //   align-items: center;
// // //   // //   z-index: 1000;
// // //   // // `;

// // //   // // const ModalContent = styled.div`
// // //   // //   background: white;
// // //   // //   border-radius: 16px;
// // //   // //   width: 500px;
// // //   // //   max-width: 90%;
// // //   // //   max-height: 90%;
// // //   // //   overflow-y: auto;
// // //   // //   padding: 20px;
// // //   // //   box-shadow: 0 25px 50px rgba(0,0,0,0.1);
// // //   // // `;

// // //   // // const ModalHeader = styled.div`
// // //   // //   display: flex;
// // //   // //   justify-content: space-between;
// // //   // //   align-items: center;
// // //   // //   margin-bottom: 20px;
// // //   // //   border-bottom: 1px solid #eee;
// // //   // //   padding-bottom: 10px;
// // //   // // `;

// // //   // // const CloseButton = styled.button`
// // //   // //   background: none;
// // //   // //   border: none;
// // //   // //   cursor: pointer;
// // //   // //   color: #666;
// // //   // //   transition: color 0.3s ease;

// // //   // //   &:hover {
// // //   // //     color: #000;
// // //   // //   }
// // //   // // `;

// // //   // // // Rest of the previous code remains the same...
// // //   // // // (Include all the previous styled components and theme configurations)

// // //   // // const UserSales = () => {
// // //   // //   const { storeId } = useStore();
// // //   // //   const [sales, setSales] = useState([]);
// // //   // //   const [users, setUsers] = useState([]);
// // //   // //   const [loading, setLoading] = useState(true);
// // //   // //   const [searchTerm, setSearchTerm] = useState('');
// // //   // //   const [isFilterModalOpen, setIsFilterModalOpen] = useState(false);
// // //   // //   const [filters, setFilters] = useState({
// // //   // //     dateRange: null,
// // //   // //     minAmount: null,
// // //   // //     userRole: null
// // //   // //   });

// // //   // //   // Fetch data
// // //   // //   useEffect(() => {
// // //   // //     const fetchData = async () => {
// // //   // //       try {
// // //   // //         const [salesResponse, usersResponse] = await Promise.all([
// // //   // //           axios.get(`http://localhost:5010/api/daily-sales`, { params: { storeId, ...filters } }),
// // //   // //           axios.get(`http://localhost:5010/api/users`, { params: { storeId } })
// // //   // //         ]);

// // //   // //         setSales(salesResponse.data);
// // //   // //         setUsers(usersResponse.data);
// // //   // //       } catch (error) {
// // //   // //         console.error("Data fetching error:", error);
// // //   // //       } finally {
// // //   // //         setLoading(false);
// // //   // //       }
// // //   // //     };

// // //   // //     fetchData();
// // //   // //   }, [storeId, filters]);

// // //   // //   // Compute sales summary
// // //   // //   const salesSummary = useMemo(() => {
// // //   // //     const totalSales = sales.reduce((sum, sale) => sum + sale.total_amount, 0);
// // //   // //     const averageSale = totalSales / sales.length || 0;
// // //   // //     const topSellingProducts = sales.reduce((acc, sale) => {
// // //   // //       sale.products.forEach(product => {
// // //   // //         acc[product.name] = (acc[product.name] || 0) + product.quantity;
// // //   // //       });
// // //   // //       return acc;
// // //   // //     }, {});

// // //   // //     return {
// // //   // //       totalSales,
// // //   // //       averageSale,
// // //   // //       salesCount: sales.length,
// // //   // //       topSellingProducts: Object.entries(topSellingProducts)
// // //   // //         .sort((a, b) => b[1] - a[1])
// // //   // //         .slice(0, 3)
// // //   // //     };
// // //   // //   }, [sales]);

// // //   // //   // Filtered and searched sales
// // //   // //   const processedSales = useMemo(() => {
// // //   // //     return sales.filter(sale => 
// // //   // //       sale._id.toLowerCase().includes(searchTerm.toLowerCase()) ||
// // //   // //       sale.total_amount.toString().includes(searchTerm) ||
// // //   // //       users.find(user => user.id === sale.user_id)?.email.toLowerCase().includes(searchTerm.toLowerCase())
// // //   // //     );
// // //   // //   }, [sales, searchTerm, users]);

// // //   // //   // Export to Excel
// // //   // //   const exportToExcel = () => {
// // //   // //     const worksheet = XLSX.utils.json_to_sheet(processedSales);
// // //   // //     const workbook = XLSX.utils.book_new();
// // //   // //     XLSX.utils.book_append_sheet(workbook, worksheet, "Sales");
// // //   // //     XLSX.writeFile(workbook, "sales_report.xlsx");
// // //   // //   };

// // //   // //   // Render remaining table rows and components as in the previous code...

// // //   // //   return (
// // //   // //     <ThemeProvider theme={theme}>
// // //   // //       <>
// // //   // //         <GlobalStyle />
// // //   // //         <Container>
// // //   // //           {/* Previous JSX remains the same */}
            
// // //   // //           {/* Custom Filter Modal */}
// // //   // //           <Modal 
// // //   // //             isOpen={isFilterModalOpen} 
// // //   // //             onClose={() => setIsFilterModalOpen(false)}
// // //   // //             title="Advanced Filters"
// // //   // //           >
// // //   // //             <div style={{ display: 'flex', flexDirection: 'column', gap: '1rem' }}>
// // //   // //               <div>
// // //   // //                 <label>Date Range</label>
// // //   // //                 <input 
// // //   // //                   type="date" 
// // //   // //                   onChange={(e) => setFilters(prev => ({...prev, dateRange: e.target.value}))}
// // //   // //                 />
// // //   // //               </div>
// // //   // //               <div>
// // //   // //                 <label>Minimum Amount</label>
// // //   // //                 <input 
// // //   // //                   type="number" 
// // //   // //                   placeholder="Minimum Sale Amount"
// // //   // //                   onChange={(e) => setFilters(prev => ({...prev, minAmount: e.target.value}))}
// // //   // //                 />
// // //   // //               </div>
// // //   // //               <div>
// // //   // //                 <label>User Role</label>
// // //   // //                 <select 
// // //   // //                   onChange={(e) => setFilters(prev => ({...prev, userRole: e.target.value}))}
// // //   // //                 >
// // //   // //                   <option value="">All Roles</option>
// // //   // //                   <option value="admin">Admin</option>
// // //   // //                   <option value="sales">Sales</option>
// // //   // //                   <option value="manager">Manager</option>
// // //   // //                 </select>
// // //   // //               </div>
// // //   // //             </div>
// // //   // //           </Modal>
// // //   // //         </Container>
// // //   // //       </>
// // //   // //     </ThemeProvider>
// // //   // //   );
// // //   // // };

// // //   // // export default UserSales;

// // //   // import React, { useState, useEffect, useMemo } from "react";
// // //   // import { useStore } from "./StoreContext";
// // //   // import axios from "axios";
// // //   // import styled, { createGlobalStyle, ThemeProvider } from "styled-components";
// // //   // import * as XLSX from 'xlsx';
// // //   // import { 
// // //   //   Users, 
// // //   //   ShoppingCart, 
// // //   //   DollarSign, 
// // //   //   Filter, 
// // //   //   BarChart2, 
// // //   //   TrendingUp, 
// // //   //   Download, 
// // //   //   Search,
// // //   //   Clock,
// // //   //   UserCheck,
// // //   //   Package,
// // //   //   Layers,
// // //   //   X
// // //   // } from 'lucide-react';

// // //   // // Theme Configuration
// // //   // const theme = {
// // //   //   colors: {
// // //   //     primary: '#3b82f6',
// // //   //     secondary: '#10b981',
// // //   //     background: '#f3f4f6',
// // //   //     text: {
// // //   //       dark: '#1f2937',
// // //   //       light: '#6b7280'
// // //   //     },
// // //   //     accent: {
// // //   //       blue: '#6366f1',
// // //   //       green: '#22c55e',
// // //   //       red: '#ef4444',
// // //   //       orange: '#f97316'
// // //   //     }
// // //   //   }
// // //   // };

// // //   // // Global Style
// // //   // const GlobalStyle = createGlobalStyle`
// // //   //   @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap');
    
// // //   //   body {
// // //   //     margin: 0;
// // //   //     font-family: 'Inter', sans-serif;
// // //   //     background: linear-gradient(135deg, #f4f6f9, #e9ecef);
// // //   //     line-height: 1.6;
// // //   //     color: #333;
// // //   //   }
// // //   // `;

// // //   // // Styled Components
// // //   // const Container = styled.div`
// // //   //   max-width: 1600px;
// // //   //   margin: 0 auto;
// // //   //   padding: 2rem;
// // //   //   background: transparent;
// // //   // `;

// // //   // const DashboardCard = styled.div`
// // //   //   background: white;
// // //   //   border-radius: 16px;
// // //   //   box-shadow: 0 20px 40px rgba(0,0,0,0.1);
// // //   //   padding: 2rem;
// // //   //   margin-bottom: 2rem;
// // //   // `;

// // //   // const Title = styled.h2`
// // //   //   display: flex;
// // //   //   align-items: center;
// // //   //   gap: 1rem;
// // //   //   font-size: 2.5rem;
// // //   //   font-weight: 800;
// // //   //   background: linear-gradient(to right, ${p => p.theme.colors.primary}, ${p => p.theme.colors.accent.blue});
// // //   //   -webkit-background-clip: text;
// // //   //   -webkit-text-fill-color: transparent;
// // //   // `;

// // //   // const ControlPanel = styled.div`
// // //   //   display: flex;
// // //   //   gap: 1rem;
// // //   //   align-items: center;
// // //   //   margin-bottom: 1rem;
// // //   // `;

// // //   // const SearchInput = styled.div`
// // //   //   display: flex;
// // //   //   align-items: center;
// // //   //   background: white;
// // //   //   border: 1px solid #e0e0e0;
// // //   //   border-radius: 8px;
// // //   //   padding: 0.5rem 1rem;
// // //   //   box-shadow: 0 4px 6px rgba(0,0,0,0.1);

// // //   //   input {
// // //   //     border: none;
// // //   //     outline: none;
// // //   //     flex-grow: 1;
// // //   //     margin-left: 0.5rem;
// // //   //   }
// // //   // `;

// // //   // const AdvancedTable = styled.table`
// // //   //   width: 100%;
// // //   //   border-collapse: separate;
// // //   //   border-spacing: 0 0.5rem;
// // //   //   background: white;
// // //   //   box-shadow: 0 15px 30px rgba(0,0,0,0.12);
// // //   //   border-radius: 12px;
// // //   //   overflow: hidden;
// // //   // `;

// // //   // const TableHeader = styled.thead`
// // //   //   background: linear-gradient(135deg, #3b82f6, #6366f1);
// // //   //   color: white;
// // //   // `;

// // //   // const TableHeaderCell = styled.th`
// // //   //   padding: 1.2rem;
// // //   //   text-align: left;
// // //   //   font-weight: 600;
// // //   //   text-transform: uppercase;
// // //   //   letter-spacing: 0.05em;
// // //   //   font-size: 0.8rem;
// // //   // `;

// // //   // const TableRow = styled.tr`
// // //   //   transition: all 0.3s ease;
// // //   //   cursor: pointer;

// // //   //   &:hover {
// // //   //     background-color: #f3f4f6;
// // //   //     transform: scale(1.01);
// // //   //     box-shadow: 0 5px 15px rgba(0,0,0,0.1);
// // //   //   }
// // //   // `;

// // //   // const TableCell = styled.td`
// // //   //   padding: 1.2rem;
// // //   //   border-bottom: 1px solid #eee;
// // //   //   font-size: 0.9rem;
// // //   //   color: #1f2937;
// // //   // `;

// // //   // const Badge = styled.span`
// // //   //   padding: 0.3rem 0.6rem;
// // //   //   border-radius: 4px;
// // //   //   font-size: 0.7rem;
// // //   //   font-weight: 600;
// // //   //   background: ${p => p.color || '#3b82f6'};
// // //   //   color: white;
// // //   // `;

// // //   // const SummaryGrid = styled.div`
// // //   //   display: grid;
// // //   //   grid-template-columns: repeat(4, 1fr);
// // //   //   gap: 1rem;
// // //   //   margin-bottom: 2rem;
// // //   // `;

// // //   // const SummaryCard = styled.div`
// // //   //   background: white;
// // //   //   border-radius: 12px;
// // //   //   padding: 1.5rem;
// // //   //   display: flex;
// // //   //   align-items: center;
// // //   //   gap: 1rem;
// // //   //   box-shadow: 0 10px 20px rgba(0,0,0,0.08);
// // //   // `;

// // //   // // Modal Component
// // //   // const Modal = ({ isOpen, onClose, children, title }) => {
// // //   //   if (!isOpen) return null;

// // //   //   return (
// // //   //     <div style={{
// // //   //       position: 'fixed',
// // //   //       top: 0,
// // //   //       left: 0,
// // //   //       right: 0,
// // //   //       bottom: 0,
// // //   //       backgroundColor: 'rgba(0,0,0,0.5)',
// // //   //       display: 'flex',
// // //   //       justifyContent: 'center',
// // //   //       alignItems: 'center',
// // //   //       zIndex: 1000
// // //   //     }}>
// // //   //       <div style={{
// // //   //         background: 'white',
// // //   //         borderRadius: '16px',
// // //   //         width: '500px',
// // //   //         maxWidth: '90%',
// // //   //         padding: '20px',
// // //   //         boxShadow: '0 25px 50px rgba(0,0,0,0.1)'
// // //   //       }}>
// // //   //         <div style={{
// // //   //           display: 'flex',
// // //   //           justifyContent: 'space-between',
// // //   //           alignItems: 'center',
// // //   //           marginBottom: '20px',
// // //   //           borderBottom: '1px solid #eee',
// // //   //           paddingBottom: '10px'
// // //   //         }}>
// // //   //           <h2>{title}</h2>
// // //   //           <button 
// // //   //             onClick={onClose}
// // //   //             style={{
// // //   //               background: 'none',
// // //   //               border: 'none',
// // //   //               cursor: 'pointer'
// // //   //             }}
// // //   //           >
// // //   //             <X size={24} />
// // //   //           </button>
// // //   //         </div>
// // //   //         {children}
// // //   //       </div>
// // //   //     </div>
// // //   //   );
// // //   // };

// // //   // // Main Component
// // //   // const UserSales = () => {
// // //   //   const { storeId } = useStore();
// // //   //   const [sales, setSales] = useState([]);
// // //   //   const [users, setUsers] = useState([]);
// // //   //   const [loading, setLoading] = useState(true);
// // //   //   const [searchTerm, setSearchTerm] = useState('');
// // //   //   const [isFilterModalOpen, setIsFilterModalOpen] = useState(false);
// // //   //   const [filters, setFilters] = useState({
// // //   //     dateRange: null,
// // //   //     minAmount: null,
// // //   //     userRole: null
// // //   //   });

// // //   //   // Fetch data
// // //   //   useEffect(() => {
// // //   //     const fetchData = async () => {
// // //   //       try {
// // //   //         const [salesResponse, usersResponse] = await Promise.all([
// // //   //           axios.get(`http://localhost:5010/api/daily-sales1`, { params: { storeId, ...filters } }),
// // //   //           axios.get(`http://localhost:5010/api/users`, { params: { storeId } })
// // //   //         ]);

// // //   //         setSales(salesResponse.data);
// // //   //         setUsers(usersResponse.data);
// // //   //       } catch (error) {
// // //   //         console.error("Data fetching error:", error);
// // //   //       } finally {
// // //   //         setLoading(false);
// // //   //       }
// // //   //     };

// // //   //     fetchData();
// // //   //   }, [storeId, filters]);

// // //   //   // Compute sales summary
// // //   //   const salesSummary = useMemo(() => {
// // //   //     const totalSales = sales.reduce((sum, sale) => sum + sale.total_amount, 0);
// // //   //     const averageSale = totalSales / sales.length || 0;
// // //   //     const topSellingProducts = sales.reduce((acc, sale) => {
// // //   //       sale.products.forEach(product => {
// // //   //         acc[product.name] = (acc[product.name] || 0) + product.quantity;
// // //   //       });
// // //   //       return acc;
// // //   //     }, {});

// // //   //     return {
// // //   //       totalSales,
// // //   //       averageSale,
// // //   //       salesCount: sales.length,
// // //   //       topSellingProducts: Object.entries(topSellingProducts)
// // //   //         .sort((a, b) => b[1] - a[1])
// // //   //         .slice(0, 3)
// // //   //     };
// // //   //   }, [sales]);

// // //   //   // Filtered and searched sales
// // //   //   const processedSales = useMemo(() => {
// // //   //     return sales.filter(sale => 
// // //   //       sale._id.toLowerCase().includes(searchTerm.toLowerCase()) ||
// // //   //       sale.total_amount.toString().includes(searchTerm) ||
// // //   //       users.find(user => user.id === sale.user_id)?.email.toLowerCase().includes(searchTerm.toLowerCase())
// // //   //     );
// // //   //   }, [sales, searchTerm, users]);

// // //   //   // Export to Excel
// // //   //   const exportToExcel = () => {
// // //   //     const worksheet = XLSX.utils.json_to_sheet(processedSales);
// // //   //     const workbook = XLSX.utils.book_new();
// // //   //     XLSX.utils.book_append_sheet(workbook, worksheet, "Sales");
// // //   //     XLSX.writeFile(workbook, "sales_report.xlsx");
// // //   //   };

// // //   //   // Render table rows
// // //   //   const renderTableRows = () => {
// // //   //     return processedSales.map(sale => {
// // //   //       const user = users.find(u => u.id === sale.user_id);
// // //   //       const saleDate = new Date(sale.date);
        
// // //   //       return (
// // //   //         <TableRow key={sale._id}>
// // //   //           <TableCell>{sale._id}</TableCell>
// // //   //           <TableCell>
// // //   //             <Badge color={theme.colors.accent.green}>
// // //   //               ${sale.total_amount.toFixed(2)}
// // //   //             </Badge>
// // //   //           </TableCell>
// // //   //           <TableCell>
// // //   //             {saleDate.toLocaleDateString()}
// // //   //             <div style={{ 
// // //   //               color: theme.colors.text.light, 
// // //   //               fontSize: '0.7rem', 
// // //   //               display: 'flex', 
// // //   //               alignItems: 'center',
// // //   //               gap: '0.3rem'
// // //   //             }}>
// // //   //               <Clock size={12} /> {saleDate.toLocaleTimeString()}
// // //   //             </div>
// // //   //           </TableCell>
// // //   //           <TableCell>
// // //   //             {sale.products.map(p => `${p.name} (${p.quantity})`).join(', ')}
// // //   //           </TableCell>
// // //   //           <TableCell>
// // //   //             {user ? user.email : "Unknown User"}
// // //   //             <div style={{ 
// // //   //               color: theme.colors.text.light, 
// // //   //               fontSize: '0.7rem',
// // //   //               display: 'flex',
// // //   //               alignItems: 'center',
// // //   //               gap: '0.3rem'
// // //   //             }}>
// // //   //               <UserCheck size={12} /> {user?.role || "No Role"}
// // //   //             </div>
// // //   //           </TableCell>
// // //   //         </TableRow>
// // //   //       );
// // //   //     });
// // //   //   };

// // //   //   return (
// // //   //     <ThemeProvider theme={theme}>
// // //   //       <>
// // //   //         <GlobalStyle />
// // //   //         <Container>
// // //   //           <ControlPanel>
// // //   //             <Title>
// // //   //               <BarChart2 size={36} /> Sales Dashboard
// // //   //             </Title>
// // //   //             <SearchInput>
// // //   //               <Search size={16} color={theme.colors.primary} />
// // //   //               <input 
// // //   //                 type="text" 
// // //   //                 placeholder="Search sales..." 
// // //   //                 value={searchTerm}
// // //   //                 onChange={(e) => setSearchTerm(e.target.value)}
// // //   //               />
// // //   //             </SearchInput>
// // //   //             <button 
// // //   //               onClick={() => setIsFilterModalOpen(true)}
// // //   //               style={{ 
// // //   //                 display: 'flex', 
// // //   //                 alignItems: 'center', 
// // //   //                 gap: '0.5rem',
// // //   //                 padding: '0.5rem 1rem',
// // //   //                 background: theme.colors.secondary,
// // //   //                 color: 'white',
// // //   //                 border: 'none',
// // //   //                 borderRadius: '8px'
// // //   //               }}
// // //   //             >
// // //   //               <Filter size={16} /> Filters
// // //   //             </button>
// // //   //             <button 
// // //   //               onClick={exportToExcel} 
// // //   //               style={{ 
// // //   //                 display: 'flex', 
// // //   //                 alignItems: 'center', 
// // //   //                 gap: '0.5rem',
// // //   //                 padding: '0.5rem 1rem',
// // //   //                 background: theme.colors.accent.blue,
// // //   //                 color: 'white',
// // //   //                 border: 'none',
// // //   //                 borderRadius: '8px'
// // //   //               }}
// // //   //             >
// // //   //               <Download size={16} /> Export
// // //   //             </button>
// // //   //           </ControlPanel>

// // //   //           <DashboardCard>
// // //   //             <SummaryGrid>
// // //   //               <SummaryCard>
// // //   //                 <DollarSign size={36} color={theme.colors.accent.green} />
// // //   //                 <div>
// // //   //                   <h3>Total Sales</h3>
// // //   //                   <p style={{ 
// // //   //                     fontWeight: 'bold', 
// // //   //                     fontSize: '1.5rem',
// // //   //                     color: theme.colors.accent.green
// // //   //                   }}>
// // //   //                     ${salesSummary.totalSales.toFixed(2)}
// // //   //                   </p>
// // //   //                 </div>
// // //   //               </SummaryCard>
// // //   //               <SummaryCard>
// // //   //                 <ShoppingCart size={36} color={theme.colors.primary} />
// // //   //                 <div>
// // //   //                   <h3>Total Orders</h3>
// // //   //                   <p style={{ 
// // //   //                     fontWeight: 'bold', 
// // //   //                     fontSize: '1.5rem',
// // //   //                     color: theme.colors.primary
// // //   //                   }}>
// // //   //                     {salesSummary.salesCount}
// // //   //                   </p>
// // //   //                 </div>
// // //   //               </SummaryCard>
// // //   //               <SummaryCard>
// // //   //                 <TrendingUp size={36} color={theme.colors.accent.blue} />
// // //   //                 <div>
// // //   //                   <h3>Avg. Sale</h3>
// // //   //                   <p style={{ 
// // //   //                     fontWeight: 'bold', 
// // //   //                     fontSize: '1.5rem',
// // //   //                     color: theme.colors.accent.blue
// // //   //                   }}>
// // //   //                     ${salesSummary.averageSale.toFixed(2)}
// // //   //                   </p>
// // //   //                 </div>
// // //   //               </SummaryCard>
// // //   //               <SummaryCard>
// // //   //                 <Package size={36} color={theme.colors.accent.orange} />
// // //   //                 <div>
// // //   //                   <h3>Top Product</h3>
// // //   //                   <p style={{ 
// // //   //                     fontWeight: 'bold', 
// // //   //                     fontSize: '1.5rem',
// // //   //                     color: theme.colors.accent.orange
// // //   //                   }}>
// // //   //                     {salesSummary.topSellingProducts[0]?.[0] || 'N/A'}
// // //   //                   </p>
// // //   //                 </div>
// // //   //               </SummaryCard>
// // //   //             </SummaryGrid>

// // //   //             <AdvancedTable>
// // //   //               <TableHeader>
// // //   //                 <tr>
// // //   //                   <TableHeaderCell>Sale ID</TableHeaderCell>
// // //   //                   <TableHeaderCell>Total Amount</TableHeaderCell>
// // //   //                   <TableHeaderCell>Date & Time</TableHeaderCell>
// // //   //                   <TableHeaderCell>Products</TableHeaderCell>
// // //   //                   <TableHeaderCell>User Details</TableHeaderCell>
// // //   //                 </tr>
// // //   //               </TableHeader>
// // //   //               <tbody>
// // //   //                 {renderTableRows()}
// // //   //               </tbody>
// // //   //             </AdvancedTable>
// // //   //           </DashboardCard>

// // //   //           <Modal 
// // //   //             isOpen={isFilterModalOpen} 
// // //   //             onClose={() => setIsFilterModalOpen(false)}
// // //   //             title="Advanced Filters"
// // //   //           >
// // //   //             <div style={{ 
// // //   //               display: 'flex', 
// // //   //               flexDirection: 'column', 
// // //   //               gap: '1rem',
// // //   //               padding: '1rem'
// // //   //             }}>
// // //   //               <div>
// // //   //                 <label style={{ 
// // //   //                   display: 'block', 
// // //   //                   marginBottom: '0.5rem', 
// // //   //                   fontWeight: 'bold' 
// // //   //                 }}>
// // //   //                   Date Range
// // //   //                 </label>
// // //   //                 <input 
// // //   //                   type="date" 
// // //   //                   style={{
// // //   //                     width: '100%',
// // //   //                     padding: '0.5rem',
// // //   //                     borderRadius: '8px',
// // //   //                     border: '1px solid #e0e0e0'
// // //   //                   }}
// // //   //                   onChange={(e) => setFilters(prev => ({...prev, dateRange: e.target.value}))}
// // //   //                 />
// // //   //               </div>
// // //   //               <div>
// // //   //                 <label style={{ 
// // //   //                   display: 'block', 
// // //   //                   marginBottom: '0.5rem', 
// // //   //                   fontWeight: 'bold' 
// // //   //                 }}>
// // //   //                   Minimum Amount
// // //   //                 </label>
// // //   //                 <input 
// // //   //                   type="number" 
// // //   //                   placeholder="Minimum Sale Amount"
// // //   //                   style={{
// // //   //                     width: '100%',
// // //   //                     padding: '0.5rem',
// // //   //                     borderRadius: '8px',
// // //   //                     border: '1px solid #e0e0e0'
// // //   //                   }}
// // //   //                   onChange={(e) => setFilters(prev => ({...prev, minAmount: parseFloat(e.target.value)}))}
// // //   //                 />
// // //   //               </div>
// // //   //               <div>
// // //   //                 <label style={{ 
// // //   //                   display: 'block', 
// // //   //                   marginBottom: '0.5rem', 
// // //   //                   fontWeight: 'bold' 
// // //   //                 }}>
// // //   //                   User Role
// // //   //                 </label>
// // //   //                 <select 
// // //   //                   style={{
// // //   //                     width: '100%',
// // //   //                     padding: '0.5rem',
// // //   //                     borderRadius: '8px',
// // //   //                     border: '1px solid #e0e0e0'
// // //   //                   }}
// // //   //                   onChange={(e) => setFilters(prev => ({...prev, userRole: e.target.value}))}
// // //   //                 >
// // //   //                   <option value="">All Roles</option>
// // //   //                   <option value="admin">Admin</option>
// // //   //                   <option value="sales">Sales</option>
// // //   //                   <option value="manager">Manager</option>
// // //   //                 </select>
// // //   //               </div>
// // //   //               <div style={{ 
// // //   //                 display: 'flex', 
// // //   //                 justifyContent: 'space-between', 
// // //   //                 marginTop: '1rem' 
// // //   //               }}>
// // //   //                 <button 
// // //   //                   onClick={() => setIsFilterModalOpen(false)}
// // //   //                   style={{
// // //   //                     padding: '0.5rem 1rem',
// // //   //                     background: '#f3f4f6',
// // //   //                     color: '#1f2937',
// // //   //                     border: '1px solid #e0e0e0',
// // //   //                     borderRadius: '8px'
// // //   //                   }}
// // //   //                 >
// // //   //                   Cancel
// // //   //                 </button>
// // //   //                 <button 
// // //   //                   onClick={() => {
// // //   //                     // Apply filters
// // //   //                     setIsFilterModalOpen(false);
// // //   //                   }}
// // //   //                   style={{
// // //   //                     padding: '0.5rem 1rem',
// // //   //                     background: theme.colors.primary,
// // //   //                     color: 'white',
// // //   //                     border: 'none',
// // //   //                     borderRadius: '8px'
// // //   //                   }}
// // //   //                 >
// // //   //                   Apply Filters
// // //   //                 </button>
// // //   //               </div>
// // //   //             </div>
// // //   //           </Modal>
// // //   //         </Container>
// // //   //       </>
// // //   //     </ThemeProvider>
// // //   //   );
// // //   // };

// // //   // export default UserSales;
// // //   import React, { useState, useEffect, useMemo } from "react";
// // // import { useStore } from "./StoreContext";
// // // import axios from "axios";
// // // import styled, { createGlobalStyle, ThemeProvider } from "styled-components";
// // // import * as XLSX from 'xlsx';
// // // import { 
// // //   Users, 
// // //   ShoppingCart, 
// // //   DollarSign, 
// // //   Filter, 
// // //   BarChart2, 
// // //   TrendingUp, 
// // //   Download, 
// // //   Search,
// // //   Clock,
// // //   UserCheck,
// // //   Package,
// // //   Layers,
// // //   X
// // // } from 'lucide-react';
// // // import { 
// // //   BarChart, 
// // //   Bar, 
// // //   XAxis, 
// // //   YAxis, 
// // //   CartesianGrid, 
// // //   Tooltip, 
// // //   Legend, 
// // //   PieChart, 
// // //   Pie, 
// // //   Cell, 
// // //   ResponsiveContainer 
// // // } from 'recharts';

// // // // Theme Configuration (keep existing theme)
// // // const theme = {
// // //   colors: {
// // //     primary: '#3b82f6',
// // //     secondary: '#10b981',
// // //     background: '#f3f4f6',
// // //     text: {
// // //       dark: '#1f2937',
// // //       light: '#6b7280'
// // //     },
// // //     accent: {
// // //       blue: '#6366f1',
// // //       green: '#22c55e',
// // //       red: '#ef4444',
// // //       orange: '#f97316'
// // //     }
// // //   }
// // // };

// // // // Global Style (keep existing)
// // // const GlobalStyle = createGlobalStyle`
// // //   @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap');
  
// // //   body {
// // //     margin: 0;
// // //     font-family: 'Inter', sans-serif;
// // //     background: linear-gradient(135deg, #f4f6f9, #e9ecef);
// // //     line-height: 1.6;
// // //     color: #333;
// // //   }
// // //   const Container = styled.div`
// // //     max-width: 1600px;
// // //     margin: 0 auto;
// // //     padding: 2rem;
// // //     background: transparent;
// // //   `;

// // //   const DashboardCard = styled.div`
// // //     background: white;
// // //     border-radius: 16px;
// // //     box-shadow: 0 20px 40px rgba(0,0,0,0.1);
// // //     padding: 2rem;
// // //     margin-bottom: 2rem;
// // //   `;

// // //   const Title = styled.h2`
// // //     display: flex;
// // //     align-items: center;
// // //     gap: 1rem;
// // //     font-size: 2.5rem;
// // //     font-weight: 800;
// // //     background: linear-gradient(to right, ${p => p.theme.colors.primary}, ${p => p.theme.colors.accent.blue});
// // //     -webkit-background-clip: text;
// // //     -webkit-text-fill-color: transparent;
// // //   `;

// // //   const ControlPanel = styled.div`
// // //     display: flex;
// // //     gap: 1rem;
// // //     align-items: center;
// // //     margin-bottom: 1rem;
// // //   `;

// // //   const SearchInput = styled.div`
// // //     display: flex;
// // //     align-items: center;
// // //     background: white;
// // //     border: 1px solid #e0e0e0;
// // //     border-radius: 8px;
// // //     padding: 0.5rem 1rem;
// // //     box-shadow: 0 4px 6px rgba(0,0,0,0.1);

// // //     input {
// // //       border: none;
// // //       outline: none;
// // //       flex-grow: 1;
// // //       margin-left: 0.5rem;
// // //     }
// // //   `;

// // //   const AdvancedTable = styled.table`
// // //     width: 100%;
// // //     border-collapse: separate;
// // //     border-spacing: 0 0.5rem;
// // //     background: white;
// // //     box-shadow: 0 15px 30px rgba(0,0,0,0.12);
// // //     border-radius: 12px;
// // //     overflow: hidden;
// // //   `;

// // //   const TableHeader = styled.thead`
// // //     background: linear-gradient(135deg, #3b82f6, #6366f1);
// // //     color: white;
// // //   `;

// // //   const TableHeaderCell = styled.th`
// // //     padding: 1.2rem;
// // //     text-align: left;
// // //     font-weight: 600;
// // //     text-transform: uppercase;
// // //     letter-spacing: 0.05em;
// // //     font-size: 0.8rem;
// // //   `;

// // //   const TableRow = styled.tr`
// // //     transition: all 0.3s ease;
// // //     cursor: pointer;

// // //     &:hover {
// // //       background-color: #f3f4f6;
// // //       transform: scale(1.01);
// // //       box-shadow: 0 5px 15px rgba(0,0,0,0.1);
// // //     }
// // //   `;

// // //   const TableCell = styled.td`
// // //     padding: 1.2rem;
// // //     border-bottom: 1px solid #eee;
// // //     font-size: 0.9rem;
// // //     color: #1f2937;
// // //   `;

// // //   const Badge = styled.span`
// // //     padding: 0.3rem 0.6rem;
// // //     border-radius: 4px;
// // //     font-size: 0.7rem;
// // //     font-weight: 600;
// // //     background: ${p => p.color || '#3b82f6'};
// // //     color: white;
// // //   `;

// // //   const SummaryGrid = styled.div`
// // //     display: grid;
// // //     grid-template-columns: repeat(4, 1fr);
// // //     gap: 1rem;
// // //     margin-bottom: 2rem;
// // //   `;

// // //   const SummaryCard = styled.div`
// // //     background: white;
// // //     border-radius: 12px;
// // //     padding: 1.5rem;
// // //     display: flex;
// // //     align-items: center;
// // //     gap: 1rem;
// // //     box-shadow: 0 10px 20px rgba(0,0,0,0.08);
// // //   `;

// // //   @keyframes fadeIn {
// // //     from { opacity: 0; transform: translateY(20px); }
// // //     to { opacity: 1; transform: translateY(0); }
// // //   }

// // //   @keyframes chartAnimation {
// // //     from { stroke-dashoffset: 1000; }
// // //     to { stroke-dashoffset: 0; }
// // //   }
// // // `;

// // // // New Visualization Containers
// // // const VisualizationGrid = styled.div`
// // //   display: grid;
// // //   grid-template-columns: repeat(2, 1fr);
// // //   gap: 1.5rem;
// // //   margin-top: 2rem;
// // //   animation: fadeIn 0.7s ease-out;
// // // `;
// // //   const Modal = ({ isOpen, onClose, children, title }) => {
// // //     if (!isOpen) return null;

// // //     return (
// // //       <div style={{
// // //         position: 'fixed',
// // //         top: 0,
// // //         left: 0,
// // //         right: 0,
// // //         bottom: 0,
// // //         backgroundColor: 'rgba(0,0,0,0.5)',
// // //         display: 'flex',
// // //         justifyContent: 'center',
// // //         alignItems: 'center',
// // //         zIndex: 1000
// // //       }}>
// // //         <div style={{
// // //           background: 'white',
// // //           borderRadius: '16px',
// // //           width: '500px',
// // //           maxWidth: '90%',
// // //           padding: '20px',
// // //           boxShadow: '0 25px 50px rgba(0,0,0,0.1)'
// // //         }}>
// // //           <div style={{
// // //             display: 'flex',
// // //             justifyContent: 'space-between',
// // //             alignItems: 'center',
// // //             marginBottom: '20px',
// // //             borderBottom: '1px solid #eee',
// // //             paddingBottom: '10px'
// // //           }}>
// // //             <h2>{title}</h2>
// // //             <button 
// // //               onClick={onClose}
// // //               style={{
// // //                 background: 'none',
// // //                 border: 'none',
// // //                 cursor: 'pointer'
// // //               }}
// // //             >
// // //               <X size={24} />
// // //             </button>
// // //           </div>
// // //           {children}
// // //         </div>
// // //       </div>
// // //     );
// // //   };
// // // const VisualizationCard = styled.div`
// // //   background: white;
// // //   border-radius: 16px;
// // //   box-shadow: 0 20px 40px rgba(0,0,0,0.1);
// // //   padding: 1.5rem;
// // //   transition: all 0.3s ease;

// // //   &:hover {
// // //     transform: translateY(-10px);
// // //     box-shadow: 0 25px 50px rgba(0,0,0,0.15);
// // //   }
// // // `;

// // // const UserSales = () => {
// // //   const { storeId } = useStore();
// // //   const [sales, setSales] = useState([]);
// // //   const [users, setUsers] = useState([]);
// // //   const [loading, setLoading] = useState(true);
// // //   const [searchTerm, setSearchTerm] = useState('');
// // //   const [isFilterModalOpen, setIsFilterModalOpen] = useState(false);
// // //   const [filters, setFilters] = useState({
// // //     dateRange: null,
// // //     minAmount: null,
// // //     userRole: null
// // //   });

// // //   // Fetch data (keep existing)
// // //   useEffect(() => {
// // //     const fetchData = async () => {
// // //       try {
// // //         const [salesResponse, usersResponse] = await Promise.all([
// // //           axios.get(`http://localhost:5010/api/daily-sales1`, { params: { storeId, ...filters } }),
// // //           axios.get(`http://localhost:5010/api/users`, { params: { storeId } })
// // //         ]);

// // //         setSales(salesResponse.data);
// // //         setUsers(usersResponse.data);
// // //       } catch (error) {
// // //         console.error("Data fetching error:", error);
// // //       } finally {
// // //         setLoading(false);
// // //       }
// // //     };

// // //     fetchData();
// // //   }, [storeId, filters]);

// // //   // Compute advanced sales analysis
// // //   const salesAnalysis = useMemo(() => {
// // //     // User-wise sales breakdown
// // //     const userSalesBreakdown = users.map(user => {
// // //       const userSales = sales.filter(sale => sale.user_id === user.id);
// // //       const totalUserSales = userSales.reduce((sum, sale) => sum + sale.total_amount, 0);
// // //       return {
// // //         name: user.email,
// // //         sales: totalUserSales,
// // //         role: user.role
// // //       };
// // //     }).sort((a, b) => b.sales - a.sales);

// // //     // Product sales distribution
// // //     const productSalesDistribution = sales.reduce((acc, sale) => {
// // //       sale.products.forEach(product => {
// // //         const existing = acc.find(p => p.name === product.name);
// // //         if (existing) {
// // //           existing.sales += product.quantity;
// // //         } else {
// // //           acc.push({ name: product.name, sales: product.quantity });
// // //         }
// // //       });
// // //       return acc;
// // //     }, []).sort((a, b) => b.sales - a.sales);

// // //     // Time-based sales trend
// // //     const dailySalesTrend = sales.reduce((acc, sale) => {
// // //       const date = new Date(sale.date).toLocaleDateString();
// // //       const existing = acc.find(d => d.date === date);
// // //       if (existing) {
// // //         existing.sales += sale.total_amount;
// // //       } else {
// // //         acc.push({ date, sales: sale.total_amount });
// // //       }
// // //       return acc;
// // //     }, []).sort((a, b) => new Date(a.date) - new Date(b.date));
// // //     const salesSummary = useMemo(() => {
// // //       const totalSales = sales.reduce((sum, sale) => sum + sale.total_amount, 0);
// // //       const averageSale = totalSales / sales.length || 0;
// // //       const topSellingProducts = sales.reduce((acc, sale) => {
// // //         sale.products.forEach(product => {
// // //           acc[product.name] = (acc[product.name] || 0) + product.quantity;
// // //         });
// // //         return acc;
// // //       }, {});

// // //       return {
// // //         totalSales,
// // //         averageSale,
// // //         salesCount: sales.length,
// // //         topSellingProducts: Object.entries(topSellingProducts)
// // //           .sort((a, b) => b[1] - a[1])
// // //           .slice(0, 3)
// // //       };
// // //     }, [sales]);

// // //     // Filtered and searched sales
// // //     const processedSales = useMemo(() => {
// // //       return sales.filter(sale => 
// // //         sale._id.toLowerCase().includes(searchTerm.toLowerCase()) ||
// // //         sale.total_amount.toString().includes(searchTerm) ||
// // //         users.find(user => user.id === sale.user_id)?.email.toLowerCase().includes(searchTerm.toLowerCase())
// // //       );
// // //     }, [sales, searchTerm, users]);

// // //     // Export to Excel
// // //     const exportToExcel = () => {
// // //       const worksheet = XLSX.utils.json_to_sheet(processedSales);
// // //       const workbook = XLSX.utils.book_new();
// // //       XLSX.utils.book_append_sheet(workbook, worksheet, "Sales");
// // //       XLSX.writeFile(workbook, "sales_report.xlsx");
// // //     };

// // //     // Render table rows
// // //     const renderTableRows = () => {
// // //       return processedSales.map(sale => {
// // //         const user = users.find(u => u.id === sale.user_id);
// // //         const saleDate = new Date(sale.date);
        
// // //         return (
// // //           <TableRow key={sale._id}>
// // //             <TableCell>{sale._id}</TableCell>
// // //             <TableCell>
// // //               <Badge color={theme.colors.accent.green}>
// // //                 ${sale.total_amount.toFixed(2)}
// // //               </Badge>
// // //             </TableCell>
// // //             <TableCell>
// // //               {saleDate.toLocaleDateString()}
// // //               <div style={{ 
// // //                 color: theme.colors.text.light, 
// // //                 fontSize: '0.7rem', 
// // //                 display: 'flex', 
// // //                 alignItems: 'center',
// // //                 gap: '0.3rem'
// // //               }}>
// // //                 <Clock size={12} /> {saleDate.toLocaleTimeString()}
// // //               </div>
// // //             </TableCell>
// // //             <TableCell>
// // //               {sale.products.map(p => `${p.name} (${p.quantity})`).join(', ')}
// // //             </TableCell>
// // //             <TableCell>
// // //               {user ? user.email : "Unknown User"}
// // //               <div style={{ 
// // //                 color: theme.colors.text.light, 
// // //                 fontSize: '0.7rem',
// // //                 display: 'flex',
// // //                 alignItems: 'center',
// // //                 gap: '0.3rem'
// // //               }}>
// // //                 <UserCheck size={12} /> {user?.role || "No Role"}
// // //               </div>
// // //             </TableCell>
// // //           </TableRow>
// // //         );
// // //       });
// // //     };


// // //     return {
// // //       userSalesBreakdown,
// // //       productSalesDistribution,
// // //       dailySalesTrend
// // //     };
// // //   }, [sales, users]);

// // //   // Render visualizations
// // //   const renderUserSalesChart = () => (
// // //     <VisualizationCard>
// // //       <h3>Sales by User</h3>
// // //       <ResponsiveContainer width="100%" height={300}>
// // //         <BarChart data={salesAnalysis.userSalesBreakdown}>
// // //           <CartesianGrid strokeDasharray="3 3" />
// // //           <XAxis dataKey="name" />
// // //           <YAxis />
// // //           <Tooltip />
// // //           <Bar 
// // //             dataKey="sales" 
// // //             fill={theme.colors.primary} 
// // //             animationBegin={0}
// // //             animationDuration={1500}
// // //           />
// // //         </BarChart>
// // //       </ResponsiveContainer>
// // //     </VisualizationCard>
// // //   );

// // //   const renderProductSalesPieChart = () => (
// // //     <VisualizationCard>
// // //       <h3>Product Sales Distribution</h3>
// // //       <ResponsiveContainer width="100%" height={300}>
// // //         <PieChart>
// // //           <Pie
// // //             data={salesAnalysis.productSalesDistribution.slice(0, 5)}
// // //             cx="50%"
// // //             cy="50%"
// // //             labelLine={false}
// // //             outerRadius={80}
// // //             fill={theme.colors.primary}
// // //             dataKey="sales"
// // //             nameKey="name"
// // //           >
// // //             {salesAnalysis.productSalesDistribution.slice(0, 5).map((entry, index) => (
// // //               <Cell 
// // //                 key={`cell-${index}`} 
// // //                 fill={Object.values(theme.colors.accent)[index % 4]} 
// // //               />
// // //             ))}
// // //           </Pie>
// // //           <Tooltip />
// // //           <Legend />
// // //         </PieChart>
// // //       </ResponsiveContainer>
// // //     </VisualizationCard>
// // //   );

// // //   const renderDailySalesTrend = () => (
// // //     <VisualizationCard>
// // //       <h3>Daily Sales Trend</h3>
// // //       <ResponsiveContainer width="100%" height={300}>
// // //         <BarChart data={salesAnalysis.dailySalesTrend}>
// // //           <CartesianGrid strokeDasharray="3 3" />
// // //           <XAxis dataKey="date" />
// // //           <YAxis />
// // //           <Tooltip />
// // //           <Bar 
// // //             dataKey="sales" 
// // //             fill={theme.colors.secondary} 
// // //             animationBegin={0}
// // //             animationDuration={1500}
// // //           />
// // //         </BarChart>
// // //       </ResponsiveContainer>
// // //     </VisualizationCard>
// // //   );

// // //   // Existing render logic...
// // //   return (
// // //     <ThemeProvider theme={theme}>
// // //       <>
// // //         <GlobalStyle />
// // //         <Container>
// // //           {/* Existing control panel and summary grid */}
// // //                       <ControlPanel>
// // //               <Title>
// // //                 <BarChart2 size={36} /> Sales Dashboard
// // //               </Title>
// // //               <SearchInput>
// // //                 <Search size={16} color={theme.colors.primary} />
// // //                 <input 
// // //                   type="text" 
// // //                   placeholder="Search sales..." 
// // //                   value={searchTerm}
// // //                   onChange={(e) => setSearchTerm(e.target.value)}
// // //                 />
// // //               </SearchInput>
// // //               <button 
// // //                 onClick={() => setIsFilterModalOpen(true)}
// // //                 style={{ 
// // //                   display: 'flex', 
// // //                   alignItems: 'center', 
// // //                   gap: '0.5rem',
// // //                   padding: '0.5rem 1rem',
// // //                   background: theme.colors.secondary,
// // //                   color: 'white',
// // //                   border: 'none',
// // //                   borderRadius: '8px'
// // //                 }}
// // //               >
// // //                 <Filter size={16} /> Filters
// // //               </button>
// // //               <button 
// // //                 onClick={exportToExcel} 
// // //                 style={{ 
// // //                   display: 'flex', 
// // //                   alignItems: 'center', 
// // //                   gap: '0.5rem',
// // //                   padding: '0.5rem 1rem',
// // //                   background: theme.colors.accent.blue,
// // //                   color: 'white',
// // //                   border: 'none',
// // //                   borderRadius: '8px'
// // //                 }}
// // //               >
// // //                 <Download size={16} /> Export
// // //               </button>
// // //             </ControlPanel>

// // //             <DashboardCard>
// // //               <SummaryGrid>
// // //                 <SummaryCard>
// // //                   <DollarSign size={36} color={theme.colors.accent.green} />
// // //                   <div>
// // //                     <h3>Total Sales</h3>
// // //                     <p style={{ 
// // //                       fontWeight: 'bold', 
// // //                       fontSize: '1.5rem',
// // //                       color: theme.colors.accent.green
// // //                     }}>
// // //                       ${salesSummary.totalSales.toFixed(2)}
// // //                     </p>
// // //                   </div>
// // //                 </SummaryCard>
// // //                 <SummaryCard>
// // //                   <ShoppingCart size={36} color={theme.colors.primary} />
// // //                   <div>
// // //                     <h3>Total Orders</h3>
// // //                     <p style={{ 
// // //                       fontWeight: 'bold', 
// // //                       fontSize: '1.5rem',
// // //                       color: theme.colors.primary
// // //                     }}>
// // //                       {salesSummary.salesCount}
// // //                     </p>
// // //                   </div>
// // //                 </SummaryCard>
// // //                 <SummaryCard>
// // //                   <TrendingUp size={36} color={theme.colors.accent.blue} />
// // //                   <div>
// // //                     <h3>Avg. Sale</h3>
// // //                     <p style={{ 
// // //                       fontWeight: 'bold', 
// // //                       fontSize: '1.5rem',
// // //                       color: theme.colors.accent.blue
// // //                     }}>
// // //                       ${salesSummary.averageSale.toFixed(2)}
// // //                     </p>
// // //                   </div>
// // //                 </SummaryCard>
// // //                 <SummaryCard>
// // //                   <Package size={36} color={theme.colors.accent.orange} />
// // //                   <div>
// // //                     <h3>Top Product</h3>
// // //                     <p style={{ 
// // //                       fontWeight: 'bold', 
// // //                       fontSize: '1.5rem',
// // //                       color: theme.colors.accent.orange
// // //                     }}>
// // //                       {salesSummary.topSellingProducts[0]?.[0] || 'N/A'}
// // //                     </p>
// // //                   </div>
// // //                 </SummaryCard>
// // //               </SummaryGrid>

// // //               <AdvancedTable>
// // //                 <TableHeader>
// // //                   <tr>
// // //                     <TableHeaderCell>Sale ID</TableHeaderCell>
// // //                     <TableHeaderCell>Total Amount</TableHeaderCell>
// // //                     <TableHeaderCell>Date & Time</TableHeaderCell>
// // //                     <TableHeaderCell>Products</TableHeaderCell>
// // //                     <TableHeaderCell>User Details</TableHeaderCell>
// // //                   </tr>
// // //                 </TableHeader>
// // //                 <tbody>
// // //                   {renderTableRows()}
// // //                 </tbody>
// // //               </AdvancedTable>
// // //             </DashboardCard>

// // //             <Modal 
// // //               isOpen={isFilterModalOpen} 
// // //               onClose={() => setIsFilterModalOpen(false)}
// // //               title="Advanced Filters"
// // //             >
// // //               <div style={{ 
// // //                 display: 'flex', 
// // //                 flexDirection: 'column', 
// // //                 gap: '1rem',
// // //                 padding: '1rem'
// // //               }}>
// // //                 <div>
// // //                   <label style={{ 
// // //                     display: 'block', 
// // //                     marginBottom: '0.5rem', 
// // //                     fontWeight: 'bold' 
// // //                   }}>
// // //                     Date Range
// // //                   </label>
// // //                   <input 
// // //                     type="date" 
// // //                     style={{
// // //                       width: '100%',
// // //                       padding: '0.5rem',
// // //                       borderRadius: '8px',
// // //                       border: '1px solid #e0e0e0'
// // //                     }}
// // //                     onChange={(e) => setFilters(prev => ({...prev, dateRange: e.target.value}))}
// // //                   />
// // //                 </div>
// // //                 <div>
// // //                   <label style={{ 
// // //                     display: 'block', 
// // //                     marginBottom: '0.5rem', 
// // //                     fontWeight: 'bold' 
// // //                   }}>
// // //                     Minimum Amount
// // //                   </label>
// // //                   <input 
// // //                     type="number" 
// // //                     placeholder="Minimum Sale Amount"
// // //                     style={{
// // //                       width: '100%',
// // //                       padding: '0.5rem',
// // //                       borderRadius: '8px',
// // //                       border: '1px solid #e0e0e0'
// // //                     }}
// // //                     onChange={(e) => setFilters(prev => ({...prev, minAmount: parseFloat(e.target.value)}))}
// // //                   />
// // //                 </div>
// // //                 <div>
// // //                   <label style={{ 
// // //                     display: 'block', 
// // //                     marginBottom: '0.5rem', 
// // //                     fontWeight: 'bold' 
// // //                   }}>
// // //                     User Role
// // //                   </label>
// // //                   <select 
// // //                     style={{
// // //                       width: '100%',
// // //                       padding: '0.5rem',
// // //                       borderRadius: '8px',
// // //                       border: '1px solid #e0e0e0'
// // //                     }}
// // //                     onChange={(e) => setFilters(prev => ({...prev, userRole: e.target.value}))}
// // //                   >
// // //                     <option value="">All Roles</option>
// // //                     <option value="admin">Admin</option>
// // //                     <option value="sales">Sales</option>
// // //                     <option value="manager">Manager</option>
// // //                   </select>
// // //                 </div>
// // //                 <div style={{ 
// // //                   display: 'flex', 
// // //                   justifyContent: 'space-between', 
// // //                   marginTop: '1rem' 
// // //                 }}>
// // //                   <button 
// // //                     onClick={() => setIsFilterModalOpen(false)}
// // //                     style={{
// // //                       padding: '0.5rem 1rem',
// // //                       background: '#f3f4f6',
// // //                       color: '#1f2937',
// // //                       border: '1px solid #e0e0e0',
// // //                       borderRadius: '8px'
// // //                     }}
// // //                   >
// // //                     Cancel
// // //                   </button>
// // //                   <button 
// // //                     onClick={() => {
// // //                       // Apply filters
// // //                       setIsFilterModalOpen(false);
// // //                     }}
// // //                     style={{
// // //                       padding: '0.5rem 1rem',
// // //                       background: theme.colors.primary,
// // //                       color: 'white',
// // //                       border: 'none',
// // //                       borderRadius: '8px'
// // //                     }}
// // //                   >
// // //                     Apply Filters
// // //                   </button>
// // //                 </div>
// // //               </div>
// // //             </Modal>

// // //           {/* New Visualization Section */}
// // //           <VisualizationGrid>
// // //             {renderUserSalesChart()}
// // //             {renderProductSalesPieChart()}
// // //             {renderDailySalesTrend()}
// // //           </VisualizationGrid>

// // //           {/* Rest of the existing component */}
// // //         </Container>
// // //       </>
// // //     </ThemeProvider>
// // //   );
// // // };

// // // export default UserSales;
// // import React, { useState, useEffect, useMemo } from "react";
// // import { useStore } from "./StoreContext";
// // import axios from "axios";
// // import styled, { createGlobalStyle, ThemeProvider } from "styled-components";
// // import * as XLSX from 'xlsx';
// // import { 
// //   Users, 
// //   ShoppingCart, 
// //   DollarSign, 
// //   Filter, 
// //   BarChart2, 
// //   TrendingUp, 
// //   Download, 
// //   Search,
// //   Clock,
// //   UserCheck,
// //   Package,
// //   Layers,
// //   X
// // } from 'lucide-react';
// // import { 
// //   BarChart, 
// //   Bar, 
// //   XAxis, 
// //   YAxis, 
// //   CartesianGrid, 
// //   Tooltip, 
// //   Legend, 
// //   PieChart, 
// //   Pie, 
// //   Cell, 
// //   ResponsiveContainer 
// // } from 'recharts';

// // // Theme Configuration
// // const theme = {
// //   colors: {
// //     primary: '#3b82f6',
// //     secondary: '#10b981',
// //     background: '#f3f4f6',
// //     text: {
// //       dark: '#1f2937',
// //       light: '#6b7280'
// //     },
// //     accent: {
// //       blue: '#6366f1',
// //       green: '#22c55e',
// //       red: '#ef4444',
// //       orange: '#f97316'
// //     }
// //   }
// // };

// // // Global Style
// // const GlobalStyle = createGlobalStyle`
// //   @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap');
  
// //   body {
// //     margin: 0;
// //     font-family: 'Inter', sans-serif;
// //     background: linear-gradient(135deg, #f4f6f9, #e9ecef);
// //     line-height: 1.6;
// //     color: #333;
// //   }

// //   .container {
// //     max-width: 1600px;
// //     margin: 0 auto;
// //     padding: 2rem;
// //     background: transparent;
// //   }

// //   .dashboard-card {
// //     background: white;
// //     border-radius: 16px;
// //     box-shadow: 0 20px 40px rgba(0,0,0,0.1);
// //     padding: 2rem;
// //     margin-bottom: 2rem;
// //   }

// //   .title {
// //     display: flex;
// //     align-items: center;
// //     gap: 1rem;
// //     font-size: 2.5rem;
// //     font-weight: 800;
// //     background: linear-gradient(to right, ${p => p.theme.colors.primary}, ${p => p.theme.colors.accent.blue});
// //     -webkit-background-clip: text;
// //     -webkit-text-fill-color: transparent;
// //   }

// //   .control-panel {
// //     display: flex;
// //     gap: 1rem;
// //     align-items: center;
// //     margin-bottom: 1rem;
// //   }

// //   .search-input {
// //     display: flex;
// //     align-items: center;
// //     background: white;
// //     border: 1px solid #e0e0e0;
// //     border-radius: 8px;
// //     padding: 0.5rem 1rem;
// //     box-shadow: 0 4px 6px rgba(0,0,0,0.1);

// //     input {
// //       border: none;
// //       outline: none;
// //       flex-grow: 1;
// //       margin-left: 0.5rem;
// //     }
// //   }

// //   .advanced-table {
// //     width: 100%;
// //     border-collapse: separate;
// //     border-spacing: 0 0.5rem;
// //     background: white;
// //     box-shadow: 0 15px 30px rgba(0,0,0,0.12);
// //     border-radius: 12px;
// //     overflow: hidden;
// //   }

// //   .table-header {
// //     background: linear-gradient(135deg, #3b82f6, #6366f1);
// //     color: white;
// //   }

// //   .table-header-cell {
// //     padding: 1.2rem;
// //     text-align: left;
// //     font-weight: 600;
// //     text-transform: uppercase;
// //     letter-spacing: 0.05em;
// //     font-size: 0.8rem;
// //   }

// //   .table-row {
// //     transition: all 0.3s ease;
// //     cursor: pointer;

// //     &:hover {
// //       background-color: #f3f4f6;
// //       transform: scale(1.01);
// //       box-shadow: 0 5px 15px rgba(0,0,0,0.1);
// //     }
// //   }

// //   .table-cell {
// //     padding: 1.2rem;
// //     border-bottom: 1px solid #eee;
// //     font-size: 0.9rem;
// //     color: #1f2937;
// //   }

// //   .badge {
// //     padding: 0.3rem 0.6rem;
// //     border-radius: 4px;
// //     font-size: 0.7rem;
// //     font-weight: 600;
// //     background: ${p => p.color || '#3b82f6'};
// //     color: white;
// //   }

// //   .summary-grid {
// //     display: grid;
// //     grid-template-columns: repeat(4, 1fr);
// //     gap: 1rem;
// //     margin-bottom: 2rem;
// //   }

// //   .summary-card {
// //     background: white;
// //     border-radius: 12px;
// //     padding: 1.5rem;
// //     display: flex;
// //     align-items: center;
// //     gap: 1rem;
// //     box-shadow: 0 10px 20px rgba(0,0,0,0.08);
// //   }

// //   @keyframes fadeIn {
// //     from { opacity: 0; transform: translateY(20px); }
// //     to { opacity: 1; transform: translateY(0); }
// //   }

// //   @keyframes chartAnimation {
// //     from { stroke-dashoffset: 1000; }
// //     to { stroke-dashoffset: 0; }
// //   }
// // `;

// // // Visualization Containers
// // const VisualizationGrid = styled.div`
// //   display: grid;
// //   grid-template-columns: repeat(2, 1fr);
// //   gap: 1.5rem;
// //   margin-top: 2rem;
// //   animation: fadeIn 0.7s ease-out;
// // `;

// // const VisualizationCard = styled.div`
// //   background: white;
// //   border-radius: 16px;
// //   box-shadow: 0 20px 40px rgba(0,0,0,0.1);
// //   padding: 1.5rem;
// //   transition: all 0.3s ease;

// //   &:hover {
// //     transform: translateY(-10px);
// //     box-shadow: 0 25px 50px rgba(0,0,0,0.15);
// //   }
// // `;

// // const Modal = ({ isOpen, onClose, children, title }) => {
// //   if (!isOpen) return null;

// //   return (
// //     <div style={{
// //       position: 'fixed',
// //       top: 0,
// //       left: 0,
// //       right: 0,
// //       bottom: 0,
// //       backgroundColor: 'rgba(0,0,0,0.5)',
// //       display: 'flex',
// //       justifyContent: 'center',
// //       alignItems: 'center',
// //       zIndex: 1000
// //     }}>
// //       <div style={{
// //         background: 'white',
// //         borderRadius: '16px',
// //         width: '500px',
// //         maxWidth: '90%',
// //         padding: '20px',
// //         boxShadow: '0 25px 50px rgba(0,0,0,0.1)'
// //       }}>
// //         <div style={{
// //           display: 'flex',
// //           justifyContent: 'space-between',
// //           alignItems: 'center',
// //           marginBottom: '20px',
// //           borderBottom: '1px solid #eee',
// //           paddingBottom: '10px'
// //         }}>
// //           <h2>{title}</h2>
// //           <button 
// //             onClick={onClose}
// //             style={{
// //               background: 'none',
// //               border: 'none',
// //               cursor: 'pointer'
// //             }}
// //           >
// //             <X size={24} />
// //           </button>
// //         </div>
// //         {children}
// //       </div>
// //     </div>
// //   );
// // };

// // const UserSales = () => {
// //   const { storeId } = useStore();
// //   const [sales, setSales] = useState([]);
// //   const [users, setUsers] = useState([]);
// //   const [loading, setLoading] = useState(true);
// //   const [searchTerm, setSearchTerm] = useState('');
// //   const [isFilterModalOpen, setIsFilterModalOpen] = useState(false);
// //   const [filters, setFilters] = useState({
// //     dateRange: null,
// //     minAmount: null,
// //     userRole: null
// //   });

// //   // Fetch data
// //   useEffect(() => {
// //     const fetchData = async () => {
// //       try {
// //         const [salesResponse, usersResponse] = await Promise.all([
// //           axios.get(`http://localhost:5010/api/daily-sales1`, { params: { storeId, ...filters } }),
// //           axios.get(`http://localhost:5010/api/users`, { params: { storeId } })
// //         ]);

// //         setSales(salesResponse.data);
// //         setUsers(usersResponse.data);
// //       } catch (error) {
// //         console.error("Data fetching error:", error);
// //       } finally {
// //         setLoading(false);
// //       }
// //     };

// //     fetchData();
// //   }, [storeId, filters]);

// //   // Compute advanced sales analysis
// //   const salesAnalysis = useMemo(() => {
// //     const userSalesBreakdown = users.map(user => {
// //       const userSales = sales.filter(sale => sale.user_id === user.id);
// //       const totalUserSales = userSales.reduce((sum, sale) => sum + sale.total_amount, 0);
// //       return {
// //         name: user.email,
// //         sales: totalUserSales,
// //         role: user.role
// //       };
// //     }).sort((a, b) => b.sales - a.sales);

// //     const productSalesDistribution = sales.reduce((acc, sale) => {
// //       sale.products.forEach(product => {
// //         const existing = acc.find(p => p.name === product.name);
// //         if (existing) {
// //           existing.sales += product.quantity;
// //         } else {
// //           acc.push({ name: product.name, sales: product.quantity });
// //         }
// //       });
// //       return acc;
// //     }, []).sort((a, b) => b.sales - a.sales);

// //     const dailySalesTrend = sales.reduce((acc, sale) => {
// //       const date = new Date(sale.date).toLocaleDateString();
// //       const existing = acc.find(d => d.date === date);
// //       if (existing) {
// //         existing.sales += sale.total_amount;
// //       } else {
// //         acc.push({ date, sales: sale.total_amount });
// //       }
// //       return acc;
// //     }, []).sort((a, b) => new Date(a.date) - new Date(b.date));

// //     return {
// //       userSalesBreakdown,
// //       productSalesDistribution,
// //       dailySalesTrend
// //     };
// //   }, [sales, users]);

// //   const salesSummary = useMemo(() => {
// //     const totalSales = sales.reduce((sum, sale) => sum + sale.total_amount, 0);
// //     const averageSale = totalSales / sales.length || 0;
// //     const topSellingProducts = sales.reduce((acc, sale) => {
// //       sale.products.forEach(product => {
// //         acc[product.name] = (acc[product.name] || 0) + product.quantity;
// //       });
// //       return acc;
// //     }, {});

// //     return {
// //       totalSales,
// //       averageSale,
// //       salesCount: sales.length,
// //       topSellingProducts: Object.entries(topSellingProducts)
// //         .sort((a, b) => b[1] - a[1])
// //         .slice(0, 3)
// //     };
// //   }, [sales]);

// //   const processedSales = useMemo(() => {
// //     return sales.filter(sale => 
// //       sale._id.toLowerCase().includes(searchTerm.toLowerCase()) ||
// //       sale.total_amount.toString().includes(searchTerm) ||
// //       users.find(user => user.id === sale.user_id)?.email.toLowerCase().includes(searchTerm.toLowerCase())
// //     );
// //   }, [sales, searchTerm, users]);

// //   const exportToExcel = () => {
// //     const worksheet = XLSX.utils.json_to_sheet(processedSales);
// //     const workbook = XLSX.utils.book_new();
// //     XLSX.utils.book_append_sheet(workbook, worksheet, "Sales");
// //     XLSX.writeFile(workbook, "sales_report.xlsx");
// //   };

// //   const renderTableRows = () => {
// //     return processedSales.map(sale => {
// //       const user = users.find(u => u.id === sale.user_id);
// //       const saleDate = new Date(sale.date);
      
// //       return (
// //         <tr className="table-row" key={sale._id}>
// //           <td className="table-cell">{sale._id}</td>
// //           <td className="table-cell">
// //             <span className="badge" style={{ backgroundColor: theme.colors.accent.green }}>
// //               ${sale.total_amount.toFixed(2)}
// //             </span>
// //           </td>
// //           <td className="table-cell">
// //             {saleDate.toLocaleDateString()}
// //             <div style={{ 
// //               color: theme.colors.text.light, 
// //               fontSize: '0.7rem', 
// //               display: 'flex', 
// //               alignItems: 'center',
// //               gap: '0.3rem'
// //             }}>
// //               <Clock size={12} /> {saleDate.toLocaleTimeString()}
// //             </div>
// //           </td>
// //           <td className="table-cell">
// //             {sale.products.map(p => `${p.name} (${p.quantity})`).join(', ')}
// //           </td>
// //           <td className="table-cell">
// //             {user ? user.email : "Unknown User"}
// //             <div style={{ 
// //               color: theme.colors.text.light, 
// //               fontSize: '0.7rem',
// //               display: 'flex',
// //               alignItems: 'center',
// //               gap: '0.3rem'
// //             }}>
// //               <UserCheck size={12} /> {user?.role || "No Role"}
// //             </div>
// //           </td>
// //         </tr>
// //       );
// //     });
// //   };

// //   const renderUserSalesChart = () => (
// //     <VisualizationCard>
// //       <h3>Sales by User</h3>
// //       <ResponsiveContainer width="100%" height={300}>
// //         <BarChart data={salesAnalysis.userSalesBreakdown}>
// //           <CartesianGrid strokeDasharray="3 3" />
// //           <XAxis dataKey="name" />
// //           <YAxis />
// //           <Tooltip />
// //           <Bar 
// //             dataKey="sales" 
// //             fill={theme.colors.primary} 
// //             animationBegin={0}
// //             animationDuration={1500}
// //           />
// //         </BarChart>
// //       </ResponsiveContainer>
// //     </VisualizationCard>
// //   );

// //   const renderProductSalesPieChart = () => (
// //     <VisualizationCard>
// //       <h3>Product Sales Distribution</h3>
// //       <ResponsiveContainer width="100%" height={300}>
// //         <PieChart>
// //           <Pie
// //             data={salesAnalysis.productSalesDistribution.slice(0, 5)}
// //             cx="50%"
// //             cy="50%"
// //             labelLine={false}
// //             outerRadius={80}
// //             fill={theme.colors.primary}
// //             dataKey="sales"
// //             nameKey="name"
// //           >
// //             {salesAnalysis.productSalesDistribution.slice(0, 5).map((entry, index) => (
// //               <Cell 
// //                 key={`cell-${index}`} 
// //                 fill={Object.values(theme.colors.accent)[index % 4]} 
// //               />
// //             ))}
// //           </Pie>
// //           <Tooltip />
// //           <Legend />
// //         </PieChart>
// //       </ResponsiveContainer>
// //     </VisualizationCard>
// //   );

// //   const renderDailySalesTrend = () => (
// //     <VisualizationCard>
// //       <h3>Daily Sales Trend</h3>
// //       <ResponsiveContainer width="100%" height={300}>
// //         <BarChart data={salesAnalysis.dailySalesTrend}>
// //           <CartesianGrid strokeDasharray="3 3" />
// //           <XAxis dataKey="date" />
// //           <YAxis />
// //           <Tooltip />
// //           <Bar 
// //             dataKey="sales" 
// //             fill={theme.colors.secondary} 
// //             animationBegin={0}
// //             animationDuration={1500}
// //           />
// //         </BarChart>
// //       </ResponsiveContainer>
// //     </VisualizationCard>
// //   );

// //   return (
// //     <ThemeProvider theme={theme}>
// //       <>
// //         <GlobalStyle />
// //         <div className="container">
// //           <div className="control-panel">
// //             <h2 className="title">
// //               <BarChart2 size={36} /> Sales Dashboard
// //             </h2>
// //             <div className="search-input">
// //               <Search size={16} color={theme.colors.primary} />
// //               <input 
// //                 type="text" 
// //                 placeholder="Search sales..." 
// //                 value={searchTerm}
// //                 onChange={(e) => setSearchTerm(e.target.value)}
// //               />
// //             </div>
// //             <button 
// //               onClick={() => setIsFilterModalOpen(true)}
// //               style={{ 
// //                 display: 'flex', 
// //                 alignItems: 'center', 
// //                 gap: '0.5rem',
// //                 padding: '0.5rem 1rem',
// //                 background: theme.colors.secondary,
// //                 color: 'white',
// //                 border: 'none',
// //                 borderRadius: '8px'
// //               }}
// //             >
// //               <Filter size={16} /> Filters
// //             </button>
// //             <button 
// //               onClick={exportToExcel} 
// //               style={{ 
// //                 display: 'flex', 
// //                 alignItems: 'center', 
// //                 gap: '0.5rem',
// //                 padding: '0.5rem 1rem',
// //                 background: theme.colors.accent.blue,
// //                 color: 'white',
// //                 border: 'none',
// //                 borderRadius: '8px'
// //               }}
// //             >
// //               <Download size={16} /> Export
// //             </button>
// //           </div>

// //           <div className="dashboard-card">
// //             <div className="summary-grid">
// //               <div className="summary-card">
// //                 <DollarSign size={36} color={theme.colors.accent.green} />
// //                 <div>
// //                   <h3>Total Sales</h3>
// //                   <p style={{ 
// //                     fontWeight: 'bold', 
// //                     fontSize: '1.5rem',
// //                     color: theme.colors.accent.green
// //                   }}>
// //                     ${salesSummary.totalSales.toFixed(2)}
// //                   </p>
// //                 </div>
// //               </div>
// //               <div className="summary-card">
// //                 <ShoppingCart size={36} color={theme.colors.primary} />
// //                 <div>
// //                   <h3>Total Orders</h3>
// //                   <p style={{ 
// //                     fontWeight: 'bold', 
// //                     fontSize: '1.5rem',
// //                     color: theme.colors.primary
// //                   }}>
// //                     {salesSummary.salesCount}
// //                   </p>
// //                 </div>
// //               </div>
// //               <div className="summary-card">
// //                 <TrendingUp size={36} color={theme.colors.accent.blue} />
// //                 <div>
// //                   <h3>Avg. Sale</h3>
// //                   <p style={{ 
// //                     fontWeight: 'bold', 
// //                     fontSize: '1.5rem',
// //                     color: theme.colors.accent.blue
// //                   }}>
// //                     ${salesSummary.averageSale.toFixed(2)}
// //                   </p>
// //                 </div>
// //               </div>
// //               <div className="summary-card">
// //                 <Package size={36} color={theme.colors.accent.orange} />
// //                 <div>
// //                   <h3>Top Product</h3>
// //                   <p style={{ 
// //                     fontWeight: 'bold', 
// //                     fontSize: '1.5rem',
// //                     color: theme.colors.accent.orange
// //                   }}>
// //                     {salesSummary.topSellingProducts[0]?.[0] || 'N/A'}
// //                   </p>
// //                 </div>
// //               </div>
// //             </div>

// //             <table className="advanced-table">
// //               <thead className="table-header">
// //                 <tr>
// //                   <th className="table-header-cell">Sale ID</th>
// //                   <th className="table-header-cell">Total Amount</th>
// //                   <th className="table-header-cell">Date & Time</th>
// //                   <th className="table-header-cell">Products</th>
// //                   <th className="table-header-cell">User Details</th>
// //                 </tr>
// //               </thead>
// //               <tbody>
// //                 {renderTableRows()}
// //               </tbody>
// //             </table>
// //           </div>

// //           <Modal 
// //             isOpen={isFilterModalOpen} 
// //             onClose={() => setIsFilterModalOpen(false)}
// //             title="Advanced Filters"
// //           >
// //             <div style={{ 
// //               display: 'flex', 
// //               flexDirection: 'column', 
// //               gap: '1rem',
// //               padding: '1rem'
// //             }}>
// //               <div>
// //                 <label style={{ 
// //                   display: 'block', 
// //                   marginBottom: '0.5rem', 
// //                   fontWeight: 'bold' 
// //                 }}>
// //                   Date Range
// //                 </label>
// //                 <input 
// //                   type="date" 
// //                   style={{
// //                     width: '100%',
// //                     padding: '0.5rem',
// //                     borderRadius: '8px',
// //                     border: '1px solid #e0e0e0'
// //                   }}
// //                   onChange={(e) => setFilters(prev => ({...prev, dateRange: e.target.value}))}
// //                 />
// //               </div>
// //               <div>
// //                 <label style={{ 
// //                   display: 'block', 
// //                   marginBottom: '0.5rem', 
// //                   fontWeight: 'bold' 
// //                 }}>
// //                   Minimum Amount
// //                 </label>
// //                 <input 
// //                   type="number" 
// //                   placeholder="Minimum Sale Amount"
// //                   style={{
// //                     width: '100%',
// //                     padding: '0.5rem',
// //                     borderRadius: '8px',
// //                     border: '1px solid #e0e0e0'
// //                   }}
// //                   onChange={(e) => setFilters(prev => ({...prev, minAmount: parseFloat(e.target.value)}))}
// //                 />
// //               </div>
// //               <div>
// //                 <label style={{ 
// //                   display: 'block', 
// //                   marginBottom: '0.5rem', 
// //                   fontWeight: 'bold' 
// //                 }}>
// //                   User Role
// //                 </label>
// //                 <select 
// //                   style={{
// //                     width: '100%',
// //                     padding: '0.5rem',
// //                     borderRadius: '8px',
// //                     border: '1px solid #e0e0e0'
// //                   }}
// //                   onChange={(e) => setFilters(prev => ({...prev, userRole: e.target.value}))}
// //                 >
// //                   <option value="">All Roles</option>
// //                   <option value="admin">Admin</option>
// //                   <option value="sales">Sales</option>
// //                   <option value="manager">Manager</option>
// //                 </select>
// //               </div>
// //               <div style={{ 
// //                 display: 'flex', 
// //                 justifyContent: 'space-between', 
// //                 marginTop: '1rem' 
// //               }}>
// //                 <button 
// //                   onClick={() => setIsFilterModalOpen(false)}
// //                   style={{
// //                     padding: '0.5rem 1rem',
// //                     background: '#f3f4f6',
// //                     color: '#1f2937',
// //                     border: '1px solid #e0e0e0',
// //                     borderRadius: '8px'
// //                   }}
// //                 >
// //                   Cancel
// //                 </button>
// //                 <button 
// //                   onClick={() => {
// //                     // Apply filters
// //                     setIsFilterModalOpen(false);
// //                   }}
// //                   style={{
// //                     padding: '0.5rem 1rem',
// //                     background: theme.colors.primary,
// //                     color: 'white',
// //                     border: 'none',
// //                     borderRadius: '8px'
// //                   }}
// //                 >
// //                   Apply Filters
// //                 </button>
// //               </div>
// //             </div>
// //           </Modal>

// //           <VisualizationGrid>
// //             {renderUserSalesChart()}
// //             {renderProductSalesPieChart()}
// //             {renderDailySalesTrend()}
// //           </VisualizationGrid>
// //         </div>
// //       </>
// //     </ThemeProvider>
// //   );
// // };

// // export default UserSales;

// // import React, { useState, useEffect, useMemo } from "react";
// // import { useStore } from "./StoreContext";
// // import axios from "axios";
// // import styled, { createGlobalStyle, ThemeProvider } from "styled-components";
// // import * as XLSX from 'xlsx';
// // import { 
// //   ShoppingCart, 
// //   DollarSign, 
// //   Filter, 
// //   BarChart2, 
// //   TrendingUp, 
// //   Download, 
// //   Search,
// //   Clock,
// //   UserCheck,
// //   Package,
// //   X
// // } from 'lucide-react';
// // import { 
// //   BarChart, 
// //   Bar, 
// //   XAxis, 
// //   YAxis, 
// //   CartesianGrid, 
// //   Tooltip, 
// //   Legend, 
// //   PieChart, 
// //   Pie, 
// //   Cell, 
// //   ResponsiveContainer,
// //   LineChart,
// //   Line
// // } from 'recharts';

// // // Theme Configuration
// // const theme = {
// //   colors: {
// //     primary: '#3b82f6',
// //     secondary: '#10b981',
// //     background: '#f3f4f6',
// //     text: {
// //       dark: '#1f2937',
// //       light: '#6b7280'
// //     },
// //     accent: {
// //       blue: '#6366f1',
// //       green: '#22c55e',
// //       red: '#ef4444',
// //       orange: '#f97316'
// //     }
// //   }
// // };

// // // Global Style
// // const GlobalStyle = createGlobalStyle`
// //   @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap');
  
// //   body {
// //     margin: 0;
// //     font-family: 'Inter', sans-serif;
// //     background: linear-gradient(135deg, #f4f6f9, #e9ecef);
// //     line-height: 1.6;
// //     color: #333;
// //   }

// //   .container {
// //     max-width: 1600px;
// //     margin: 0 auto;
// //     padding: 2rem;
// //     background: transparent;
// //   }

// //   .dashboard-card {
// //     background: white;
// //     border-radius: 16px;
// //     box-shadow: 0 20px 40px rgba(0,0,0,0.1);
// //     padding: 2rem;
// //     margin-bottom: 2rem;
// //   }

// //   .title {
// //     display: flex;
// //     align-items: center;
// //     gap: 1rem;
// //     font-size: 2.5rem;
// //     font-weight: 800;
// //     background: linear-gradient(to right, ${p => p.theme.colors.primary}, ${p => p.theme.colors.accent.blue});
// //     -webkit-background-clip: text;
// //     -webkit-text-fill-color: transparent;
// //   }

// //   .control-panel {
// //     display: flex;
// //     gap: 1rem;
// //     align-items: center;
// //     margin-bottom: 1rem;
// //   }

// //   .search-input {
// //     display: flex;
// //     align-items: center;
// //     background: white;
// //     border: 1px solid #e0e0e0;
// //     border-radius: 8px;
// //     padding: 0.5rem 1rem;
// //     box-shadow: 0 4px 6px rgba(0,0,0,0.1);

// //     input {
// //       border: none;
// //       outline: none;
// //       flex-grow: 1;
// //       margin-left: 0.5rem;
// //     }
// //   }

// //   .advanced-table {
// //     width: 100%;
// //     border-collapse: separate;
// //     border-spacing: 0 0.5rem;
// //     background: white;
// //     box-shadow: 0 15px 30px rgba(0,0,0,0.12);
// //     border-radius: 12px;
// //     overflow: hidden;
// //   }

// //   .table-header {
// //     background: linear-gradient(135deg, #3b82f6, #6366f1);
// //     color: white;
// //   }

// //   .table-header-cell {
// //     padding: 1.2rem;
// //     text-align: left;
// //     font-weight: 600;
// //     text-transform: uppercase;
// //     letter-spacing: 0.05em;
// //     font-size: 0.8rem;
// //   }

// //   .table-row {
// //     transition: all 0.3s ease;
// //     cursor: pointer;

// //     &:hover {
// //       background-color: #f3f4f6;
// //       transform: scale(1.01);
// //       box-shadow: 0 5px 15px rgba(0,0,0,0.1);
// //     }
// //   }

// //   .table-cell {
// //     padding: 1.2rem;
// //     border-bottom: 1px solid #eee;
// //     font-size: 0.9rem;
// //     color: #1f2937;
// //   }

// //   .badge {
// //     padding: 0.3rem 0.6rem;
// //     border-radius: 4px;
// //     font-size: 0.7rem;
// //     font-weight: 600;
// //     background: ${p => p.color || '#3b82f6'};
// //     color: white;
// //   }

// //   .summary-grid {
// //     display: grid;
// //     grid-template-columns: repeat(4, 1fr);
// //     gap: 1rem;
// //     margin-bottom: 2rem;
// //   }

// //   .summary-card {
// //     background: white;
// //     border-radius: 12px;
// //     padding: 1.5rem;
// //     display: flex;
// //     align-items: center;
// //     gap: 1rem;
// //     box-shadow: 0 10px 20px rgba(0,0,0,0.08);
// //   }

// //   @keyframes fadeIn {
// //     from { opacity: 0; transform: translateY(20px); }
// //     to { opacity: 1; transform: translateY(0); }
// //   }
// // `;

// // // Visualization Containers
// // const VisualizationGrid = styled.div`
// //   display: grid;
// //   grid-template-columns: repeat(2, 1fr);
// //   gap: 1.5rem;
// //   margin-top: 2rem;
// //   animation: fadeIn 0.7s ease-out;
// // `;

// // const VisualizationCard = styled.div`
// //   background: white;
// //   border-radius: 16px;
// //   box-shadow: 0 20px 40px rgba(0,0,0,0.1);
// //   padding: 1.5rem;
// //   transition: all 0.3s ease;

// //   &:hover {
// //     transform: translateY(-10px);
// //     box-shadow: 0 25px 50px rgba(0,0,0,0.15);
// //   }
// // `;

// // const Modal = ({ isOpen, onClose, children, title }) => {
// //   if (!isOpen) return null;

// //   return (
// //     <div style={{
// //       position: 'fixed',
// //       top: 0,
// //       left: 0,
// //       right: 0,
// //       bottom: 0,
// //       backgroundColor: 'rgba(0,0,0,0.5)',
// //       display: 'flex',
// //       justifyContent: 'center',
// //       alignItems: 'center',
// //       zIndex: 1000
// //     }}>
// //       <div style={{
// //         background: 'white',
// //         borderRadius: '16px',
// //         width: '500px',
// //         maxWidth: '90%',
// //         padding: '20px',
// //         boxShadow: '0 25px 50px rgba(0,0,0,0.1)'
// //       }}>
// //         <div style={{
// //           display: 'flex',
// //           justifyContent: 'space-between',
// //           alignItems: 'center',
// //           marginBottom: '20px',
// //           borderBottom: '1px solid #eee',
// //           paddingBottom: '10px'
// //         }}>
// //           <h2>{title}</h2>
// //           <button 
// //             onClick={onClose}
// //             style={{
// //               background: 'none',
// //               border: 'none',
// //               cursor: 'pointer'
// //             }}
// //           >
// //             <X size={24} />
// //           </button>
// //         </div>
// //         {children}
// //       </div>
// //     </div>
// //   );
// // };

// // const UserSales = () => {
// //   const { storeId } = useStore();
// //   const [sales, setSales] = useState([]);
// //   const [users, setUsers] = useState([]);
// //   const [loading, setLoading] = useState(true);
// //   const [searchTerm, setSearchTerm] = useState('');
// //   const [isFilterModalOpen, setIsFilterModalOpen] = useState(false);
// //   const [filters, setFilters] = useState({
// //     dateRange: null,
// //     minAmount: null,
// //     userRole: null
// //   });

// //   // Fetch data
// //   useEffect(() => {
// //     const fetchData = async () => {
// //       try {
// //         const [salesResponse, usersResponse] = await Promise.all([
// //           axios.get(`http://localhost:5010/api/daily-sales1`, { params: { storeId, ...filters } }),
// //           axios.get(`http://localhost:5010/api/users`, { params: { storeId } })
// //         ]);

// //         setSales(salesResponse.data);
// //         setUsers(usersResponse.data);
// //       } catch (error) {
// //         console.error("Data fetching error:", error);
// //       } finally {
// //         setLoading(false);
// //       }
// //     };

// //     fetchData();
// //   }, [storeId, filters]);

// //   // Compute advanced sales analysis
// //   const salesAnalysis = useMemo(() => {
// //     // User-wise sales breakdown
// //     const userSalesBreakdown = users.map(user => {
// //       const userSales = sales.filter(sale => sale.user_id === user.id);
// //       const totalUserSales = userSales.reduce((sum, sale) => sum + sale.total_amount, 0);
// //       return {
// //         userId: user.id,
// //         sales: totalUserSales,
// //         role: user.role
// //       };
// //     }).sort((a, b) => b.sales - a.sales);

// //     // Product sales distribution
// //     const productSalesDistribution = sales.reduce((acc, sale) => {
// //       sale.products.forEach(product => {
// //         const existing = acc.find(p => p.name === product.name);
// //         if (existing) {
// //           existing.sales += product.quantity;
// //         } else {
// //           acc.push({ name: product.name, sales: product.quantity });
// //         }
// //       });
// //       return acc;
// //     }, []).sort((a, b) => b.sales - a.sales);

// //     // Time-based sales trend
// //     const dailySalesTrend = sales.reduce((acc, sale) => {
// //       const date = new Date(sale.date).toLocaleDateString();
// //       const existing = acc.find(d => d.date === date);
// //       if (existing) {
// //         existing.sales += sale.total_amount;
// //       } else {
// //         acc.push({ date, sales: sale.total_amount });
// //       }
// //       return acc;
// //     }, []).sort((a, b) => new Date(a.date) - new Date(b.date));

// //     // Sales by role
// //     const salesByRole = users.reduce((acc, user) => {
// //       const userSales = sales.filter(sale => sale.user_id === user.id);
// //       const totalUserSales = userSales.reduce((sum, sale) => sum + sale.total_amount, 0);
// //       if (acc[user.role]) {
// //         acc[user.role] += totalUserSales;
// //       } else {
// //         acc[user.role] = totalUserSales;
// //       }
// //       return acc;
// //     }, {});

// //     return {
// //       userSalesBreakdown,
// //       productSalesDistribution,
// //       dailySalesTrend,
// //       salesByRole: Object.entries(salesByRole).map(([role, sales]) => ({ role, sales }))
// //     };
// //   }, [sales, users]);

// //   const salesSummary = useMemo(() => {
// //     const totalSales = sales.reduce((sum, sale) => sum + sale.total_amount, 0);
// //     const averageSale = totalSales / sales.length || 0;
// //     const topSellingProducts = sales.reduce((acc, sale) => {
// //       sale.products.forEach(product => {
// //         acc[product.name] = (acc[product.name] || 0) + product.quantity;
// //       });
// //       return acc;
// //     }, {});

// //     return {
// //       totalSales,
// //       averageSale,
// //       salesCount: sales.length,
// //       topSellingProducts: Object.entries(topSellingProducts)
// //         .sort((a, b) => b[1] - a[1])
// //         .slice(0, 3)
// //     };
// //   }, [sales]);

// //   const processedSales = useMemo(() => {
// //     return sales.filter(sale => 
// //       sale._id.toLowerCase().includes(searchTerm.toLowerCase()) ||
// //       sale.total_amount.toString().includes(searchTerm) ||
// //       users.find(user => user.id === sale.user_id)?.id.toString().includes(searchTerm)
// //     );
// //   }, [sales, searchTerm, users]);

// //   const exportToExcel = () => {
// //     const worksheet = XLSX.utils.json_to_sheet(processedSales);
// //     const workbook = XLSX.utils.book_new();
// //     XLSX.utils.book_append_sheet(workbook, worksheet, "Sales");
// //     XLSX.writeFile(workbook, "sales_report.xlsx");
// //   };

// //   const renderTableRows = () => {
// //     return processedSales.map(sale => {
// //       const user = users.find(u => u.id === sale.user_id);
// //       const saleDate = new Date(sale.date);
      
// //       return (
// //         <tr className="table-row" key={sale._id}>
// //           <td className="table-cell">{sale._id}</td>
// //           <td className="table-cell">
// //             <span className="badge" style={{ backgroundColor: theme.colors.accent.green }}>
// //               ${sale.total_amount.toFixed(2)}
// //             </span>
// //           </td>
// //           <td className="table-cell">
// //             {saleDate.toLocaleDateString()}
// //             <div style={{ 
// //               color: theme.colors.text.light, 
// //               fontSize: '0.7rem', 
// //               display: 'flex', 
// //               alignItems: 'center',
// //               gap: '0.3rem'
// //             }}>
// //               <Clock size={12} /> {saleDate.toLocaleTimeString()}
// //             </div>
// //           </td>
// //           <td className="table-cell">
// //             {sale.products.map(p => `${p.name} (${p.quantity})`).join(', ')}
// //           </td>
// //           <td className="table-cell">
// //             {user ? `User ID: ${user.id}` : "Unknown User"}
// //             <div style={{ 
// //               color: theme.colors.text.light, 
// //               fontSize: '0.7rem',
// //               display: 'flex',
// //               alignItems: 'center',
// //               gap: '0.3rem'
// //             }}>
// //               <UserCheck size={12} /> {user?.role || "No Role"}
// //             </div>
// //           </td>
// //         </tr>
// //       );
// //     });
// //   };

// //   const renderUserSalesChart = () => (
// //     <VisualizationCard>
// //       <h3>Sales by User</h3>
// //       <ResponsiveContainer width="100%" height={300}>
// //         <BarChart data={salesAnalysis.userSalesBreakdown}>
// //           <CartesianGrid strokeDasharray="3 3" />
// //           <XAxis dataKey="userId" />
// //           <YAxis />
// //           <Tooltip />
// //           <Bar 
// //             dataKey="sales" 
// //             fill={theme.colors.primary} 
// //             animationBegin={0}
// //             animationDuration={1500}
// //           />
// //         </BarChart>
// //       </ResponsiveContainer>
// //     </VisualizationCard>
// //   );

// //   const renderProductSalesPieChart = () => (
// //     <VisualizationCard>
// //       <h3>Product Sales Distribution</h3>
// //       <ResponsiveContainer width="100%" height={300}>
// //         <PieChart>
// //           <Pie
// //             data={salesAnalysis.productSalesDistribution.slice(0, 5)}
// //             cx="50%"
// //             cy="50%"
// //             labelLine={false}
// //             outerRadius={80}
// //             fill={theme.colors.primary}
// //             dataKey="sales"
// //             nameKey="name"
// //           >
// //             {salesAnalysis.productSalesDistribution.slice(0, 5).map((entry, index) => (
// //               <Cell 
// //                 key={`cell-${index}`} 
// //                 fill={Object.values(theme.colors.accent)[index % 4]} 
// //               />
// //             ))}
// //           </Pie>
// //           <Tooltip />
// //           <Legend />
// //         </PieChart>
// //       </ResponsiveContainer>
// //     </VisualizationCard>
// //   );

// //   const renderDailySalesTrend = () => (
// //     <VisualizationCard>
// //       <h3>Daily Sales Trend</h3>
// //       <ResponsiveContainer width="100%" height={300}>
// //         <LineChart data={salesAnalysis.dailySalesTrend}>
// //           <CartesianGrid strokeDasharray="3 3" />
// //           <XAxis dataKey="date" />
// //           <YAxis />
// //           <Tooltip />
// //           <Line 
// //             type="monotone" 
// //             dataKey="sales" 
// //             stroke={theme.colors.secondary} 
// //             strokeWidth={2}
// //             animationDuration={1500}
// //           />
// //         </LineChart>
// //       </ResponsiveContainer>
// //     </VisualizationCard>
// //   );

// //   const renderSalesByRoleChart = () => (
// //     <VisualizationCard>
// //       <h3>Sales by Role</h3>
// //       <ResponsiveContainer width="100%" height={300}>
// //         <PieChart>
// //           <Pie
// //             data={salesAnalysis.salesByRole}
// //             cx="50%"
// //             cy="50%"
// //             labelLine={false}
// //             outerRadius={80}
// //             fill={theme.colors.primary}
// //             dataKey="sales"
// //             nameKey="role"
// //           >
// //             {salesAnalysis.salesByRole.map((entry, index) => (
// //               <Cell 
// //                 key={`cell-${index}`} 
// //                 fill={Object.values(theme.colors.accent)[index % 4]} 
// //               />
// //             ))}
// //           </Pie>
// //           <Tooltip />
// //           <Legend />
// //         </PieChart>
// //       </ResponsiveContainer>
// //     </VisualizationCard>
// //   );

// //   return (
// //     <ThemeProvider theme={theme}>
// //       <>
// //         <GlobalStyle />
// //         <div className="container">
// //           <div className="control-panel">
// //             <h2 className="title">
// //               <BarChart2 size={36} /> Sales Dashboard
// //             </h2>
// //             <div className="search-input">
// //               <Search size={16} color={theme.colors.primary} />
// //               <input 
// //                 type="text" 
// //                 placeholder="Search sales..." 
// //                 value={searchTerm}
// //                 onChange={(e) => setSearchTerm(e.target.value)}
// //               />
// //             </div>
// //             <button 
// //               onClick={() => setIsFilterModalOpen(true)}
// //               style={{ 
// //                 display: 'flex', 
// //                 alignItems: 'center', 
// //                 gap: '0.5rem',
// //                 padding: '0.5rem 1rem',
// //                 background: theme.colors.secondary,
// //                 color: 'white',
// //                 border: 'none',
// //                 borderRadius: '8px'
// //               }}
// //             >
// //               <Filter size={16} /> Filters
// //             </button>
// //             <button 
// //               onClick={exportToExcel} 
// //               style={{ 
// //                 display: 'flex', 
// //                 alignItems: 'center', 
// //                 gap: '0.5rem',
// //                 padding: '0.5rem 1rem',
// //                 background: theme.colors.accent.blue,
// //                 color: 'white',
// //                 border: 'none',
// //                 borderRadius: '8px'
// //               }}
// //             >
// //               <Download size={16} /> Export
// //             </button>
// //           </div>

// //           <div className="dashboard-card">
// //             <div className="summary-grid">
// //               <div className="summary-card">
// //                 <DollarSign size={36} color={theme.colors.accent.green} />
// //                 <div>
// //                   <h3>Total Sales</h3>
// //                   <p style={{ 
// //                     fontWeight: 'bold', 
// //                     fontSize: '1.5rem',
// //                     color: theme.colors.accent.green
// //                   }}>
// //                     ${salesSummary.totalSales.toFixed(2)}
// //                   </p>
// //                 </div>
// //               </div>
// //               <div className="summary-card">
// //                 <ShoppingCart size={36} color={theme.colors.primary} />
// //                 <div>
// //                   <h3>Total Orders</h3>
// //                   <p style={{ 
// //                     fontWeight: 'bold', 
// //                     fontSize: '1.5rem',
// //                     color: theme.colors.primary
// //                   }}>
// //                     {salesSummary.salesCount}
// //                   </p>
// //                 </div>
// //               </div>
// //               <div className="summary-card">
// //                 <TrendingUp size={36} color={theme.colors.accent.blue} />
// //                 <div>
// //                   <h3>Avg. Sale</h3>
// //                   <p style={{ 
// //                     fontWeight: 'bold', 
// //                     fontSize: '1.5rem',
// //                     color: theme.colors.accent.blue
// //                   }}>
// //                     ${salesSummary.averageSale.toFixed(2)}
// //                   </p>
// //                 </div>
// //               </div>
// //               <div className="summary-card">
// //                 <Package size={36} color={theme.colors.accent.orange} />
// //                 <div>
// //                   <h3>Top Product</h3>
// //                   <p style={{ 
// //                     fontWeight: 'bold', 
// //                     fontSize: '1.5rem',
// //                     color: theme.colors.accent.orange
// //                   }}>
// //                     {salesSummary.topSellingProducts[0]?.[0] || 'N/A'}
// //                   </p>
// //                 </div>
// //               </div>
// //             </div>

// //             <table className="advanced-table">
// //               <thead className="table-header">
// //                 <tr>
// //                   <th className="table-header-cell">Sale ID</th>
// //                   <th className="table-header-cell">Total Amount</th>
// //                   <th className="table-header-cell">Date & Time</th>
// //                   <th className="table-header-cell">Products</th>
// //                   <th className="table-header-cell">User Details</th>
// //                 </tr>
// //               </thead>
// //               <tbody>
// //                 {renderTableRows()}
// //               </tbody>
// //             </table>
// //           </div>

// //           <Modal 
// //             isOpen={isFilterModalOpen} 
// //             onClose={() => setIsFilterModalOpen(false)}
// //             title="Advanced Filters"
// //           >
// //             <div style={{ 
// //               display: 'flex', 
// //               flexDirection: 'column', 
// //               gap: '1rem',
// //               padding: '1rem'
// //             }}>
// //               <div>
// //                 <label style={{ 
// //                   display: 'block', 
// //                   marginBottom: '0.5rem', 
// //                   fontWeight: 'bold' 
// //                 }}>
// //                   Date Range
// //                 </label>
// //                 <input 
// //                   type="date" 
// //                   style={{
// //                     width: '100%',
// //                     padding: '0.5rem',
// //                     borderRadius: '8px',
// //                     border: '1px solid #e0e0e0'
// //                   }}
// //                   onChange={(e) => setFilters(prev => ({...prev, dateRange: e.target.value}))}
// //                 />
// //               </div>
// //               <div>
// //                 <label style={{ 
// //                   display: 'block', 
// //                   marginBottom: '0.5rem', 
// //                   fontWeight: 'bold' 
// //                 }}>
// //                   Minimum Amount
// //                 </label>
// //                 <input 
// //                   type="number" 
// //                   placeholder="Minimum Sale Amount"
// //                   style={{
// //                     width: '100%',
// //                     padding: '0.5rem',
// //                     borderRadius: '8px',
// //                     border: '1px solid #e0e0e0'
// //                   }}
// //                   onChange={(e) => setFilters(prev => ({...prev, minAmount: parseFloat(e.target.value)}))}
// //                 />
// //               </div>
// //               <div>
// //                 <label style={{ 
// //                   display: 'block', 
// //                   marginBottom: '0.5rem', 
// //                   fontWeight: 'bold' 
// //                 }}>
// //                   User Role
// //                 </label>
// //                 <select 
// //                   style={{
// //                     width: '100%',
// //                     padding: '0.5rem',
// //                     borderRadius: '8px',
// //                     border: '1px solid #e0e0e0'
// //                   }}
// //                   onChange={(e) => setFilters(prev => ({...prev, userRole: e.target.value}))}
// //                 >
// //                   <option value="">All Roles</option>
// //                   <option value="admin">Admin</option>
// //                   <option value="sales">Sales</option>
// //                   <option value="manager">Manager</option>
// //                 </select>
// //               </div>
// //               <div style={{ 
// //                 display: 'flex', 
// //                 justifyContent: 'space-between', 
// //                 marginTop: '1rem' 
// //               }}>
// //                 <button 
// //                   onClick={() => setIsFilterModalOpen(false)}
// //                   style={{
// //                     padding: '0.5rem 1rem',
// //                     background: '#f3f4f6',
// //                     color: '#1f2937',
// //                     border: '1px solid #e0e0e0',
// //                     borderRadius: '8px'
// //                   }}
// //                 >
// //                   Cancel
// //                 </button>
// //                 <button 
// //                   onClick={() => {
// //                     // Apply filters
// //                     setIsFilterModalOpen(false);
// //                   }}
// //                   style={{
// //                     padding: '0.5rem 1rem',
// //                     background: theme.colors.primary,
// //                     color: 'white',
// //                     border: 'none',
// //                     borderRadius: '8px'
// //                   }}
// //                 >
// //                   Apply Filters
// //                 </button>
// //               </div>
// //             </div>
// //           </Modal>

// //           <VisualizationGrid>
// //             {renderUserSalesChart()}
// //             {renderProductSalesPieChart()}
// //             {renderDailySalesTrend()}
// //             {renderSalesByRoleChart()}
// //           </VisualizationGrid>
// //         </div>
// //       </>
// //     </ThemeProvider>
// //   );
// // };

// // export default UserSales;
// import React, { useState, useEffect, useMemo } from "react";
// import { useStore } from "./StoreContext";
// import axios from "axios";
// import styled, { createGlobalStyle, ThemeProvider } from "styled-components";
// import * as XLSX from "xlsx";
// import {
//   ShoppingCart,
//   DollarSign,
//   Filter,
//   BarChart2,
//   TrendingUp,
//   Download,
//   Search,
//   Clock,
//   UserCheck,
//   Package,
//   X,
// } from "lucide-react";
// import {
//   BarChart,
//   Bar,
//   XAxis,
//   YAxis,
//   CartesianGrid,
//   Tooltip,
//   Legend,
//   PieChart,
//   Pie,
//   Cell,
//   ResponsiveContainer,
//   LineChart,
//   Line,
// } from "recharts";

// // Theme Configuration
// const theme = {
//   colors: {
//     primary: "#3b82f6",
//     secondary: "#10b981",
//     background: "#f3f4f6",
//     text: {
//       dark: "#1f2937",
//       light: "#6b7280",
//     },
//     accent: {
//       blue: "#6366f1",
//       green: "#22c55e",
//       red: "#ef4444",
//       orange: "#f97316",
//     },
//   },
// };

// // Global Style
// const GlobalStyle = createGlobalStyle`
//   @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap');
  
//   body {
//     margin: 0;
//     font-family: 'Inter', sans-serif;
//     background: linear-gradient(135deg, #f4f6f9, #e9ecef);
//     line-height: 1.6;
//     color: #333;
//   }

//   .container {
//     max-width: 1600px;
//     margin: 0 auto;
//     padding: 2rem;
//     background: transparent;
//   }

//   .dashboard-card {
//     background: white;
//     border-radius: 16px;
//     box-shadow: 0 20px 40px rgba(0,0,0,0.1);
//     padding: 2rem;
//     margin-bottom: 2rem;
//   }

//   .title {
//     display: flex;
//     align-items: center;
//     gap: 1rem;
//     font-size: 2.5rem;
//     font-weight: 800;
//     background: linear-gradient(to right, ${p => p.theme.colors.primary}, ${p => p.theme.colors.accent.blue});
//     -webkit-background-clip: text;
//     -webkit-text-fill-color: transparent;
//   }

//   .control-panel {
//     display: flex;
//     gap: 1rem;
//     align-items: center;
//     margin-bottom: 1rem;
//   }

//   .search-input {
//     display: flex;
//     align-items: center;
//     background: white;
//     border: 1px solid #e0e0e0;
//     border-radius: 8px;
//     padding: 0.5rem 1rem;
//     box-shadow: 0 4px 6px rgba(0,0,0,0.1);

//     input {
//       border: none;
//       outline: none;
//       flex-grow: 1;
//       margin-left: 0.5rem;
//     }
//   }

//   .advanced-table {
//     width: 100%;
//     border-collapse: separate;
//     border-spacing: 0 0.5rem;
//     background: white;
//     box-shadow: 0 15px 30px rgba(0,0,0,0.12);
//     border-radius: 12px;
//     overflow: hidden;
//   }

//   .table-header {
//     background: linear-gradient(135deg, #3b82f6, #6366f1);
//     color: white;
//   }

//   .table-header-cell {
//     padding: 1.2rem;
//     text-align: left;
//     font-weight: 600;
//     text-transform: uppercase;
//     letter-spacing: 0.05em;
//     font-size: 0.8rem;
//   }

//   .table-row {
//     transition: all 0.3s ease;
//     cursor: pointer;

//     &:hover {
//       background-color: #f3f4f6;
//       transform: scale(1.01);
//       box-shadow: 0 5px 15px rgba(0,0,0,0.1);
//     }
//   }

//   .table-cell {
//     padding: 1.2rem;
//     border-bottom: 1px solid #eee;
//     font-size: 0.9rem;
//     color: #1f2937;
//   }

//   .badge {
//     padding: 0.3rem 0.6rem;
//     border-radius: 4px;
//     font-size: 0.7rem;
//     font-weight: 600;
//     background: ${p => p.color || "#3b82f6"};
//     color: white;
//   }

//   .summary-grid {
//     display: grid;
//     grid-template-columns: repeat(4, 1fr);
//     gap: 1rem;
//     margin-bottom: 2rem;
//   }

//   .summary-card {
//     background: white;
//     border-radius: 12px;
//     padding: 1.5rem;
//     display: flex;
//     align-items: center;
//     gap: 1rem;
//     box-shadow: 0 10px 20px rgba(0,0,0,0.08);
//   }

//   @keyframes fadeIn {
//     from { opacity: 0; transform: translateY(20px); }
//     to { opacity: 1; transform: translateY(0); }
//   }
// `;

// // Visualization Containers
// const VisualizationGrid = styled.div`
//   display: grid;
//   grid-template-columns: repeat(2, 1fr);
//   gap: 1.5rem;
//   margin-top: 2rem;
//   animation: fadeIn 0.7s ease-out;
// `;

// const VisualizationCard = styled.div`
//   background: white;
//   border-radius: 16px;
//   box-shadow: 0 20px 40px rgba(0,0,0,0.1);
//   padding: 1.5rem;
//   transition: all 0.3s ease;

//   &:hover {
//     transform: translateY(-10px);
//     box-shadow: 0 25px 50px rgba(0,0,0,0.15);
//   }
// `;

// const Modal = ({ isOpen, onClose, children, title }) => {
//   if (!isOpen) return null;

//   return (
//     <div
//       style={{
//         position: "fixed",
//         top: 0,
//         left: 0,
//         right: 0,
//         bottom: 0,
//         backgroundColor: "rgba(0,0,0,0.5)",
//         display: "flex",
//         justifyContent: "center",
//         alignItems: "center",
//         zIndex: 1000,
//       }}
//     >
//       <div
//         style={{
//           background: "white",
//           borderRadius: "16px",
//           width: "500px",
//           maxWidth: "90%",
//           padding: "20px",
//           boxShadow: "0 25px 50px rgba(0,0,0,0.1)",
//         }}
//       >
//         <div
//           style={{
//             display: "flex",
//             justifyContent: "space-between",
//             alignItems: "center",
//             marginBottom: "20px",
//             borderBottom: "1px solid #eee",
//             paddingBottom: "10px",
//           }}
//         >
//           <h2>{title}</h2>
//           <button
//             onClick={onClose}
//             style={{
//               background: "none",
//               border: "none",
//               cursor: "pointer",
//             }}
//           >
//             <X size={24} />
//           </button>
//         </div>
//         {children}
//       </div>
//     </div>
//   );
// };

// const UserSales = () => {
//   const { storeId } = useStore();
//   const [sales, setSales] = useState([]);
//   const [users, setUsers] = useState([]);
//   const [loading, setLoading] = useState(true);
//   const [searchTerm, setSearchTerm] = useState("");
//   const [isFilterModalOpen, setIsFilterModalOpen] = useState(false);
//   const [filters, setFilters] = useState({
//     dateRange: null,
//     minAmount: null,
//     userRole: null,
//   });

//   // Fetch data
//   useEffect(() => {
//     const fetchData = async () => {
//       try {
//         setLoading(true);
//         const [salesResponse, usersResponse] = await Promise.all([
//           axios.get(`http://localhost:5010/api/daily-sales1`, {
//             params: { storeId, date: filters.dateRange, ...filters },
//           }),
//           axios.get(`http://localhost:5010/api/users`, { params: { storeId } }),
//         ]);

//         // Validate sales data
//         const salesData = Array.isArray(salesResponse.data) ? salesResponse.data : [];
//         if (salesData.length > 0 && !salesData[0].id) {
//           console.warn("Sales data is missing 'id' field. Check backend response:", salesData);
//         }
//         setSales(salesData);

//         // Validate users data
//         const usersData = Array.isArray(usersResponse.data) ? usersResponse.data : [];
//         if (usersData.length > 0 && !usersData[0].id) {
//           console.warn("Users data is missing 'id' field. Check backend response:", usersData);
//         }
//         setUsers(usersData);
//       } catch (error) {
//         console.error("Data fetching error:", error);
//         setSales([]);
//         setUsers([]);
//       } finally {
//         setLoading(false);
//       }
//     };

//     fetchData();
//   }, [storeId, filters]);

//   // Compute advanced sales analysis
//   const salesAnalysis = useMemo(() => {
//     // User-wise sales breakdown
//     const userSalesBreakdown = users.map(user => {
//       const userSales = sales.filter(sale => sale.user_id === user.id);
//       const totalUserSales = userSales.reduce((sum, sale) => sum + (sale.total_amount || 0), 0);
//       return {
//         userId: user.id,
//         sales: totalUserSales,
//         role: user.role || "Unknown",
//       };
//     }).sort((a, b) => b.sales - a.sales);

//     // Product sales distribution
//     const productSalesDistribution = sales.reduce((acc, sale) => {
//       (sale.products || []).forEach(product => {
//         const existing = acc.find(p => p.name === product.name);
//         if (existing) {
//           existing.sales += product.quantity || 0;
//         } else {
//           acc.push({ name: product.name || "Unknown", sales: product.quantity || 0 });
//         }
//       });
//       return acc;
//     }, []).sort((a, b) => b.sales - a.sales);

//     // Time-based sales trend
//     const dailySalesTrend = sales.reduce((acc, sale) => {
//       const date = sale.date ? new Date(sale.date).toLocaleDateString() : "Unknown";
//       const existing = acc.find(d => d.date === date);
//       if (existing) {
//         existing.sales += sale.total_amount || 0;
//       } else {
//         acc.push({ date, sales: sale.total_amount || 0 });
//       }
//       return acc;
//     }, []).sort((a, b) => new Date(a.date) - new Date(b.date));

//     // Sales by role
//     const salesByRole = users.reduce((acc, user) => {
//       const userSales = sales.filter(sale => sale.user_id === user.id);
//       const totalUserSales = userSales.reduce((sum, sale) => sum + (sale.total_amount || 0), 0);
//       const role = user.role || "Unknown";
//       if (acc[role]) {
//         acc[role] += totalUserSales;
//       } else {
//         acc[role] = totalUserSales;
//       }
//       return acc;
//     }, {});

//     return {
//       userSalesBreakdown,
//       productSalesDistribution,
//       dailySalesTrend,
//       salesByRole: Object.entries(salesByRole).map(([role, sales]) => ({ role, sales })),
//     };
//   }, [sales, users]);

//   const salesSummary = useMemo(() => {
//     const totalSales = sales.reduce((sum, sale) => sum + (sale.total_amount || 0), 0);
//     const averageSale = sales.length ? totalSales / sales.length : 0;
//     const topSellingProducts = sales.reduce((acc, sale) => {
//       (sale.products || []).forEach(product => {
//         acc[product.name || "Unknown"] = (acc[product.name || "Unknown"] || 0) + (product.quantity || 0);
//       });
//       return acc;
//     }, {});

//     return {
//       totalSales,
//       averageSale,
//       salesCount: sales.length,
//       topSellingProducts: Object.entries(topSellingProducts)
//         .sort((a, b) => b[1] - a[1])
//         .slice(0, 3),
//     };
//   }, [sales]);

//   const processedSales = useMemo(() => {
//     return sales.filter(sale =>
//       (sale.id || "").toLowerCase().includes((searchTerm || "").toLowerCase()) ||
//       (sale.total_amount || 0).toString().includes(searchTerm || "") ||
//       (users.find(user => user.id === sale.user_id)?.id || "").toString().includes(searchTerm || "")
//     );
//   }, [sales, searchTerm, users]);

//   const exportToExcel = () => {
//     const worksheet = XLSX.utils.json_to_sheet(processedSales);
//     const workbook = XLSX.utils.book_new();
//     XLSX.utils.book_append_sheet(workbook, worksheet, "Sales");
//     XLSX.writeFile(workbook, "sales_report.xlsx");
//   };

//   const renderTableRows = () => {
//     return processedSales.map(sale => {
//       const user = users.find(u => u.id === sale.user_id);
//       const saleDate = sale.date ? new Date(sale.date) : new Date();

//       return (
//         <tr className="table-row" key={sale.id || "unknown-" + Math.random()}>
//           <td className="table-cell">{sale.id || "N/A"}</td>
//           <td className="table-cell">
//             <span className="badge" style={{ backgroundColor: theme.colors.accent.green }}>
//               ${(sale.total_amount || 0).toFixed(2)}
//             </span>
//           </td>
//           <td className="table-cell">
//             {saleDate.toLocaleDateString()}
//             <div
//               style={{
//                 color: theme.colors.text.light,
//                 fontSize: "0.7rem",
//                 display: "flex",
//                 alignItems: "center",
//                 gap: "0.3rem",
//               }}
//             >
//               <Clock size={12} /> {saleDate.toLocaleTimeString()}
//             </div>
//           </td>
//           <td className="table-cell">
//             {(sale.products || []).map(p => `${p.name || "Unknown"} (${p.quantity || 0})`).join(", ") || "No products"}
//           </td>
//           <td className="table-cell">
//             {user ? `User ID: ${user.id}` : "Unknown User"}
//             <div
//               style={{
//                 color: theme.colors.text.light,
//                 fontSize: "0.7rem",
//                 display: "flex",
//                 alignItems: "center",
//                 gap: "0.3rem",
//               }}
//             >
//               <UserCheck size={12} /> {user?.role || "No Role"}
//             </div>
//           </td>
//         </tr>
//       );
//     });
//   };

//   const renderUserSalesChart = () => (
//     <VisualizationCard>
//       <h3>Sales by User</h3>
//       <ResponsiveContainer width="100%" height={300}>
//         <BarChart data={salesAnalysis.userSalesBreakdown}>
//           <CartesianGrid strokeDasharray="3 3" />
//           <XAxis dataKey="userId" />
//           <YAxis />
//           <Tooltip />
//           <Bar
//             dataKey="sales"
//             fill={theme.colors.primary}
//             animationBegin={0}
//             animationDuration={1500}
//           />
//         </BarChart>
//       </ResponsiveContainer>
//     </VisualizationCard>
//   );

//   const renderProductSalesPieChart = () => (
//     <VisualizationCard>
//       <h3>Product Sales Distribution</h3>
//       <ResponsiveContainer width="100%" height={300}>
//         <PieChart>
//           <Pie
//             data={salesAnalysis.productSalesDistribution.slice(0, 5)}
//             cx="50%"
//             cy="50%"
//             labelLine={false}
//             outerRadius={80}
//             fill={theme.colors.primary}
//             dataKey="sales"
//             nameKey="name"
//           >
//             {salesAnalysis.productSalesDistribution.slice(0, 5).map((entry, index) => (
//               <Cell
//                 key={`cell-${index}`}
//                 fill={Object.values(theme.colors.accent)[index % 4]}
//               />
//             ))}
//           </Pie>
//           <Tooltip />
//           <Legend />
//         </PieChart>
//       </ResponsiveContainer>
//     </VisualizationCard>
//   );

//   const renderDailySalesTrend = () => (
//     <VisualizationCard>
//       <h3>Daily Sales Trend</h3>
//       <ResponsiveContainer width="100%" height={300}>
//         <LineChart data={salesAnalysis.dailySalesTrend}>
//           <CartesianGrid strokeDasharray="3 3" />
//           <XAxis dataKey="date" />
//           <YAxis />
//           <Tooltip />
//           <Line
//             type="monotone"
//             dataKey="sales"
//             stroke={theme.colors.secondary}
//             strokeWidth={2}
//             animationDuration={1500}
//           />
//         </LineChart>
//       </ResponsiveContainer>
//     </VisualizationCard>
//   );

//   const renderSalesByRoleChart = () => (
//     <VisualizationCard>
//       <h3>Sales by Role</h3>
//       <ResponsiveContainer width="100%" height={300}>
//         <PieChart>
//           <Pie
//             data={salesAnalysis.salesByRole}
//             cx="50%"
//             cy="50%"
//             labelLine={false}
//             outerRadius={80}
//             fill={theme.colors.primary}
//             dataKey="sales"
//             nameKey="role"
//           >
//             {salesAnalysis.salesByRole.map((entry, index) => (
//               <Cell
//                 key={`cell-${index}`}
//                 fill={Object.values(theme.colors.accent)[index % 4]}
//               />
//             ))}
//           </Pie>
//           <Tooltip />
//           <Legend />
//         </PieChart>
//       </ResponsiveContainer>
//     </VisualizationCard>
//   );

//   if (loading) {
//     return (
//       <ThemeProvider theme={theme}>
//         <>
//           <GlobalStyle />
//           <div className="container">
//             <div style={{ textAlign: "center", padding: "2rem" }}>
//               <h2>Loading...</h2>
//             </div>
//           </div>
//         </>
//       </ThemeProvider>
//     );
//   }

//   return (
//     <ThemeProvider theme={theme}>
//       <>
//         <GlobalStyle />
//         <div className="container">
//           <div className="control-panel">
//             <h2 className="title">
//               <BarChart2 size={36} /> Sales Dashboard
//             </h2>
//             <div className="search-input">
//               <Search size={16} color={theme.colors.primary} />
//               <input
//                 type="text"
//                 placeholder="Search sales..."
//                 value={searchTerm}
//                 onChange={e => setSearchTerm(e.target.value)}
//               />
//             </div>
//             <button
//               onClick={() => setIsFilterModalOpen(true)}
//               style={{
//                 display: "flex",
//                 alignItems: "center",
//                 gap: "0.5rem",
//                 padding: "0.5rem 1rem",
//                 background: theme.colors.secondary,
//                 color: "white",
//                 border: "none",
//                 borderRadius: "8px",
//               }}
//             >
//               <Filter size={16} /> Filters
//             </button>
//             <button
//               onClick={exportToExcel}
//               style={{
//                 display: "flex",
//                 alignItems: "center",
//                 gap: "0.5rem",
//                 padding: "0.5rem 1rem",
//                 background: theme.colors.accent.blue,
//                 color: "white",
//                 border: "none",
//                 borderRadius: "8px",
//               }}
//             >
//               <Download size={16} /> Export
//             </button>
//           </div>

//           <div className="dashboard-card">
//             <div className="summary-grid">
//               <div className="summary-card">
//                 <DollarSign size={36} color={theme.colors.accent.green} />
//                 <div>
//                   <h3>Total Sales</h3>
//                   <p
//                     style={{
//                       fontWeight: "bold",
//                       fontSize: "1.5rem",
//                       color: theme.colors.accent.green,
//                     }}
//                   >
//                     ${salesSummary.totalSales.toFixed(2)}
//                   </p>
//                 </div>
//               </div>
//               <div className="summary-card">
//                 <ShoppingCart size={36} color={theme.colors.primary} />
//                 <div>
//                   <h3>Total Orders</h3>
//                   <p
//                     style={{
//                       fontWeight: "bold",
//                       fontSize: "1.5rem",
//                       color: theme.colors.primary,
//                     }}
//                   >
//                     {salesSummary.salesCount}
//                   </p>
//                 </div>
//               </div>
//               <div className="summary-card">
//                 <TrendingUp size={36} color={theme.colors.accent.blue} />
//                 <div>
//                   <h3>Avg. Sale</h3>
//                   <p
//                     style={{
//                       fontWeight: "bold",
//                       fontSize: "1.5rem",
//                       color: theme.colors.accent.blue,
//                     }}
//                   >
//                     ${salesSummary.averageSale.toFixed(2)}
//                   </p>
//                 </div>
//               </div>
//               <div className="summary-card">
//                 <Package size={36} color={theme.colors.accent.orange} />
//                 <div>
//                   <h3>Top Product</h3>
//                   <p
//                     style={{
//                       fontWeight: "bold",
//                       fontSize: "1.5rem",
//                       color: theme.colors.accent.orange,
//                     }}
//                   >
//                     {salesSummary.topSellingProducts[0]?.[0] || "N/A"}
//                   </p>
//                 </div>
//               </div>
//             </div>

//             <table className="advanced-table">
//               <thead className="table-header">
//                 <tr>
//                   <th className="table-header-cell">Sale ID</th>
//                   <th className="table-header-cell">Total Amount</th>
//                   <th className="table-header-cell">Date & Time</th>
//                   <th className="table-header-cell">Products</th>
//                   <th className="table-header-cell">User Details</th>
//                 </tr>
//               </thead>
//               <tbody>{renderTableRows()}</tbody>
//             </table>
//           </div>

//           <Modal
//             isOpen={isFilterModalOpen}
//             onClose={() => setIsFilterModalOpen(false)}
//             title="Advanced Filters"
//           >
//             <div
//               style={{
//                 display: "flex",
//                 flexDirection: "column",
//                 gap: "1rem",
//                 padding: "1rem",
//               }}
//             >
//               <div>
//                 <label
//                   style={{
//                     display: "block",
//                     marginBottom: "0.5rem",
//                     fontWeight: "bold",
//                   }}
//                 >
//                   Date Range
//                 </label>
//                 <input
//                   type="date"
//                   style={{
//                     width: "100%",
//                     padding: "0.5rem",
//                     borderRadius: "8px",
//                     border: "1px solid #e0e0e0",
//                   }}
//                   onChange={e =>
//                     setFilters(prev => ({ ...prev, dateRange: e.target.value }))
//                   }
//                 />
//               </div>
//               <div>
//                 <label
//                   style={{
//                     display: "block",
//                     marginBottom: "0.5rem",
//                     fontWeight: "bold",
//                   }}
//                 >
//                   Minimum Amount
//                 </label>
//                 <input
//                   type="number"
//                   placeholder="Minimum Sale Amount"
//                   style={{
//                     width: "100%",
//                     padding: "0.5rem",
//                     borderRadius: "8px",
//                     border: "1px solid #e0e0e0",
//                   }}
//                   onChange={e =>
//                     setFilters(prev => ({
//                       ...prev,
//                       minAmount: parseFloat(e.target.value),
//                     }))
//                   }
//                 />
//               </div>
//               <div>
//                 <label
//                   style={{
//                     display: "block",
//                     marginBottom: "0.5rem",
//                     fontWeight: "bold",
//                   }}
//                 >
//                   User Role
//                 </label>
//                 <select
//                   style={{
//                     width: "100%",
//                     padding: "0.5rem",
//                     borderRadius: "8px",
//                     border: "1px solid #e0e0e0",
//                   }}
//                   onChange={e =>
//                     setFilters(prev => ({ ...prev, userRole: e.target.value }))
//                   }
//                 >
//                   <option value="">All Roles</option>
//                   <option value="admin">Admin</option>
//                   <option value="sales">Sales</option>
//                   <option value="manager">Manager</option>
//                 </select>
//               </div>
//               <div
//                 style={{
//                   display: "flex",
//                   justifyContent: "space-between",
//                   marginTop: "1rem",
//                 }}
//               >
//                 <button
//                   onClick={() => setIsFilterModalOpen(false)}
//                   style={{
//                     padding: "0.5rem 1rem",
//                     background: "#f3f4f6",
//                     color: "#1f2937",
//                     border: "1px solid #e0e0e0",
//                     borderRadius: "8px",
//                   }}
//                 >
//                   Cancel
//                 </button>
//                 <button
//                   onClick={() => {
//                     setIsFilterModalOpen(false);
//                   }}
//                   style={{
//                     padding: "0.5rem 1rem",
//                     background: theme.colors.primary,
//                     color: "white",
//                     border: "none",
//                     borderRadius: "8px",
//                   }}
//                 >
//                   Apply Filters
//                 </button>
//               </div>
//             </div>
//           </Modal>

//           <VisualizationGrid>
//             {renderUserSalesChart()}
//             {renderProductSalesPieChart()}
//             {renderDailySalesTrend()}
//             {renderSalesByRoleChart()}
//           </VisualizationGrid>
//         </div>
//       </>
//     </ThemeProvider>
//   );
// };

// export default UserSales;
import React, { useState, useEffect, useMemo } from "react";
import { useStore } from "./StoreContext";
import axios from "axios";
import styled, { createGlobalStyle, ThemeProvider } from "styled-components";
import * as XLSX from "xlsx";
import {
  ShoppingCart,
  DollarSign,
  Filter,
  BarChart2,
  TrendingUp,
  Download,
  Search,
  Clock,
  UserCheck,
  Package,
  X,
} from "lucide-react";
import {
  BarChart,
  Bar,
  XAxis,
  YAxis,
  CartesianGrid,
  Tooltip,
  Legend,
  PieChart,
  Pie,
  Cell,
  ResponsiveContainer,
  LineChart,
  Line,
} from "recharts";

// Theme Configuration
const theme = {
  colors: {
    primary: "#3b82f6",
    secondary: "#10b981",
    background: "#f3f4f6",
    text: {
      dark: "#1f2937",
      light: "#6b7280",
    },
    accent: {
      blue: "#6366f1",
      green: "#22c55e",
      red: "#ef4444",
      orange: "#f97316",
    },
  },
};

// Global Style
const GlobalStyle = createGlobalStyle`
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap');
  
  body {
    margin: 0;
    font-family: 'Inter', sans-serif;
    background: linear-gradient(135deg, #f4f6f9, #e9ecef);
    line-height: 1.6;
    color: #333;
  }

  .container {
    max-width: 1600px;
    margin: 0 auto;
    padding: 2rem;
    background: transparent;
  }

  .dashboard-card {
    background: white;
    border-radius: 16px;
    box-shadow: 0 20px 40px rgba(0,0,0,0.1);
    padding: 2rem;
    margin-bottom: 2rem;
  }

  .title {
    display: flex;
    align-items: center;
    gap: 1rem;
    font-size: 2.5rem;
    font-weight: 800;
    background: linear-gradient(to right, ${p => p.theme.colors.primary}, ${p => p.theme.colors.accent.blue});
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }

  .control-panel {
    display: flex;
    gap: 1rem;
    align-items: center;
    margin-bottom: 1rem;
  }

  .search-input {
    display: flex;
    align-items: center;
    background: white;
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    padding: 0.5rem 1rem;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);

    input {
      border: none;
      outline: none;
      flex-grow: 1;
      margin-left: 0.5rem;
    }
  }

  .advanced-table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0 0.5rem;
    background: white;
    box-shadow: 0 15px 30px rgba(0,0,0,0.12);
    border-radius: 12px;
    overflow: hidden;
  }

  .table-header {
    background: linear-gradient(135deg, #3b82f6, #6366f1);
    color: white;
  }

  .table-header-cell {
    padding: 1.2rem;
    text-align: left;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    font-size: 0.8rem;
  }

  .table-row {
    transition: all 0.3s ease;
    cursor: pointer;

    &:hover {
      background-color: #f3f4f6;
      transform: scale(1.01);
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
  }

  .table-cell {
    padding: 1.2rem;
    border-bottom: 1px solid #eee;
    font-size: 0.9rem;
    color: #1f2937;
  }

  .badge {
    padding: 0.3rem 0.6rem;
    border-radius: 4px;
    font-size: 0.7rem;
    font-weight: 600;
    background: ${p => p.color || "#3b82f6"};
    color: white;
  }

  .summary-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 1rem;
    margin-bottom: 2rem;
  }

  .summary-card {
    background: white;
    border-radius: 12px;
    padding: 1.5rem;
    display: flex;
    align-items: center;
    gap: 1rem;
    box-shadow: 0 10px 20px rgba(0,0,0,0.08);
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }
`;

// Visualization Containers
const VisualizationGrid = styled.div`
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 1.5rem;
  margin-top: 2rem;
  animation: fadeIn 0.7s ease-out;
`;

const VisualizationCard = styled.div`
  background: white;
  border-radius: 16px;
  box-shadow: 0 20px 40px rgba(0,0,0,0.1);
  padding: 1.5rem;
  transition: all 0.3s ease;

  &:hover {
    transform: translateY(-10px);
    box-shadow: 0 25px 50px rgba(0,0,0,0.15);
  }
`;

const Modal = ({ isOpen, onClose, children, title }) => {
  if (!isOpen) return null;

  return (
    <div
      style={{
        position: "fixed",
        top: 0,
        left: 0,
        right: 0,
        bottom: 0,
        backgroundColor: "rgba(0,0,0,0.5)",
        display: "flex",
        justifyContent: "center",
        alignItems: "center",
        zIndex: 1000,
      }}
    >
      <div
        style={{
          background: "white",
          borderRadius: "16px",
          width: "500px",
          maxWidth: "90%",
          padding: "20px",
          boxShadow: "0 25px 50px rgba(0,0,0,0.1)",
        }}
      >
        <div
          style={{
            display: "flex",
            justifyContent: "space-between",
            alignItems: "center",
            marginBottom: "20px",
            borderBottom: "1px solid #eee",
            paddingBottom: "10px",
          }}
        >
          <h2>{title}</h2>
          <button
            onClick={onClose}
            style={{
              background: "none",
              border: "none",
              cursor: "pointer",
            }}
          >
            <X size={24} />
          </button>
        </div>
        {children}
      </div>
    </div>
  );
};

const UserSales = () => {
  const { storeId } = useStore();
  const [sales, setSales] = useState([]);
  const [users, setUsers] = useState([]);
  const [loading, setLoading] = useState(true);
  const [searchTerm, setSearchTerm] = useState("");
  const [isFilterModalOpen, setIsFilterModalOpen] = useState(false);
  const [filters, setFilters] = useState({
    dateRange: null,
    minAmount: null,
    userRole: null,
  });

  // Fetch data
  useEffect(() => {
    const fetchData = async () => {
      try {
        setLoading(true);
        const [salesResponse, usersResponse] = await Promise.all([
          axios.get(`http://localhost:5010/api/daily-sales1`, {
            params: {
              storeId,
              date: filters.dateRange,
              minAmount: filters.minAmount,
              userRole: filters.userRole,
            },
          }),
          axios.get(`http://localhost:5010/api/users`, { params: { storeId } }),
        ]);

        // Validate and set sales data
        const salesData = Array.isArray(salesResponse.data) ? salesResponse.data : [];
        console.log("Sales data received:", salesData.slice(0, 2)); // Debug: Log first two sales
        setSales(salesData);

        // Validate and set users data
        const usersData = Array.isArray(usersResponse.data) ? usersResponse.data : [];
        console.log("Users data received:", usersData.slice(0, 2)); // Debug: Log first two users
        setUsers(usersData);
      } catch (error) {
        console.error("Data fetching error:", error);
        setSales([]);
        setUsers([]);
      } finally {
        setLoading(false);
      }
    };

    fetchData();
  }, [storeId, filters]);

  // Compute advanced sales analysis
  const salesAnalysis = useMemo(() => {
    // User-wise sales breakdown
    const userSalesBreakdown = users.map(user => {
      const userSales = sales.filter(sale => sale.user_id === user.id);
      const totalUserSales = userSales.reduce((sum, sale) => sum + (sale.total_amount || 0), 0);
      return {
        userId: user.id,
        sales: totalUserSales,
        role: user.role || "Unknown",
      };
    }).sort((a, b) => b.sales - a.sales);

    // Product sales distribution
    const productSalesDistribution = sales.reduce((acc, sale) => {
      (sale.products || []).forEach(product => {
        const existing = acc.find(p => p.name === product.name);
        if (existing) {
          existing.sales += product.quantity || 0;
        } else {
          acc.push({ name: product.name || "Unknown", sales: product.quantity || 0 });
        }
      });
      return acc;
    }, []).sort((a, b) => b.sales - a.sales);

    // Time-based sales trend
    const dailySalesTrend = sales.reduce((acc, sale) => {
      const date = sale.date ? new Date(sale.date).toLocaleDateString() : "Unknown";
      const existing = acc.find(d => d.date === date);
      if (existing) {
        existing.sales += sale.total_amount || 0;
      } else {
        acc.push({ date, sales: sale.total_amount || 0 });
      }
      return acc;
    }, []).sort((a, b) => new Date(a.date) - new Date(b.date));

    // Sales by role
    const salesByRole = users.reduce((acc, user) => {
      const userSales = sales.filter(sale => sale.user_id === user.id);
      const totalUserSales = userSales.reduce((sum, sale) => sum + (sale.total_amount || 0), 0);
      const role = user.role || "Unknown";
      if (totalUserSales > 0) {  // Only include roles with sales
        acc[role] = (acc[role] || 0) + totalUserSales;
      }
      return acc;
    }, {});

    const salesByRoleArray = Object.entries(salesByRole).map(([role, sales]) => ({ role, sales }));
    console.log("Sales by Role data:", salesByRoleArray); // Debug: Log sales by role

    return {
      userSalesBreakdown,
      productSalesDistribution,
      dailySalesTrend,
      salesByRole: salesByRoleArray,
    };
  }, [sales, users]);

  const salesSummary = useMemo(() => {
    const totalSales = sales.reduce((sum, sale) => sum + (sale.total_amount || 0), 0);
    const averageSale = sales.length ? totalSales / sales.length : 0;
    const topSellingProducts = sales.reduce((acc, sale) => {
      (sale.products || []).forEach(product => {
        acc[product.name || "Unknown"] = (acc[product.name || "Unknown"] || 0) + (product.quantity || 0);
      });
      return acc;
    }, {});

    return {
      totalSales,
      averageSale,
      salesCount: sales.length,
      topSellingProducts: Object.entries(topSellingProducts)
        .sort((a, b) => b[1] - a[1])
        .slice(0, 3),
    };
  }, [sales]);

  const processedSales = useMemo(() => {
    return sales.filter(sale =>
      (sale.id || "").toLowerCase().includes((searchTerm || "").toLowerCase()) ||
      (sale.total_amount || 0).toString().includes(searchTerm || "") ||
      (users.find(user => user.id === sale.user_id)?.id || "").toString().includes(searchTerm || "")
    );
  }, [sales, searchTerm, users]);

  const exportToExcel = () => {
    const worksheet = XLSX.utils.json_to_sheet(processedSales);
    const workbook = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(workbook, worksheet, "Sales");
    XLSX.writeFile(workbook, "sales_report.xlsx");
  };

  const renderTableRows = () => {
    return processedSales.map(sale => {
      const user = users.find(u => u.id === sale.user_id);
      const saleDate = sale.date ? new Date(sale.date) : new Date();

      return (
        <tr className="table-row" key={sale.id || "unknown-" + Math.random()}>
          <td className="table-cell">{sale.id || "N/A"}</td>
          <td className="table-cell">
            <span className="badge" style={{ backgroundColor: theme.colors.accent.green }}>
              ${(sale.total_amount || 0).toFixed(2)}
            </span>
          </td>
          <td className="table-cell">
            {saleDate.toLocaleDateString()}
            <div
              style={{
                color: theme.colors.text.light,
                fontSize: "0.7rem",
                display: "flex",
                alignItems: "center",
                gap: "0.3rem",
              }}
            >
              <Clock size={12} /> {saleDate.toLocaleTimeString()}
            </div>
          </td>
          <td className="table-cell">
            {(sale.products || []).map(p => `${p.name || "Unknown"} (${p.quantity || 0})`).join(", ") || "No products"}
          </td>
          <td className="table-cell">
            {user ? `User ID: ${user.id}` : "Unknown User"}
            <div
              style={{
                color: theme.colors.text.light,
                fontSize: "0.7rem",
                display: "flex",
                alignItems: "center",
                gap: "0.3rem",
              }}
            >
              <UserCheck size={12} /> {user?.role || "No Role"}
            </div>
          </td>
        </tr>
      );
    });
  };

  const renderUserSalesChart = () => (
    <VisualizationCard>
      <h3>Sales by User</h3>
      <ResponsiveContainer width="100%" height={300}>
        <BarChart data={salesAnalysis.userSalesBreakdown}>
          <CartesianGrid strokeDasharray="3 3" />
          <XAxis dataKey="userId" />
          <YAxis />
          <Tooltip />
          <Bar
            dataKey="sales"
            fill={theme.colors.primary}
            animationBegin={0}
            animationDuration={1500}
          />
        </BarChart>
      </ResponsiveContainer>
    </VisualizationCard>
  );

  const renderProductSalesPieChart = () => (
    <VisualizationCard>
      <h3>Product Sales Distribution</h3>
      <ResponsiveContainer width="100%" height={300}>
        <PieChart>
          <Pie
            data={salesAnalysis.productSalesDistribution.slice(0, 5)}
            cx="50%"
            cy="50%"
            labelLine={false}
            outerRadius={80}
            fill={theme.colors.primary}
            dataKey="sales"
            nameKey="name"
          >
            {salesAnalysis.productSalesDistribution.slice(0, 5).map((entry, index) => (
              <Cell
                key={`cell-${index}`}
                fill={Object.values(theme.colors.accent)[index % 4]}
              />
            ))}
          </Pie>
          <Tooltip />
          <Legend />
        </PieChart>
      </ResponsiveContainer>
    </VisualizationCard>
  );

  const renderDailySalesTrend = () => (
    <VisualizationCard>
      <h3>Daily Sales Trend</h3>
      <ResponsiveContainer width="100%" height={300}>
        <LineChart data={salesAnalysis.dailySalesTrend}>
          <CartesianGrid strokeDasharray="3 3" />
          <XAxis dataKey="date" />
          <YAxis />
          <Tooltip />
          <Line
            type="monotone"
            dataKey="sales"
            stroke={theme.colors.secondary}
            strokeWidth={2}
            animationDuration={1500}
          />
        </LineChart>
      </ResponsiveContainer>
    </VisualizationCard>
  );

  const renderSalesByRoleChart = () => {
    if (!salesAnalysis.salesByRole || salesAnalysis.salesByRole.length === 0) {
      return (
        <VisualizationCard>
          <h3>Sales by Role</h3>
          <div style={{ textAlign: "center", padding: "2rem" }}>
            <p>No sales data available by role.</p>
          </div>
        </VisualizationCard>
      );
    }

    return (
      <VisualizationCard>
        <h3>Sales by Role</h3>
        <ResponsiveContainer width="100%" height={300}>
          <PieChart>
            <Pie
              data={salesAnalysis.salesByRole}
              cx="50%"
              cy="50%"
              labelLine={false}
              outerRadius={80}
              fill={theme.colors.primary}
              dataKey="sales"
              nameKey="role"
            >
              {salesAnalysis.salesByRole.map((entry, index) => (
                <Cell
                  key={`cell-${index}`}
                  fill={Object.values(theme.colors.accent)[index % 4]}
                />
              ))}
            </Pie>
            <Tooltip />
            <Legend />
          </PieChart>
        </ResponsiveContainer>
      </VisualizationCard>
    );
  };

  if (loading) {
    return (
      <ThemeProvider theme={theme}>
        <>
          <GlobalStyle />
          <div className="container">
            <div style={{ textAlign: "center", padding: "2rem" }}>
              <h2>Loading...</h2>
            </div>
          </div>
        </>
      </ThemeProvider>
    );
  }

  return (
    <ThemeProvider theme={theme}>
      <>
        <GlobalStyle />
        <div className="container">
          <div className="control-panel">
            <h2 className="title">
              <BarChart2 size={36} /> Sales Dashboard
            </h2>
            <div className="search-input">
              <Search size={16} color={theme.colors.primary} />
              <input
                type="text"
                placeholder="Search sales..."
                value={searchTerm}
                onChange={e => setSearchTerm(e.target.value)}
              />
            </div>
            <button
              onClick={() => setIsFilterModalOpen(true)}
              style={{
                display: "flex",
                alignItems: "center",
                gap: "0.5rem",
                padding: "0.5rem 1rem",
                background: theme.colors.secondary,
                color: "white",
                border: "none",
                borderRadius: "8px",
              }}
            >
              <Filter size={16} /> Filters
            </button>
            <button
              onClick={exportToExcel}
              style={{
                display: "flex",
                alignItems: "center",
                gap: "0.5rem",
                padding: "0.5rem 1rem",
                background: theme.colors.accent.blue,
                color: "white",
                border: "none",
                borderRadius: "8px",
              }}
            >
              <Download size={16} /> Export
            </button>
          </div>

          <div className="dashboard-card">
            <div className="summary-grid">
              <div className="summary-card">
                <DollarSign size={36} color={theme.colors.accent.green} />
                <div>
                  <h3>Total Sales</h3>
                  <p
                    style={{
                      fontWeight: "bold",
                      fontSize: "1.5rem",
                      color: theme.colors.accent.green,
                    }}
                  >
                    ${salesSummary.totalSales.toFixed(2)}
                  </p>
                </div>
              </div>
              <div className="summary-card">
                <ShoppingCart size={36} color={theme.colors.primary} />
                <div>
                  <h3>Total Orders</h3>
                  <p
                    style={{
                      fontWeight: "bold",
                      fontSize: "1.5rem",
                      color: theme.colors.primary,
                    }}
                  >
                    {salesSummary.salesCount}
                  </p>
                </div>
              </div>
              <div className="summary-card">
                <TrendingUp size={36} color={theme.colors.accent.blue} />
                <div>
                  <h3>Avg. Sale</h3>
                  <p
                    style={{
                      fontWeight: "bold",
                      fontSize: "1.5rem",
                      color: theme.colors.accent.blue,
                    }}
                  >
                    ${salesSummary.averageSale.toFixed(2)}
                  </p>
                </div>
              </div>
              <div className="summary-card">
                <Package size={36} color={theme.colors.accent.orange} />
                <div>
                  <h3>Top Product</h3>
                  <p
                    style={{
                      fontWeight: "bold",
                      fontSize: "1.5rem",
                      color: theme.colors.accent.orange,
                    }}
                  >
                    {salesSummary.topSellingProducts[0]?.[0] || "N/A"}
                  </p>
                </div>
              </div>
            </div>

            <table className="advanced-table">
              <thead className="table-header">
                <tr>
                  <th className="table-header-cell">Sale ID</th>
                  <th className="table-header-cell">Total Amount</th>
                  <th className="table-header-cell">Date & Time</th>
                  <th className="table-header-cell">Products</th>
                  <th className="table-header-cell">User Details</th>
                </tr>
              </thead>
              <tbody>{renderTableRows()}</tbody>
            </table>
          </div>

          <Modal
            isOpen={isFilterModalOpen}
            onClose={() => setIsFilterModalOpen(false)}
            title="Advanced Filters"
          >
            <div
              style={{
                display: "flex",
                flexDirection: "column",
                gap: "1rem",
                padding: "1rem",
              }}
            >
              <div>
                <label
                  style={{
                    display: "block",
                    marginBottom: "0.5rem",
                    fontWeight: "bold",
                  }}
                >
                  Date Range
                </label>
                <input
                  type="date"
                  style={{
                    width: "100%",
                    padding: "0.5rem",
                    borderRadius: "8px",
                    border: "1px solid #e0e0e0",
                  }}
                  value={filters.dateRange || ""}
                  onChange={e =>
                    setFilters(prev => ({ ...prev, dateRange: e.target.value }))
                  }
                />
              </div>
              <div>
                <label
                  style={{
                    display: "block",
                    marginBottom: "0.5rem",
                    fontWeight: "bold",
                  }}
                >
                  Minimum Amount
                </label>
                <input
                  type="number"
                  placeholder="Minimum Sale Amount"
                  style={{
                    width: "100%",
                    padding: "0.5rem",
                    borderRadius: "8px",
                    border: "1px solid #e0e0e0",
                  }}
                  value={filters.minAmount || ""}
                  onChange={e =>
                    setFilters(prev => ({
                      ...prev,
                      minAmount: e.target.value ? parseFloat(e.target.value) : null,
                    }))
                  }
                />
              </div>
              <div>
                <label
                  style={{
                    display: "block",
                    marginBottom: "0.5rem",
                    fontWeight: "bold",
                  }}
                >
                  User Role
                </label>
                <select
                  style={{
                    width: "100%",
                    padding: "0.5rem",
                    borderRadius: "8px",
                    border: "1px solid #e0e0e0",
                  }}
                  value={filters.userRole || ""}
                  onChange={e =>
                    setFilters(prev => ({ ...prev, userRole: e.target.value || null }))
                  }
                >
                  <option value="">All Roles</option>
                  <option value="admin">Admin</option>
                  <option value="sales">Sales</option>
                  <option value="manager">Manager</option>
                </select>
              </div>
              <div
                style={{
                  display: "flex",
                  justifyContent: "space-between",
                  marginTop: "1rem",
                }}
              >
                <button
                  onClick={() => setIsFilterModalOpen(false)}
                  style={{
                    padding: "0.5rem 1rem",
                    background: "#f3f4f6",
                    color: "#1f2937",
                    border: "1px solid #e0e0e0",
                    borderRadius: "8px",
                  }}
                >
                  Cancel
                </button>
                <button
                  onClick={() => {
                    setIsFilterModalOpen(false);
                  }}
                  style={{
                    padding: "0.5rem 1rem",
                    background: theme.colors.primary,
                    color: "white",
                    border: "none",
                    borderRadius: "8px",
                  }}
                >
                  Apply Filters
                </button>
              </div>
            </div>
          </Modal>

          <VisualizationGrid>
            {renderUserSalesChart()}
            {renderProductSalesPieChart()}
            {renderDailySalesTrend()}
            {renderSalesByRoleChart()}
          </VisualizationGrid>
        </div>
      </>
    </ThemeProvider>
  );
};

export default UserSales;